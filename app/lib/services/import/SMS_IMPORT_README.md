# 短信导入功能使用指南

## 功能概述

短信导入功能可以自动读取手机中的支付短信，使用AI智能识别交易记录，并导入到记账本中。

## 使用步骤

### 1. 进入短信导入
- 打开"智能导入"页面
- 点击"短信导入"卡片

### 2. 配置导入参数
- **时间范围**：选择要读取的短信时间范围
  - 可以手动选择开始和结束日期
  - 或使用快捷按钮（最近7天/30天/90天）
  - 建议：首次使用选择较短时间范围（如7-30天）

- **过滤选项**：
  - 开启"仅读取支付相关短信"：只读取银行、支付宝、微信等支付平台的短信（推荐）
  - 关闭：读取所有短信，AI会自动过滤非交易内容（处理时间较长）

### 3. 授予权限
- 首次使用需要授予"短信读取"权限
- 点击"开始导入"后，系统会弹出权限请求
- 点击"允许"授予权限

### 4. 等待处理
导入过程分为三个阶段：
1. **读取短信**：从手机中读取指定时间范围的短信
2. **AI解析**：使用AI识别短信中的交易信息（金额、商户、日期等）
3. **检查重复**：与已有记录对比，标记可能重复的交易

### 5. 预览确认
- 处理完成后，会显示识别到的交易记录
- 可以查看、编辑、删除每条记录
- 确认无误后，点击"导入"完成

## 支持的短信来源

### 银行（17家）
- 工商银行 (95588)
- 农业银行 (95599)
- 建设银行 (95533)
- 中国银行 (95566)
- 招商银行 (95555)
- 中信银行 (95558)
- 光大银行 (95595)
- 交通银行 (95559)
- 民生银行 (95568)
- 浦发银行 (95501)
- 兴业银行 (95561)
- 华夏银行 (95577)
- 广发银行 (95508)
- 平安银行 (95511)
- 渤海银行 (95526)
- 浙商银行 (95527)
- 邮储银行 (95528)

### 支付平台
- 支付宝 / Alipay
- 微信支付 / WeChat / WeChatPay
- 财付通
- 京东金融
- 美团
- 拼多多
- 云闪付

## 常见问题

### Q: 为什么需要短信读取权限？
A: 短信导入功能需要读取您的短信内容以识别交易记录。我们承诺：
- 短信内容仅在本地处理
- 不会永久存储短信内容
- 仅用于识别交易记录

### Q: 短信内容会被上传到服务器吗？
A: 短信内容会发送到AI服务进行解析，但不会永久存储。解析完成后，短信内容会被丢弃。

### Q: 为什么没有找到交易记录？
A: 可能的原因：
- 该时间段内没有支付相关短信
- 短信已被删除
- 短信格式无法识别
- 开启了"仅读取支付相关短信"，但短信发件人不在支持列表中

建议：
- 尝试扩大时间范围
- 关闭"仅读取支付相关短信"过滤
- 使用文件导入功能

### Q: AI解析失败怎么办？
A: 可能的原因：
- 网络连接问题
- AI服务暂时不可用
- 短信格式过于复杂

建议：
- 检查网络连接
- 稍后重试
- 使用文件导入功能

### Q: 如何避免重复导入？
A: 系统会自动检查重复交易，标记可能重复的记录。在预览页面，您可以：
- 查看重复检测结果
- 手动取消勾选重复记录
- 系统会根据金额、日期、商户等信息判断重复

### Q: iOS支持短信导入吗？
A: 不支持。iOS系统不允许第三方应用读取短信内容。建议使用文件导入功能。

### Q: 处理时间很长怎么办？
A: 处理时间取决于：
- 时间范围长度
- 短信数量
- 网络速度

建议：
- 首次使用选择较短时间范围（7-30天）
- 开启"仅读取支付相关短信"过滤
- 确保网络连接稳定

## 隐私说明

### 数据处理
1. **本地读取**：短信从手机本地读取
2. **AI解析**：短信内容发送到AI服务进行解析
3. **结果返回**：只保存解析后的交易记录（金额、日期、商户等）
4. **短信丢弃**：原始短信内容不会永久存储

### 权限使用
- **短信读取权限**：仅用于读取短信内容
- **网络权限**：用于调用AI服务
- 不会访问其他敏感信息（通讯录、通话记录等）

### 安全保障
- 短信内容仅在导入过程中临时使用
- 不会上传到第三方服务器
- 不会与其他用户共享
- 可以随时在系统设置中撤销权限

## 技术架构

### 服务层
- **SmsReaderService**：负责读取短信
- **SmsParserService**：负责AI解析
- **SmsImportService**：协调整个导入流程
- **DuplicateScorer**：重复检测

### 数据流
```
用户选择时间范围
  ↓
SmsReaderService 读取短信
  ↓
SmsParserService AI解析（批量15条）
  ↓
转换为 ImportCandidate
  ↓
DuplicateScorer 检查重复
  ↓
ImportPreviewPage 预览确认
  ↓
BatchImportService 执行导入
```

### AI Prompt设计
- 结构化JSON输出
- 自动过滤非交易短信
- 智能分类推断
- 批量处理优化

## 更新日志

### v1.0.0 (2024-01-24)
- ✅ 初始版本发布
- ✅ 支持Android平台
- ✅ 支持17家银行 + 7个支付平台
- ✅ AI智能解析
- ✅ 自动重复检测
- ✅ 完整的错误处理
