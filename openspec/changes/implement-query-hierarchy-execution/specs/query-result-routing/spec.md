# 规范：查询结果路由

## 新增需求

### 需求：智能响应方式选择

系统必须根据查询复杂度自动选择合适的响应方式。

#### 场景：Level 1纯语音响应

**前置条件**：
- 查询复杂度评分 ≤ 1
- 查询结果为简单数值

**操作**：
- 系统生成语音文本
- 不显示任何UI组件

**预期结果**：
- 返回QueryResponse，level=simple
- 包含voiceText字段
- cardData和chartData为null
- TTS播放语音文本

**示例**：
- 输入："今天花了多少"
- 输出："今天花了156块，3笔"

#### 场景：Level 2语音+卡片响应

**前置条件**：
- 查询复杂度评分 2-4
- 查询结果包含占比、进度或对比数据

**操作**：
- 系统生成语音文本
- 构建轻量卡片数据

**预期结果**：
- 返回QueryResponse，level=medium
- 包含voiceText和cardData字段
- chartData为null
- TTS播放语音文本，同时显示卡片
- 卡片3秒后自动淡出

**示例**：
- 输入："餐饮这个月花了多少"
- 输出："餐饮2180，占了快三成，预算还剩320"
- 显示进度卡片

#### 场景：Level 3语音+图表响应

**前置条件**：
- 查询复杂度评分 ≥ 5
- 查询结果包含多个数据点或趋势数据

**操作**：
- 系统生成语音摘要
- 构建交互图表数据

**预期结果**：
- 返回QueryResponse，level=complex
- 包含voiceText和chartData字段
- cardData为null
- TTS播放语音摘要，同时显示图表
- 图表支持交互（点击查看明细）

**示例**：
- 输入："最近三个月的消费趋势"
- 输出："整体在下降，10月最高9800，这个月目前8400"
- 显示折线图

### 需求：语音文本生成

系统必须根据查询结果生成自然、友好的语音文本。

#### 场景：简单统计文本生成

**前置条件**：
- 查询类型为summary或statistics

**操作**：
- 系统根据查询结果生成文本

**预期结果**：
- 文本包含时间段、金额、笔数
- 语言自然流畅

**模板**：
- "{时间段}您一共花费了{金额}元"
- "{时间段}您花费了{支出}元，收入{收入}元"
- "{时间段}有{笔数}笔记录"

#### 场景：趋势分析文本生成

**前置条件**：
- 查询类型为trend

**操作**：
- 系统分析趋势并生成摘要

**预期结果**：
- 文本描述趋势方向（上升/下降/平稳）
- 提及最高点和最低点

**模板**：
- "整体在{上升/下降}，{月份}最高{金额}，{月份}最低{金额}"

## 相关功能

- 依赖：[query-complexity-analysis](../query-complexity-analysis/spec.md) - 获取复杂度评分
- 关联：[lightweight-query-card](../lightweight-query-card/spec.md) - Level 2卡片数据构建
- 关联：[interactive-query-chart](../interactive-query-chart/spec.md) - Level 3图表数据构建
