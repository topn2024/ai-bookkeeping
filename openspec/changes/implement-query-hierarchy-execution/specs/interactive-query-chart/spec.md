# 规范：交互式查询图表

## 新增需求

### 需求：交互图表组件

系统必须提供交互式图表组件，用于Level 3复杂查询响应。

#### 场景：折线图显示（趋势分析）

**前置条件**：
- 查询类型为trend
- 复杂度判定为Level 3
- 数据点 ≥ 3个

**操作**：
- 系统构建折线图数据
- 显示InteractiveQueryChart组件

**预期结果**：
- 显示折线图
- X轴显示时间标签
- Y轴显示金额
- 支持点击数据点查看详情
- 支持缩放和平移

**示例**：
- 查询："最近三个月的消费趋势"
- 图表显示：10月、11月、12月的折线图

#### 场景：柱状图显示（分类对比）

**前置条件**：
- 查询包含分类维度
- 复杂度判定为Level 3
- 需要对比多个分类

**操作**：
- 系统构建柱状图数据
- 显示InteractiveQueryChart组件

**预期结果**：
- 显示柱状图
- X轴显示分类名称
- Y轴显示金额
- 支持点击柱子查看详情

**示例**：
- 查询："各分类本月支出对比"
- 图表显示：餐饮、交通、购物等分类的柱状图

#### 场景：饼图显示（占比分布）

**前置条件**：
- 查询类型为distribution
- 复杂度判定为Level 3
- 需要显示占比

**操作**：
- 系统构建饼图数据
- 显示InteractiveQueryChart组件

**预期结果**：
- 显示饼图
- 每个扇区显示分类名称和占比
- 支持点击扇区查看详情

**示例**：
- 查询："各分类占比分布"
- 图表显示：餐饮29%、交通18%、购物15%等

### 需求：图表交互功能

图表必须支持用户交互，提供更详细的信息。

#### 场景：点击数据点查看详情

**前置条件**：
- 图表已显示

**操作**：
- 用户点击数据点/柱子/扇区

**预期结果**：
- 显示详情弹窗
- 包含该数据点的详细信息（金额、笔数、时间等）
- 支持跳转到交易列表查看明细

#### 场景：图表缩放和平移

**前置条件**：
- 折线图或柱状图已显示
- 数据点较多

**操作**：
- 用户双指缩放或拖动图表

**预期结果**：
- 图表支持缩放
- 图表支持平移
- 缩放和平移流畅

### 需求：图表性能优化

图表必须保持流畅的渲染性能。

#### 场景：数据点采样

**前置条件**：
- 查询结果数据点 > 1000个

**操作**：
- 系统对数据点进行采样

**预期结果**：
- 采样后数据点 ≤ 1000个
- 保持数据趋势不变
- 图表渲染流畅（60fps）

#### 场景：懒加载

**前置条件**：
- 图表数据量较大

**操作**：
- 用户滚动或缩放图表

**预期结果**：
- 只渲染可见区域的数据
- 滚动时动态加载数据
- 不卡顿

## 相关功能

- 依赖：[query-result-routing](../query-result-routing/spec.md) - 接收图表数据
- 关联：[query-complexity-analysis](../query-complexity-analysis/spec.md) - Level 3判定
- 关联：[custom-sql-query](../custom-sql-query/spec.md) - 复杂查询数据源
