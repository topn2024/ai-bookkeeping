# 实施任务清单

## 1. 准备工作
- [ ] 1.1 研究Flutter短信读取方案，选择合适的依赖包（如sms_advanced或telephony）
- [ ] 1.2 在pubspec.yaml中添加短信读取依赖
- [ ] 1.3 在AndroidManifest.xml中声明READ_SMS权限
- [ ] 1.4 设计短信解析的AI Prompt模板

## 2. 核心服务实现
- [ ] 2.1 创建SmsReaderService服务类
  - [ ] 2.1.1 实现权限检查和申请逻辑
  - [ ] 2.1.2 实现按时间范围读取短信功能
  - [ ] 2.1.3 实现短信发件人过滤（银行、支付宝、微信等）
  - [ ] 2.1.4 实现分页加载机制
- [ ] 2.2 创建SmsParserService服务类
  - [ ] 2.2.1 实现调用AI服务解析短信内容
  - [ ] 2.2.2 实现批量解析优化（合并多条短信一次调用）
  - [ ] 2.2.3 实现解析结果转换为ImportCandidate格式
  - [ ] 2.2.4 实现解析失败重试机制
  - [ ] 2.2.5 添加解析进度回调

## 3. 集成到导入流程
- [ ] 3.1 在BatchImportService中集成短信导入流程
  - [ ] 3.1.1 添加importFromSms方法
  - [ ] 3.1.2 复用现有的重复检测逻辑（DuplicateScorer）
  - [ ] 3.1.3 复用现有的分类识别逻辑
- [ ] 3.2 确保短信导入的ImportCandidate与文件导入格式一致

## 4. UI界面开发
- [ ] 4.1 在SmartImportPage中添加"短信导入"按钮
  - [ ] 4.1.1 设计按钮样式和图标
  - [ ] 4.1.2 添加平台检测（iOS显示不可用提示）
- [ ] 4.2 创建SmsImportConfigPage配置页面
  - [ ] 4.2.1 实现时间范围选择器（起始日期、结束日期）
  - [ ] 4.2.2 显示预计读取的短信数量
  - [ ] 4.2.3 添加权限申请引导
- [ ] 4.3 创建SmsImportProgressPage进度页面
  - [ ] 4.3.1 显示短信读取进度
  - [ ] 4.3.2 显示AI解析进度
  - [ ] 4.3.3 显示重复检测进度
  - [ ] 4.3.4 支持取消操作
- [ ] 4.4 复用ImportPreviewPage进行预览确认
  - [ ] 4.4.1 确保ImportCandidate格式与文件导入一致
  - [ ] 4.4.2 设置source字段为"短信导入"
  - [ ] 4.4.3 在sourceNote中保留原始短信内容
  - [ ] 4.4.4 验证所有预览功能正常（筛选、编辑、批量操作）
  - [ ] 4.4.5 测试用户修改解析结果的流程

## 5. 错误处理和用户体验
- [ ] 5.1 实现权限被拒绝的友好提示和引导
- [ ] 5.2 实现网络异常的错误提示和重试
- [ ] 5.3 实现AI解析失败的降级处理
- [ ] 5.4 添加短信导入使用说明和帮助文档
- [ ] 5.5 实现导入历史记录（标记来源为"短信导入"）

## 6. 测试
- [ ] 6.1 单元测试
  - [ ] 6.1.1 测试SmsReaderService的权限检查逻辑
  - [ ] 6.1.2 测试SmsParserService的解析逻辑
  - [ ] 6.1.3 测试时间范围筛选功能
- [ ] 6.2 集成测试
  - [ ] 6.2.1 测试完整的短信导入流程
  - [ ] 6.2.2 测试重复检测功能
  - [ ] 6.2.3 测试大量短信的性能
- [ ] 6.3 手动测试
  - [ ] 6.3.1 在真实Android设备上测试权限申请
  - [ ] 6.3.2 测试各种银行和支付平台的短信格式
  - [ ] 6.3.3 测试iOS平台的提示信息
  - [ ] 6.3.4 测试边界情况（无短信、权限拒绝等）
  - [ ] 6.3.5 测试预览页面的所有功能（筛选、编辑、批量操作）
  - [ ] 6.3.6 测试用户修改解析错误的记录并成功导入

## 7. 文档和发布
- [ ] 7.1 更新用户使用文档，说明短信导入功能
- [ ] 7.2 添加隐私政策说明（短信权限用途）
- [ ] 7.3 准备功能演示视频或截图
- [ ] 7.4 更新版本发布说明
