# 移除传统预算系统任务清单

## 任务概述

本文档列出了移除传统预算系统的所有任务，每个任务都是可验证的小型工作项。

---

## 阶段1：代码分析和准备

### 1.1 分析传统预算相关代码

- [ ] **任务1.1.1**: 搜索所有引用 `Budget` 模型的文件
  - 使用 `grep -r "import.*budget.dart" app/lib/`
  - 列出所有引用文件
  - **验证**: 生成完整的文件清单

- [ ] **任务1.1.2**: 搜索所有引用 `budgetProvider` 的代码
  - 使用 `grep -r "budgetProvider" app/lib/`
  - 列出所有引用位置
  - **验证**: 生成完整的引用清单

- [ ] **任务1.1.3**: 搜索所有传统预算相关的页面
  - 查找包含 "budget" 但不包含 "vault" 的页面文件
  - 列出所有页面
  - **验证**: 生成页面清单

- [ ] **任务1.1.4**: 搜索所有传统预算相关的 Service
  - 查找 `services/` 目录下的预算相关文件
  - 区分传统预算和零基预算
  - **验证**: 生成 Service 清单

- [ ] **任务1.1.5**: 创建删除清单文档
  - 汇总所有需要删除的文件
  - 汇总所有需要修改的文件
  - **验证**: 清单完整准确

---

## 阶段2：数据层清理

### 2.1 删除数据表

- [ ] **任务2.1.1**: 备份数据库
  - 创建数据库备份
  - 验证备份完整性
  - **验证**: 备份文件存在且可恢复

- [ ] **任务2.1.2**: 删除 `budgets` 表
  - 在数据库迁移中添加 DROP TABLE 语句
  - 更新数据库版本号
  - **验证**: 表删除成功

- [ ] **任务2.1.3**: 删除 `budget_carryovers` 表
  - 在数据库迁移中添加 DROP TABLE 语句
  - **验证**: 表删除成功

- [ ] **任务2.1.4**: 删除 `zero_based_allocations` 表（如果存在）
  - 检查表是否存在
  - 如果存在则删除
  - **验证**: 表删除成功或不存在

- [ ] **任务2.1.5**: 更新数据库版本
  - 更新 `_databaseVersion` 常量
  - 在 `_onUpgrade` 中添加迁移逻辑
  - **验证**: 数据库升级成功

### 2.2 删除模型

- [ ] **任务2.2.1**: 删除 `app/lib/models/budget.dart`
  - 删除文件
  - **验证**: 文件不存在

- [ ] **任务2.2.2**: 删除 Budget 相关的枚举
  - 检查 `BudgetPeriod` 是否被 BudgetVault 使用
  - 如果不使用则删除
  - **验证**: 枚举删除或保留正确

- [ ] **任务2.2.3**: 删除 Budget 相关的类型定义
  - 删除 `BudgetType` 枚举
  - 删除 `BudgetCarryover` 类
  - 删除 `ZeroBasedAllocation` 类
  - **验证**: 类型定义删除

---

## 阶段3：业务层清理

### 3.1 删除 Provider

- [ ] **任务3.1.1**: 删除 `app/lib/providers/budget_provider.dart`
  - 删除文件
  - **验证**: 文件不存在

- [ ] **任务3.1.2**: 删除 `app/lib/providers/zero_based_budget_provider.dart`
  - 检查是否是传统预算相关
  - 如果是则删除
  - **验证**: 文件删除或保留正确

- [ ] **任务3.1.3**: 更新 Provider 注册
  - 从 `service_providers.dart` 中移除传统预算 Provider
  - 从 `main.dart` 中移除相关注册
  - **验证**: 编译通过

### 3.2 删除 Service

- [ ] **任务3.2.1**: 删除 `app/lib/services/smart_budget_service.dart`
  - 删除文件
  - **验证**: 文件不存在

- [ ] **任务3.2.2**: 删除 `app/lib/services/adaptive_budget_service.dart`
  - 删除文件
  - **验证**: 文件不存在

- [ ] **任务3.2.3**: 删除 `app/lib/services/budget_carryover_service.dart`
  - 删除文件
  - **验证**: 文件不存在

- [ ] **任务3.2.4**: 删除 `app/lib/services/budget_alert_service.dart`
  - 检查是否被小金库使用
  - 如果不使用则删除
  - **验证**: 文件删除或保留正确

- [ ] **任务3.2.5**: 删除 `app/lib/services/budget_planning_coordinator.dart`
  - 删除文件
  - **验证**: 文件不存在

- [ ] **任务3.2.6**: 删除 `app/lib/services/budget_habit_integration.dart`
  - 删除文件
  - **验证**: 文件不存在

- [ ] **任务3.2.7**: 删除 `app/lib/services/budget_money_age_integration.dart`
  - 删除文件
  - **验证**: 文件不存在

- [ ] **任务3.2.8**: 删除 `app/lib/services/budget/` 目录下的传统预算相关文件
  - 删除 `budget_suggestion_engine.dart`（如果只用于传统预算）
  - 删除 `budget_suggestion.dart`（如果只用于传统预算）
  - **验证**: 文件删除正确

### 3.3 更新依赖

- [ ] **任务3.3.1**: 搜索所有导入 Budget 模型的文件
  - 使用 `grep -r "import.*models/budget.dart" app/lib/`
  - 列出所有文件
  - **验证**: 生成文件清单

- [ ] **任务3.3.2**: 更新或删除引用 Budget 的代码
  - 逐个文件检查
  - 删除或替换为 BudgetVault
  - **验证**: 编译通过

- [ ] **任务3.3.3**: 搜索所有使用 budgetProvider 的代码
  - 使用 `grep -r "budgetProvider" app/lib/`
  - 列出所有位置
  - **验证**: 生成位置清单

- [ ] **任务3.3.4**: 更新或删除使用 budgetProvider 的代码
  - 逐个位置检查
  - 删除或替换为 budgetVaultProvider
  - **验证**: 编译通过

---

## 阶段4：UI层清理

### 4.1 删除页面

- [ ] **任务4.1.1**: 删除 `app/lib/pages/budget_management_page.dart`
  - 删除文件
  - **验证**: 文件不存在

- [ ] **任务4.1.2**: 删除 `app/lib/pages/budget_center_page.dart`
  - 删除文件
  - **验证**: 文件不存在

- [ ] **任务4.1.3**: 删除 `app/lib/pages/zero_based_budget_page.dart`
  - 检查是否是传统预算相关
  - 如果是则删除
  - **验证**: 文件删除或保留正确

- [ ] **任务4.1.4**: 删除 `app/lib/pages/budget_health_page.dart`
  - 检查是否只用于传统预算
  - 如果是则删除
  - **验证**: 文件删除或保留正确

- [ ] **任务4.1.5**: 删除 `app/lib/pages/budget_carryover_settings_page.dart`
  - 删除文件
  - **验证**: 文件不存在

- [ ] **任务4.1.6**: 删除 `app/lib/pages/budget_money_age_page.dart`
  - 检查是否只用于传统预算
  - 如果是则删除
  - **验证**: 文件删除或保留正确

- [ ] **任务4.1.7**: 删除 `app/lib/pages/voice_budget_page.dart`
  - 检查是否只用于传统预算
  - 如果是则删除
  - **验证**: 文件删除或保留正确

- [ ] **任务4.1.8**: 删除 `app/lib/pages/reports/budget_report_page.dart`
  - 检查是否只用于传统预算
  - 如果是则删除或更新为小金库报表
  - **验证**: 文件删除或更新正确

### 4.2 删除组件

- [ ] **任务4.2.1**: 删除 `app/lib/widgets/budget_status_bar.dart`
  - 检查是否只用于传统预算
  - 如果是则删除
  - **验证**: 文件删除或保留正确

- [ ] **任务4.2.2**: 删除 `app/lib/widgets/budget_alert_widget.dart`
  - 检查是否被小金库使用
  - 如果不使用则删除
  - **验证**: 文件删除或保留正确

- [ ] **任务4.2.3**: 删除其他传统预算相关的 Widget
  - 搜索 `widgets/` 目录下的预算相关文件
  - 逐个检查并删除
  - **验证**: 文件删除正确

### 4.3 更新首页

- [ ] **任务4.3.1**: 移除首页传统预算摘要卡片
  - 打开 `app/lib/pages/home_page.dart`
  - 找到传统预算摘要相关代码
  - 删除相关代码
  - **验证**: 首页显示正常

- [ ] **任务4.3.2**: 更新预算入口为"小金库"
  - 修改入口文本
  - 修改入口图标
  - 修改跳转路由
  - **验证**: 点击跳转到小金库页面

- [ ] **任务4.3.3**: 更新首页导航链接
  - 移除"预算管理"链接
  - 保留"小金库"链接
  - **验证**: 导航正确

### 4.4 更新导航

- [ ] **任务4.4.1**: 更新主导航菜单
  - 打开导航配置文件
  - 移除"预算管理"菜单项
  - 保留"小金库"菜单项
  - **验证**: 菜单显示正确

- [ ] **任务4.4.2**: 更新路由配置
  - 打开路由配置文件
  - 移除传统预算相关的路由
  - **验证**: 路由配置正确

- [ ] **任务4.4.3**: 更新所有页面的导航链接
  - 搜索所有跳转到传统预算页面的代码
  - 删除或替换为小金库页面
  - **验证**: 所有链接正确

---

## 阶段5：功能清理

### 5.1 更新语音助手

- [ ] **任务5.1.1**: 移除传统预算相关的语音命令
  - 打开 `app/lib/services/voice/smart_intent_recognizer.dart`
  - 移除传统预算相关的意图识别
  - **验证**: 语音识别正常

- [ ] **任务5.1.2**: 更新语音命令列表
  - 打开语音命令配置
  - 移除传统预算相关的命令
  - **验证**: 命令列表正确

- [ ] **任务5.1.3**: 更新语音反馈
  - 移除传统预算相关的反馈文本
  - **验证**: 反馈正确

- [ ] **任务5.1.4**: 测试语音功能
  - 测试小金库相关的语音命令
  - 确认传统预算命令不再响应
  - **验证**: 语音功能正常

### 5.2 更新报表系统

- [ ] **任务5.2.1**: 移除传统预算相关的报表
  - 检查报表页面
  - 移除传统预算报表
  - **验证**: 报表页面正常

- [ ] **任务5.2.2**: 更新报表数据源
  - 确认报表只使用小金库数据
  - **验证**: 报表数据正确

- [ ] **任务5.2.3**: 测试报表功能
  - 测试所有报表页面
  - 确认显示正常
  - **验证**: 报表功能正常

### 5.3 更新设置页面

- [ ] **任务5.3.1**: 移除传统预算相关的设置
  - 打开设置页面
  - 移除预算结转设置
  - 移除其他传统预算设置
  - **验证**: 设置页面正常

- [ ] **任务5.3.2**: 更新设置项
  - 保留小金库相关的设置
  - **验证**: 设置功能正常

---

## 阶段6：测试与验证

### 6.1 代码检查

- [ ] **任务6.1.1**: 运行 flutter analyze
  - 执行 `flutter analyze`
  - 检查是否有错误
  - **验证**: 无错误无警告

- [ ] **任务6.1.2**: 搜索残留的 Budget 引用
  - 使用 `grep -r "Budget[^V]" app/lib/`（排除 BudgetVault）
  - 检查是否有遗漏
  - **验证**: 无残留引用

- [ ] **任务6.1.3**: 搜索残留的 budgetProvider 引用
  - 使用 `grep -r "budgetProvider" app/lib/`
  - 检查是否有遗漏
  - **验证**: 无残留引用

- [ ] **任务6.1.4**: 删除未使用的导入
  - 运行 `dart fix --apply`
  - 清理未使用的导入
  - **验证**: 代码整洁

### 6.2 功能测试

- [ ] **任务6.2.1**: 测试小金库创建
  - 创建新的小金库
  - 验证保存成功
  - **验证**: 功能正常

- [ ] **任务6.2.2**: 测试小金库编辑
  - 编辑现有小金库
  - 验证更新成功
  - **验证**: 功能正常

- [ ] **任务6.2.3**: 测试小金库删除
  - 删除小金库
  - 验证删除成功
  - **验证**: 功能正常

- [ ] **任务6.2.4**: 测试收入分配
  - 记录收入
  - 分配到小金库
  - 验证分配成功
  - **验证**: 功能正常

- [ ] **任务6.2.5**: 测试支出记录
  - 记录支出
  - 验证从小金库扣减
  - **验证**: 功能正常

- [ ] **任务6.2.6**: 测试小金库转账
  - 在小金库之间转账
  - 验证转账成功
  - **验证**: 功能正常

- [ ] **任务6.2.7**: 测试首页显示
  - 打开首页
  - 验证小金库摘要显示正常
  - 验证无传统预算相关内容
  - **验证**: 显示正常

- [ ] **任务6.2.8**: 测试导航
  - 测试所有导航链接
  - 验证无传统预算入口
  - **验证**: 导航正常

- [ ] **任务6.2.9**: 测试语音助手
  - 测试小金库相关的语音命令
  - 验证传统预算命令不响应
  - **验证**: 语音功能正常

- [ ] **任务6.2.10**: 测试报表
  - 打开所有报表页面
  - 验证显示正常
  - **验证**: 报表正常

### 6.3 集成测试

- [ ] **任务6.3.1**: 端到端测试
  - 完整的用户流程测试
  - 从创建小金库到记录交易
  - **验证**: 流程顺畅

- [ ] **任务6.3.2**: 数据一致性测试
  - 验证数据库数据正确
  - 验证UI显示与数据一致
  - **验证**: 数据一致

---

## 阶段7：文档更新

### 7.1 更新用户文档

- [ ] **任务7.1.1**: 更新功能说明
  - 移除传统预算相关的说明
  - 更新为小金库说明
  - **验证**: 文档准确

- [ ] **任务7.1.2**: 更新使用指南
  - 更新预算功能使用指南
  - 只保留小金库相关内容
  - **验证**: 指南清晰

- [ ] **任务7.1.3**: 更新常见问题
  - 移除传统预算相关的问题
  - 添加小金库相关的问题
  - **验证**: FAQ完整

### 7.2 更新开发文档

- [ ] **任务7.2.1**: 更新架构文档
  - 移除传统预算相关的架构说明
  - 更新数据库设计文档
  - **验证**: 文档准确

- [ ] **任务7.2.2**: 更新 API 文档
  - 移除传统预算相关的 API
  - 更新小金库 API 文档
  - **验证**: API文档完整

- [ ] **任务7.2.3**: 更新技术决策记录
  - 记录移除传统预算的决策
  - 说明原因和影响
  - **验证**: 记录完整

### 7.3 编写 Release Notes

- [ ] **任务7.3.1**: 编写变更说明
  - 说明移除了传统预算
  - 说明保留了小金库功能
  - **验证**: 说明清晰

- [ ] **任务7.3.2**: 编写迁移指南
  - 说明如何使用小金库替代传统预算
  - 提供示例
  - **验证**: 指南实用

- [ ] **任务7.3.3**: 编写已知问题
  - 列出可能的问题
  - 提供解决方案
  - **验证**: 问题列表完整

---

## 任务统计

- **总任务数**: 87
- **阶段1**: 5 个任务（代码分析）
- **阶段2**: 8 个任务（数据层清理）
- **阶段3**: 16 个任务（业务层清理）
- **阶段4**: 17 个任务（UI层清理）
- **阶段5**: 11 个任务（功能清理）
- **阶段6**: 21 个任务（测试与验证）
- **阶段7**: 9 个任务（文档更新）

---

## 进度跟踪

- [ ] 阶段1：代码分析和准备（0/5）
- [ ] 阶段2：数据层清理（0/8）
- [ ] 阶段3：业务层清理（0/16）
- [ ] 阶段4：UI层清理（0/17）
- [ ] 阶段5：功能清理（0/11）
- [ ] 阶段6：测试与验证（0/21）
- [ ] 阶段7：文档更新（0/9）

**总进度**: 0/87 (0%)

---

**最后更新**: 2026-01-25
**预计完成时间**: 3-4 个工作日
