# 变更：语音多意图处理能力

## 为什么

当前语音助手只能识别和处理单一意图。当用户说出包含多个操作请求的复杂语句时（如"我今天打车去了白石洲，见了个朋友，吃了一顿饭。晚上也是打车回来的，花了35块钱。给我打开日常花销的小金库"），系统只会处理其中一个意图，导致：

1. **信息丢失**：用户提到的多笔交易只能记录一笔
2. **体验割裂**：用户需要分多次说才能完成所有操作
3. **不符合自然语言习惯**：人们日常表达往往是连续叙述多件事

## 变更内容

### 核心能力
- 实现语音输入的多意图分句和识别
- 支持同时处理记账意图和导航意图
- 智能过滤无关信息（噪音）
- 对缺失金额的交易进行追问确认

### 处理策略
1. **分句解析**：按标点符号和语义边界分割输入
2. **意图分类**：对每个分句独立进行意图识别
3. **意图合并**：合并同类意图，保留不同类型意图
4. **分步确认**：完整意图直接确认，不完整意图追问补充

### 用户体验
```
用户: "我今天打车去了白石洲，吃了一顿饭，打车回来花了35块钱，打开小金库看看"

助手: "我听到了这些内容：
      ✅ 打车 35元 - 已准备记录
      ⚠️ 打车去白石洲 - 请问花了多少钱？
      ⚠️ 吃饭 - 请问花了多少钱？
      📂 打开小金库 - 稍后跳转

      请确认或补充金额"
```

## 影响

- 受影响代码：
  - `app/lib/services/nlu_engine.dart` - 添加 MultiIntentParser
  - `app/lib/services/voice/voice_intent_router.dart` - 添加多意图分析
  - `app/lib/services/voice_service_coordinator.dart` - 添加意图队列
  - `app/lib/pages/enhanced_voice_assistant_page.dart` - 多意图确认UI
  - `app/lib/services/qwen_service.dart` - 可选的AI辅助分解

- 依赖关系：
  - 依赖 `complete-voice-assistant` 变更完成（ASR/TTS基础能力）

## 风险评估

| 风险 | 影响 | 缓解措施 |
|------|------|----------|
| 分句不准确导致意图误判 | 中 | 保守分句 + 用户确认 |
| 多意图处理增加延迟 | 低 | 并行处理 + 流式反馈 |
| 追问流程过于复杂 | 中 | 支持批量补充 + 快捷跳过 |
| 噪音误判为有效意图 | 低 | 置信度阈值过滤 |

## 验收标准

1. 用户说出包含多个记账请求的语句时，系统能识别出所有有效意图
2. 完整意图（有金额）可直接记录，不完整意图会追问金额
3. 记账意图和导航意图可以同时处理
4. 无关信息（如"见了个朋友"）被正确过滤
5. 用户可以一次性补充多个缺失金额
6. 处理延迟增加不超过500ms
