# 多意图语音处理

## 新增需求

### 需求：语音输入分句解析

系统必须能将用户的连续语音输入分解为多个独立的语义片段，以支持多意图识别。

#### 场景：按标点符号分句

- 当用户说"我买了咖啡。然后打车回家"
- 系统必须分解为两个片段：["我买了咖啡", "打车回家"]

#### 场景：按连接词分句

- 当用户说"吃了午饭，还有买了水果"
- 系统必须分解为两个片段：["吃了午饭", "买了水果"]

#### 场景：按时间转换词分句

- 当用户说"早上打车去公司，晚上打车回来"
- 系统必须分解为两个片段：["早上打车去公司", "晚上打车回来"]

#### 场景：保持语义完整性

- 当用户说"花了35块钱打车"
- 系统禁止将其分割，必须保持为完整片段：["花了35块钱打车"]

---

### 需求：多意图识别和分类

系统必须能识别每个语义片段的意图类型，并进行分类处理。

#### 场景：识别多个记账意图

- 当用户说"打车花了35，吃饭花了80"
- 系统必须识别出两个记账意图：
  - 意图1：支出 35元 分类:交通
  - 意图2：支出 80元 分类:餐饮

#### 场景：识别混合意图

- 当用户说"记一笔打车35元，然后打开预算看看"
- 系统必须识别出：
  - 记账意图：支出 35元 分类:交通
  - 导航意图：打开预算页面

#### 场景：过滤无关信息

- 当用户说"今天见了个朋友，聊了很久，打车回来花了20"
- 系统必须过滤噪音"见了个朋友，聊了很久"
- 只保留有效意图：支出 20元 分类:交通

---

### 需求：意图完整性判断

系统必须判断每个意图是否具备执行所需的必要信息。

#### 场景：完整的记账意图

- 当意图包含金额时（如"打车花了35"）
- 系统必须标记为完整意图，可直接执行

#### 场景：不完整的记账意图

- 当意图缺少金额时（如"打车去了白石洲"）
- 系统必须标记为不完整意图
- 并必须记录缺失槽位：金额

#### 场景：导航意图完整性

- 当意图包含目标页面时（如"打开小金库"）
- 系统必须标记为完整的导航意图

---

### 需求：多意图确认流程

系统必须提供友好的多意图确认交互界面。

#### 场景：显示意图列表

- 当识别出多个意图时
- 系统必须显示意图列表，区分：
  - ✅ 完整意图（可直接记录）
  - ⚠️ 不完整意图（需要补充信息）
  - 📂 导航意图（稍后执行）

#### 场景：追问缺失金额

- 当存在不完整的记账意图时
- 系统必须询问用户补充金额
- 必须支持语音或键盘输入

#### 场景：批量确认

- 当用户说"确认"或"全部记录"
- 系统必须批量执行所有完整意图
- 并开始处理不完整意图的追问

#### 场景：部分取消

- 当用户说"取消第二个"
- 系统必须从意图列表中移除第二个意图
- 必须继续处理剩余意图

---

### 需求：意图执行顺序

系统必须按合理顺序执行多个意图，确保用户体验流畅。

#### 场景：记账优先于导航

- 当同时存在记账意图和导航意图时
- 系统必须先完成记账
- 再执行导航跳转

#### 场景：完整意图优先于追问

- 当同时存在完整和不完整意图时
- 系统必须先确认并记录完整意图
- 再追问不完整意图的缺失信息

---

### 需求：配置和开关

系统必须支持多意图处理的配置控制，允许用户自定义行为。

#### 场景：功能开关

- 当用户关闭"多意图处理"设置时
- 系统必须回退到单意图处理模式
- 只处理置信度最高的单一意图

#### 场景：追问模式配置

- 当用户设置"逐个追问"模式
- 系统必须逐个询问每个不完整意图
- 当用户设置"批量追问"模式
- 系统必须一次性列出所有需要补充的信息
