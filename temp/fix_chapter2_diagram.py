# -*- coding: utf-8 -*-
"""
修正第2章2.0.2设计理念图
"""

def main():
    filepath = 'd:/code/ai-bookkeeping/docs/design/app_v2_design.md'

    with open(filepath, 'r', encoding='utf-8') as f:
        content = f.read()

    changes = 0

    old_diagram = '''#### 2.0.2 设计理念

```
产品定位核心理念：让记账成为一种轻松的习惯

┌─────────────────────────────────────────────────────────────┐
│                    AI智能记账2.0定位                          │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│   ┌─────────────┐  ┌─────────────┐  ┌─────────────┐        │
│   │   语音优先   │  │   智能理解   │  │   主动服务   │        │
│   │  Voice-First │  │ AI-Powered  │  │  Proactive  │        │
│   └──────┬──────┘  └──────┬──────┘  └──────┬──────┘        │
│          │                │                │                │
│          └────────────────┼────────────────┘                │
│                           │                                 │
│                           ▼                                 │
│              ┌─────────────────────────┐                    │
│              │      用户价值中心        │                    │
│              │  省时 · 省心 · 省力      │                    │
│              └─────────────────────────┘                    │
│                           │                                 │
│          ┌────────────────┼────────────────┐                │
│          │                │                │                │
│          ▼                ▼                ▼                │
│   ┌─────────────┐  ┌─────────────┐  ┌─────────────┐        │
│   │  个人记账    │  │  家庭共享    │  │  财务洞察    │        │
│   │   场景       │  │   场景       │  │   场景       │        │
│   └─────────────┘  └─────────────┘  └─────────────┘        │
│                                                             │
└─────────────────────────────────────────────────────────────┘
```'''

    new_diagram = '''#### 2.0.2 设计理念

```
产品愿景：您的智能财务伙伴，让每一分钱都有意义

┌─────────────────────────────────────────────────────────────────────────────┐
│                      AI智能记账2.0 - 您的智能财务伙伴                          │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│                    ┌─────────────────────────────┐                          │
│                    │       核心差异化能力         │                          │
│                    └──────────────┬──────────────┘                          │
│                                   │                                         │
│              ┌────────────────────┼────────────────────┐                    │
│              │                                         │                    │
│              ▼                                         ▼                    │
│   ┌─────────────────────┐                   ┌─────────────────────┐        │
│   │      钱龄分析        │                   │      零基预算        │        │
│   │    Money Age        │                   │   Zero-Based Budget │        │
│   │                     │                   │                     │        │
│   │  理解钱的时间价值    │                   │  每分钱都有去处      │        │
│   │  FIFO先进先出       │                   │  小金库资金隔离      │        │
│   │  花的是多久前的钱    │                   │  收入100%分配       │        │
│   └──────────┬──────────┘                   └──────────┬──────────┘        │
│              │                                         │                    │
│              └────────────────────┬────────────────────┘                    │
│                                   │                                         │
│                                   ▼                                         │
│                    ┌─────────────────────────────┐                          │
│                    │     全智能化财务伙伴         │                          │
│                    │  极致体验 - 习惯培养 - 洞察  │                          │
│                    └──────────────┬──────────────┘                          │
│                                   │                                         │
│         ┌─────────────────────────┼─────────────────────────┐               │
│         │                         │                         │               │
│         ▼                         ▼                         ▼               │
│  ┌─────────────┐          ┌─────────────┐          ┌─────────────┐         │
│  │  极致体验    │          │  习惯培养    │          │  智能洞察    │         │
│  │             │          │             │          │             │         │
│  │  语音记账   │          │  打卡激励   │          │  AI分析     │         │
│  │  图像识别   │          │  连续记录   │          │  趋势预测   │         │
│  │  智能分类   │          │  成就体系   │          │  个性建议   │         │
│  └─────────────┘          └─────────────┘          └─────────────┘         │
│                                                                             │
│                    ─────────────────────────────                            │
│                            扩展服务                                          │
│              家庭账本 - 位置智能 - 数据同步 - 报表导出                         │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘
```'''

    if old_diagram in content:
        content = content.replace(old_diagram, new_diagram)
        print("OK: Updated 2.0.2 设计理念图")
        changes += 1
    else:
        print("Warning: 2.0.2 diagram not found, trying alternative match")
        # 尝试按行替换
        lines = content.split('\n')
        start_idx = -1
        end_idx = -1
        for i, line in enumerate(lines):
            if '#### 2.0.2 设计理念' in line:
                start_idx = i
            if start_idx > 0 and '#### 2.0.3' in line:
                end_idx = i
                break

        if start_idx > 0 and end_idx > start_idx:
            new_lines = lines[:start_idx] + new_diagram.split('\n') + [''] + lines[end_idx:]
            content = '\n'.join(new_lines)
            print(f"OK: Replaced 2.0.2 section (lines {start_idx}-{end_idx})")
            changes += 1

    if changes > 0:
        with open(filepath, 'w', encoding='utf-8') as f:
            f.write(content)
        print(f"\n===== Chapter 2 diagram fix done, {changes} changes =====")
    else:
        print("\nNo changes made")

    return changes

if __name__ == '__main__':
    main()
