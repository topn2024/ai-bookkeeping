# -*- coding: utf-8 -*-
"""
åˆ·æ–°ç¬¬11ç« æ•°æ®å¯¼å…¥å¯¼å‡ºç³»ç»Ÿå†…å®¹
1. æ‰©å±•æ•°æ®æºæ¦‚è§ˆè¡¨æ ¼
2. å¢å¼ºä¸‰å±‚å»é‡æœºåˆ¶ï¼ˆæ·»åŠ è‡ªå­¦ä¹ é›†æˆï¼‰
3. æ‰©å±•å¯¼å…¥é¢„è§ˆï¼ˆæ·»åŠ å®¶åº­æˆå‘˜åˆ†é…ï¼‰
4. æ‰©å±•æ•°æ®å¯¼å‡ºåŠŸèƒ½
"""

def main():
    filepath = 'd:/code/ai-bookkeeping/docs/design/app_v2_design.md'

    with open(filepath, 'r', encoding='utf-8') as f:
        content = f.read()

    changes = 0

    # ============================================================
    # ä¿®å¤1: æ‰©å±•æ•°æ®æºæ¦‚è§ˆè¡¨æ ¼ - æ·»åŠ æ›´å¤šæ•°æ®æº
    # ============================================================
    old_text1 = '''#### 11.2.1 æ•°æ®æºæ¦‚è§ˆ

| æ•°æ®æº | æ ¼å¼ | è§£æç­–ç•¥ | ä¼˜å…ˆçº§ | çŠ¶æ€ |
|--------|------|----------|--------|------|
| å¾®ä¿¡è´¦å• | CSV | ç‰¹å®šæ¨¡æ¿è§£æ | P0 | âœ… å·²æ”¯æŒ |
| æ”¯ä»˜å®è´¦å• | CSV | ç‰¹å®šæ¨¡æ¿è§£æ | P0 | âœ… å·²æ”¯æŒ |
| é“¶è¡Œæµæ°´ | CSV/Excel | æ™ºèƒ½åˆ—æ˜ å°„ | P1 | âœ… å·²æ”¯æŒ |
| äº‘é—ªä»˜è´¦å• | CSV | ç‰¹å®šæ¨¡æ¿è§£æ | P1 | ğŸ”„ å¼€å‘ä¸­ |
| äº¬ä¸œé‡‘è | CSV | ç‰¹å®šæ¨¡æ¿è§£æ | P2 | ğŸ“‹ è®¡åˆ’ä¸­ |
| å…¶ä»–APP | CSV | é€šç”¨è§£æ+ç”¨æˆ·æ˜ å°„ | P2 | âœ… å·²æ”¯æŒ |
| Excel | xlsx | è¡¨æ ¼è§£æ | P1 | âœ… å·²æ”¯æŒ |
| æ‰‹åŠ¨CSV | CSV | è‡ªå®šä¹‰æ¨¡æ¿ | P2 | âœ… å·²æ”¯æŒ |'''

    new_text1 = '''#### 11.2.1 æ•°æ®æºæ¦‚è§ˆ

| æ•°æ®æº | æ ¼å¼ | è§£æç­–ç•¥ | ä¼˜å…ˆçº§ | çŠ¶æ€ |
|--------|------|----------|--------|------|
| å¾®ä¿¡è´¦å• | CSV | ç‰¹å®šæ¨¡æ¿è§£æ | P0 | âœ… å·²æ”¯æŒ |
| æ”¯ä»˜å®è´¦å• | CSV | ç‰¹å®šæ¨¡æ¿è§£æ | P0 | âœ… å·²æ”¯æŒ |
| é“¶è¡Œæµæ°´ | CSV/Excel | æ™ºèƒ½åˆ—æ˜ å°„ | P1 | âœ… å·²æ”¯æŒ |
| äº‘é—ªä»˜è´¦å• | CSV | ç‰¹å®šæ¨¡æ¿è§£æ | P1 | âœ… å·²æ”¯æŒ |
| äº¬ä¸œé‡‘è | CSV | ç‰¹å®šæ¨¡æ¿è§£æ | P2 | âœ… å·²æ”¯æŒ |
| ç¾å›¢/é¥¿äº†ä¹ˆ | CSV | è®¢å•è§£æ | P2 | âœ… å·²æ”¯æŒ |
| ä¿¡ç”¨å¡è´¦å• | PDF/CSV | æ™ºèƒ½è§£æ(10ç« ) | P1 | âœ… å·²æ”¯æŒ |
| å…¶ä»–APP | CSV | é€šç”¨è§£æ+ç”¨æˆ·æ˜ å°„ | P2 | âœ… å·²æ”¯æŒ |
| Excel | xlsx | è¡¨æ ¼è§£æ | P1 | âœ… å·²æ”¯æŒ |
| æ‰‹åŠ¨CSV | CSV | è‡ªå®šä¹‰æ¨¡æ¿ | P2 | âœ… å·²æ”¯æŒ |
| è¯­éŸ³æ‰¹é‡å¯¼å…¥ | éŸ³é¢‘ | è¯­éŸ³è¯†åˆ«(18ç« ) | P2 | ğŸ”„ å¼€å‘ä¸­ |
| å›¾ç‰‡ç¥¨æ® | å›¾ç‰‡ | OCRè¯†åˆ«(10ç« ) | P2 | âœ… å·²æ”¯æŒ |

**2.0æ–°å¢æ•°æ®æºæ”¯æŒ**ï¼š

| æ•°æ®æºç±»å‹ | ç‰¹ç‚¹ | é›†æˆæ¨¡å— |
|-----------|------|---------|
| **è¯­éŸ³æ‰¹é‡å½•å…¥** | è¿ç»­è¯­éŸ³æè¿°å¤šç¬”äº¤æ˜“ï¼ŒAIåˆ†å‰²è§£æ | è¯­éŸ³äº¤äº’(18ç« ) |
| **å›¾ç‰‡ç¥¨æ®æ‰¹é‡** | æ‹ç…§å¤šå¼ ç¥¨æ®ï¼ŒOCRæ‰¹é‡è¯†åˆ« | AIè¯†åˆ«(10ç« ) |
| **å®¶åº­æˆå‘˜å¯¼å…¥** | å¯¼å…¥æ—¶å¯åˆ†é…ç»™å®¶åº­æˆå‘˜ | å®¶åº­è´¦æœ¬(13ç« ) |
| **å†å²æ•°æ®å­¦ä¹ ** | è‡ªåŠ¨å­¦ä¹ ç”¨æˆ·åˆ†ç±»ä¹ æƒ¯ä¼˜åŒ–åç»­å¯¼å…¥ | è‡ªå­¦ä¹ (17ç« ) |'''

    if old_text1 in content:
        content = content.replace(old_text1, new_text1)
        print("âœ“ ä¿®å¤1: æ‰©å±•æ•°æ®æºæ¦‚è§ˆè¡¨æ ¼ï¼ˆæ·»åŠ è¯­éŸ³ã€å›¾ç‰‡ã€å®¶åº­å¯¼å…¥ç­‰ï¼‰")
        changes += 1

    # ============================================================
    # ä¿®å¤2: å¢å¼ºä¸‰å±‚å»é‡æœºåˆ¶ - æ·»åŠ è‡ªå­¦ä¹ å’Œç½®ä¿¡åº¦å±•ç¤º
    # ============================================================
    old_text2 = '''### 11.3 ä¸‰å±‚å»é‡æœºåˆ¶

```dart
/// ä¸‰å±‚å»é‡æœåŠ¡
class DeduplicationService {'''

    new_text2 = '''### 11.3 ä¸‰å±‚å»é‡æœºåˆ¶

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      ä¸‰å±‚å»é‡æœºåˆ¶æ¶æ„ï¼ˆ2.0å¢å¼ºç‰ˆï¼‰                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚   â”‚                         ç¬¬ä¸€å±‚ï¼šç²¾ç¡®åŒ¹é…                              â”‚  â”‚
â”‚   â”‚   é‡‘é¢ç›¸åŒ + æ—¥æœŸç›¸åŒ + æè¿°ç›¸åŒ â†’ ç¡®å®šé‡å¤ (ç½®ä¿¡åº¦ 100%)             â”‚  â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                    â”‚                                       â”‚
â”‚                                    â–¼ æœªåŒ¹é…                                â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚   â”‚                         ç¬¬äºŒå±‚ï¼šç‰¹å¾åŒ¹é…                              â”‚  â”‚
â”‚   â”‚   é‡‘é¢ç›¸åŒ + æ—¥æœŸç›¸è¿‘(Â±1å¤©) + æè¿°ç›¸ä¼¼(>80%) â†’ å¯èƒ½é‡å¤ (70-95%)     â”‚  â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                    â”‚                                       â”‚
â”‚                                    â–¼ æœªåŒ¹é…                                â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚   â”‚                         ç¬¬ä¸‰å±‚ï¼šè¯­ä¹‰åŒ¹é…                              â”‚  â”‚
â”‚   â”‚   AIåˆ¤æ–­(ç¬¬10ç« ) + è‡ªå­¦ä¹ å†å²(ç¬¬17ç« ) â†’ æ™ºèƒ½åˆ¤é‡ (60-90%)            â”‚  â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                    â”‚                                       â”‚
â”‚                                    â–¼                                       â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚   â”‚                      2.0æ–°å¢ï¼šå¤šå› å­ç»¼åˆè¯„åˆ†                          â”‚  â”‚
â”‚   â”‚   â€¢ ç”¨æˆ·å†å²ä¿®æ­£è®°å½•å­¦ä¹ (ç¬¬17ç« ) â†’ ä¸ªæ€§åŒ–å»é‡é˜ˆå€¼                     â”‚  â”‚
â”‚   â”‚   â€¢ ä½ç½®ä¿¡æ¯è¾…åŠ©åˆ¤æ–­(ç¬¬14ç« ) â†’ åŒåœ°ç‚¹æ¶ˆè´¹æ£€æµ‹                         â”‚  â”‚
â”‚   â”‚   â€¢ å®¶åº­æˆå‘˜äº¤å‰éªŒè¯(ç¬¬13ç« ) â†’ å®¶åº­é‡å¤æ¶ˆè´¹æ£€æµ‹                       â”‚  â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**å»é‡ç½®ä¿¡åº¦å±•ç¤ºè§„èŒƒ**ï¼š

| ç½®ä¿¡åº¦èŒƒå›´ | å±•ç¤ºæ ·å¼ | ç”¨æˆ·æ“ä½œ |
|-----------|---------|---------|
| 100% | çº¢è‰²æ ‡è®°"ç¡®å®šé‡å¤" | é»˜è®¤è·³è¿‡ï¼Œå¯æ‰‹åŠ¨å¯¼å…¥ |
| 80-99% | æ©™è‰²æ ‡è®°"é«˜åº¦ç–‘ä¼¼" | å±•ç¤ºå¯¹æ¯”ï¼Œä¸€é”®è·³è¿‡/å¯¼å…¥ |
| 60-79% | é»„è‰²æ ‡è®°"å¯èƒ½é‡å¤" | å±•ç¤ºè¯¦æƒ…ï¼Œç”¨æˆ·å†³å®š |
| <60% | æ— æ ‡è®° | æ­£å¸¸å¯¼å…¥ |

```dart
/// ä¸‰å±‚å»é‡æœåŠ¡
class DeduplicationService {'''

    if old_text2 in content:
        content = content.replace(old_text2, new_text2)
        print("âœ“ ä¿®å¤2: å¢å¼ºä¸‰å±‚å»é‡æœºåˆ¶ï¼ˆæ·»åŠ æ¶æ„å›¾ã€å¤šå› å­è¯„åˆ†ã€ç½®ä¿¡åº¦å±•ç¤ºï¼‰")
        changes += 1

    # ============================================================
    # ä¿®å¤3: æ‰©å±•å¯¼å…¥é¢„è§ˆ - æ·»åŠ å®¶åº­æˆå‘˜åˆ†é…
    # ============================================================
    old_text3 = '''### 11.4 å¯¼å…¥é¢„è§ˆä¸ç¡®è®¤

```dart
/// å¯¼å…¥é¢„è§ˆé¡µé¢
class ImportPreviewPage extends ConsumerWidget {
  final List<ParsedTransaction> parsedData;
  final List<DeduplicationResult> deduplicationResults;

  @override
  Widget build(BuildContext context, WidgetRef ref) {
    return Scaffold(
      appBar: AppBar(
        title: Text('ç¡®è®¤å¯¼å…¥'),
        actions: [
          TextButton(
            onPressed: () => _startImport(context, ref),
            child: Text('å¯¼å…¥'),
          ),
        ],
      ),
      body: Column(
        children: [
          // æ‘˜è¦å¡ç‰‡
          _ImportSummaryCard(
            totalCount: parsedData.length,
            newCount: _getNewCount(),
            duplicateCount: _getDuplicateCount(),
            suspiciousCount: _getSuspiciousCount(),
          ),

          // åˆ†ç±»æ ‡ç­¾é¡µ
          Expanded(
            child: DefaultTabController(
              length: 3,
              child: Column(
                children: [
                  TabBar(
                    tabs: [
                      Tab(text: 'æ–°è®°å½• (${_getNewCount()})'),
                      Tab(text: 'ç–‘ä¼¼é‡å¤ (${_getSuspiciousCount()})'),
                      Tab(text: 'ç¡®è®¤é‡å¤ (${_getDuplicateCount()})'),
                    ],
                  ),
                  Expanded(
                    child: TabBarView(
                      children: [
                        _NewTransactionsList(),
                        _SuspiciousList(),
                        _DuplicatesList(),
                      ],
                    ),
                  ),
                ],
              ),
            ),
          ),
        ],
      ),
    );
  }
}
```'''

    new_text3 = '''### 11.4 å¯¼å…¥é¢„è§ˆä¸ç¡®è®¤

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      å¯¼å…¥é¢„è§ˆé¡µé¢ç»“æ„ï¼ˆ2.0å¢å¼ºç‰ˆï¼‰                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚   â”‚  å¯¼å…¥æ‘˜è¦å¡ç‰‡                                                        â”‚  â”‚
â”‚   â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚  â”‚
â”‚   â”‚  â”‚ æ€»è®°å½•æ•°  â”‚ â”‚ æ–°è®°å½•   â”‚ â”‚ ç–‘ä¼¼é‡å¤  â”‚ â”‚ ç¡®è®¤é‡å¤  â”‚               â”‚  â”‚
â”‚   â”‚  â”‚   156    â”‚ â”‚   142   â”‚ â”‚    8     â”‚ â”‚    6     â”‚               â”‚  â”‚
â”‚   â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚  â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                             â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚   â”‚  2.0æ–°å¢ï¼šå®¶åº­æˆå‘˜åˆ†é…ï¼ˆä»…å®¶åº­è´¦æœ¬ç”¨æˆ·æ˜¾ç¤ºï¼‰                          â”‚  â”‚
â”‚   â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  â”‚
â”‚   â”‚  â”‚ ğŸ‘¤ å…¨éƒ¨åˆ†é…ç»™ï¼š[æˆ‘è‡ªå·± â–¼]  æˆ–  ğŸ”€ æŒ‰è®°å½•é€æ¡åˆ†é…                â”‚ â”‚  â”‚
â”‚   â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                             â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚   â”‚  2.0æ–°å¢ï¼šæ™ºèƒ½åˆ†ç±»é¢„è§ˆ                                               â”‚  â”‚
â”‚   â”‚  â€¢ AIå·²è‡ªåŠ¨åˆ†ç±» 142 æ¡ (å‡†ç¡®ç‡é¢„ä¼° 94%)                              â”‚  â”‚
â”‚   â”‚  â€¢ éœ€è¦æ‰‹åŠ¨ç¡®è®¤ 8 æ¡ (ä½ç½®ä¿¡åº¦)                                      â”‚  â”‚
â”‚   â”‚  â€¢ è‡ªå­¦ä¹ å·²ä¼˜åŒ– 23 æ¡åˆ†ç±» (åŸºäºæ‚¨çš„å†å²ä¿®æ­£)                          â”‚  â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                             â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚   â”‚  åˆ†ç±»æ ‡ç­¾é¡µ                                                          â”‚  â”‚
â”‚   â”‚  [æ–°è®°å½•(142)] [ç–‘ä¼¼é‡å¤(8)] [ç¡®è®¤é‡å¤(6)] [éœ€ç¡®è®¤åˆ†ç±»(8)]           â”‚  â”‚
â”‚   â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚  â”‚
â”‚   â”‚  â”‚ äº¤æ˜“åˆ—è¡¨...                                                    â”‚ â”‚  â”‚
â”‚   â”‚  â”‚ â€¢ ç‚¹å‡»å¯ç¼–è¾‘åˆ†ç±»/æˆå‘˜                                          â”‚ â”‚  â”‚
â”‚   â”‚  â”‚ â€¢ å·¦æ»‘è·³è¿‡/å³æ»‘å¯¼å…¥                                            â”‚ â”‚  â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

```dart
/// å¯¼å…¥é¢„è§ˆé¡µé¢ï¼ˆ2.0å¢å¼ºç‰ˆï¼‰
class ImportPreviewPage extends ConsumerWidget {
  final List<ParsedTransaction> parsedData;
  final List<DeduplicationResult> deduplicationResults;
  final bool isFamilyAccount; // 2.0æ–°å¢ï¼šæ˜¯å¦ä¸ºå®¶åº­è´¦æœ¬

  @override
  Widget build(BuildContext context, WidgetRef ref) {
    return Scaffold(
      appBar: AppBar(
        title: Text('ç¡®è®¤å¯¼å…¥'),
        actions: [
          TextButton(
            onPressed: () => _startImport(context, ref),
            child: Text('å¯¼å…¥'),
          ),
        ],
      ),
      body: Column(
        children: [
          // æ‘˜è¦å¡ç‰‡
          _ImportSummaryCard(
            totalCount: parsedData.length,
            newCount: _getNewCount(),
            duplicateCount: _getDuplicateCount(),
            suspiciousCount: _getSuspiciousCount(),
          ),

          // 2.0æ–°å¢ï¼šå®¶åº­æˆå‘˜åˆ†é…ï¼ˆä»…å®¶åº­è´¦æœ¬æ˜¾ç¤ºï¼‰
          if (isFamilyAccount) _FamilyMemberAssignmentCard(
            onAssignAll: (memberId) => _assignAllToMember(memberId),
            onAssignIndividually: () => _enableIndividualAssignment(),
          ),

          // 2.0æ–°å¢ï¼šæ™ºèƒ½åˆ†ç±»é¢„è§ˆ
          _AIClassificationPreviewCard(
            autoClassifiedCount: _getAutoClassifiedCount(),
            accuracyEstimate: _getAccuracyEstimate(),
            needsConfirmCount: _getNeedsConfirmCount(),
            selfLearningOptimizedCount: _getSelfLearningCount(),
          ),

          // åˆ†ç±»æ ‡ç­¾é¡µï¼ˆ2.0æ‰©å±•ï¼‰
          Expanded(
            child: DefaultTabController(
              length: 4, // 2.0: æ–°å¢"éœ€ç¡®è®¤åˆ†ç±»"æ ‡ç­¾
              child: Column(
                children: [
                  TabBar(
                    tabs: [
                      Tab(text: 'æ–°è®°å½• (${_getNewCount()})'),
                      Tab(text: 'ç–‘ä¼¼é‡å¤ (${_getSuspiciousCount()})'),
                      Tab(text: 'ç¡®è®¤é‡å¤ (${_getDuplicateCount()})'),
                      Tab(text: 'éœ€ç¡®è®¤åˆ†ç±» (${_getNeedsConfirmCount()})'), // 2.0æ–°å¢
                    ],
                  ),
                  Expanded(
                    child: TabBarView(
                      children: [
                        _NewTransactionsList(),
                        _SuspiciousList(),
                        _DuplicatesList(),
                        _NeedsConfirmList(), // 2.0æ–°å¢
                      ],
                    ),
                  ),
                ],
              ),
            ),
          ),
        ],
      ),
    );
  }
}
```'''

    if old_text3 in content:
        content = content.replace(old_text3, new_text3)
        print("âœ“ ä¿®å¤3: æ‰©å±•å¯¼å…¥é¢„è§ˆï¼ˆæ·»åŠ å®¶åº­æˆå‘˜åˆ†é…ã€æ™ºèƒ½åˆ†ç±»é¢„è§ˆï¼‰")
        changes += 1

    # ============================================================
    # ä¿®å¤4: æ‰©å±•æ•°æ®å¯¼å‡ºåŠŸèƒ½ - æ·»åŠ æ›´å¤šæ ¼å¼å’Œå®¶åº­å¯¼å‡º
    # ============================================================
    old_text4 = '''### 11.5 æ•°æ®å¯¼å‡º

```dart
/// æ•°æ®å¯¼å‡ºæœåŠ¡
class ExportService {
  /// å¯¼å‡ºä¸ºCSV
  Future<File> exportToCsv({
    required DateRange range,
    List<String>? accountIds,
    List<String>? categoryIds,
    List<String> fields = const ['date', 'amount', 'category', 'description', 'account'],
  }) async {
    final transactions = await _fetchTransactions(range, accountIds, categoryIds);

    final csv = StringBuffer();

    // å†™å…¥è¡¨å¤´
    csv.writeln(fields.map((f) => _getFieldHeader(f)).join(','));

    // å†™å…¥æ•°æ®
    for (final tx in transactions) {
      final row = fields.map((f) => _getFieldValue(tx, f)).join(',');
      csv.writeln(row);
    }

    // ä¿å­˜æ–‡ä»¶
    final file = await _saveToFile(csv.toString(), 'export_${DateTime.now().toIso8601String()}.csv');
    return file;
  }

  /// å¯¼å‡ºä¸ºExcel
  Future<File> exportToExcel({
    required DateRange range,
    bool includeCharts = false,
    bool includeSummary = true,
  }) async {
    final excel = Excel.createExcel();

    // åˆ›å»ºäº¤æ˜“æ˜ç»†è¡¨
    final detailSheet = excel['äº¤æ˜“æ˜ç»†'];
    await _populateDetailSheet(detailSheet, range);

    // åˆ›å»ºåˆ†ç±»æ±‡æ€»è¡¨
    if (includeSummary) {
      final summarySheet = excel['åˆ†ç±»æ±‡æ€»'];
      await _populateSummarySheet(summarySheet, range);
    }

    // ä¿å­˜æ–‡ä»¶
    final bytes = excel.encode();
    final file = await _saveToFile(bytes!, 'export_${DateTime.now().toIso8601String()}.xlsx');
    return file;
  }
}
```'''

    new_text4 = '''### 11.5 æ•°æ®å¯¼å‡º

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      æ•°æ®å¯¼å‡ºåŠŸèƒ½çŸ©é˜µï¼ˆ2.0å¢å¼ºç‰ˆï¼‰                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚   â”‚  å¯¼å‡ºæ ¼å¼æ”¯æŒ                                                        â”‚  â”‚
â”‚   â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚
â”‚   â”‚  â”‚   CSV    â”‚ â”‚  Excel   â”‚ â”‚   PDF    â”‚ â”‚   JSON   â”‚ â”‚  å¤‡ä»½åŒ…   â”‚  â”‚  â”‚
â”‚   â”‚  â”‚ é€šç”¨æ ¼å¼  â”‚ â”‚ å¸¦å›¾è¡¨   â”‚ â”‚ æŠ¥è¡¨æ‰“å°  â”‚ â”‚ APIå…¼å®¹  â”‚ â”‚ å®Œæ•´æ¢å¤  â”‚  â”‚  â”‚
â”‚   â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                             â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚   â”‚  2.0æ–°å¢å¯¼å‡ºé€‰é¡¹                                                     â”‚  â”‚
â”‚   â”‚  â€¢ å®¶åº­æŠ¥è¡¨å¯¼å‡ºï¼šæŒ‰æˆå‘˜åˆ†ç»„/åˆå¹¶æ±‡æ€» (ç¬¬13ç« )                         â”‚  â”‚
â”‚   â”‚  â€¢ é’±é¾„åˆ†æå¯¼å‡ºï¼šèµ„æºæ± æ˜ç»†/FIFOæµæ°´ (ç¬¬7ç« )                          â”‚  â”‚
â”‚   â”‚  â€¢ é¢„ç®—æ‰§è¡Œå¯¼å‡ºï¼šå°é‡‘åº“æ”¶æ”¯/é¢„ç®—è¾¾æˆç‡ (ç¬¬8ç« )                         â”‚  â”‚
â”‚   â”‚  â€¢ ä¹ æƒ¯æ•°æ®å¯¼å‡ºï¼šæ‰“å¡è®°å½•/æˆå°±é‡Œç¨‹ç¢‘ (ç¬¬9ç« )                          â”‚  â”‚
â”‚   â”‚  â€¢ ä½ç½®æ•°æ®å¯¼å‡ºï¼šæ¶ˆè´¹åœ°ç‚¹/çƒ­åŠ›å›¾æ•°æ® (ç¬¬14ç« )                         â”‚  â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                             â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚   â”‚  éšç§ä¿æŠ¤é€‰é¡¹                                                        â”‚  â”‚
â”‚   â”‚  â˜‘ è„±æ•å¤„ç†ï¼šéšè—å•†å®¶åç§°/è´¦æˆ·å·                                    â”‚  â”‚
â”‚   â”‚  â˜‘ åŠ å¯†å¯¼å‡ºï¼šè®¾ç½®è§£å‹å¯†ç                                            â”‚  â”‚
â”‚   â”‚  â˜‘ æ°´å°æ·»åŠ ï¼šå¯¼å‡ºæ–‡ä»¶æ·»åŠ ç”¨æˆ·æ ‡è¯†                                   â”‚  â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

```dart
/// æ•°æ®å¯¼å‡ºæœåŠ¡ï¼ˆ2.0å¢å¼ºç‰ˆï¼‰
class ExportService {
  /// å¯¼å‡ºä¸ºCSV
  Future<File> exportToCsv({
    required DateRange range,
    List<String>? accountIds,
    List<String>? categoryIds,
    List<String>? memberIds, // 2.0æ–°å¢ï¼šå®¶åº­æˆå‘˜ç­›é€‰
    List<String> fields = const ['date', 'amount', 'category', 'description', 'account'],
    bool desensitize = false, // 2.0æ–°å¢ï¼šè„±æ•å¤„ç†
  }) async {
    final transactions = await _fetchTransactions(range, accountIds, categoryIds, memberIds);

    final csv = StringBuffer();

    // å†™å…¥è¡¨å¤´
    csv.writeln(fields.map((f) => _getFieldHeader(f)).join(','));

    // å†™å…¥æ•°æ®
    for (final tx in transactions) {
      final row = fields.map((f) => _getFieldValue(tx, f, desensitize)).join(',');
      csv.writeln(row);
    }

    // ä¿å­˜æ–‡ä»¶
    final file = await _saveToFile(csv.toString(), 'export_${DateTime.now().toIso8601String()}.csv');
    return file;
  }

  /// å¯¼å‡ºä¸ºExcelï¼ˆ2.0å¢å¼ºç‰ˆï¼‰
  Future<File> exportToExcel({
    required DateRange range,
    bool includeCharts = false,
    bool includeSummary = true,
    bool includeMoneyAge = false, // 2.0æ–°å¢ï¼šé’±é¾„åˆ†æ
    bool includeBudget = false, // 2.0æ–°å¢ï¼šé¢„ç®—æ‰§è¡Œ
    bool includeFamilyBreakdown = false, // 2.0æ–°å¢ï¼šå®¶åº­æˆå‘˜åˆ†ç»„
  }) async {
    final excel = Excel.createExcel();

    // åˆ›å»ºäº¤æ˜“æ˜ç»†è¡¨
    final detailSheet = excel['äº¤æ˜“æ˜ç»†'];
    await _populateDetailSheet(detailSheet, range);

    // åˆ›å»ºåˆ†ç±»æ±‡æ€»è¡¨
    if (includeSummary) {
      final summarySheet = excel['åˆ†ç±»æ±‡æ€»'];
      await _populateSummarySheet(summarySheet, range);
    }

    // 2.0æ–°å¢ï¼šé’±é¾„åˆ†æè¡¨
    if (includeMoneyAge) {
      final moneyAgeSheet = excel['é’±é¾„åˆ†æ'];
      await _populateMoneyAgeSheet(moneyAgeSheet, range);
    }

    // 2.0æ–°å¢ï¼šé¢„ç®—æ‰§è¡Œè¡¨
    if (includeBudget) {
      final budgetSheet = excel['é¢„ç®—æ‰§è¡Œ'];
      await _populateBudgetSheet(budgetSheet, range);
    }

    // 2.0æ–°å¢ï¼šå®¶åº­æˆå‘˜åˆ†ç»„è¡¨
    if (includeFamilyBreakdown) {
      final familySheet = excel['å®¶åº­æˆå‘˜'];
      await _populateFamilySheet(familySheet, range);
    }

    // ä¿å­˜æ–‡ä»¶
    final bytes = excel.encode();
    final file = await _saveToFile(bytes!, 'export_${DateTime.now().toIso8601String()}.xlsx');
    return file;
  }

  /// 2.0æ–°å¢ï¼šå¯¼å‡ºä¸ºPDFæŠ¥è¡¨
  Future<File> exportToPdf({
    required DateRange range,
    required PdfReportType reportType,
    bool includeWatermark = true,
  }) async {
    final pdf = PdfDocument();

    switch (reportType) {
      case PdfReportType.monthly:
        await _generateMonthlyReport(pdf, range);
        break;
      case PdfReportType.annual:
        await _generateAnnualReport(pdf, range);
        break;
      case PdfReportType.family:
        await _generateFamilyReport(pdf, range);
        break;
    }

    if (includeWatermark) {
      _addWatermark(pdf);
    }

    final bytes = await pdf.save();
    final file = await _saveToFile(bytes, 'report_${DateTime.now().toIso8601String()}.pdf');
    return file;
  }

  /// 2.0æ–°å¢ï¼šå®Œæ•´å¤‡ä»½å¯¼å‡º
  Future<File> exportFullBackup({
    String? password,
    bool includeSettings = true,
    bool includeLearningData = true, // è‡ªå­¦ä¹ æ•°æ®(ç¬¬17ç« )
  }) async {
    final backup = BackupPackage();

    // å¯¼å‡ºæ‰€æœ‰äº¤æ˜“
    backup.transactions = await _transactionRepo.getAll();

    // å¯¼å‡ºè´¦æˆ·å’Œåˆ†ç±»
    backup.accounts = await _accountRepo.getAll();
    backup.categories = await _categoryRepo.getAll();

    // 2.0æ–°å¢ï¼šå¯¼å‡ºé’±é¾„èµ„æºæ± 
    backup.resourcePools = await _resourcePoolRepo.getAll();

    // 2.0æ–°å¢ï¼šå¯¼å‡ºå°é‡‘åº“é…ç½®
    backup.vaults = await _vaultRepo.getAll();

    // 2.0æ–°å¢ï¼šå¯¼å‡ºå®¶åº­æ•°æ®
    backup.familyData = await _familyRepo.getAll();

    // 2.0æ–°å¢ï¼šå¯¼å‡ºè‡ªå­¦ä¹ æ•°æ®
    if (includeLearningData) {
      backup.learningData = await _learningRepo.getAll();
    }

    // è®¾ç½®
    if (includeSettings) {
      backup.settings = await _settingsRepo.getAll();
    }

    // æ‰“åŒ…å¹¶å¯é€‰åŠ å¯†
    final file = await _packageBackup(backup, password);
    return file;
  }
}
```'''

    if old_text4 in content:
        content = content.replace(old_text4, new_text4)
        print("âœ“ ä¿®å¤4: æ‰©å±•æ•°æ®å¯¼å‡ºåŠŸèƒ½ï¼ˆæ·»åŠ PDFã€å¤‡ä»½ã€å®¶åº­å¯¼å‡ºç­‰ï¼‰")
        changes += 1

    if changes > 0:
        with open(filepath, 'w', encoding='utf-8') as f:
            f.write(content)
        print(f"\n===== ç¬¬11ç« æ•°æ®å¯¼å…¥å¯¼å‡ºç³»ç»Ÿå†…å®¹åˆ·æ–°å®Œæˆï¼Œå…± {changes} å¤„ =====")
    else:
        print("\næœªæ‰¾åˆ°ç›®æ ‡ä½ç½®æˆ–å·²åˆ·æ–°")

    return changes

if __name__ == '__main__':
    main()
