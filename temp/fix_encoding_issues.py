# -*- coding: utf-8 -*-
"""
修复文档中的乱码问题
"""

def main():
    filepath = 'd:/code/ai-bookkeeping/docs/design/app_v2_design.md'

    with open(filepath, 'r', encoding='utf-8') as f:
        content = f.read()

    changes = 0

    # 定义需要修复的乱码模式
    fixes = [
        # 第2章相关
        ('核��差异化功能', '核心差异化功能'),
        ('极致的交互体验���全AI智能化', '极致的交互体验、全AI智能化'),
        ('──────────────────────────────────────��──────────────────────────────────────', '────────────────────────────────────────────────────────────────────────────'),
        ('══════════════════════���════════════════════════════════════════════════', '═══════════════════════════════════════════════════════════════════════'),

        # 第7章/位置相关
        ('地���位置智能化应用', '地理位置智能化应用'),
        ('└─────┬───��─┘', '└─────┬─────┘'),

        # 第13章家庭账本相关
        ('(��一笔|添加)', '(记一笔|添加)'),
        ('家庭��员', '家庭成员'),

        # 第14章位置相关
        ('隐私设���', '隐私设置'),

        # 其他ASCII art修复
        ('───────────────────────────────��────────────────────────────────────────────', '─────────────────────────────────────────────────────────────────────────'),
        ('────────────┼��──────────────────────', '────────────┼─────────────────────────'),
        ('──────────────────────────────────────────��┘', '───────────────────────────────────────────┘'),
        ('│  ��', '│  │'),
        ('���', '│'),
        ('最少��作', '最少操作'),

        # 通用replacement character清理
        ('��', ''),
    ]

    for old, new in fixes:
        if old in content:
            count = content.count(old)
            content = content.replace(old, new)
            print(f"Fixed: '{old[:30]}...' -> '{new[:30]}...' ({count} occurrences)")
            changes += count

    # 写入文件
    if changes > 0:
        with open(filepath, 'w', encoding='utf-8') as f:
            f.write(content)
        print(f"\n===== Encoding fix done, {changes} total fixes =====")
    else:
        print("\nNo encoding issues found")

    return changes

if __name__ == '__main__':
    main()
