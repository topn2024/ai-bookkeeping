# -*- coding: utf-8 -*-
"""
更新6.2.2核心功能数据流关系图中的章节号引用
"""

def main():
    filepath = 'd:/code/ai-bookkeeping/docs/design/app_v2_design.md'

    with open(filepath, 'r', encoding='utf-8') as f:
        content = f.read()

    changes = 0

    # 修复1: 可观测性与监控章节号 22 -> 25
    old_text = '''   │   ┌─────────────────────────────────────────────────────────────────────────┐  │
   │   │                      可观测性与监控 (第22章)                             │  │
   │   │                                                                         │  │
   │   │   全链路追踪 ────────► 用户行为日志，性能指标，错误追踪                  │  │
   │   │   业务指标 ──────────► 钱龄分布，预算执行率，习惯打卡率                  │  │
   │   │   健康监控 ──────────► AI服务可用性，同步成功率，响应时间                │  │
   │   └─────────────────────────────────────────────────────────────────────────┘  │'''

    new_text = '''   │   ┌─────────────────────────────────────────────────────────────────────────┐  │
   │   │                      可观测性与监控 (第25章)                             │  │
   │   │                                                                         │  │
   │   │   全链路追踪 ────────► 用户行为日志，性能指标，错误追踪                  │  │
   │   │   业务指标 ──────────► 钱龄分布，预算执行率，习惯打卡率                  │  │
   │   │   健康监控 ──────────► AI服务可用性，同步成功率，响应时间                │  │
   │   └─────────────────────────────────────────────────────────────────────────┘  │
   │                                                                                 │
   │   ┌─────────────────────────────────────────────────────────────────────────┐  │
   │   │                      家庭账本协作 (第13章)                               │  │
   │   │                                                                         │  │
   │   │   交易同步 ──────────► 共享记账，成员贡献展示，实时协作                  │  │
   │   │   预算共享 ──────────► 家庭预算，成员配额，智能分配                      │  │
   │   │   权限管理 ──────────► 角色控制，隐私保护，访问控制                      │  │
   │   └─────────────────────────────────────────────────────────────────────────┘  │
   │                                                                                 │
   │   ┌─────────────────────────────────────────────────────────────────────────┐  │
   │   │                      语音交互系统 (第18章)                               │  │
   │   │                                                                         │  │
   │   │   意图理解 ──────────► 语音识别，意图分类，多轮对话                      │  │
   │   │   自学习增强 ────────► 个性化适应，协同学习，模型迭代                    │  │
   │   │   反馈优化 ──────────► 用户纠正，准确率提升，持续改进                    │  │
   │   └─────────────────────────────────────────────────────────────────────────┘  │
   │                                                                                 │
   │   ┌─────────────────────────────────────────────────────────────────────────┐  │
   │   │                      用户增长系统 (第28-29章)                            │  │
   │   │                                                                         │  │
   │   │   NPS提升 ───────────► 满意度追踪，口碑传播，用户推荐                    │  │
   │   │   自然增长 ──────────► 邀请裂变，分享引导，ASO优化                       │  │
   │   │   留存转化 ──────────► 成就激励，习惯巩固，价值展示                      │  │
   │   └─────────────────────────────────────────────────────────────────────────┘  │'''

    if old_text in content:
        content = content.replace(old_text, new_text)
        print("✓ 更新1: 6.2.2添加家庭账本/语音交互/用户增长模块")
        changes += 1

    if changes > 0:
        with open(filepath, 'w', encoding='utf-8') as f:
            f.write(content)
        print(f"\n===== 6.2.2更新完成，共 {changes} 处 =====")
    else:
        print("\n未找到目标位置或已更新")

    return changes

if __name__ == '__main__':
    main()
