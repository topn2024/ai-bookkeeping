# -*- coding: utf-8 -*-
"""
æ·»åŠ ç¬¬13ç« å®¶åº­è´¦æœ¬çš„äº¤å‰å¼•ç”¨ï¼š
1. ç¬¬2ç« ç”¨æˆ·ç”»åƒä¸­çš„å®¶åº­ç†è´¢è€… -> ç¬¬13ç« 
2. ç¬¬29ç« è£‚å˜æœºåˆ¶ä¸­çš„å®¶åº­è´¦æœ¬è£‚å˜ -> ç¬¬13ç« 
3. ç¬¬13ç« æœ«å°¾ -> ç›¸å…³ç« èŠ‚ï¼ˆç¬¬7ç« é’±é¾„ã€ç¬¬8ï¿½ï¿½é¢„ç®—ã€ç¬¬29ç« è£‚å˜ï¼‰
"""

def main():
    filepath = 'd:/code/ai-bookkeeping/docs/design/app_v2_design.md'

    with open(filepath, 'r', encoding='utf-8') as f:
        content = f.read()

    changes = 0

    # 1. åœ¨ç¬¬2ç« ç”¨æˆ·ç”»åƒè¡¨æ ¼ä¸­çš„å®¶åº­ç†è´¢è€…è¡Œåæ·»åŠ äº¤å‰å¼•ç”¨
    # æ‰¾åˆ°å®¶åº­ç†è´¢è€…è¡Œä¹‹åçš„ä½ç½®
    old_text1 = '''| **å®¶åº­ç†è´¢è€…** | å®¶åº­å¼€æ”¯éš¾ä»¥è§„åˆ’å’Œè¿½è¸ª | å…±äº«è´¦æœ¬ã€é¢„ç®—åˆ†ç±»ã€æ”¯å‡ºè¶‹åŠ¿åˆ†æ |
| **è‡ªç”±èŒä¸šè€…** | æ”¶å…¥ä¸å›ºå®šï¼Œéœ€è¦ç°é‡‘æµç®¡ç† | æ”¶å…¥è¿½è¸ªã€ç¨åŠ¡è¾…åŠ© |'''

    new_text1 = '''| **å®¶åº­ç†è´¢è€…** | å®¶åº­å¼€æ”¯éš¾ä»¥è§„åˆ’å’Œè¿½è¸ª | å…±äº«è´¦æœ¬ã€é¢„ç®—åˆ†ç±»ã€æ”¯å‡ºè¶‹åŠ¿åˆ†æ |
| **è‡ªç”±èŒä¸šè€…** | æ”¶å…¥ä¸å›ºå®šï¼Œéœ€è¦ç°é‡‘æµç®¡ç† | æ”¶å…¥è¿½è¸ªã€ç¨åŠ¡è¾…åŠ© |

> ğŸ“ **ç›¸å…³ç« èŠ‚**ï¼šå®¶åº­ç†è´¢è€…æ ¸å¿ƒåŠŸèƒ½è¯¦è§[ç¬¬13ç«  å®¶åº­è´¦æœ¬ä¸å¤šæˆå‘˜ç®¡ç†ç³»ç»Ÿ](#13-å®¶åº­è´¦æœ¬ä¸å¤šæˆå‘˜ç®¡ç†ç³»ç»Ÿ)'''

    if old_text1 in content:
        if 'å®¶åº­ç†è´¢è€…æ ¸å¿ƒåŠŸèƒ½è¯¦è§' not in content:
            content = content.replace(old_text1, new_text1)
            print("å·²æ·»åŠ ç¬¬2ç« ç”¨æˆ·ç”»åƒåˆ°ç¬¬13ç« çš„äº¤å‰å¼•ç”¨")
            changes += 1
        else:
            print("ç¬¬2ç« äº¤å‰å¼•ç”¨å·²å­˜åœ¨")
    else:
        print("æœªæ‰¾åˆ°ç¬¬2ç« æ’å…¥ä½ç½®")

    # 2. åœ¨ç¬¬29.4.1èŠ‚å®¶åº­è´¦æœ¬è£‚å˜æ ‡é¢˜åæ·»åŠ äº¤å‰å¼•ç”¨
    old_text2 = '''#### 29.4.1 å®¶åº­è´¦æœ¬è£‚å˜

å®¶åº­è´¦æœ¬æ˜¯å¤©ç„¶çš„è£‚å˜åœºæ™¯ï¼Œåˆ›å»ºè€…å¿…ç„¶ä¼šé‚€è¯·å®¶äººåŠ å…¥ã€‚'''

    new_text2 = '''#### 29.4.1 å®¶åº­è´¦æœ¬è£‚å˜

> ğŸ“ **ç›¸å…³ç« èŠ‚**ï¼šå®¶åº­è´¦æœ¬æ ¸å¿ƒåŠŸèƒ½å®ç°è¯¦è§[ç¬¬13ç«  å®¶åº­è´¦æœ¬ä¸å¤šæˆå‘˜ç®¡ç†ç³»ç»Ÿ](#13-å®¶åº­è´¦æœ¬ä¸å¤šæˆå‘˜ç®¡ç†ç³»ç»Ÿ)

å®¶åº­è´¦æœ¬æ˜¯å¤©ç„¶çš„è£‚å˜åœºæ™¯ï¼Œåˆ›å»ºè€…å¿…ç„¶ä¼šé‚€è¯·å®¶äººåŠ å…¥ã€‚'''

    if old_text2 in content:
        if 'å®¶åº­è´¦æœ¬æ ¸å¿ƒåŠŸèƒ½å®ç°è¯¦è§' not in content:
            content = content.replace(old_text2, new_text2)
            print("å·²æ·»åŠ ç¬¬29.4.1èŠ‚åˆ°ç¬¬13ç« çš„äº¤å‰å¼•ç”¨")
            changes += 1
        else:
            print("ç¬¬29.4.1èŠ‚äº¤å‰å¼•ç”¨å·²å­˜åœ¨")
    else:
        print("æœªæ‰¾åˆ°ç¬¬29.4.1èŠ‚æ’å…¥ä½ç½®")

    if changes > 0:
        with open(filepath, 'w', encoding='utf-8') as f:
            f.write(content)
        print(f"\nå·²å®Œæˆ {changes} å¤„äº¤å‰å¼•ç”¨æ·»åŠ ")
    else:
        print("\næœªåšä»»ä½•ä¿®æ”¹")

if __name__ == '__main__':
    main()
