# -*- coding: utf-8 -*-
"""
在设计文档第20章用户体验设计中添加极致体验改进方案的引用
"""

def main():
    filepath = 'd:/code/ai-bookkeeping/docs/design/app_v2_design.md'

    with open(filepath, 'r', encoding='utf-8') as f:
        content = f.read()

    changes = 0

    # 在20.0.1表格之后添加新的小节
    old_text = '''| **信任建立** | 透明可控 | 数据可导出、操作可撤销、隐私设置 | 用户投诉率<0.1% |'''

    new_text = '''| **信任建立** | 透明可控 | 数据可导出、操作可撤销、隐私设置 | 用户投诉率<0.1% |

#### 20.0.2 极致体验改进计划

> 📎 **详细改进方案**：见 [极致体验改进方案](./extreme_experience_improvements.md)

基于产品体验审视，识别出以下核心改进点：

| 优先级 | 问题 | 改进方案 | 预期效果 |
|--------|------|----------|----------|
| **P0** | 记账流程步骤不清晰 | 三档确认模式：极速/快速确认/详细编辑 | 平均耗时从5-8秒降至2-4秒 |
| **P0** | 新用户准确率低 | 四步冷启动加速：画像+导入+强化学习+预算初始化 | 首周分类准确率从70%提升至85% |
| **P0** | 初始配置复杂 | 渐进式配置：快速开始+场景触发配置 | 首次记账步骤从6-8步减至2步 |
| **P0** | 伙伴文案只有鼓励 | 可行建议型文案：分析+建议+行动按钮 | 建议采纳率≥30% |
| **P1** | 错误纠正成本高 | 一键重新识别+多笔快速调整+自动降级 | 纠正步骤≤2步 |
| **P1** | 家庭账本复杂 | 分层设计：简单共享→家庭模式→高级模式 | 邀请成功率≥80% |
| **P1** | 激励疲劳 | 智能激励衰减+用户可配置强度 | 4周后忽略率≤20% |

**三档确认模式设计**：

```
┌─────────────────────────────────────────────────────────────────┐
│                    记账确认模式决策树                             │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│   识别完成                                                       │
│       │                                                         │
│       ▼                                                         │
│   ┌──────────────────┐                                          │
│   │ 置信度评估        │                                          │
│   └────────┬─────────┘                                          │
│            │                                                    │
│   ┌────────┼────────┬────────────────┐                          │
│   │        │        │                │                          │
│   ▼        ▼        ▼                ▼                          │
│ ≥95%     80-95%   <80%           识别失败                        │
│   │        │        │                │                          │
│   ▼        ▼        ▼                ▼                          │
│ ┌────┐  ┌────┐  ┌────┐          ┌────┐                          │
│ │极速│  │快速│  │详细│          │降级│                          │
│ │模式│  │确认│  │编辑│          │处理│                          │
│ └────┘  └────┘  └────┘          └────┘                          │
│   │        │        │                │                          │
│   ▼        ▼        ▼                ▼                          │
│ 自动     底部      编辑          重试/切换                        │
│ 保存     卡片      页面          输入方式                         │
│   │        │        │                │                          │
│ 1-2秒   2-4秒    5-10秒          视情况                          │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

**新用户冷启动加速**：

```
用户首次打开
     │
     ▼
┌─────────────┐    ┌─────────────┐    ┌─────────────┐    ┌─────────────┐
│ Step 1      │    │ Step 2      │    │ Step 3      │    │ Step 4      │
│ 快速画像    │───►│ 历史导入    │───►│ 强化学习    │───►│ 预算初始化  │
│ (30秒)      │    │ (可选)      │    │ (前7天)     │    │ (智能推荐)  │
└─────────────┘    └─────────────┘    └─────────────┘    └─────────────┘
      │                  │                  │                  │
      ▼                  ▼                  ▼                  ▼
   3个问题           导入账单            每笔确认           选择方案
   加载模板          提升准确率          快速学习           或微调
```'''

    if old_text in content:
        content = content.replace(old_text, new_text)
        print("OK: Added 20.0.2 极致体验改进计划")
        changes += 1

    # 写入文件
    if changes > 0:
        with open(filepath, 'w', encoding='utf-8') as f:
            f.write(content)
        print(f"\n===== UX improvements reference added, {changes} changes =====")
    else:
        print("\nNo changes made - marker not found")

    return changes

if __name__ == '__main__':
    main()
