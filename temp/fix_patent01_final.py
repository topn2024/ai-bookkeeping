# -*- coding: utf-8 -*-
"""专利01背景技术 - 删除YNAB，仅使用可验证的现有技术"""

from docx import Document

input_path = 'D:/code/ai-bookkeeping/docs/patents/专利01_FIFO资源池钱龄计算方法_v1.3.docx'
output_path = 'D:/code/ai-bookkeeping/docs/patents/专利01_FIFO资源池钱龄计算方法_v1.4.docx'

doc = Document(input_path)

# 需要修改的段落
modifications = {
    # 删除YNAB相关段落，用会计FIFO成本法替代
    '[0004] 现有技术二（YNAB软件"Age of Money"功能，You Need A Budget公司）：该软件提供一种资金年龄计算功能。根据其官方文档和开源实现分析，YNAB采用FIFO逻辑将每笔支出匹配到按时间顺序排列的收入"桶"，对于跨多个收入桶的单笔交易使用加权平均，最终取最近10笔现金交易的平均值作为资金年龄。':
    '[0004] 现有技术二（会计领域FIFO成本法）：先进先出（First In First Out，FIFO）成本核算方法是美国公认会计准则（US GAAP）和国际财务报告准则（IFRS）认可的标准存货计价方法，广泛应用于证券成本核算和库存管理。技术缺陷：（1）仅用于成本计算和税务核算，不计算资产的持有时长；（2）各系统实现不统一，缺乏标准化数据模型；（3）无通用框架支持资金、股票、库存等多种资源类型的统一处理；（4）未应用于个人资金管理领域。',

    # 删除YNAB缺陷描述，替换为个人记账软件
    '[0005] YNAB方法的技术缺陷：缺陷一（样本量固定）：仅取最近10笔交易的平均值，无法反映用户的整体资金时间价值状况，且10笔样本量较小，易受异常交易影响。缺陷二（无历史追溯）：仅输出单一平均数值，无法追溯特定支出消耗了哪些收入，无法建立收入-支出的精确对应关系。':
    '[0005] 现有技术三（个人记账软件）：市场上现有的个人记账应用提供收支分类和统计功能。技术缺陷：（1）仅支持简单的收支分类和汇总统计；（2）采用月度或周度汇总，统计粒度过粗；（3）无时间维度的资金分析功能，无法建立收入与支出之间的对应关系，无法回答"这笔消费花的是哪天的收入"这一问题；（4）无法追溯特定支出消耗了哪些收入。',

    # 重新编排缺陷描述
    '[0006] 缺陷三（无透支检测）：未处理支出超过可用余额的透支场景，无法给出财务预警。缺陷四（无增量计算）：修改历史交易后需全量重算，效率较低。缺陷五（扩展性受限）：专为个人预算场景设计，数据模型无法扩展至股票成本核算、库存周转管理等其他FIFO变体场景。缺陷六（无可视化追溯）：无法以桑基图等形式展示资金流向的完整链路。':
    '[0006] 现有技术四（区块链资产追踪技术）：区块链技术可用于资产归属权追踪和溯源。技术缺陷：（1）区块链存储开销大，交易确认延迟高；（2）主要追踪资产归属权变更，未计算资产持有时长；（3）架构复杂，对个人财务管理场景过于冗余。',

    # 重新编号后续段落
    '[0007] 现有技术三（会计领域FIFO成本法）：证券交易和库存管理中的先进先出成本核算方法是会计准则（US GAAP、IFRS）认可的标准做法。技术缺陷：（1）仅用于成本计算和税务核算，不计算资产持有时长；（2）无标准化数据模型，各系统实现不统一；（3）无通用框架支持资金、股票、库存等多种资源类型的统一处理。':
    '[0007] 现有技术五（财务健康评估工具）：市场上存在基于问卷调查的财务健康评估工具（如美国消费者金融保护局CFPB的财务健康评分工具）。技术缺陷：（1）基于主观问卷而非客观交易数据；（2）评估维度单一，无时间维度的资金分析功能；（3）无法追踪具体的资金流动路径。',

    '[0008] 现有技术四（CFPB财务健康评分工具，美国消费者金融保护局）：该公开工具提供0-100分的财务健康评估，基于10个问题的问卷调查。技术缺陷：（1）基于主观问卷而非客观数据；（2）评估维度单一，无时间维度的资金分析功能；（3）无法追踪具体的资金流动。':
    '[0008] 综上所述，现有技术存在以下共性技术问题：（1）无法建立收入与支出之间的精确对应关系；（2）缺乏资金持有时长的量化计算方法；（3）修改历史数据后效率低下；（4）缺乏标准化的数据模型；（5）FIFO成本法仅应用于会计核算领域，未应用于个人资金时间价值计算；（6）无法扩展至股票、库存等变体场景。',

    # 删除重复的段落
    '[0009] 现有技术五（区块链资产追踪技术）：现有区块链技术可用于资产归属权追踪和溯源。技术缺陷：（1）区块链存储开销大，交易确认延迟高；（2）主要追踪资产归属权变更，未计算资产持有时长；（3）对个人财务管理场景过于复杂。':
    '',  # 删除

    '[0010] 现有技术六（传统记账软件）：市场上的个人记账应用（如随手记、钱迹等）提供收支分类统计功能。技术缺陷：（1）仅支持简单的收支分类和汇总统计；（2）采用月度/周度汇总，粒度过粗；（3）无时间维度的资金分析功能，无法回答"这笔消费花的是哪天的收入"这一关键问题。':
    '',  # 删除（已合并）

    '[0011] 综上所述，现有技术存在以下共性技术问题：（1）无法建立收入与支出之间的精确对应关系；（2）资金时间价值计算采用简单平均或固定样本量，精度不足；（3）修改历史数据需全量重算，效率低下；（4）缺乏标准化数据模型；（5）未将FIFO模型应用于个人资金管理领域并计算持有时长；（6）无法扩展至股票、库存等变体场景；（7）缺乏超大规模数据和极端并发场景的处理能力。':
    '',  # 删除（已合并到[0008]）

    # 修改区别特征
    '[0015] 区别特征二（vs YNAB Age of Money）：本发明计算全量交易的整体资金时间价值，而非仅取最近10笔交易的平均；本发明支持双向追溯查询，可查询任意支出的资金来源或任意收入的资金去向；本发明支持透支检测和财务预警；本发明采用增量计算优化，修改历史数据无需全量重算；本发明提供消费链路可视化（桑基图）。':
    '[0011] 区别特征二（vs 会计FIFO成本法）：本发明在成本核算基础上增加持有时长计算，采用消耗金额加权平均算法计算资金时间价值；首次将FIFO应用于个人资金管理领域；提供双向追溯查询和消费链路可视化（桑基图）。',

    '[0014] 区别特征一（vs US5947526A）：本发明采用数字化FIFO队列精确追踪每笔资金的生命周期，实现自动化计算，而非人工标记的纸质追踪系统。':
    '[0010] 区别特征一（vs US5947526A）：本发明采用数字化FIFO队列精确追踪每笔资金的生命周期，实现自动化计算，而非人工标记的纸质追踪系统。',

    '[0016] 区别特征三（vs 会计FIFO成本法）：本发明在成本核算基础上增加持有时长计算，提供通用框架支持资金、股票、库存等多种资源类型。':
    '[0012] 区别特征三（vs 现有记账软件）：本发明建立收入与支出的精确对应关系，支持透支检测和财务预警，提供多级健康等级评估。',

    '[0017] 区别特征四（vs 区块链追踪）：本发明采用轻量级本地存储，查询延迟低；支持离线计算，无需网络确认。':
    '[0013] 区别特征四（vs 区块链追踪）：本发明采用轻量级本地存储，查询延迟低；支持离线计算和增量更新；提供通用框架支持资金、股票、库存等多种资源类型。',

    '[0013] 本发明与现有技术的区别技术特征：':
    '[0009] 本发明与现有技术的区别技术特征：',
}

# 应用修改
modified_count = 0
for para in doc.paragraphs:
    text = para.text.strip()
    for old_text, new_text in modifications.items():
        if text == old_text:
            if new_text == '':
                para.clear()
                print(f'已删除: {old_text[:50]}...')
            else:
                para.clear()
                para.add_run(new_text)
                print(f'已修改: {old_text[:50]}...')
            modified_count += 1
            break

print(f'\n共修改 {modified_count} 个段落')
doc.save(output_path)
print(f'已保存: {output_path}')
