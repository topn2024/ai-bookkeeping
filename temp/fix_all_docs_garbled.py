# -*- coding: utf-8 -*-
"""
修复所有文档中的乱码字符
"""

import re
import os

def fix_file(filepath):
    with open(filepath, 'r', encoding='utf-8') as f:
        content = f.read()

    original = content

    # 文件特定修复
    fixes = {
        'AI智能记账2.0功能特性清单.md': [
            ('用户可添加/编辑/删除���类', '用户可添加/编辑/删除分类'),
            ('高级功能按��展开', '高级功能按需展开'),
            ('遇到问题时提供���助', '遇到问题时提供帮助'),
        ],
        'AI智能记账2.0竞品分析报告.md': [
            ('差��化营销', '差异化营销'),
            ('└────────────────���────────────────────────────────────────────────┘', '└─────────────────────────────────────────────────────────────────┘'),
            ('上手简��', '上手简单'),
            ('"和偶��一起记账"', '"和偶像一起记账"'),
            ('与虚拟偶像���话记账', '与虚拟偶像对话记账'),
            ('Age of Money）原��', 'Age of Money）原创'),
            ('| 趋势预测 | ✅ AI | �� | ❌ | ❌ | ❌ |', '| 趋势预测 | ✅ AI | ✅ | ❌ | ❌ | ❌ |'),
            ('┌────────────────────────────────────────────────────────���────────┐', '┌─────────────────────────────────────────────────────────────────┐'),
            ('有效的用��获取渠道', '有效的用户获取渠道'),
            ('需要持续创���保持领先', '需要持续创新保持领先'),
        ],
        'AI智能记账2.0战略分析报告（五看三定）.md': [
            ('看竞争、看��己、看机会', '看竞争、看自己、看机会'),
            ('┌──────────────────────────────────��──────────────────────────────────┐', '┌────────────────────────────────────────────────────────────────────┐'),
            ('┌────────────────────────────────────────��────────────────────┐', '┌──────────────────────────────────────────────────────────────┐'),
            ('├────────────────────────────────────────���────────────────────────────┤', '├─────────────────────────────────────────────────────────────────────┤'),
            ('| ��白 | AI+预算管理无强力竞品', '| 空白 | AI+预算管理无强力竞品'),
            ('(可把握机���)', '(可把握机会)'),
            ('| **战略价值** | ��⭐⭐⭐ |', '| **战略价值** | ⭐⭐⭐⭐ |'),
            ('┌────────────────────────────────────────────────────��────────┐', '┌──────────────────────────────────────────────────────────────┐'),
            ('### 7.3 ��段里程碑', '### 7.3 阶段里程碑'),
            ('口碑���播', '口碑传播'),
            ('┼─────┼─────┼─────┼─────┼��────┼─────┼', '┼─────┼─────┼─────┼─────┼─────┼─────┼'),
            ('差异化明显，��护城河潜力', '差异化明显，有护城河潜力'),
        ],
    }

    filename = os.path.basename(filepath)
    if filename in fixes:
        for old, new in fixes[filename]:
            if old in content:
                content = content.replace(old, new)
                print(f"  ✅ {old[:25]}... -> {new[:25]}...")

    # 通用修复：移除残留的replacement character
    content = re.sub(r'�+', '', content)

    if content != original:
        with open(filepath, 'w', encoding='utf-8') as f:
            f.write(content)
        return True
    return False

def main():
    files = [
        'd:/code/ai-bookkeeping/docs/AI智能记账2.0功能特性清单.md',
        'd:/code/ai-bookkeeping/docs/AI智能记账2.0竞品分析报告.md',
        'd:/code/ai-bookkeeping/docs/AI智能记账2.0战略分析报告（五看三定）.md',
    ]

    for filepath in files:
        print(f"\n处理: {os.path.basename(filepath)}")
        if fix_file(filepath):
            print(f"  ✅ 修复完成")
        else:
            print(f"  ℹ️ 无需修复")

if __name__ == '__main__':
    main()
