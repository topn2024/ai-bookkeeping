# -*- coding: utf-8 -*-
"""修正专利01中对YNAB的描述 - 保存为v1.3"""

from docx import Document

input_path = 'D:/code/ai-bookkeeping/docs/patents/专利01_FIFO资源池钱龄计算方法_v1.2.docx'
output_path = 'D:/code/ai-bookkeeping/docs/patents/专利01_FIFO资源池钱龄计算方法_v1.3.docx'

doc = Document(input_path)

# 需要修正的内容
corrections = {
    # [0004] YNAB描述
    '[0004] 现有技术二（YNAB软件"Age of Money"功能，You Need A Budget公司）：该软件提供一种资金年龄计算功能，根据官方文档描述，其采用最近10笔交易的平均算法计算资金年龄。':
    '[0004] 现有技术二（YNAB软件"Age of Money"功能，You Need A Budget公司）：该软件提供一种资金年龄计算功能。根据其官方文档和开源实现分析，YNAB采用FIFO逻辑将每笔支出匹配到按时间顺序排列的收入"桶"，对于跨多个收入桶的单笔交易使用加权平均，最终取最近10笔现金交易的平均值作为资金年龄。',

    # [0005] YNAB缺陷描述
    '[0005] YNAB方法的技术缺陷：缺陷一（样本量固定）：固定取最近10笔交易的平均值，忽略交易金额差异。量化分析：用户1月收入1000元、2月收入9000元，3月消费5000元。YNAB算法（简单平均）无法区分不同金额的贡献权重。正确计算（FIFO加权）：(1000×60 + 4000×30)/5000 = 36天，能精确反映资金流动。':
    '[0005] YNAB方法的技术缺陷：缺陷一（样本量固定）：仅取最近10笔交易的平均值，无法反映用户的整体资金时间价值状况，且10笔样本量较小，易受异常交易影响。缺陷二（无历史追溯）：仅输出单一平均数值，无法追溯特定支出消耗了哪些收入，无法建立收入-支出的精确对应关系。',

    # [0006] 更多缺陷
    '[0006] 缺陷二（无法追溯）：仅输出单一数值，无法建立收入-支出的精确对应关系。缺陷三（粒度不足）：以交易笔数而非金额为统计单位，大额交易与小额交易权重相同。缺陷四（无透支检测）：未处理支出超过可用余额的场景。缺陷五（扩展性受限）：专为个人预算设计，无法扩展至股票成本核算、库存管理等FIFO变体场景。':
    '[0006] 缺陷三（无透支检测）：未处理支出超过可用余额的透支场景，无法给出财务预警。缺陷四（无增量计算）：修改历史交易后需全量重算，效率较低。缺陷五（扩展性受限）：专为个人预算场景设计，数据模型无法扩展至股票成本核算、库存周转管理等其他FIFO变体场景。缺陷六（无可视化追溯）：无法以桑基图等形式展示资金流向的完整链路。',

    # [0015] 区别特征二
    '[0015] 区别特征二（vs YNAB Age of Money）：本发明采用金额加权FIFO算法，钱龄 = Σ(消耗金额ᵢ×天数ᵢ) / Σ(消耗金额ᵢ)（加权平均），考虑每笔资金的实际金额贡献，而非固定样本量的简单平均，精度显著提升。':
    '[0015] 区别特征二（vs YNAB Age of Money）：本发明计算全量交易的整体资金时间价值，而非仅取最近10笔交易的平均；本发明支持双向追溯查询，可查询任意支出的资金来源或任意收入的资金去向；本发明支持透支检测和财务预警；本发明采用增量计算优化，修改历史数据无需全量重算；本发明提供消费链路可视化（桑基图）。',
}

modified_count = 0
for para in doc.paragraphs:
    text = para.text.strip()
    for old_text, new_text in corrections.items():
        if text == old_text:
            para.clear()
            para.add_run(new_text)
            print(f'已修正: {old_text[:50]}...')
            modified_count += 1
            break

print(f'\n共修正 {modified_count} 个段落')
doc.save(output_path)
print(f'已保存: {output_path}')
