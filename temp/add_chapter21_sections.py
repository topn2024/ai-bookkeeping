# -*- coding: utf-8 -*-
"""
添加第21章协同关系图和系统集成部分
"""

def main():
    filepath = 'd:/code/ai-bookkeeping/docs/design/app_v2_design.md'

    with open(filepath, 'r', encoding='utf-8') as f:
        content = f.read()

    changes = 0

    # 1. 在21.0.2后添加21.0.3协同关系图
    old_after_target = '''| **RTL支持** | 为未来预留 | 架构支持RTL布局扩展 |

### 21.1 支持的语言'''

    new_with_relation = '''| **RTL支持** | 为未来预留 | 架构支持RTL布局扩展 |

#### 21.0.3 与其他系统的协同关系

```
┌────────────────────────────────────────────────────────────────────────────┐
│                      国际化与其他模块的协同关系                               │
├────────────────────────────────────────────────────────────────────────────┤
│                                                                            │
│                        ┌─────────────────────────┐                         │
│                        │   21. 国际化与本地化     │                         │
│                        │       （本章）           │                         │
│                        └───────────┬─────────────┘                         │
│                                    │                                       │
│        ┌───────────────────────────┼───────────────────────────┐           │
│        │                           │                           │           │
│        ▼                           ▼                           ▼           │
│   ┌──────────┐              ┌──────────┐              ┌──────────┐        │
│   │ 10.AI    │              │ 11.分类   │              │ 20.用户   │        │
│   │  识别    │              │  系统    │              │  体验    │        │
│   │ ──────── │              │ ──────── │              │ ──────── │        │
│   │ AI多语言 │              │ 分类翻译 │              │ UI文本   │        │
│   │ 理解输出 │              │ 图标适配 │              │ 本地化   │        │
│   └──────────┘              └──────────┘              └──────────┘        │
│        │                           │                           │           │
│        └───────────────────────────┼───────────────────────────┘           │
│                                    ▼                                       │
│                        ┌─────────────────────────┐                         │
│                        │   15. 技术架构          │                         │
│                        │   - 资源加载机制        │                         │
│                        │   - 缓存策略            │                         │
│                        └─────────────────────────┘                         │
│                                                                            │
│  ════════════════════════════════════════════════════════════════════════  │
│                           2.0新增协作模块                                   │
│  ════════════════════════════════════════════════════════════════════════  │
│                                                                            │
│   ┌──────────┐  ┌──────────┐  ┌─���────────┐  ┌──────────┐  ┌──────────┐   │
│   │18.语音   │  │14.位置   │  │13.家庭   │  │9.习惯    │  │28-29.增长│   │
│   │  交互    │  │  智能    │  │  账本    │  │  培养    │  │  体系    │   │
│   │ ──────── │  │ ──────── │  │ ──────── │  │ ──────── │  │ ──────── │   │
│   │语音识别  │  │城市POI   │  │成员名称  │  │成就文案  │  │邀请文案  │   │
│   │多语言    │  │本地化    │  │多语言    │  │多语言    │  │多语言    │   │
│   └──────────┘  └──────────┘  └──────────┘  └──────────┘  └──────────┘   │
│                                                                            │
└────────────────────────────────────────────────────────────────────────────┘
```

### 21.1 支持的语言'''

    if old_after_target in content:
        content = content.replace(old_after_target, new_with_relation)
        print("OK: Added 21.0.3 relation diagram")
        changes += 1
    else:
        print("SKIP: Target for 21.0.3 not found")

    # 2. 在21.9后添加21.10系统集成部分
    chapter22_marker = '## 22. 安全与隐私'

    new_section_21_10 = '''### 21.10 与其他系统集成

#### 21.10.1 系统集成概览

国际化系统与其他2.0模块的集成确保所有用户界面和内容正确本地化：

```
┌────────────────────────────────────────────────────────────────────────────┐
│                        国际化集成全景图                                      │
├────────────────────────────────────────────────────────────────────────────┤
│                                                                            │
│  ┌─────────────────────────────────────────────────────────────────────┐  │
│  │                        国际化核心服务                                 │  │
│  │  ┌──────────┐  ┌──────────┐  ┌──────────┐  ┌──────────┐           │  │
│  │  │ 语言管理  │  │ 货币格式  │  │ 日期格式  │  │ 资源加载  │           │  │
│  │  └──────────┘  └──────────┘  └──────────┘  └──────────┘           │  │
│  └───────────────────────────┬─────────────────────────────────────────┘  │
│                              │                                            │
│         ┌────────────────────┼────────────────────┐                       │
│         │                    │                    │                       │
│         ▼                    ▼                    ▼                       │
│  ┌─────────────┐     ┌─────────────┐     ┌─────────────┐                 │
│  │  UI文本      │     │  数据格式    │     │  AI内容      │                 │
│  │  本地化      │     │  本地化      │     │  本地化      │                 │
│  ├─────────────┤     ├─────────────┤     ├─────────────┤                 │
│  │ • 页面文本   │     │ • 货币显示   │     │ • 语音识别   │                 │
│  │ • 按钮标签   │     │ • 日期显示   │     │ • AI建议     │                 │
│  │ • 提示信息   │     │ • 数字格式   │     │ • 洞察文案   │                 │
│  └─────────────┘     └─────────────┘     └─────────────┘                 │
│                                                                            │
└────────────────────────────────────────────────────────────────────────────┘
```

#### 21.10.2 语音交互系统集成

语音识别需要根据用户语言设置调整识别语言和数字表达模式：

| 语言 | 识别语言代码 | 数字表达示例 | 货币表达示例 |
|------|-------------|-------------|-------------|
| 简体中文 | cmn-Hans-CN | "十块"、"一百" | "25块钱" |
| 繁体中文 | cmn-Hant-TW | "十塊"、"一百" | "25塊錢" |
| 英语 | en-US | "ten", "hundred" | "$25" |
| 日语 | ja-JP | "十円"、"百円" | "25円" |
| 韩语 | ko-KR | "십원"、"백원" | "25원" |

#### 21.10.3 AI系统集成

AI提示词和生成内容根据用户语言设置自动调整：

| 功能 | 本地化内容 | 示例 |
|------|-----------|------|
| 交易解析 | 提示词模板 | 请分析...（中文）/ Please analyze...（英文） |
| 洞察生成 | 输出语言 | 本月消费... / This month's spending... |
| 建议文案 | 建议内容 | 建议控制... / Consider reducing... |
| 分类识别 | 分类名称 | 返回本地化分类名 |

#### 21.10.4 分类系统集成

预设分类的多语言名称映射：

| 分类Key | 简中 | 繁中 | 英语 | 日语 | 韩语 |
|---------|------|------|------|------|------|
| food | 餐饮 | 餐飲 | Food | 食費 | 식비 |
| transport | 交通 | 交通 | Transportation | 交通費 | 교통 |
| shopping | ���物 | 購物 | Shopping | 買い物 | 쇼핑 |
| entertainment | 娱乐 | 娛樂 | Entertainment | 娯楽 | 오락 |
| healthcare | 医疗 | 醫療 | Healthcare | 医療 | 의료 |

#### 21.10.5 货币格式集成

支持的货币及其格式化规则：

| 货币 | 符号 | 小数位 | 千分位 | 示例 |
|------|------|--------|--------|------|
| CNY | ¥ | 2 | , | ¥1,234.56 |
| USD | $ | 2 | , | $1,234.56 |
| JPY | ¥ | 0 | , | ¥1,234 |
| KRW | ₩ | 0 | , | ₩1,234 |
| EUR | € | 2 | . | €1.234,56 |
| TWD | NT$ | 0 | , | NT$1,234 |
| HKD | HK$ | 2 | , | HK$1,234.56 |

#### 21.10.6 日期时间格式集成

不同语言的日期时间格式：

| 格式类型 | 简中 | 英语 | ���语 | 韩语 |
|----------|------|------|------|------|
| 短日期 | 12/25 | 12/25 | 12/25 | 12/25 |
| 中日期 | 2024年12月25日 | Dec 25, 2024 | 2024年12月25日 | 2024년 12월 25일 |
| 相对时间 | 3分钟前 | 3 minutes ago | 3分前 | 3분 전 |
| 星期 | 周一 | Mon | 月 | 월 |

---

'''

    if chapter22_marker in content:
        content = content.replace(chapter22_marker, new_section_21_10 + chapter22_marker)
        print("OK: Added 21.10 integration section")
        changes += 1
    else:
        print("SKIP: Chapter 22 marker not found")

    if changes > 0:
        with open(filepath, 'w', encoding='utf-8') as f:
            f.write(content)
        print(f"\nTotal: {changes} changes")

    return changes

if __name__ == '__main__':
    main()
