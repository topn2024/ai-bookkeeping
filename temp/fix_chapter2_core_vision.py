# -*- coding: utf-8 -*-
"""
修正第2章产品定位核心愿景
核心目标：帮助用户培养良好的金融习惯
理论基础：钱龄分析 + 零基预算
实现手段：全智能化 + 极致体验
"""

def main():
    filepath = 'd:/code/ai-bookkeeping/docs/design/app_v2_design.md'

    with open(filepath, 'r', encoding='utf-8') as f:
        content = f.read()

    changes = 0

    # ========== 修正2.0.1 产品定位设计原则矩阵 ==========
    old_matrix = '''#### 2.0.1 产品定位设计原则矩阵

| 设计原则 | 在产品定位中的体现 | 具体措施 |
|----------|-------------------|----------|
| 钱龄洞察 | 让用户理解每一分钱的时间价值 | FIFO钱龄计算、可视化展示、优化建议 |
| 零基预算 | 让每一分钱都有明确用途 | 收入全分配、小金库隔离、预算结转 |
| 习惯培养 | 帮助用户建立健康财务习惯 | 打卡激励、连续记录、成就体系 |
| 智能伙伴 | 有温度的全智能化财务伙伴 | AI识别、主动洞察、情感化交互 |
| 极致体验 | 零门槛、零学习成本 | 语音优先、智能默认、一键操作 |'''

    new_matrix = '''#### 2.0.1 产品定位设计原则矩阵

| 层次 | 设计原则 | 在产品定位中的体现 | 具体措施 |
|------|----------|-------------------|----------|
| **核心目标** | 习惯培养 | 帮助用户建立健康的金融习惯 | 渐进引导、正向激励、持续陪伴 |
| **理论基础** | 钱龄分析 | 让用户理解钱的时间价值 | FIFO计算、可视化、优化建议 |
| **理论基础** | 零基预算 | 让每一分钱都有明确用途 | 收入全分配、小金库隔离、预算结转 |
| **实现手段** | 全智能化 | 降低使用门槛，减少用户负担 | AI识别、智能分类、主动洞察 |
| **实现手段** | 极致体验 | 让用户更易接受、更愿持续使用 | 语音优先、一键操作、情感化交互 |'''

    if old_matrix in content:
        content = content.replace(old_matrix, new_matrix)
        print("OK: Updated 2.0.1 产品定位设计原则矩阵")
        changes += 1

    # ========== 修正2.0.2 设计理念图 ==========
    # 找到2.0.2并替换整个section
    lines = content.split('\n')
    start_idx = -1
    end_idx = -1

    for i, line in enumerate(lines):
        if '#### 2.0.2 设计理念' in line:
            start_idx = i
        if start_idx > 0 and '#### 2.0.3' in line:
            end_idx = i
            break

    if start_idx > 0 and end_idx > start_idx:
        new_section = '''#### 2.0.2 设计理念

```
产品愿景：您的智能财务伙伴，帮助您培养良好的金融习惯

┌─────────────────────────────────────────────────────────────────────────────┐
│                      AI智能记账2.0 产品定位层次                               │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│                    ┌─────────────────────────────┐                          │
│                    │       核心目标 (Why)         │                          │
│                    │                             │                          │
│                    │   帮助用户培养良好的金融习惯  │                          │
│                    │                             │                          │
│                    │  这是我们存在的根本意义      │                          │
│                    └──────────────┬──────────────┘                          │
│                                   │                                         │
│              ┌────────────────────┴────────────────────┐                    │
│              │           理论基础 (What)                │                    │
│              │    用户按此方法管钱，财务会慢慢健康       │                    │
│              └────────────────────┬────────────────────┘                    │
│                                   │                                         │
│              ┌────────────────────┼────────────────────┐                    │
│              │                                         │                    │
│              ▼                                         ▼                    │
│   ┌─────────────────────┐                   ┌─────────────────────┐        │
│   │      钱龄分析        │                   │      零基预算        │        │
│   │                     │                   │                     │        │
│   │  理解钱的时间价值    │                   │  让每分钱都有去处    │        │
│   │  知道花的是多久前    │                   │  收入100%分配       │        │
│   │  赚的钱             │                   │  小金库资金隔离      │        │
│   └─────────────────────┘                   └─────────────────────┘        │
│                                   │                                         │
│              ┌────────────────────┴────────────────────┐                    │
│              │           实现手段 (How)                 │                    │
│              │    让用户更容易接受，更愿意持续使用        │                    │
│              └────────────────────┬────────────────────┘                    │
│                                   │                                         │
│              ┌────────────────────┼────────────────────┐                    │
│              │                                         │                    │
│              ▼                                         ▼                    │
│   ┌─────────────────────┐                   ┌─────────────────────┐        │
│   │      全智能化        │                   │      极致体验        │        │
│   │                     │                   │                     │        │
│   │  语音/图像AI识别     │                   │  零门槛、零学习成本  │        │
│   │  智能分类推荐        │                   │  一键操作           │        │
│   │  主动洞察提醒        │                   │  情感化交互         │        │
│   │                     │                   │                     │        │
│   │  --> 降低使用门槛    │                   │  --> 易于接受       │        │
│   │  --> 减少用户负担    │                   │  --> 持续使用       │        │
│   └─────────────────────┘                   └─────────────────────┘        │
│                                                                             │
│                    ─────────────────────────────                            │
│                           扩展服务能力                                       │
│             家庭账本 - 位置智能 - 数据同步 - 报表导出                          │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘
```

**核心逻辑说明：**

1. **核心目标（Why）**：帮助用户培养良好的金融习惯 —— 这是产品存在的根本意义
2. **理论基础（What）**：钱龄分析 + 零基预算 —— 我们相信用户按这套方法管理金钱，财务会慢慢变得健康
3. **实现手段（How）**：全智能化 + 极致体验 —— 降低门槛、减少负担，让用户更容易接受、更愿意持续使用

'''
        new_lines = lines[:start_idx] + new_section.split('\n') + lines[end_idx:]
        content = '\n'.join(new_lines)
        print("OK: Updated 2.0.2 设计理念图")
        changes += 1

    # ========== 修正2.1 产品定位 ==========
    old_21 = '''### 2.1 产品定位

**"您的智能财务伙伴 —— 让每一分钱都有意义"**

AI智能记账 2.0 是一款**以钱龄分析和零基预算为核心**的全智能化财务伙伴应用。区别于传统记账工具的"记录"属性，我们致力于：

1. **让用户理解钱的时间价值** —— 通过钱龄分析，用户知道今天花的钱是多久之前赚的
2. **让每一分钱都有明确用途** —— 通过零基预算，收入被100%分配到各个小金库
3. **培养健康的财务习惯** —— 通过习惯培养系统，让记账成为自然而然的日常

我们不只是一个记账工具，而是一个**懂你的财务伙伴**——拥有极致的交互体验、全AI智能化的识别与洞察，帮助用户在财务管理的道路上不断成长。'''

    new_21 = '''### 2.1 产品定位

**"您的智能财务伙伴 —— 帮助您培养良好的金融习惯"**

AI智能记账 2.0 的**核心目标**是：**帮助用户培养良好的金融习惯**。

我们相信，一个人如果按照**钱龄分析**和**零基预算**的方法来管理自己的金钱，那么他的财务就会慢慢变得健康：

- **钱龄分析**：让用户理解钱的时间价值，知道今天花的钱是多久之前赚的，从而更珍惜每一分钱
- **零基预算**：让每一分钱都有明确用途，收入100%分配到各个小金库，避免"花剩下的才存"的被动模式

为了让用户更容易接受这套理论、更愿意持续使用，我们采用**全智能化**和**极致体验**作为实现手段：

- **全智能化**：语音/图像AI识别、智能分类推荐、主动洞察提醒 —— 降低使用门槛，减少用户负担
- **极致体验**：零门槛、零学习成本、一键操作、情感化交互 —— 让用户易于接受，愿意持续使用

我们不只是一个记账工具，而是一个**陪伴用户成长的财务伙伴**——帮助用户在财务管理的道路上，逐步养成良好的金融习惯。'''

    if old_21 in content:
        content = content.replace(old_21, new_21)
        print("OK: Updated 2.1 产品定位")
        changes += 1

    # 写入文件
    if changes > 0:
        with open(filepath, 'w', encoding='utf-8') as f:
            f.write(content)
        print(f"\n===== Chapter 2 core vision fix done, {changes} changes =====")
    else:
        print("\nNo changes needed")

    return changes

if __name__ == '__main__':
    main()
