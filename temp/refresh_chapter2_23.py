# -*- coding: utf-8 -*-
"""
åˆ·æ–°ç¬¬2ç« 2.3æ ¸å¿ƒä»·å€¼ä¸»å¼ 
æŒ‰ç…§Why-What-Howå±‚æ¬¡é‡æ–°ç»„ç»‡å†…å®¹
"""

def main():
    filepath = 'd:/code/ai-bookkeeping/docs/design/app_v2_design.md'

    with open(filepath, 'r', encoding='utf-8') as f:
        content = f.read()

    changes = 0

    # æ‰¾åˆ°2.3å’Œ2.4ä¹‹é—´çš„å†…å®¹å¹¶æ›¿æ¢
    lines = content.split('\n')
    start_idx = -1
    end_idx = -1

    for i, line in enumerate(lines):
        if '### 2.3 æ ¸å¿ƒä»·å€¼ä¸»å¼ ' in line:
            start_idx = i
        if start_idx > 0 and '### 2.4 ç«žå“å·®å¼‚åŒ–' in line:
            end_idx = i
            break

    if start_idx > 0 and end_idx > start_idx:
        new_section = '''### 2.3 æ ¸å¿ƒä»·å€¼ä¸»å¼ 

#### 2.3.1 ä»·å€¼ä¸»å¼ å±‚æ¬¡æž¶æž„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         æ ¸å¿ƒä»·å€¼ä¸»å¼  (Why-What-How)                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚  â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•— â”‚
â”‚  â•‘                      æ ¸å¿ƒç›®æ ‡ (Why)                                    â•‘ â”‚
â”‚  â•‘                                                                       â•‘ â”‚
â”‚  â•‘                 ðŸŽ¯ å¸®åŠ©ç”¨æˆ·åŸ¹å…»è‰¯å¥½çš„é‡‘èžä¹ æƒ¯                           â•‘ â”‚
â”‚  â•‘                                                                       â•‘ â”‚
â”‚  â•‘            è¿™æ˜¯æˆ‘ä»¬å­˜åœ¨çš„æ ¹æœ¬æ„ä¹‰ï¼Œæ˜¯ä¸€åˆ‡è®¾è®¡çš„å‡ºå‘ç‚¹                    â•‘ â”‚
â”‚  â•‘                                                                       â•‘ â”‚
â”‚  â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• â”‚
â”‚                                   â”‚                                         â”‚
â”‚                                   â–¼                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                      ç†è®ºåŸºç¡€ (What)                                   â”‚ â”‚
â”‚  â”‚              ç”¨æˆ·æŒ‰æ­¤æ–¹æ³•ç®¡é’±ï¼Œè´¢åŠ¡ä¼šæ…¢æ…¢å˜å¾—å¥åº·                        â”‚ â”‚
â”‚  â”‚                                                                       â”‚ â”‚
â”‚  â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚ â”‚
â”‚  â”‚   â”‚       â³ é’±é¾„åˆ†æž        â”‚    â”‚       ðŸ’° é›¶åŸºé¢„ç®—        â”‚         â”‚ â”‚
â”‚  â”‚   â”‚                         â”‚    â”‚                         â”‚         â”‚ â”‚
â”‚  â”‚   â”‚  ç†è§£é’±çš„æ—¶é—´ä»·å€¼        â”‚    â”‚  è®©æ¯åˆ†é’±éƒ½æœ‰åŽ»å¤„        â”‚         â”‚ â”‚
â”‚  â”‚   â”‚  çŸ¥é“èŠ±çš„æ˜¯å¤šä¹…å‰èµšçš„é’±  â”‚    â”‚  æ”¶å…¥100%åˆ†é…åˆ°å°é‡‘åº“    â”‚         â”‚ â”‚
â”‚  â”‚   â”‚  ä»Žè€Œæ›´çæƒœæ¯ä¸€åˆ†é’±      â”‚    â”‚  é¿å…"èŠ±å‰©æ‰å­˜"çš„è¢«åŠ¨    â”‚         â”‚ â”‚
â”‚  â”‚   â”‚                         â”‚    â”‚                         â”‚         â”‚ â”‚
â”‚  â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                   â”‚                                         â”‚
â”‚                                   â–¼                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                      å®žçŽ°æ‰‹æ®µ (How)                                    â”‚ â”‚
â”‚  â”‚              è®©ç”¨æˆ·æ›´å®¹æ˜“æŽ¥å—ç†è®ºï¼Œæ›´æ„¿æ„æŒç»­ä½¿ç”¨                         â”‚ â”‚
â”‚  â”‚                                                                       â”‚ â”‚
â”‚  â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚ â”‚
â”‚  â”‚   â”‚       ðŸ¤– å…¨æ™ºèƒ½åŒ–        â”‚    â”‚       âœ¨ æžè‡´ä½“éªŒ        â”‚         â”‚ â”‚
â”‚  â”‚   â”‚                         â”‚    â”‚                         â”‚         â”‚ â”‚
â”‚  â”‚   â”‚  è¯­éŸ³/å›¾åƒAIè¯†åˆ«         â”‚    â”‚  é›¶é—¨æ§›ã€é›¶å­¦ä¹ æˆæœ¬      â”‚         â”‚ â”‚
â”‚  â”‚   â”‚  æ™ºèƒ½åˆ†ç±»æŽ¨è           â”‚    â”‚  ä¸€é”®æ“ä½œã€æµç•…äº¤äº’      â”‚         â”‚ â”‚
â”‚  â”‚   â”‚  ä¸»åŠ¨æ´žå¯Ÿæé†’           â”‚    â”‚  æƒ…æ„ŸåŒ–è®¾è®¡ã€ä¼™ä¼´é™ªä¼´    â”‚         â”‚ â”‚
â”‚  â”‚   â”‚                         â”‚    â”‚                         â”‚         â”‚ â”‚
â”‚  â”‚   â”‚  --> é™ä½Žä½¿ç”¨é—¨æ§›       â”‚    â”‚  --> æ˜“äºŽæŽ¥å—           â”‚         â”‚ â”‚
â”‚  â”‚   â”‚  --> å‡å°‘ç”¨æˆ·è´Ÿæ‹…       â”‚    â”‚  --> æŒç»­ä½¿ç”¨           â”‚         â”‚ â”‚
â”‚  â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                   â”‚                                         â”‚
â”‚                                   â–¼                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                        æ‰©å±•æœåŠ¡èƒ½åŠ›                                    â”‚ â”‚
â”‚  â”‚              ä¸ºä¸åŒåœºæ™¯ç”¨æˆ·æä¾›å¢žå€¼æœåŠ¡                                  â”‚ â”‚
â”‚  â”‚                                                                       â”‚ â”‚
â”‚  â”‚   ðŸ‘¨â€ðŸ‘©â€ðŸ‘§â€ðŸ‘¦ å®¶åº­è´¦æœ¬    ðŸ“ ä½ç½®æ™ºèƒ½    ðŸ”„ æ•°æ®åŒæ­¥    ðŸ“Š æŠ¥è¡¨å¯¼å‡º    ðŸ”” æé†’   â”‚ â”‚
â”‚  â”‚                                                                       â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### 2.3.2 ä»·å€¼å±‚æ¬¡è¯¦è§£

| å±‚æ¬¡ | å†…å®¹ | æ ¸å¿ƒç†å¿µ | ç”¨æˆ·ä»·å€¼ |
|------|------|----------|----------|
| **æ ¸å¿ƒç›®æ ‡ (Why)** | åŸ¹å…»è‰¯å¥½é‡‘èžä¹ æƒ¯ | è¿™æ˜¯äº§å“å­˜åœ¨çš„æ ¹æœ¬æ„ä¹‰ | è´¢åŠ¡å¥åº·ã€ç”Ÿæ´»å®‰å¿ƒ |
| **ç†è®ºåŸºç¡€ (What)** | é’±é¾„åˆ†æž + é›¶åŸºé¢„ç®— | ç”¨æˆ·æŒ‰æ­¤ç®¡é’±ï¼Œè´¢åŠ¡ä¼šæ…¢æ…¢å¥åº· | ç†è§£é‡‘é’±ã€è§„åˆ’æœ‰æ–¹ |
| **å®žçŽ°æ‰‹æ®µ (How)** | å…¨æ™ºèƒ½åŒ– + æžè‡´ä½“éªŒ | é™ä½Žé—¨æ§›ï¼Œè®©ç”¨æˆ·æ›´æ˜“æŽ¥å— | è½»æ¾ä½¿ç”¨ã€æŒç»­åšæŒ |
| **æ‰©å±•æœåŠ¡** | å®¶åº­è´¦æœ¬ã€ä½ç½®æ™ºèƒ½ç­‰ | ä¸ºä¸åŒåœºæ™¯æä¾›å¢žå€¼èƒ½åŠ› | åœºæ™¯è¦†ç›–ã€åŠŸèƒ½ä¸°å¯Œ |

#### 2.3.3 æ ¸å¿ƒé€»è¾‘é“¾æ¡

```dart
/// äº§å“ä»·å€¼é€»è¾‘é“¾
class ProductValueChain {
  /// æ ¸å¿ƒé€»è¾‘è¯´æ˜Ž
  static const valueLogic = """
  1. æˆ‘ä»¬çš„æ ¸å¿ƒç›®æ ‡æ˜¯ï¼šå¸®åŠ©ç”¨æˆ·åŸ¹å…»è‰¯å¥½çš„é‡‘èžä¹ æƒ¯

  2. æˆ‘ä»¬ç›¸ä¿¡ï¼šç”¨æˆ·æŒ‰ç…§é’±é¾„åˆ†æžå’Œé›¶åŸºé¢„ç®—çš„æ–¹æ³•ç®¡é’±ï¼Œè´¢åŠ¡ä¼šæ…¢æ…¢å˜å¥åº·
     - é’±é¾„åˆ†æžï¼šè®©ç”¨æˆ·ç†è§£é’±çš„æ—¶é—´ä»·å€¼ï¼Œæ›´çæƒœæ¯ä¸€åˆ†é’±
     - é›¶åŸºé¢„ç®—ï¼šè®©æ¯åˆ†é’±éƒ½æœ‰åŽ»å¤„ï¼Œå˜è¢«åŠ¨å‚¨è“„ä¸ºä¸»åŠ¨è§„åˆ’

  3. ä¸ºäº†è®©ç”¨æˆ·æ›´å®¹æ˜“æŽ¥å—è¿™å¥—ç†è®ºï¼Œæˆ‘ä»¬é‡‡ç”¨ï¼š
     - å…¨æ™ºèƒ½åŒ–ï¼šé™ä½Žä½¿ç”¨é—¨æ§›ï¼Œå‡å°‘ç”¨æˆ·è´Ÿæ‹…
     - æžè‡´ä½“éªŒï¼šè®©ç”¨æˆ·æ˜“äºŽæŽ¥å—ï¼Œæ„¿æ„æŒç»­ä½¿ç”¨

  4. æœ€ç»ˆå½¢æˆæ­£å‘å¾ªçŽ¯ï¼š
     ç”¨æˆ·è½»æ¾ä½¿ç”¨ â†’ é€æ­¥ç†è§£ç†è®º â†’ å…»æˆå¥½ä¹ æƒ¯ â†’ è´¢åŠ¡å˜å¥åº· â†’ æ›´æ„¿æ„ä½¿ç”¨
  """;

  /// ç”¨æˆ·ä»·å€¼è½¬åŒ–è·¯å¾„
  static const userValuePath = [
    'ä¸‹è½½ä½¿ç”¨',      // è¢«æžè‡´ä½“éªŒå¸å¼•
    'è½»æ¾è®°è´¦',      // å…¨æ™ºèƒ½åŒ–é™ä½Žé—¨æ§›
    'ç†è§£é’±é¾„',      // é€æ­¥æŽ¥å—ç†è®º
    'è§„åˆ’é¢„ç®—',      // å¼€å§‹ä¸»åŠ¨ç®¡ç†
    'å…»æˆä¹ æƒ¯',      // å½¢æˆè‰¯å¥½ä¹ æƒ¯
    'è´¢åŠ¡å¥åº·',      // è¾¾æˆæ ¸å¿ƒç›®æ ‡
  ];
}
```

#### 2.3.4 ä¸Žç”¨æˆ·æ²Ÿé€šçš„ä»·å€¼ä¸»å¼ 

é¢å‘ä¸åŒç”¨æˆ·ç¾¤ä½“ï¼Œæˆ‘ä»¬çš„ä»·å€¼ä¸»å¼ è¡¨è¾¾æ–¹å¼ï¼š

| ç”¨æˆ·ç¾¤ä½“ | æ ¸å¿ƒç—›ç‚¹ | ä»·å€¼ä¸»å¼ è¡¨è¾¾ |
|----------|----------|--------------|
| **è®°è´¦æ–°æ‰‹** | ä¸çŸ¥é“é’±èŠ±å“ªäº† | "è¯´ä¸€å¥è¯å°±èƒ½è®°è´¦ï¼ŒAIå¸®ä½ è‡ªåŠ¨åˆ†ç±»" |
| **æœˆå…‰æ—** | æ€»æ˜¯å­˜ä¸ä¸‹é’± | "è®©æ¯ä¸€åˆ†é’±éƒ½æœ‰åŽ»å¤„ï¼Œå‘Šåˆ«æœˆå…‰" |
| **ç†è´¢çˆ±å¥½è€…** | æƒ³è¦æ›´æ·±å…¥çš„æ´žå¯Ÿ | "äº†è§£ä½ èŠ±çš„æ˜¯å¤šä¹…å‰èµšçš„é’±" |
| **å®¶åº­ç”¨æˆ·** | å®¶åº­è´¢åŠ¡ä¸é€æ˜Ž | "å…¨å®¶ä¸€èµ·è®°è´¦ï¼Œè´¢åŠ¡æ›´é€æ˜Ž" |
| **ä¹ æƒ¯åŸ¹å…»è€…** | åšæŒä¸ä¸‹æ¥ | "æ¯å¤©æ‰“å¡ï¼Œå…»æˆè‰¯å¥½è´¢åŠ¡ä¹ æƒ¯" |

'''
        new_lines = lines[:start_idx] + new_section.split('\n') + lines[end_idx:]
        content = '\n'.join(new_lines)
        print(f"OK: Replaced 2.3 section (lines {start_idx}-{end_idx})")
        changes += 1

    if changes > 0:
        with open(filepath, 'w', encoding='utf-8') as f:
            f.write(content)
        print(f"\n===== Chapter 2.3 refresh done, {changes} changes =====")
    else:
        print("\nNo changes made")

    return changes

if __name__ == '__main__':
    main()
