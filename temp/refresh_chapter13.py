# -*- coding: utf-8 -*-
"""
åˆ·æ–°ç¬¬13ç« å®¶åº­è´¦æœ¬ä¸å¤šæˆå‘˜ç®¡ç†ç³»ç»Ÿå†…å®¹
æ·»åŠ 2.0æ–°å¢æ¨¡å—é›†æˆ
"""

def main():
    filepath = 'd:/code/ai-bookkeeping/docs/design/app_v2_design.md'

    with open(filepath, 'r', encoding='utf-8') as f:
        content = f.read()

    changes = 0

    # ä¿®å¤1: åˆ·æ–°13.0.3ä¸å…¶ä»–ç³»ç»Ÿçš„å…³ç³»å›¾ - æ·»åŠ 2.0æ–°å¢æ¨¡å—
    old_text1 = '''```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ï¿½ï¿½â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      å®¶åº­è´¦æœ¬ç³»ç»Ÿä¸å…¶ä»–æ¨¡å—çš„å…³ç³»                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚                        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                           â”‚
â”‚                        â”‚   13. å®¶åº­è´¦æœ¬ç³»ç»Ÿ       â”‚                           â”‚
â”‚                        â”‚      ï¼ˆæœ¬ç« ï¼‰            â”‚                           â”‚
â”‚                        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                           â”‚
â”‚                                    â”‚                                         â”‚
â”‚        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ï¿½ï¿½ï¿½â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”‚
â”‚        â”‚                           â”‚                           â”‚             â”‚
â”‚        â–¼                           â–¼                           â–¼             â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚   â”‚ 7.é’±é¾„   â”‚              â”‚ 8.é¢„ç®—   â”‚              â”‚ 9.ä¹ æƒ¯   â”‚          â”‚
â”‚   â”‚  ç³»ç»Ÿ    â”‚              â”‚  ç³»ç»Ÿ    â”‚              â”‚  åŸ¹å…»    â”‚          â”‚
â”‚   â”‚ â”€â”€â”€â”€â”€â”€â”€â”€ â”‚              â”‚ â”€â”€â”€â”€â”€â”€â”€â”€ â”‚              â”‚ â”€â”€â”€â”€â”€â”€â”€â”€ â”‚          â”‚
â”‚   â”‚ å®¶åº­é’±é¾„ â”‚              â”‚ å®¶åº­é¢„ç®— â”‚              â”‚ å®¶åº­ä¹ æƒ¯ â”‚          â”‚
â”‚   â”‚ æˆå‘˜è´¡çŒ® â”‚              â”‚ æˆå‘˜é…é¢ â”‚              â”‚ å…±åŒç›®æ ‡ â”‚          â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â”‚        â”‚                           â”‚                           â”‚             â”‚
â”‚        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚
â”‚                                    â–¼                                         â”‚
â”‚                        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                           â”‚
â”‚                        â”‚   12. æ•°æ®è”åŠ¨ä¸å¯è§†åŒ–   â”‚                           â”‚
â”‚                        â”‚   - å®¶åº­æŠ¥è¡¨             â”‚                           â”‚
â”‚                        â”‚   - æˆå‘˜å¯¹æ¯”åˆ†æ         â”‚                           â”‚
â”‚                        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                           â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```'''

    new_text1 = '''```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      å®¶åº­è´¦æœ¬ç³»ç»Ÿä¸å…¶ä»–æ¨¡å—çš„å…³ç³»                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚                        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                           â”‚
â”‚                        â”‚   13. å®¶åº­è´¦æœ¬ç³»ç»Ÿ       â”‚                           â”‚
â”‚                        â”‚      ï¼ˆæœ¬ç« ï¼‰            â”‚                           â”‚
â”‚                        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€ï¿½ï¿½ï¿½â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                           â”‚
â”‚                                    â”‚                                         â”‚
â”‚        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”‚
â”‚        â”‚                           â”‚                           â”‚             â”‚
â”‚        â–¼                           â–¼                           â–¼             â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚   â”‚ 7.é’±é¾„   â”‚              â”‚ 8.é¢„ç®—   â”‚              â”‚ 9.ä¹ æƒ¯   â”‚          â”‚
â”‚   â”‚  ç³»ç»Ÿ    â”‚              â”‚  ç³»ç»Ÿ    â”‚              â”‚  åŸ¹å…»    â”‚          â”‚
â”‚   â”‚ â”€â”€â”€â”€â”€â”€â”€â”€ â”‚              â”‚ â”€â”€â”€â”€â”€â”€â”€â”€ â”‚              â”‚ â”€â”€â”€â”€â”€â”€â”€â”€ â”‚          â”‚
â”‚   â”‚ å®¶åº­é’±é¾„ â”‚              â”‚ å®¶åº­é¢„ç®— â”‚              â”‚ å®¶åº­ä¹ æƒ¯ â”‚          â”‚
â”‚   â”‚ æˆå‘˜è´¡çŒ® â”‚              â”‚ æˆå‘˜é…é¢ â”‚              â”‚ å…±åŒç›®æ ‡ â”‚          â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â”‚        â”‚                           â”‚                           â”‚             â”‚
â”‚        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚
â”‚                                    â–¼                                         â”‚
â”‚                        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                           â”‚
â”‚                        â”‚   12. æ•°æ®è”åŠ¨ä¸å¯è§†åŒ–   â”‚                           â”‚
â”‚                        â”‚   - å®¶åº­æŠ¥è¡¨             â”‚                           â”‚
â”‚                        â”‚   - æˆå‘˜å¯¹æ¯”åˆ†æ         â”‚                           â”‚
â”‚                        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                           â”‚
â”‚                                                                              â”‚
â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•   â”‚
â”‚                           2.0æ–°å¢åä½œæ¨¡å—                                     â”‚
â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•ï¿½ï¿½ï¿½â•â•â•â•â•â•â•â•â•â•â•   â”‚
â”‚                                                                              â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚   â”‚18.è¯­éŸ³   â”‚  â”‚17.è‡ªå­¦ä¹  â”‚  â”‚14.ä½ç½®   â”‚  â”‚10.AIè¯†åˆ« â”‚  â”‚28-29.å¢é•¿â”‚     â”‚
â”‚   â”‚  äº¤äº’    â”‚  â”‚  ç³»ç»Ÿ    â”‚  â”‚  æ™ºèƒ½    â”‚  â”‚  ç³»ç»Ÿ    â”‚  â”‚  ä½“ç³»    â”‚     â”‚
â”‚   â”‚ â”€â”€â”€â”€â”€â”€â”€â”€ â”‚  â”‚ â”€â”€â”€â”€â”€â”€â”€â”€ â”‚  â”‚ â”€â”€â”€â”€â”€â”€â”€â”€ â”‚  â”‚ â”€â”€â”€â”€â”€â”€â”€â”€ â”‚  â”‚ â”€â”€â”€â”€â”€â”€â”€â”€ â”‚     â”‚
â”‚   â”‚"å®¶åº­æ”¯å‡ºâ”‚  â”‚å®¶åº­æ¶ˆè´¹  â”‚  â”‚å®¶åº­æˆå‘˜  â”‚  â”‚ç¥¨æ®åˆ†æ‘Š  â”‚  â”‚å®¶åº­è£‚å˜  â”‚     â”‚
â”‚   â”‚ å¤šå°‘"   â”‚  â”‚æ¨¡å¼å­¦ä¹   â”‚  â”‚ä½ç½®å…±äº«  â”‚  â”‚æ™ºèƒ½è¯†åˆ«  â”‚  â”‚é‚€è¯·æ¿€åŠ±  â”‚     â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ï¿½ï¿½â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```'''

    if old_text1 in content:
        content = content.replace(old_text1, new_text1)
        print("âœ“ ä¿®å¤1: åˆ·æ–°13.0.3ä¸å…¶ä»–ç³»ç»Ÿçš„å…³ç³»å›¾ï¼Œæ·»åŠ 2.0æ–°å¢åä½œæ¨¡å—")
        changes += 1

    # ä¿®å¤2: åˆ·æ–°13.9.1é›†æˆç‚¹æ¦‚è§ˆå›¾ - æ·»åŠ æ›´å¤šç³»ç»Ÿ
    old_text2 = '''```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        å®¶åº­è´¦æœ¬ç³»ç»Ÿé›†æˆç‚¹                                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                             â”‚
â”‚  â”‚ å®¶åº­è´¦æœ¬ç³»ç»Ÿ â”‚                                                             â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜                                                             â”‚
â”‚         â”‚                                                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚                          é›†æˆæ¥å£å±‚                                   â”‚    â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚    â”‚
â”‚  â”‚  â”‚ è´¦æœ¬ä¸Šä¸‹æ–‡ â”‚ â”‚ æˆå‘˜ä¸Šä¸‹æ–‡â”‚ â”‚ æƒé™æ£€æŸ¥  â”‚ â”‚ æ•°æ®è¿‡æ»¤  â”‚ â”‚ é€šçŸ¥åˆ†å‘  â”‚  â”‚    â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚         â”‚           â”‚           â”‚           â”‚           â”‚                    â”‚
â”‚         â–¼           â–¼           â–¼           â–¼           â–¼                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚  â”‚  é’±é¾„ç³»ç»Ÿ â”‚ â”‚  é¢„ç®—ç³»ç»Ÿ â”‚ â”‚ ä¹ æƒ¯åŸ¹å…»  â”‚ â”‚ æ•°æ®å¯è§†åŒ–â”‚ â”‚ è¯­éŸ³äº¤äº’  â”‚          â”‚
â”‚  â”‚  â”€â”€â”€â”€â”€â”€â”€â”€ â”‚ â”‚  â”€â”€â”€â”€â”€â”€â”€â”€ â”‚ â”‚ â”€â”€â”€â”€â”€â”€â”€â”€ â”‚ â”‚  â”€â”€â”€â”€â”€â”€â”€â”€ â”‚ â”‚  â”€â”€â”€â”€â”€â”€â”€â”€ â”‚          â”‚
â”‚  â”‚ å®¶åº­é’±é¾„  â”‚ â”‚ å®¶åº­é¢„ç®—  â”‚ â”‚ å…±åŒç›®æ ‡  â”‚ â”‚ æˆå‘˜å¯¹æ¯”  â”‚ â”‚ "å®¶åº­æ”¯å‡º"â”‚          â”‚
â”‚  â”‚ ç»Ÿè®¡      â”‚ â”‚ æˆå‘˜é…é¢  â”‚ â”‚ æ’è¡Œæ¦œ    â”‚ â”‚ å®¶åº­æŠ¥è¡¨  â”‚ â”‚ è¯­éŸ³å‘½ä»¤  â”‚          â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```'''

    new_text2 = '''```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        å®¶åº­è´¦æœ¬ç³»ç»Ÿé›†æˆç‚¹                                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                             â”‚
â”‚  â”‚ å®¶åº­è´¦æœ¬ç³»ç»Ÿ â”‚                                                             â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜                                                             â”‚
â”‚         â”‚                                                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚                          é›†æˆæ¥å£å±‚                                   â”‚    â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚    â”‚
â”‚  â”‚  â”‚ è´¦æœ¬ä¸Šä¸‹æ–‡ â”‚ â”‚ æˆå‘˜ä¸Šä¸‹æ–‡â”‚ â”‚ æƒé™æ£€æŸ¥  â”‚ â”‚ æ•°æ®è¿‡æ»¤  â”‚ â”‚ é€šçŸ¥åˆ†å‘  â”‚  â”‚    â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚         â”‚           â”‚           â”‚           â”‚           â”‚                    â”‚
â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•    â”‚
â”‚                              æ ¸å¿ƒä¸šåŠ¡é›†æˆ                                     â”‚
â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•    â”‚
â”‚         â”‚           â”‚           â”‚           â”‚           â”‚                    â”‚
â”‚         â–¼           â–¼           â–¼           â–¼           â–¼                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚  â”‚  é’±é¾„ç³»ç»Ÿ â”‚ â”‚  é¢„ç®—ç³»ç»Ÿ â”‚ â”‚ ä¹ æƒ¯åŸ¹å…»  â”‚ â”‚ æ•°æ®å¯è§†åŒ–â”‚ â”‚ AIè¯†åˆ«   â”‚          â”‚
â”‚  â”‚  (ç¬¬7ç« ) â”‚ â”‚  (ç¬¬8ç« ) â”‚ â”‚ (ç¬¬9ç« )  â”‚ â”‚  (ç¬¬12ç« )â”‚ â”‚ (ç¬¬10ç« ) â”‚          â”‚
â”‚  â”‚ â”€â”€â”€â”€â”€â”€â”€â”€ â”‚ â”‚ â”€â”€â”€â”€â”€â”€â”€â”€ â”‚ â”‚ â”€â”€â”€â”€â”€â”€â”€â”€ â”‚ â”‚  â”€â”€â”€â”€â”€â”€â”€â”€ â”‚ â”‚  â”€â”€â”€â”€â”€â”€â”€â”€ â”‚          â”‚
â”‚  â”‚ å®¶åº­é’±é¾„  â”‚ â”‚ å®¶åº­é¢„ç®—  â”‚ â”‚ å…±åŒç›®æ ‡  â”‚ â”‚ æˆå‘˜å¯¹æ¯”  â”‚ â”‚ ç¥¨æ®åˆ†æ‘Š  â”‚          â”‚
â”‚  â”‚ ç»Ÿè®¡æ±‡æ€»  â”‚ â”‚ æˆå‘˜é…é¢  â”‚ â”‚ æ’è¡Œæ¦œ    â”‚ â”‚ å®¶åº­æŠ¥è¡¨  â”‚ â”‚ æ™ºèƒ½è¯†åˆ«  â”‚          â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â”‚                                                                              â”‚
â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•    â”‚
â”‚                           2.0æ–°å¢æ¨¡å—é›†æˆ                                     â”‚
â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•    â”‚
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚  â”‚ è¯­éŸ³äº¤äº’  â”‚ â”‚ è‡ªå­¦ä¹    â”‚ â”‚ ä½ç½®æ™ºèƒ½  â”‚ â”‚ ä¼™ä¼´åŒ–   â”‚ â”‚ ç”¨æˆ·å¢é•¿  â”‚          â”‚
â”‚  â”‚ (ç¬¬18ç« ) â”‚ â”‚ (ç¬¬17ç« ) â”‚ â”‚ (ç¬¬14ç« ) â”‚ â”‚ (ç¬¬4ç« )  â”‚ â”‚(ç¬¬28-29ç« )â”‚          â”‚
â”‚  â”‚ â”€â”€â”€â”€â”€â”€â”€â”€ â”‚ â”‚ â”€â”€â”€â”€â”€â”€â”€â”€ â”‚ â”‚ â”€â”€â”€â”€â”€â”€â”€â”€ â”‚ â”‚ â”€â”€â”€â”€â”€â”€â”€â”€ â”‚ â”‚ â”€â”€â”€â”€â”€â”€â”€â”€ â”‚          â”‚
â”‚  â”‚"å®¶åº­æ¶ˆè´¹ â”‚ â”‚ å®¶åº­æ¶ˆè´¹  â”‚ â”‚ æˆå‘˜ä½ç½®  â”‚ â”‚ å®¶åº­äº’åŠ¨  â”‚ â”‚ å®¶åº­è£‚å˜  â”‚          â”‚
â”‚  â”‚ æŸ¥è¯¢"    â”‚ â”‚ æ¨¡å¼å­¦ä¹   â”‚ â”‚ å…±äº«æ¶ˆè´¹  â”‚ â”‚ é¼“åŠ±æ–‡æ¡ˆ  â”‚ â”‚ é‚€è¯·æ¿€åŠ±  â”‚          â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â”‚                                                                              â”‚
â”‚  ğŸ’¡ å®¶åº­è´¦æœ¬ä½œä¸ºåä½œå…¥å£ï¼Œä¸æ‰€æœ‰æ ¸å¿ƒæ¨¡å—å’Œ2.0æ–°å¢æ¨¡å—æ·±åº¦é›†æˆ                    â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```'''

    if old_text2 in content:
        content = content.replace(old_text2, new_text2)
        print("âœ“ ä¿®å¤2: åˆ·æ–°13.9.1é›†æˆç‚¹æ¦‚è§ˆå›¾ï¼Œæ·»åŠ 2.0æ–°å¢æ¨¡å—é›†æˆ")
        changes += 1

    # ä¿®å¤3: åœ¨13.9.2ä¹‹åæ·»åŠ æ›´å¤šç³»ç»Ÿé›†æˆç« èŠ‚
    old_text3 = '''#### 13.9.2 ç»Ÿä¸€è´¦æœ¬ä¸Šä¸‹æ–‡

```dart
/// è´¦æœ¬ä¸Šä¸‹æ–‡ - å…¨å±€å¯ç”¨ï¼Œç¡®å®šå½“å‰æ“ä½œçš„è´¦æœ¬å’Œæƒé™
class LedgerContext {'''

    new_text3 = '''#### 13.9.2 ä¸è¯­éŸ³äº¤äº’ç³»ç»Ÿé›†æˆï¼ˆç¬¬18ç« ï¼‰

```dart
/// å®¶åº­è´¦æœ¬è¯­éŸ³äº¤äº’æœåŠ¡
class FamilyLedgerVoiceService {
  final LedgerContext _ledgerContext;
  final VoiceIntentHandler _intentHandler;

  /// æ”¯æŒçš„å®¶åº­è´¦æœ¬è¯­éŸ³æ„å›¾
  static const supportedIntents = [
    VoiceIntent(
      pattern: '(å®¶åº­|å…¨å®¶)(è¿™ä¸ªæœˆ|æœ¬æœˆ)?(èŠ±äº†|æ¶ˆè´¹äº†|æ”¯å‡º)(å¤šå°‘|å‡ )(é’±)?',
      action: 'queryFamilyExpense',
      example: 'å®¶åº­è¿™ä¸ªæœˆèŠ±äº†å¤šå°‘é’±',
    ),
    VoiceIntent(
      pattern: '(æŸ¥çœ‹|çœ‹çœ‹)?(.+)(èŠ±äº†|æ¶ˆè´¹äº†)(å¤šå°‘)?',
      action: 'queryMemberExpense',
      example: 'è€å…¬èŠ±äº†å¤šå°‘',
    ),
    VoiceIntent(
      pattern: '(ï¿½ï¿½ä¸€ç¬”|æ·»åŠ )(å®¶åº­|å…±åŒ)(æ”¯å‡º|æ¶ˆè´¹)',
      action: 'addFamilyTransaction',
      example: 'è®°ä¸€ç¬”å®¶åº­æ”¯å‡º',
    ),
    VoiceIntent(
      pattern: '(å‘èµ·|åˆ›å»º)(åˆ†æ‘Š|AA)',
      action: 'createSplit',
      example: 'å‘èµ·åˆ†æ‘Š',
    ),
    VoiceIntent(
      pattern: '(é‚€è¯·|æ·»åŠ )(.+)(åŠ å…¥|è¿›å…¥)è´¦æœ¬',
      action: 'inviteMember',
      example: 'é‚€è¯·å¦ˆå¦ˆåŠ å…¥è´¦æœ¬',
    ),
  ];

  /// å¤„ç†å®¶åº­æ¶ˆè´¹æŸ¥è¯¢
  Future<VoiceResponse> handleFamilyExpenseQuery(VoiceQuery query) async {
    final ledger = _ledgerContext.currentLedger;
    if (ledger == null || !ledger.isShared) {
      return VoiceResponse(
        text: 'æ‚¨è¿˜æ²¡æœ‰åˆ›å»ºå®¶åº­è´¦æœ¬å“¦ï¼Œè¦ç°åœ¨åˆ›å»ºä¸€ä¸ªå—ï¼Ÿ',
        action: VoiceAction.askConfirmation,
      );
    }

    final stats = await _getFamilyStats(ledger.id, query.timeRange);
    return VoiceResponse(
      text: '${ledger.name}${query.timeRangeText}å…±æ”¯å‡º${stats.totalExpense.toStringAsFixed(0)}å…ƒï¼Œ'
            'å…¶ä¸­${stats.topSpender}æ¶ˆè´¹æœ€å¤šï¼ŒèŠ±äº†${stats.topSpenderAmount.toStringAsFixed(0)}å…ƒã€‚',
      data: stats,
    );
  }

  /// å¤„ç†æˆå‘˜æ¶ˆè´¹æŸ¥è¯¢
  Future<VoiceResponse> handleMemberExpenseQuery(
    String memberName,
    DateRange timeRange,
  ) async {
    final member = await _findMemberByName(memberName);
    if (member == null) {
      return VoiceResponse(
        text: 'æ²¡æœ‰æ‰¾åˆ°å«"$memberName"çš„å®¶åº­æˆå‘˜ï¼Œè¯·æ£€æŸ¥åå­—æ˜¯å¦æ­£ç¡®ã€‚',
      );
    }

    final stats = await _getMemberStats(member.id, timeRange);
    return VoiceResponse(
      text: '${member.displayName}${timeRange.description}æ¶ˆè´¹äº†${stats.totalExpense.toStringAsFixed(0)}å…ƒï¼Œ'
            'ä¸»è¦èŠ±åœ¨${stats.topCategory}ä¸Šã€‚',
      data: stats,
    );
  }
}
```

#### 13.9.3 ä¸è‡ªå­¦ä¹ ç³»ç»Ÿé›†æˆï¼ˆç¬¬17ç« ï¼‰

```dart
/// å®¶åº­æ¶ˆè´¹æ¨¡å¼å­¦ä¹ æœåŠ¡
class FamilyConsumptionLearningService {
  final SelfLearningFramework _learningFramework;

  /// å­¦ä¹ å®¶åº­æ¶ˆè´¹æ¨¡å¼
  Future<void> learnFamilyPatterns(String ledgerId) async {
    // å­¦ä¹ å®¶åº­æ•´ä½“æ¶ˆè´¹æ¨¡å¼
    await _learningFramework.learn(
      domain: 'family_consumption',
      context: {'ledgerId': ledgerId},
      features: [
        'weekly_pattern',      // å‘¨æ¶ˆè´¹æ¨¡å¼ï¼ˆå‘¨æœ«vså·¥ä½œæ—¥ï¼‰
        'member_contribution', // æˆå‘˜è´¡çŒ®æ¯”ä¾‹
        'category_preference', // å®¶åº­åˆ†ç±»åå¥½
        'split_frequency',     // åˆ†æ‘Šé¢‘ç‡
      ],
    );
  }

  /// è·å–å®¶åº­é¢„ç®—æ™ºèƒ½å»ºè®®
  Future<FamilyBudgetSuggestion> suggestFamilyBudget({
    required String ledgerId,
    required String period,
  }) async {
    final patterns = await _learningFramework.getPatterns(
      domain: 'family_consumption',
      context: {'ledgerId': ledgerId},
    );

    return FamilyBudgetSuggestion(
      totalBudget: patterns.predictedMonthlyExpense * 1.1, // é¢„ç•™10%å¼¹æ€§
      memberAllocations: patterns.memberContributionRatios,
      categoryAllocations: patterns.categoryPreferences,
      confidence: patterns.confidence,
      explanation: 'åŸºäºè¿‡å»${patterns.dataMonths}ä¸ªæœˆçš„å®¶åº­æ¶ˆè´¹æ•°æ®ï¼Œ'
                   'é¢„è®¡æœ¬æœˆæ”¯å‡º${patterns.predictedMonthlyExpense.toStringAsFixed(0)}å…ƒã€‚',
    );
  }

  /// å­¦ä¹ æˆå‘˜åˆ†æ‘Šåå¥½
  Future<SplitPreference> learnSplitPreference(String ledgerId) async {
    final history = await _getSplitHistory(ledgerId);
    return SplitPreference(
      preferredMethod: history.mostUsedMethod,      // æœ€å¸¸ç”¨åˆ†æ‘Šæ–¹å¼
      defaultRatios: history.averageRatios,         // é»˜è®¤åˆ†æ‘Šæ¯”ä¾‹
      frequentCategories: history.frequentCategories, // å¸¸åˆ†æ‘Šçš„åˆ†ç±»
    );
  }
}
```

#### 13.9.4 ä¸ä½ç½®æ™ºèƒ½ç³»ç»Ÿé›†æˆï¼ˆç¬¬14ç« ï¼‰

```dart
/// å®¶åº­ä½ç½®æ™ºèƒ½æœåŠ¡
class FamilyLocationService {
  final LocationService _locationService;
  final LedgerContext _ledgerContext;

  /// å®¶åº­æˆå‘˜ä½ç½®å…±äº«ï¼ˆéœ€è¦æˆå‘˜æˆæƒï¼‰
  Stream<List<MemberLocation>> watchFamilyLocations(String ledgerId) {
    return _locationService.watchMemberLocations(
      ledgerId: ledgerId,
      filter: (member) => member.locationSharingEnabled,
    );
  }

  /// æ™ºèƒ½åˆ†æ‘Šå»ºè®®ï¼ˆåŸºäºä½ç½®ï¼‰
  Future<SplitSuggestion> suggestSplitByLocation({
    required Transaction transaction,
  }) async {
    if (transaction.location == null) return SplitSuggestion.none();

    // æŸ¥æ‰¾åŒæ—¶åœ¨åœºçš„å®¶åº­æˆå‘˜
    final nearbyMembers = await _findNearbyMembers(
      location: transaction.location!,
      timeWindow: Duration(minutes: 30),
    );

    if (nearbyMembers.length <= 1) return SplitSuggestion.none();

    return SplitSuggestion(
      members: nearbyMembers,
      method: SplitMethod.equal,
      reason: 'æ£€æµ‹åˆ°${nearbyMembers.length}ä½å®¶åº­ï¿½ï¿½å‘˜åœ¨é™„è¿‘ï¼Œæ˜¯å¦åˆ†æ‘Šè¿™ç¬”æ¶ˆè´¹ï¼Ÿ',
      confidence: 0.8,
    );
  }

  /// å®¶åº­æ¶ˆè´¹åœ°ç‚¹çƒ­åŠ›å›¾
  Future<FamilyLocationHeatmap> getFamilyHeatmap({
    required String ledgerId,
    required DateRange timeRange,
  }) async {
    final transactions = await _getTransactionsWithLocation(ledgerId, timeRange);
    return FamilyLocationHeatmap.fromTransactions(
      transactions: transactions,
      groupBy: (tx) => tx.memberId, // æŒ‰æˆå‘˜åˆ†ç»„
    );
  }
}
```

#### 13.9.5 ä¸ç”¨æˆ·å¢é•¿ç³»ç»Ÿé›†æˆï¼ˆç¬¬28-29ç« ï¼‰

```dart
/// å®¶åº­è£‚å˜å¢é•¿æœåŠ¡
class FamilyGrowthService {
  final GrowthTracker _growthTracker;
  final InviteService _inviteService;

  /// å®¶åº­é‚€è¯·æ¿€åŠ±æœºåˆ¶
  static const inviteRewards = {
    1: InviteReward(points: 100, badge: 'family_starter'),
    3: InviteReward(points: 300, badge: 'family_builder'),
    5: InviteReward(points: 500, badge: 'family_master', premiumDays: 7),
  };

  /// å¤„ç†å®¶åº­é‚€è¯·æˆåŠŸ
  Future<void> onFamilyInviteSuccess({
    required String inviterId,
    required String inviteeId,
    required String ledgerId,
  }) async {
    // è®°å½•é‚€è¯·æˆåŠŸ
    await _growthTracker.trackEvent(
      event: 'family_invite_success',
      properties: {
        'inviter_id': inviterId,
        'invitee_id': inviteeId,
        'ledger_id': ledgerId,
      },
    );

    // å‘æ”¾é‚€è¯·å¥–åŠ±
    final inviteCount = await _inviteService.getInviteCount(inviterId);
    final reward = inviteRewards[inviteCount];
    if (reward != null) {
      await _grantReward(inviterId, reward);
    }

    // è§¦å‘ä¼™ä¼´åŒ–åº†ç¥
    await _triggerCompanionCelebration(inviterId, inviteeId);
  }

  /// ç”Ÿæˆå®¶åº­åˆ†äº«å¡ç‰‡
  Future<ShareCard> generateFamilyShareCard({
    required String ledgerId,
    required String period,
  }) async {
    final stats = await _getFamilyStats(ledgerId, period);
    return ShareCard(
      type: ShareCardType.familyReport,
      title: 'æˆ‘ä»¬å®¶çš„è´¢åŠ¡å¥åº·æŠ¥å‘Š',
      subtitle: '$period å®¶åº­æ¶ˆè´¹æ€»è§ˆ',
      stats: [
        StatItem('æ€»æ”¯å‡º', 'Â¥${stats.totalExpense.toStringAsFixed(0)}'),
        StatItem('äººå‡', 'Â¥${stats.perMemberExpense.toStringAsFixed(0)}'),
        StatItem('æœ€å¤§åˆ†ç±»', stats.topCategory),
      ],
      cta: 'ä¸€èµ·æ¥è®°è´¦å§ï¼',
      inviteCode: await _inviteService.generateCode(ledgerId),
    );
  }
}
```

#### 13.9.6 ç»Ÿä¸€è´¦æœ¬ä¸Šä¸‹æ–‡

```dart
/// è´¦æœ¬ä¸Šä¸‹æ–‡ - å…¨å±€å¯ç”¨ï¼Œç¡®å®šå½“å‰æ“ä½œçš„è´¦æœ¬å’Œæƒé™
class LedgerContext {'''

    if old_text3 in content:
        content = content.replace(old_text3, new_text3)
        print("âœ“ ä¿®å¤3: æ·»åŠ 13.9.2-13.9.5ä¸è¯­éŸ³/è‡ªå­¦ä¹ /ä½ç½®/å¢é•¿ç³»ç»Ÿé›†æˆ")
        changes += 1

    if changes > 0:
        with open(filepath, 'w', encoding='utf-8') as f:
            f.write(content)
        print(f"\n===== ç¬¬13ç« å†…å®¹åˆ·æ–°å®Œæˆï¼Œå…± {changes} å¤„ =====")
    else:
        print("\næœªæ‰¾åˆ°ç›®æ ‡ä½ç½®æˆ–å·²åˆ·æ–°")

    return changes

if __name__ == '__main__':
    main()
