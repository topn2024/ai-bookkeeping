# -*- coding: utf-8 -*-
"""
修复第13章13.0.3与其他系统的关系图
"""

def main():
    filepath = 'd:/code/ai-bookkeeping/docs/design/app_v2_design.md'

    with open(filepath, 'r', encoding='utf-8') as f:
        content = f.read()

    # 找到13.0.3标题后的图表
    old_diagram = '''```
┌──────────────────────────────────────────────────────────────────────────────┐
│                      家庭账本系统与其他模块的关系                               │
├──────────────────────────────────────────────────────────────────────────────┤
│                                                                              │
│                        ┌─────────────────────────┐                           │
│                        │   13. 家庭账本系统       │                           │
│                        │      （本章）            │                           │
│                        └───────────┬─────────────┘                           │
│                                    │                                         │
│        ┌───────────────────────────┼─��─────────────────────────┐             │
│        │                           │                           │             │
│        ▼                           ▼                           ▼             │
│   ┌──────────┐              ┌──────────┐              ┌──────────┐          │
│   │ 7.钱龄   │              │ 8.预算   │              │ 9.习惯   │          │
│   │  系统    │              │  系统    │              │  培养    │          │
│   │ ──────── │              │ ──────── │              │ ──────── │          │
│   │ 家庭钱龄 │              │ 家庭预算 │              │ 家庭习惯 │          │
│   │ 成员贡献 │              │ 成员配额 │              │ 共同目标 │          │
│   └──────────┘              └──────────┘              └──────────┘          │
│        │                           │                           │             │
│        └───────────────────────────┼───────────────────────────┘             │
│                                    ▼                                         │
│                        ┌─────────────────────────┐                           │
│                        │   12. 数据联动与可视化   │                           │
│                        │   - 家庭报表             │                           │
│                        │   - 成员对比分析         │                           │
│                        └─────────────────────────┘                           │
│                                                                              │
└──────────────────────────────────────────────────────────────────────────────┘
```'''

    new_diagram = '''```
┌──────────────────────────────────────────────────────────────────────────────┐
│                      家庭账本系统与其他模块的关系                               │
├──────────────────────────────────────────────────────────────────────────────┤
│                                                                              │
│                        ┌─────────────────────────┐                           │
│                        │   13. 家庭账本系统       │                           │
│                        │      （本章）            │                           │
│                        └───────────┬─────────────┘                           │
│                                    │                                         │
│        ┌───────────────────────────┼───────────────────────────┐             │
│        │                           │                           │             │
│        ▼                           ▼                           ▼             │
│   ┌──────────┐              ┌──────────┐              ┌──────────┐          │
│   │ 7.钱龄   │              │ 8.预算   │              │ 9.习惯   │          │
│   │  系统    │              │  系统    │              │  培养    │          │
│   │ ──────── │              │ ──────── │              │ ──────── │          │
│   │ 家庭钱龄 │              │ 家庭预算 │              │ 家庭习惯 │          │
│   │ 成员贡献 │              │ 成员配额 │              │ 共同目标 │          │
│   └──────────┘              └──────────┘              └──────────┘          │
│        │                           │                           │             │
│        └───────────────────────────┼───────────────────────────┘             │
│                                    ▼                                         │
│                        ┌─────────────────────────┐                           │
│                        │   12. 数据联动与可视化   │                           │
│                        │   - 家庭报表             │                           │
│                        │   - 成员对比分析         │                           │
│                        └─────────────────────────┘                           │
│                                                                              │
│  ════════════════════════════════════════════════════════════════════════   │
│                           2.0新增协作模块                                     │
│  ════════════════════════════════════════════════════════════════════════   │
│                                                                              │
│   ┌──────────┐  ┌──────────┐  ┌──────────┐  ┌──────────┐  ┌──────────┐     │
│   │18.语音   │  │17.自学习 │  │14.位置   │  │10.AI识别 │  │28-29.增长│     │
│   │  交互    │  │  系统    │  │  智能    │  │  系统    │  │  体系    │     │
│   │ ──────── │  │ ──────── │  │ ──────── │  │ ──────── │  │ ──────── │     │
│   │"家庭支出│  │家庭消费  │  │家庭成员  │  │票据分摊  │  │家庭裂变  │     │
│   │ 多少"   │  │模式学习  │  │位置共享  │  │智能识别  │  │邀请激励  │     │
│   └──────────┘  └──────────┘  └──────────┘  └──────────┘  └──────────┘     │
│                                                                              │
└──────────────────────────────────────────────────────────────────────────────┘
```'''

    if old_diagram in content:
        content = content.replace(old_diagram, new_diagram)
        with open(filepath, 'w', encoding='utf-8') as f:
            f.write(content)
        print("✓ 修复成功: 刷新13.0.3与其他系统的关系图，添加2.0新增协作模块")
        return 1
    else:
        print("未找到目标图表")
        return 0

if __name__ == '__main__':
    main()
