# AI记账应用发布脚本

## 功能说明

`release.sh` 是一键式发布脚本，自动完成以下任务：

1. ✅ 更新版本号（pubspec.yaml 和 build_info.dart）
2. ✅ 编译 release APK
3. ✅ 上传APK到两个服务器（39.105.12.124 和 160.202.238.29）
4. ✅ 在两个服务器数据库创建版本记录
5. ✅ 提交代码到GitHub

## 使用方法

### 基本使用

```bash
cd /Users/beihua/code/baiji/ai-bookkeeping/scripts
./release.sh
```

### 交互式流程

运行脚本后，会有以下交互步骤：

1. **选择版本递增方式**
   - `1` - Major (大版本): 2.0.0 → 3.0.0
   - `2` - Minor (小版本): 2.0.0 → 2.1.0
   - `3` - Patch (补丁版本): 2.0.0 → 2.0.1 【推荐用于bug修复】
   - `4` - Build (仅构建号): 2.0.0+54 → 2.0.0+55
   - `5` - 自定义版本号

2. **输入更新说明**
   - 多行输入，输入 `END` 结束
   - 示例：
     ```
     修复短信导入金额为0的问题

     - 添加金额验证
     - 优化错误提示
     END
     ```

3. **确认发布**
   - 输入 `y` 或 `Y` 确认
   - 输入其他字符取消

## 前置要求

### 必需工具

- `flutter` - Flutter SDK
- `sshpass` - SSH密码工具
- `git` - Git版本控制
- `python3` - Python 3

### 安装sshpass (macOS)

```bash
brew install sshpass
```

### 服务器访问权限

需要配置服务器1 (39.105.12.124) 的SSH密钥或密码。

服务器2 (160.202.238.29) 的密码已内置在脚本中。

## 版本号规范

版本号格式：`主版本.次版本.修订版本+构建号`

示例：`2.0.11+55`
- `2` - 主版本号（Major）
- `0` - 次版本号（Minor）
- `11` - 修订版本号（Patch）
- `55` - 构建号（Build Number）

## 注意事项

1. ⚠️ 发布前请确保本地代码已测试通过
2. ⚠️ 版本号只能递增，不能回退
3. ⚠️ 发布后用户会收到更新提示，请谨慎操作
4. ⚠️ 两个服务器必须同时更新，保持版本一致
5. ⚠️ 更新说明会显示给用户，请认真填写
