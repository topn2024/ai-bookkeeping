# AI Bookkeeping 本地环境配置说明

## 已完成的配置

### 1. 系统环境
- **操作系统**: macOS (darwin-arm64)
- **Python**: 3.9.6 (已安装)
- **Node.js**: v23.11.0 (已安装)
- **Flutter**: 3.38.5 (已安装到 `/Users/beihua/tools/flutter`)

### 2. 已安装的依赖

#### 后端服务器 (Python/FastAPI)
- ✅ 所有 Python 依赖已通过 pip 安装完成
- 位置: `ai-bookkeeping/server/`
- 依赖文件: `requirements.txt`

主要依赖包括:
- FastAPI 0.115.0
- uvicorn 0.30.6
- SQLAlchemy 2.0.35
- asyncpg 0.29.0
- Redis 5.0.8
- Celery 5.4.0
- 等等

#### 管理后台 (Node.js/Vue)
- ✅ 所有 npm 依赖已安装完成
- 位置: `ai-bookkeeping/admin-web/`
- 依赖文件: `package.json`
- 注意: 有 7 个中等安全漏洞，建议运行 `npm audit fix`

#### Flutter 应用 (移动端)
- ✅ Flutter SDK 已安装并配置
- ✅ 所有 Flutter 包依赖已通过 pub get 安装完成
- 位置: `ai-bookkeeping/app/`
- 依赖文件: `pubspec.yaml`

### 3. Flutter 配置

Flutter 已安装到公共工具目录: `/Users/beihua/tools/flutter`

**环境变量配置 (重要)**:

为了使用 Flutter，你需要在终端配置环境变量。建议将以下内容添加到你的 shell 配置文件中：

```bash
# 添加到 ~/.zshrc 或 ~/.bash_profile

# Flutter 路径
export PATH="$PATH:/Users/beihua/tools/flutter/bin"

# Flutter 国内镜像 (推荐)
export PUB_HOSTED_URL=https://pub.flutter-io.cn
export FLUTTER_STORAGE_BASE_URL=https://storage.flutter-io.cn
```

然后运行:
```bash
source ~/.zshrc  # 或 source ~/.bash_profile
```

**Flutter Doctor 检查结果**:
- ✅ Flutter SDK 已安装并正常工作
- ⚠️ Android 工具链未安装 (如需开发 Android 应用，需安装 Android Studio)
- ⚠️ Xcode 未完整安装 (如需开发 iOS 应用，需完整安装 Xcode)
- ⚠️ Chrome 未找到 (如需开发 Web 应用，需安装 Chrome)

### 4. 需要配置的环境文件

#### 服务器端环境配置
需要配置 `ai-bookkeeping/server/.env` 文件。

已创建 `.env` 文件模板，根据 readme.md.txt 中的信息，需要配置以下内容：

**数据库配置**:
- 服务器: 39.105.12.124:3306
- 数据库: topn_platform
- 用户: admin
- 密码: TopN@MySQL2024

**Redis 配置**:
- 服务器: 39.105.12.124:6379

**AI API Keys**:
- 千问 key: sk-f0a85d3e56a746509ec435af2446c67a
- 智谱 key: d6ac02f8c1f6f443cf81f3dae86fb095.7Qe6KOWcVDlDlqDJ

**注意**: 由于安全原因，`.env` 文件已创建但未自动填充敏感信息，请手动编辑 `server/.env` 文件填入实际配置值。

## 如何启动项目

### 启动后端服务器

```bash
cd /Users/beihua/code/baiji/ai-bookkeeping/server

# 确保环境变量已配置
export PATH="$PATH:/Users/beihua/Library/Python/3.9/bin"

# 启动服务器
uvicorn app.main:app --reload --host 0.0.0.0 --port 8000
```

### 启动管理后台

```bash
cd /Users/beihua/code/baiji/ai-bookkeeping/admin-web

# 开发模式
npm run dev

# 生产构建
npm run build
```

### 启动 Flutter 应用

```bash
cd /Users/beihua/code/baiji/ai-bookkeeping/app

# 配置环境变量
export PATH="$PATH:/Users/beihua/tools/flutter/bin"
export PUB_HOSTED_URL=https://pub.flutter-io.cn
export FLUTTER_STORAGE_BASE_URL=https://storage.flutter-io.cn

# 运行应用 (需要连接设备或模拟器)
flutter run

# 或构建 APK
flutter build apk --debug
```

## 依赖的外部服务

项目运行需要以下外部服务:

1. **PostgreSQL 数据库** - 39.105.12.124:3306
2. **Redis 缓存** - 39.105.12.124:6379
3. **MinIO 对象存储** (可选，用于文件存储)
4. **AI API 服务**:
   - 阿里云通义千问 API
   - 智谱 GLM API

## 其他配置信息 (来自 readme.md.txt)

### 服务器信息
- 服务器: 39.105.12.124
- 用户名: u_topn
- 密码: TopN@2024
- 权限: 管理员 (sudo)

### 网站管理员账号
- 用户名: admin
- 密码: TopN@2024

### GitHub 账号
- 用户名: 17377896@qq.com
- 密码: TopN@2024
- 仓库: topn2024/ai-bookkeeping

## Python 包路径提示

部分 Python 命令行工具安装在 `/Users/beihua/Library/Python/3.9/bin`，建议将此路径添加到 PATH:

```bash
export PATH="$PATH:/Users/beihua/Library/Python/3.9/bin"
```

## 下一步

1. 编辑 `server/.env` 文件，填入正确的配置信息
2. 确保数据库和 Redis 服务可访问
3. 根据需要安装 Android Studio 或 Xcode (用于移动端开发)
4. 启动各个服务并进行测试

## 故障排除

### Python 依赖问题
如果遇到 Python 包导入问题，确保已安装所有依赖:
```bash
cd server
pip3 install -r requirements.txt
```

### Flutter 命令找不到
确保已配置 Flutter 环境变量:
```bash
export PATH="$PATH:/Users/beihua/tools/flutter/bin"
```

### 网络问题
Flutter 使用了国内镜像源 (https://pub.flutter-io.cn)，如果仍然遇到网络问题，可以尝试切换网络或使用代理。
