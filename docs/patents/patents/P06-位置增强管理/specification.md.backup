# 专利06：基于地理围栏的个人预算预警方法及系统

## 技术领域

[0001] 本发明涉及个人财务管理技术领域，尤其涉及一种基于地理围栏的个人预算预警方法及系统。

## 背景技术

[0002] 随着移动支付的普及，用户的消费场景日益多样化。不同地理位置往往对应不同的消费类型和金额水平，如商业区消费普遍较高，居民区消费相对较低。

[0003] 现有技术存在以下问题：

[0004] **一、预算管理与位置脱节**：传统预算管理系统不考虑用户所处位置，无法在用户进入高消费区域时提前预警。

[0005] **二、消费提醒滞后**：现有系统只能在消费发生后提醒用户预算使用情况，无法实现事前预警。

[0006] **三、位置数据隐私保护不足**：现有位置服务大多将位置数据上传到服务器，存在隐私泄露风险。

## 与现有技术的区别声明

[0007] **重要说明**：本发明聚焦于**个人日常消费的预算管理和事前预警**，与以下场景完全不同且不涉及：
- 企业费用报销系统
- 商务里程追踪
- 里程报销费率计算
- 商务/个人行程分类
- 停车费、过路费等费用报销

[0008] 本发明的核心目的是**帮助个人用户控制日常消费**，通过位置感知实现**事前预算预警**，而非事后费用报销。

## 发明内容

[0009] 针对上述问题，本发明提供一种基于地理围栏的个人预算预警方法及系统，通过本地化位置处理、智能预算关联和隐私保护技术，实现个人消费的事前预警。

### 技术方案

#### 一、本地化位置处理模块（隐私保护核心）

[0010] **位置数据本地处理**：所有位置数据在用户设备本地处理，不上传到任何服务器：
```
隐私保护策略：
1. 本地地理围栏匹配：
   - 地理围栏定义存储在本地SQLite数据库
   - 位置匹配计算在本地完成
   - 匹配结果仅包含围栏ID，不含精确坐标

2. 位置数据脱敏：
   - 存储时使用区域ID替代精确坐标
   - 区域粒度可配置（商圈级/街道级/城区级）
   - 历史位置数据定期自动清理（默认7天）

3. 可选的云同步：
   - 仅同步围栏配置（名称、类型、关联预算）
   - 不同步任何位置历史或轨迹
   - 用户可完全禁用云同步功能
```

[0011] **后台位置监听优化**：低功耗的后台位置监听机制：
```
功耗优化策略：
1. 自适应监听频率：
   - 静止状态：每5分钟检测一次
   - 移动状态：每1分钟检测一次
   - 快速移动：每30秒检测一次

2. 地理围栏触发：
   - 使用系统级地理围栏API
   - 仅在进入/离开围栏时唤醒应用
   - 减少持续GPS轮询的功耗

3. 智能休眠：
   - 夜间自动降低监听频率
   - 检测到用户在家时暂停监听
```

#### 二、预算感知地理围栏模块

[0012] **围栏-预算关联**：将地理围栏与个人预算分类关联：
```
围栏类型定义：
1. 商业区围栏：
   - 类型：shopping_mall, department_store
   - 关联预算：购物预算
   - 预警阈值：进入时显示剩余额度

2. 餐饮街围栏：
   - 类型：food_street, restaurant_area
   - 关联预算：餐饮预算
   - 预警阈值：预算使用率>80%时预警

3. 娱乐区围栏：
   - 类型：entertainment_district, cinema_area
   - 关联预算：娱乐预算
   - 预警阈值：单次消费超过预算20%时预警

4. 自定义围栏：
   - 用户可自行添加常去区域
   - 自定义围栏名称和关联预算
   - 支持多边形围栏定义
```

[0013] **进入围栏预警逻辑**：
```
算法：围栏进入预警
输入：当前位置 L, 围栏列表 Fences, 预算状态 B
输出：预警消息 Alert

处理流程：
1. 围栏匹配：
   for fence in Fences:
       if contains(fence.polygon, L):
           matched_fences.append(fence)

2. 预算检查：
   for fence in matched_fences:
       budget = get_budget(fence.category)
       remaining = budget.limit - budget.spent
       usage_rate = budget.spent / budget.limit

3. 预警决策：
   if usage_rate > 0.9:
       Alert = "⚠️ {category}预算即将用完，仅剩{remaining}元"
   elif usage_rate > 0.8:
       Alert = "📊 {category}预算使用率较高，剩余{remaining}元"
   else:
       Alert = "📍 进入{fence.name}，{category}预算剩余{remaining}元"

4. 通知发送：
   - 本地通知推送
   - 可选震动提醒
   - 快捷操作入口（查看预算详情）
```

#### 三、消费场景智能识别模块

[0014] **场景识别算法**：基于位置、时间和用户习惯识别消费场景：
```
场景识别规则：
1. 时间+位置规则：
   - 工作日 11:00-14:00 + 餐饮区 → 午餐场景
   - 周末 14:00-18:00 + 商业区 → 购物场景
   - 晚间 18:00-22:00 + 娱乐区 → 娱乐场景
   - 节假日 + 景区围栏 → 旅游场景

2. 用户习惯学习：
   - 记录用户历史消费的时间-位置-分类
   - 构建个性化场景识别模型
   - 优先使用用户习惯规则

3. 预算自动切换：
   - 识别到场景后，自动激活对应预算
   - 在预算仪表板突出显示当前场景预算
   - 消费记录自动预填分类
```

[0015] **停留时间分析**：
```
算法：停留时间与消费关联
输入：围栏停留记录 S = {enter_time, exit_time, fence_id}
输出：消费预测 Prediction

分析维度：
1. 停留时长统计：
   - duration = exit_time - enter_time
   - 短停留（<15分钟）：可能不消费
   - 中停留（15-60分钟）：可能单次消费
   - 长停留（>60分钟）：可能多次消费

2. 历史关联：
   - 统计该围栏的历史消费金额
   - 计算平均消费：avg_amount = sum(amounts) / count
   - 预测本次消费：predicted = avg_amount × duration_factor

3. 预算提醒：
   - if predicted > remaining_budget:
       Alert = "预计消费{predicted}元，超出剩余预算"
```

#### 四、智能商户识别模块

[0016] **本地商户库**：在设备本地维护轻量级商户信息库：
```
商户识别策略：
1. 位置匹配：
   - 获取用户当前位置的POI信息
   - 匹配半径可配置（50m/100m/200m）
   - 返回最近的商户候选列表

2. 商户-分类映射：
   - 预置常见商户的分类信息
   - 用户确认后更新本地映射
   - 支持用户自定义商户分类

3. 商户画像（本地）：
   - 记录用户在该商户的消费历史
   - 计算平均消费金额、消费频率
   - 识别消费模式（如每周固定咖啡消费）
```

[0017] **商户消费模式识别**：
```
算法：商户消费模式
输入：商户ID M, 用户历史 H
输出：消费模式 Pattern

模式类型：
1. 固定消费：
   - 金额波动小（std/mean < 0.1）
   - 示例：每天早餐、咖啡

2. 周期消费：
   - 固定周期访问（如每周一次）
   - 示例：周末电影、月度理发

3. 随机消费：
   - 无明显规律
   - 金额波动大

预算关联：
- 固定消费：自动纳入预算规划
- 周期消费：到期前提醒
- 随机消费：实时预算检查
```

#### 五、异常消费预警模块

[0018] **位置异常检测**：
```
算法：位置异常消费检测
输入：消费记录 T, 用户位置模式 P
输出：异常评分 Score

检测维度：
1. 地理异常：
   - 距离常规活动区域过远
   - 首次出现的位置
   - 异常评分 = sigmoid(distance / usual_range - 2)

2. 时间异常：
   - 非常规消费时段
   - 如深夜在陌生位置消费
   - 异常评分 = 1 if unusual_hour else 0

3. 金额异常：
   - 超过该位置历史平均消费
   - 异常评分 = sigmoid(amount / avg_amount - 2)

综合评分：
Score = 0.4×地理异常 + 0.3×时间异常 + 0.3×金额异常

预警阈值：
- Score > 0.7：高风险，强制确认
- 0.5 < Score ≤ 0.7：中风险，提醒确认
- Score ≤ 0.5：正常，静默记录
```

#### 六、与预算系统的深度集成

[0019] **位置感知预算分配**：
```
预算智能分配策略：
1. 区域预算建议：
   - 分析用户各区域的历史消费
   - 建议：商业区预算 = 月均商业区消费 × 1.1
   - 建议：餐饮区预算 = 月均餐饮消费 × 1.0

2. 动态预算调整：
   - 检测到用户出差/旅行
   - 自动激活临时预算配额
   - 回归后恢复日常预算

3. 位置预算看板：
   - 显示各区域的预算使用情况
   - 地图可视化展示消费热点
   - 提供区域消费优化建议
```

## 技术效果

[0020] 本发明相比现有技术，具有以下技术效果：

[0021] **一、事前预警**：在用户进入消费区域时提前预警，帮助用户在消费前做出理性决策。

[0022] **二、隐私保护**：所有位置数据在本地处理，不上传服务器，保护用户隐私。

[0023] **三、智能关联**：地理围栏与预算分类智能关联，自动识别消费场景。

[0024] **四、低功耗**：自适应位置监听和系统级围栏触发，优化设备功耗。

[0025] **五、个性化**：基于用户消费习惯的个性化场景识别和预算建议。

## 与EP4506878A2的技术区别详细说明

[0026] 本发明与EP4506878A2（Mobile Device Distance Tracking）在技术目的、核心算法和应用场景上存在本质区别：

### 一、技术目的对比

| 维度 | EP4506878A2 | 本发明 | 本质区别 |
|------|-------------|--------|---------|
| 目的 | 商务里程追踪与费用报销 | 个人日常预算预警 | **事后报销 vs 事前预警** |
| 用户 | 企业员工 | 个人消费者 | **B2B vs B2C** |
| 触发时机 | 行程结束后 | 进入消费区域时 | **被动记录 vs 主动预警** |
| 数据用途 | 生成报销凭证 | 控制消费行为 | **财务合规 vs 行为干预** |

### 二、核心技术特征对比

| 技术特征 | EP4506878A2 | 本发明 | 创新点 |
|---------|-------------|--------|--------|
| **位置处理** | 云端存储和处理 | 本地处理，不上传服务器 | 隐私保护架构 |
| **围栏类型** | 办公场所、客户地址 | 商业区、餐饮街、娱乐区 | 消费场景围栏 |
| **关联对象** | 里程费率、报销政策 | 预算分类、消费限额 | 预算-围栏关联 |
| **触发机制** | 行程结束时计算 | 进入围栏时实时预警 | 实时触发 |
| **输出内容** | 里程数、报销金额 | 预算剩余、消费建议 | 行为指导 |

### 三、算法和流程对比

**EP4506878A2的典型流程**：
```
1. 记录行程起止点
2. 计算行驶里程
3. 查询公司报销费率
4. 分类为商务/个人行程
5. 生成报销申请
```

**本发明的典型流程**：
```
1. 检测进入消费区域（地理围栏触发）
2. 识别消费场景（时间+位置+用户习惯）
3. 查询关联预算（围栏-预算映射）
4. 计算预算使用率和剩余额度
5. 发送事前预警通知（帮助用户理性决策）
6. 提供消费建议（基于历史消费模式）
```

### 四、技术边界清晰声明

[0027] 本发明**不涉及**以下EP4506878A2的技术领域：
- ❌ 里程计算和追踪
- ❌ 商务行程分类
- ❌ 报销费率查询
- ❌ 费用报销流程
- ❌ 停车费/过路费计算

[0028] 本发明**独有的**技术特征：
- ✅ 预算-围栏关联机制（将地理围栏与个人预算分类绑定）
- ✅ 事前消费预警（在消费发生前提醒用户预算状态）
- ✅ 本地化隐私保护（位置数据不上传，本地处理）
- ✅ 消费场景智能识别（基于时间+位置+习惯的多因子识别）
- ✅ 停留时间-消费预测（分析停留时间预测消费金额）

[0029] **总结**：本发明聚焦于**个人财务健康管理**，核心创新是将地理围栏技术与个人预算管理深度结合，实现**消费前预警**，帮助用户控制支出。这与EP4506878A2的**事后费用报销**形成了明确的技术边界，两者在技术目的、算法流程和应用场景上均不重叠。

## 附图说明

[0028] 图1为本发明系统架构图；
[0029] 图2为地理围栏-预算关联示意图；
[0030] 图3为进入围栏预警流程图；
[0031] 图4为场景识别算法流程图；
[0032] 图5为位置数据本地处理架构图。

## 具体实施方式

### 实施例1：商业区购物预警

[0033] 用户周末下午走进某商业区。系统执行以下步骤：

[0034] S1.1 **围栏触发**：检测到用户进入"XX商业广场"围栏（shopping_mall类型）。

[0035] S1.2 **预算检查**：查询购物预算，发现本月已使用1500元，预算2000元，使用率75%。

[0036] S1.3 **预警发送**：发送本地通知"📍 进入XX商业广场，购物预算剩余500元"。

[0037] S1.4 **快捷操作**：用户点击通知，可查看预算详情或快速记录消费。

### 实施例2：午餐场景识别

[0038] 工作日中午12点，用户位于公司附近的餐饮街。系统执行以下步骤：

[0039] S2.1 **场景识别**：检测到工作日+中午+餐饮区，识别为"午餐场景"。

[0040] S2.2 **预算激活**：自动激活餐饮预算，显示"今日午餐预算剩余30元"。

[0041] S2.3 **商户推荐**：基于用户历史，推荐附近性价比高的餐厅。

### 实施例3：异常消费预警

[0042] 用户在陌生城市的深夜出现一笔大额消费。系统执行以下步骤：

[0043] S3.1 **异常检测**：地理异常（陌生城市）+ 时间异常（深夜）+ 金额异常（超过日常）。

[0044] S3.2 **风险评分**：综合评分0.85，触发高风险预警。

[0045] S3.3 **确认请求**：发送推送"检测到异常消费，请确认是否本人操作"。

[0046] S3.4 **用户反馈**：用户确认为出差消费，系统学习并更新模式。
