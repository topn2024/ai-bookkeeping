# 权利要求书

## 多成员协作的家庭账本管理方法及系统

### 独立权利要求

**权利要求1**：一种多成员协作的家庭账本管理方法，其特征在于，包括以下步骤：

S1. 细粒度权限控制步骤：
- 定义四级角色：所有者（全部权限）、管理员（管理成员外的全部权限）、成员（仅操作自己记录）、只读（仅查看）；
- 配置细粒度权限：查看、添加、编辑、删除、导出、邀请、成员管理；
- 设置查看范围：全部/自己/指定成员；设置编辑范围：全部/自己；

S2. 协作冲突检测与解决步骤：
- 检测冲突类型：编辑冲突、删除冲突、金额冲突、分类冲突；
- 自动合并：适用于备注、标签等非关键字段；
- 最后写入优先：适用于时间戳明确的情况；
- 手动解决：适用于金额、分类等关键字段；

S3. 家庭财务数据隔离步骤：
- 个人账本仅用户自己可见；
- 家庭账本根据权限可见；
- 支持从个人账本共享到家庭账本；

S4. 智能分摊计算步骤：
- 平均分摊：每人金额 = 总金额 / 人数；
- 按比例分摊：每人金额 = 总金额 × 比例；
- 按份额分摊：每人金额 = 单价 × 份数；
- 计算债务关系，最小化转账次数；

S5. 成员管理与操作日志步骤：
- 邀请成员：生成邀请链接，7天有效期；
- 成员退出处理：保留数据/删除数据/转移数据三种选项；
- 记录操作日志，保留90天，支持回滚。

**权利要求2**：一种多成员协作的家庭账本管理系统，其特征在于，包括：

权限控制模块：用于管理4级角色和细粒度权限；

冲突解决模块：用于检测和解决协作冲突；

数据隔离模块：用于隔离个人与家庭数据；

智能分摊模块：用于计算分摊金额和债务关系；

成员管理模块：用于邀请、移除、退出处理。

### 从属权利要求

**权利要求3**：根据权利要求1所述的方法，其特征在于，所述角色权限定义为：

- 所有者：全部权限，可删除账本，可转让所有权；
- 管理员：查看、添加、编辑、删除（全部数据），可邀请和管理成员（除所有者外）；
- 成员：查看（全部数据），添加、编辑、删除（仅自己的记录）；
- 只读：仅查看权限。

**权利要求4**：根据权利要求1所述的方法，其特征在于，所述冲突检测包括：

- 版本号检查：local.version != server.version；
- 删除冲突：server.deleted；
- 金额冲突：local.amount != server.amount；
- 分类冲突：local.category != server.category。

**权利要求5**：根据权利要求1所述的方法，其特征在于，所述债务关系计算包括：

- 计算每人净支付；
- 分离债权人和债务人；
- 贪心算法最小化转账次数；
- 按金额排序，优先清算大额债务。

**权利要求6**：根据权利要求1所述的方法，其特征在于，所述成员退出处理包括：

- 保留数据：数据归属家庭账本，标记创建者为"已退出成员"；
- 删除数据：删除该用户创建的所有记录；
- 转移数据：将记录转移到用户个人账本。

**权利要求7**：根据权利要求1所述的方法，其特征在于，还包括操作日志与回滚：

- 记录所有操作：添加、编辑、删除、邀请、移除；
- 保留最近90天日志；
- 所有者和管理员可回滚操作。

**权利要求8**：根据权利要求2所述的系统，其特征在于，还包括：

- 操作日志模块：记录所有操作；
- 回滚模块：回滚错误操作；
- 通知模块：发送邀请、冲突、债务提醒。
