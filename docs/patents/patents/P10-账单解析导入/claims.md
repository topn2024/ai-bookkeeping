# 权利要求书

## 中国特有支付平台账单的精密解析导入方法及系统

### 独立权利要求

**权利要求1**：一种中国特有支付平台账单的精密解析导入方法，其特征在于，包括以下步骤：

S1. 支付平台格式自动识别步骤：
- 检测账单文件的字符编码类型，所述编码类型包括GBK、UTF-8和UTF-8 with BOM；
- 扫描文件表头，识别支付平台特征字段，所述特征字段包括支付宝的"交易创建时间"、微信支付的"交易时间"；
- 根据识别结果确定账单来源平台，并加载对应的字段映射表；

S2. 金额精度保护步骤：
- 将账单中的金额字符串直接转换为Decimal类型，避免Float中间态造成的精度损失；
- 采用银行家舍入规则处理小数位，所述银行家舍入规则将0.5舍向最近的偶数；
- 支持多种金额格式的统一转换，所述格式包括千分位、货币符号、中文数字和万元单位；

S3. 中文商户智能分类步骤：
- 基于预设的中文商户分类规则库识别商户类别，所述规则库包含中国本土商户关键词；
- 结合用户历史分类记录进行个性化分类推荐；

S4. 数据导入步骤：
- 将解析后的交易数据转换为统一数据模型；
- 批量写入数据库。

**权利要求2**：一种中国特有支付平台账单的精密解析导入系统，其特征在于，包括：

支付平台格式识别模块：用于检测账单文件的字符编码和平台特征字段，确定账单来源平台；

金额精度保护模块：用于将金额字符串转换为Decimal类型，并采用银行家舍入规则处理小数位；

中文商户分类模块：用于基于中文商户分类规则库和用户历史记录进行智能分类；

数据导入模块：用于将解析后的数据转换为统一模型并批量写入数据库。

### 从属权利要求

**权利要求3**：根据权利要求1所述的方法，其特征在于，所述支付宝账单解析包括：

- 支持全角和半角括号的字段名识别，包括"金额（元）"和"金额(元)"；
- 首选UTF-8解码，UTF-8解码失败时尝试GBK编码；
- 字段映射包括：交易创建时间、交易对方、金额、收/支、交易状态、交易订单号、服务费、成功退款。

**权利要求4**：根据权利要求1所述的方法，其特征在于，所述微信支付账单解析包括：

- 自动检测并去除UTF-8 BOM标记（0xEF 0xBB 0xBF）；
- 支持"收/支"字段的全角斜杠处理；
- 字段映射包括：交易时间、交易类型、交易对方、商品、金额、支付方式、当前状态、交易单号。

**权利要求5**：根据权利要求1所述的方法，其特征在于，所述金额格式统一转换包括：

- 千分位处理：将"1,234.56"转换为Decimal('1234.56')；
- 货币符号处理：将"¥1,234.56"转换为Decimal('1234.56')；
- 中文数字识别：将"一千二百三十四元五角六分"转换为Decimal('1234.56')；
- 万元单位处理：将"1.2万"转换为Decimal('12000.00')。

**权利要求6**：根据权利要求1所述的方法，其特征在于，所述中文商户分类规则库包括：

- 餐饮类规则：识别"美团"、"饿了么"为外卖，"星巴克"、"瑞幸"为咖啡茶饮；
- 出行类规则：识别"滴滴"、"曹操"为网约车，"地铁"、"公交"为公共交通；
- 购物类规则：识别"淘宝"、"京东"为电商，"盒马"、"永辉"为超市；
- 娱乐类规则：识别"爱奇艺"、"腾讯视频"为视频平台。

**权利要求7**：根据权利要求1所述的方法，其特征在于，还包括批量导入性能优化步骤：

- 根据文件大小选择分片策略：小于1MB直接处理，1-10MB分10片，10-100MB分100片，大于100MB分1000片；
- 采用并行处理方式解析各分片；
- 支持断点续传：每处理100片保存检查点，中断后可从检查点恢复。

**权利要求8**：根据权利要求1所述的方法，其特征在于，还包括跨平台去重步骤：

- 快速预筛选：匹配时间窗口±5分钟内、金额相同的交易；
- 计算综合相似度：similarity = 0.3×金额匹配 + 0.25×时间匹配 + 0.2×商户匹配 + 0.15×描述匹配 + 0.1×分类匹配；
- 去重决策：相似度>0.9自动合并，0.7-0.9提示用户确认，≤0.7视为不同交易。

**权利要求9**：根据权利要求1所述的方法，其特征在于，所述统一数据模型包括以下字段：

- 全局唯一ID；
- 来源平台标识；
- 平台原始交易ID；
- 交易时间；
- 金额（Decimal类型）；
- 标准化商户名称；
- 统一分类；
- 收支方向；
- 交易状态；
- 数据校验和。

**权利要求10**：根据权利要求2所述的系统，其特征在于，所述金额精度保护模块采用Decimal(18,2)类型存储金额，精确到分，支持人民币、美元、日元等多种货币的精度级别适配。
