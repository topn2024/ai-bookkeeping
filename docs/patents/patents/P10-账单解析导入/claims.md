# 权利要求书

## 中国支付平台账单精密解析导入方法及系统

### 独立权利要求

**权利要求1**：一种中国支付平台账单精密解析导入方法，其特征在于，包括以下步骤：

S1. 自适应格式识别步骤：
- 采用多特征匹配算法，自动识别支付宝、微信支付、银行卡等平台账单格式；
- 编码检测包括UTF-8、GBK、UTF-8 with BOM三种编码类型，检测准确率>99%；
- 特征字段识别包括支付宝的"交易创建时间"、微信支付的"交易时间"、银行卡的"日期"等特征字段；
- 识别准确率>95%，识别响应时间<100ms；

S2. Decimal精度保护步骤：
- 采用Decimal(18,2)数据类型存储金额，避免浮点数精度损失；
- 金额精度精确到分(0.01元)，累积误差为0；
- 格式清理包括：去除货币符号(¥、$、€)、去除千分位(1,234.56→1234.56)、处理负数((100.00)→-100.00)；
- 采用银行家舍入规则(ROUND_HALF_EVEN)处理小数位；
- 数据可靠性>99.9%；

S3. 并行解析步骤：
- 采用多线程并行解析算法，批次大小为100条/批；
- 解析速度>1000条/秒，解析响应时间<1秒(1000条记录)；
- 计算复杂度为O(n/k)，其中k为线程数；

S4. 中文商户智能分类步骤：
- 采用规则库+机器学习算法，自动识别中文商户名称并分类；
- 规则库包含中国本土商户关键词：美团/饿了么→餐饮美食、滴滴/曹操→交通出行、淘宝/京东→购物消费；
- 结合用户历史分类记录进行个性化分类推荐；
- 自动分类准确率>85%，人工分类占比<15%；

S5. 跨平台去重检测步骤：
- 采用多维度特征匹配算法，检测跨平台重复交易；
- 多维度匹配包括：金额匹配(权重0.5)、时间匹配(权重0.3)、商户匹配(权重0.2)；
- 综合相似度score = 0.5×score_amount + 0.3×score_time + 0.2×score_merchant；
- score>0.8判定为重复交易；
- 重复检测准确率>90%，误报率<10%，重复导入率<5%。

**权利要求2**：一种中国支付平台账单精密解析导入系统，其特征在于，包括：

自适应格式识别模块：采用多特征匹配算法，识别准确率>95%，识别响应时间<100ms；

Decimal精度保护模块：采用Decimal(18,2)数据类型，金额精度精确到分，累积误差为0，数据可靠性>99.9%；

并行解析引擎：采用多线程并行解析算法，解析速度>1000条/秒，解析响应时间<1秒(1000条记录)；

中文商户智能分类模块：采用规则库+机器学习算法，自动分类准确率>85%，人工分类占比<15%；

跨平台去重检测模块：采用多维度特征匹配算法，重复检测准确率>90%，误报率<10%，重复导入率<5%。

### 从属权利要求

**权利要求3**：根据权利要求1所述的方法，其特征在于，所述自适应格式识别步骤中，支付宝账单解析包括：
- 支持全角和半角括号的字段名识别，包括"金额（元）"和"金额(元)"；
- 首选UTF-8解码，UTF-8解码失败时尝试GBK编码，编码检测时间<50ms；
- 字段映射包括：交易创建时间→date、交易对方→merchant、金额→amount、收/支→direction、交易状态→status、交易订单号→order_id、服务费→fee、成功退款→refund；
- 平台判定置信度>95%。

**权利要求4**：根据权利要求1所述的方法，其特征在于，所述自适应格式识别步骤中，微信支付账单解析包括：
- 自动检测并去除UTF-8 BOM标记（0xEF 0xBB 0xBF），BOM检测时间<10ms；
- 支持"收/支"字段的全角斜杠处理；
- 字段映射包括：交易时间→date、交易类型→type、交易对方→merchant、商品→product、金额→amount、支付方式→payment_method、当前状态→status、交易单号→order_id；
- 平台判定置信度>95%。

**权利要求5**：根据权利要求1所述的方法，其特征在于，所述Decimal精度保护步骤中，金额格式统一转换包括：
- 千分位处理：将"1,234.56"转换为Decimal('1234.56')；
- 货币符号处理：将"¥1,234.56"转换为Decimal('1234.56')；
- 中文数字识别：将"一千二百三十四元五角六分"转换为Decimal('1234.56')；
- 万元单位处理：将"1.2万"转换为Decimal('12000.00')；
- 转换响应时间<1ms/条，转换准确率>99.9%。

**权利要求6**：根据权利要求1所述的方法，其特征在于，所述中文商户智能分类步骤中，分类规则库包括：
- 餐饮类规则：识别"美团"、"饿了么"为外卖，"星巴克"、"瑞幸"为咖啡茶饮，规则匹配置信度>0.95；
- 出行类规则：识别"滴滴"、"曹操"为网约车，"地铁"、"公交"为公共交通，规则匹配置信度>0.95；
- 购物类规则：识别"淘宝"、"京东"为电商，"盒马"、"永辉"为超市，规则匹配置信度>0.95；
- 娱乐类规则：识别"爱奇艺"、"腾讯视频"为视频平台，规则匹配置信度>0.95；
- 规则库包含>500个中国本土商户关键词。

**权利要求7**：根据权利要求1所述的方法，其特征在于，所述并行解析步骤中，批量导入性能优化策略包括：
- 根据文件大小选择分片策略：<1MB直接处理、1-10MB分10片、10-100MB分100片、>100MB分1000片；
- 采用并行处理方式解析各分片，线程数=min(CPU核心数, 分片数)；
- 支持断点续传：每处理100片保存检查点，中断后可从检查点恢复；
- 分片处理响应时间<100ms/片。

**权利要求8**：根据权利要求1所述的方法，其特征在于，所述跨平台去重检测步骤中，去重算法包括：
- 快速预筛选：匹配时间窗口±5分钟内、金额相同的交易，预筛选响应时间<10ms；
- 金额匹配：|T.amount - H.amount| < 0.01时score_amount=1.0，否则score_amount=0.0；
- 时间匹配：时间差<5分钟时score_time=1.0，时间差<1小时时score_time=0.5，否则score_time=0.0；
- 商户匹配：score_merchant = string_similarity(T.merchant, H.merchant)，采用编辑距离算法；
- 去重决策：相似度>0.9自动合并，0.7-0.9提示用户确认，≤0.7视为不同交易。

**权利要求9**：一种计算机可读存储介质，其上存储有计算机程序，其特征在于，所述计算机程序被处理器执行时实现权利要求1至8中任一项所述的中国支付平台账单精密解析导入方法。

**权利要求10**：一种电子设备，包括存储器、处理器及存储在存储器上并可在处理器上运行的计算机程序，其特征在于，所述处理器执行所述计算机程序时实现权利要求1至8中任一项所述的中国支付平台账单精密解析导入方法。
