# AI智能记账2.0 专利申请材料

> 版本：1.0 | 日期：2026年1月
> 申请人：[公司名称]

---

## 目录

**P0/P1 核心专利（6项）**
1. [专利一：基于FIFO资源池模型的钱龄计算方法及系统](#专利一)
2. [专利二：多模态融合的智能记账识别方法及系统](#专利二)
3. [专利三：分层自学习与协同学习的财务管理方法及系统](#专利三)
4. [专利四：零基预算的动态分配与追踪方法及系统](#专利四)
5. [专利五：四维语音交互的财务管理方法及系统](#专利五)
6. [专利六：位置增强的财务管理方法及系统](#专利六)

**P2 增强专利（6项）**
7. [专利七：多因子交易去重方法及系统](#专利七)
8. [专利八：财务数据可视化交互方法及系统](#专利八)
9. [专利九：渐进式披露的移动应用界面设计方法](#专利九)
10. [专利十：智能账单解析与导入方法及系统](#专利十)
11. [专利十一：移动端离线优先的增量同步方法](#专利十一)
12. [专利十二：隐私保护的协同学习方法](#专利十二)

---

<a name="专利一"></a>
## 专利一：基于FIFO资源池模型的钱龄计算方法及系统

### 发明名称
基于FIFO资源池模型的个人财务钱龄计算方法及系统

### 技术领域
本发明涉及个人财务管理技术领域，尤其涉及一种基于FIFO资源池模型的个人财务钱龄计算方法及系统。

### 背景技术
随着移动互联网和移动支付的普及，个人财务管理应用（记账App）已成为用户日常生活的重要工具。然而，现有的记账应用主要关注收支记录和统计分析，存在以下技术问题：

1. **缺乏资金时间价值量化**：现有技术仅能记录和展示消费金额，无法让用户直观理解其消费的时间价值。用户难以知道当前消费的资金是何时获得的收入，无法建立"先赚后花"的健康财务意识。

2. **财务健康评估维度单一**：现有技术的财务健康评估主要基于收支比例、储蓄率等静态指标，缺乏反映资金流动性和财务缓冲能力的动态指标。

3. **资金来源追溯困难**：在多收入源场景下，现有技术无法精确追踪每笔支出具体来自哪笔收入，导致用户财务意识模糊。

4. **计算效率问题**：若采用全量重算方式计算资金时间价值，在大数据量场景下会产生严重的性能问题。

美国个人理财应用YNAB提出了"Age of Money"（钱龄）概念，但其采用简单的加权平均算法，存在精度不足、无法追溯具体来源等问题。

因此，需要一种新的技术方案，能够精确计算资金的时间价值，提供可追溯的资金来源链路，并在大数据量场景下保持良好的计算性能。

### 发明内容

#### 技术问题
本发明要解决的技术问题是：如何精确计算个人财务的"钱龄"指标，实现每笔支出到收入来源的完整追溯，并在大数据量场景下保持高效的增量计算性能。

#### 技术方案
为解决上述技术问题，本发明提供一种基于FIFO资源池模型的钱龄计算方法，包括以下步骤：

**S1. 资源池创建与管理**
- S1.1 当检测到收入交易时，创建对应的资源池对象，包含以下属性：
  - 资源池ID（唯一标识）
  - 收入金额（初始余额）
  - 收入时间戳
  - 当前余额
  - 状态标记（活跃/耗尽）
- S1.2 将新创建的资源池按时间顺序插入资源池队列
- S1.3 维护资源池的活跃状态，当余额为零时标记为耗尽

**S2. FIFO消耗算法**
- S2.1 当检测到支出交易时，获取当前所有活跃状态的资源池
- S2.2 按资源池创建时间升序排列（先进先出原则）
- S2.3 依次从最早的资源池中扣减金额：
  ```
  对于每个活跃资源池P（按时间升序）:
      如果 剩余支出金额 <= P.当前余额:
          从P扣减剩余支出金额
          记录消费链路(支出ID, P.ID, 扣减金额, P.收入时间戳)
          返回
      否则:
          从P扣减P.当前余额
          记录消费链路(支出ID, P.ID, P.当前余额, P.收入时间戳)
          将P标记为耗尽
          剩余支出金额 = 剩余支出金额 - P.当前余额
  ```
- S2.4 保存消费链路记录，用于钱龄追溯

**S3. 钱龄计算**
- S3.1 单笔交易钱龄计算：
  ```
  单笔钱龄 = Σ(链路金额 × 链路钱龄) / Σ(链路金额)

  其中：
  链路钱龄 = 支出时间 - 对应资源池收入时间
  ```
- S3.2 账户整体钱龄计算：
  ```
  整体钱龄 = Σ(资源池余额 × 资源池存活天数) / Σ(资源池余额)

  其中：
  资源池存活天数 = 当前时间 - 资源池收入时间
  ```

**S4. 增量计算优化**
- S4.1 维护脏数据标记机制：
  - 当交易发生变更（新增/修改/删除）时，标记受影响的资源池
  - 仅对标记为脏的资源池进行重算
- S4.2 增量重算逻辑：
  ```
  对于每个脏资源池P:
      重置P的当前余额为初始金额
      获取所有涉及P的消费链路
      按时间顺序重新模拟消耗过程
      更新P的当前余额和状态
      清除P的脏标记
  ```
- S4.3 引入时间窗口优化：仅重算指定时间范围内的资源池

**S5. 健康等级评估**
- S5.1 根据计算得到的钱龄值，映射到六级健康等级：
  - 危险级（<7天）：财务缓冲极度不足
  - 警告级（7-14天）：财务缓冲不足
  - 一般级（14-30天）：财务状况一般
  - 良好级（30-60天）：财务状况良好
  - 优秀级（60-90天）：财务状况优秀
  - 理想级（>90天）：财务状况理想

**S6. 资源追溯查询**
- S6.1 提供单笔支出的来源追溯：
  ```
  输入：支出交易ID
  输出：[{资源池ID, 收入时间, 消耗金额, 该笔钱龄}]
  ```
- S6.2 提供收入的去向追溯：
  ```
  输入：收入交易ID（对应资源池ID）
  输出：[{支出交易ID, 支出时间, 消耗金额}]
  ```

#### 有益效果
本发明相比现有技术具有以下有益效果：

1. **精确性**：采用FIFO资源池模型，相比简单加权平均算法，能够精确追踪每笔支出的实际资金来源，计算结果更加准确。

2. **可追溯性**：建立完整的消费链路记录，用户可以查询任意一笔支出来自哪些收入，以及任意一笔收入被哪些支出消耗，提供前所未有的财务透明度。

3. **高性能**：采用增量计算和脏数据标记机制，避免全量重算，在百万级交易数据场景下仍能保持毫秒级响应。

4. **实用性**：通过六级健康等级映射，将抽象的钱龄数值转化为用户易懂的健康评估，帮助用户建立健康的财务习惯。

### 权利要求书

**权利要求1**
一种基于FIFO资源池模型的钱龄计算方法，其特征在于，包括以下步骤：
- 当检测到收入交易时，创建对应的资源池对象，所述资源池对象包含收入金额、收入时间戳、当前余额和状态标记；
- 当检测到支出交易时，按资源池创建时间升序，依次从最早的活跃资源池中扣减金额，直至完全消耗支出金额；
- 在扣减过程中，记录消费链路，所述消费链路包含支出ID、资源池ID、扣减金额和资源池收入时间戳；
- 根据消费链路计算钱龄，所述钱龄等于各链路金额与对应链路钱龄的加权平均值。

**权利要求2**
根据权利要求1所述的方法，其特征在于，所述按资源池创建时间升序依次扣减金额的步骤具体包括：
- 获取当前所有状态为活跃的资源池；
- 按资源池创建时间升序排列；
- 对于每个资源池，判断剩余支出金额是否小于等于该资源池当前余额；
- 若是，则从该资源池扣减剩余支出金额并返回；
- 若否，则从该资源池扣减其全部当前余额，将该资源池标记为耗尽，并继续处理下一个资源池。

**权利要求3**
根据权利要求1所述的方法，其特征在于，还包括增量计算优化步骤：
- 当交易发生变更时，标记受影响的资源池为脏数据；
- 仅对标记为脏的资源池进行重算；
- 重算完成后清除脏数据标记。

**权利要求4**
根据权利要求1所述的方法，其特征在于，还包括健康等级评估步骤：
- 根据计算得到的钱龄值，映射到预设的多级健康等级；
- 所述健康等级包括危险级、警告级、一般级、良好级、优秀级和理想级，分别对应不同的钱龄阈值范围。

**权利要求5**
根据权利要求1所述的方法，其特征在于，还包括资源追溯查询步骤：
- 根据支出交易ID，查询该支出的所有消费链路，返回资金来源信息；
- 根据收入交易ID，查询该收入对应资源池的所有被消耗记录，返回资金去向信息。

**权利要求6**
一种基于FIFO资源池模型的钱龄计算系统，其特征在于，包括：
- 资源池管理模块，用于创建和管理资源池对象；
- FIFO消耗模块，用于按先进先出原则从资源池中扣减支出金额；
- 链路记录模块，用于记录和存储消费链路信息；
- 钱龄计算模块，用于根据消费链路计算钱龄值；
- 增量优化模块，用于实现脏数据标记和增量重算；
- 健康评估模块，用于将钱龄值映射为健康等级。

**权利要求7**
根据权利要求6所述的系统，其特征在于，还包括追溯查询模块，用于提供支出来源追溯和收入去向追溯功能。

**权利要求8**
一种计算机可读存储介质，其上存储有计算机程序，其特征在于，所述计算机程序被处理器执行时实现权利要求1至5中任一项所述方法的步骤。

### 说明书附图

#### 图1：FIFO资源池模型示意图
```
┌─────────────────────────────────────────────────────────────────┐
│                     FIFO资源池消耗模型                           │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  收入时间轴:  1/1        1/15        2/1        2/15           │
│              │           │           │           │             │
│              ▼           ▼           ▼           ▼             │
│           ┌──────┐   ┌──────┐   ┌──────┐   ┌──────┐           │
│  资源池:  │ P1   │   │ P2   │   │ P3   │   │ P4   │           │
│           │¥5000 │   │¥3000 │   │¥5000 │   │¥2000 │           │
│           └──────┘   └──────┘   └──────┘   └──────┘           │
│              │           │           │           │             │
│              └───────────┴───────────┴───────────┘             │
│                          ↓                                     │
│                    ┌──────────┐                                │
│  支出 (2/20):      │  ¥4000   │                                │
│                    └──────────┘                                │
│                          ↓                                     │
│              ┌───────────────────────┐                         │
│              │    FIFO消耗过程       │                         │
│              ├───────────────────────┤                         │
│              │ 1. P1剩余¥1000 < ¥4000│                         │
│              │    消耗P1全部¥1000    │                         │
│              │    剩余待消耗¥3000    │                         │
│              │                       │                         │
│              │ 2. P2剩余¥3000 = ¥3000│                         │
│               │    消耗P2全部¥3000    │                         │
│              │    消耗完成           │                         │
│              └───────────────────────┘                         │
│                          ↓                                     │
│              ┌───────────────────────┐                         │
│              │    消费链路记录       │                         │
│              ├───────────────────────┤                         │
│              │ 链路1: P1→¥1000       │                         │
│              │        钱龄=50天       │                         │
│              │ 链路2: P2→¥3000       │                         │
│              │        钱龄=36天       │                         │
│              └───────────────────────┘                         │
│                          ↓                                     │
│              ┌───────────────────────┐                         │
│              │    钱龄计算           │                         │
│              ├───────────────────────┤                         │
│              │ 钱龄 = (1000×50 +     │                         │
│              │        3000×36) / 4000│                         │
│              │      = 39.5天          │                         │
│              └───────────────────────┘                         │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

#### 图2：系统架构图
```
┌─────────────────────────────────────────────────────────────────┐
│                      钱龄计算系统架构                            │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │                     应用层                               │   │
│  │  ┌──────────┐  ┌──────────┐  ┌──────────┐              │   │
│  │  │ 钱龄展示 │  │ 健康评估 │  │ 追溯查询 │              │   │
│  │  └──────────┘  └──────────┘  └──────────┘              │   │
│  └─────────────────────────────────────────────────────────┘   │
│                              ↑                                  │
│                              ↓                                  │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │                     服务层                               │   │
│  │  ┌──────────┐  ┌──────────┐  ┌──────────┐              │   │
│  │  │ 资源池   │  │ FIFO消耗 │  │ 钱龄计算 │              │   │
│  │  │ 管理服务 │  │   服务   │  │   服务   │              │   │
│  │  └──────────┘  └──────────┘  └──────────┘              │   │
│  │  ┌──────────┐  ┌──────────┐                            │   │
│  │  │ 增量优化 │  │ 健康等级 │                            │   │
│  │  │   服务   │  │ 映射服务 │                            │   │
│  │  └──────────┘  └──────────┘                            │   │
│  └─────────────────────────────────────────────────────────┘   │
│                              ↑                                  │
│                              ↓                                  │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │                     数据层                               │   │
│  │  ┌──────────┐  ┌──────────┐  ┌──────────┐              │   │
│  │  │ 资源池表 │  │ 消费链路 │  │ 脏数据   │              │   │
│  │  │          │  │   表     │  │ 标记表   │              │   │
│  │  └──────────┘  └──────────┘  └──────────┘              │   │
│  └─────────────────────────────────────────────────────────┘   │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

#### 图3：方法流程图
```
┌─────────────────┐
│     开始        │
└────────┬────────┘
         ↓
┌─────────────────┐
│  接收交易事件   │
└────────┬────────┘
         ↓
    ┌────┴────┐
    │交易类型?│
    └────┬────┘
    ↙         ↘
┌──────┐    ┌──────┐
│ 收入 │    │ 支出 │
└──┬───┘    └──┬───┘
   ↓           ↓
┌──────────┐  ┌──────────────┐
│创建资源池│  │获取活跃资源池│
└────┬─────┘  └──────┬───────┘
     ↓               ↓
┌──────────┐  ┌──────────────┐
│加入队列  │  │按时间升序排列│
└────┬─────┘  └──────┬───────┘
     ↓               ↓
     │         ┌─────┴─────┐
     │         │遍历资源池 │
     │         │FIFO消耗   │
     │         └─────┬─────┘
     │               ↓
     │         ┌─────────────┐
     │         │记录消费链路 │
     │         └─────┬───────┘
     │               ↓
     │         ┌─────────────┐
     │         │计算钱龄     │
     │         └─────┬───────┘
     ↓               ↓
┌────────────────────────────┐
│      更新健康等级          │
└───────────┬────────────────┘
            ↓
┌─────────────────┐
│      结束       │
└─────────────────┘
```

### 具体实施方式

#### 实施例1：基本钱龄计算

假设用户有以下收支记录：
- 1月1日收入：工资 ¥10,000
- 1月15日收入：奖金 ¥5,000
- 1月20日支出：房租 ¥3,000
- 2月1日支出：购物 ¥8,000

**步骤1：创建资源池**
```
资源池P1: {id: "P1", 金额: 10000, 时间: 1/1, 余额: 10000, 状态: 活跃}
资源池P2: {id: "P2", 金额: 5000, 时间: 1/15, 余额: 5000, 状态: 活跃}
```

**步骤2：处理1月20日支出¥3,000**
- 从P1消耗¥3,000
- P1余额更新为¥7,000
- 消费链路：{支出: "1/20房租", 资源池: P1, 金额: 3000, 钱龄: 19天}
- 该笔支出钱龄 = 19天

**步骤3：处理2月1日支出¥8,000**
- 从P1消耗剩余¥7,000，P1标记为耗尽
- 从P2消耗¥1,000
- 消费链路1：{支出: "2/1购物", 资源池: P1, 金额: 7000, 钱龄: 31天}
- 消费链路2：{支出: "2/1购物", 资源池: P2, 金额: 1000, 钱龄: 17天}
- 该笔支出钱龄 = (7000×31 + 1000×17) / 8000 = 29.25天

**步骤4：计算账户整体钱龄（截至2月1日）**
- P2剩余¥4,000，存活17天
- 整体钱龄 = 4000×17 / 4000 = 17天
- 健康等级：一般级（14-30天）

#### 实施例2：增量计算优化

假设用户修改了1月15日的奖金金额从¥5,000改为¥8,000：

**步骤1：标记脏数据**
- 标记P2为脏数据
- 标记所有涉及P2的消费链路为待重算

**步骤2：增量重算**
- 重置P2：{金额: 8000, 余额: 8000}
- 重新处理2月1日支出对P2的消耗
- 更新消费链路2：金额变更为¥1,000（不变，因为P1已足够消耗大部分）
- P2余额更新为¥7,000

**步骤3：清除脏标记**
- 清除P2的脏数据标记
- 更新整体钱龄

通过增量计算，仅重算了1个资源池和1条消费链路，避免了对所有交易的全量重算。

---

<a name="专利二"></a>
## 专利二：多模态融合的智能记账识别方法及系统

### 发明名称
多模态融合的智能记账识别方法及系统

### 技术领域
本发明涉及人工智能和自然语言处理技术领域，尤其涉及一种多模态融合的智能记账识别方法及系统。

### 背景技术
传统记账应用主要依赖用户手动输入，存在以下技术问题：

1. **输入效率低**：用户需要手动填写金额、分类、商户、备注等多个字段，操作繁琐，导致记账习惯难以坚持。

2. **识别方式单一**：现有智能识别方案通常仅支持单一模态（如仅支持语音或仅支持图片），无法满足多场景需求。

3. **多笔交易识别困难**：当用户一次性表达多笔交易（如"早餐15，午餐28，晚餐45"）时，现有技术难以准确拆分和识别。

4. **分类准确率有限**：现有自动分类算法主要基于关键词匹配，缺乏上下文理解能力，准确率难以满足用户需求。

5. **离线能力缺失**：大多数智能识别方案依赖云端服务，在网络不佳时无法使用。

因此，需要一种新的技术方案，能够支持语音、图像、文本等多种输入方式，准确识别和拆分多笔交易，并在离线场景下仍能正常工作。

### 发明内容

#### 技术问题
本发明要解决的技术问题是：如何实现语音、图像、文本多模态的统一识别，准确拆分多笔交易，并在保证识别准确率的同时支持离线使用。

#### 技术方案
为解决上述技术问题，本发明提供一种多模态融合的智能记账识别方法，包括以下步骤：

**S1. 多模态输入接收与预处理**

- S1.1 语音输入预处理：
  - 接收音频流或音频文件
  - 进行音频降噪、静音检测、端点检测
  - 将音频分段处理，支持连续语音

- S1.2 图像输入预处理：
  - 接收图像文件或相机实时输入
  - 进行图像增强、倾斜校正、裁剪优化
  - 识别图像类型（小票、支付截图、银行账单、手写笔记）

- S1.3 文本输入预处理：
  - 接收自然语言文本
  - 进行分词、标准化处理
  - 识别文本格式（自然语言、结构化格式）

**S2. 模态转换层**

- S2.1 语音转文本（ASR）：
  - 主路径：调用云端大语言模型（如通义千问）进行语音识别
  - 备用路径：使用本地Whisper模型进行离线识别
  - 输出：识别文本 + 置信度分数

- S2.2 图像转文本（OCR + LLM）：
  - 第一阶段：OCR提取图像中的文字信息
  - 第二阶段：调用LLM进行语义理解，提取金额、商户、日期等结构化信息
  - 输出：结构化交易信息 + 置信度分数

**S3. 语义理解层**

- S3.1 实体识别：
  ```
  识别实体类型：
  - AMOUNT: 金额（如"35元"、"¥100"）
  - CATEGORY: 分类（如"餐饮"、"交通"）
  - MERCHANT: 商户（如"星巴克"、"肯德基"）
  - DATE: 日期（如"昨天"、"上周一"）
  - ACCOUNT: 账户（如"微信"、"现金"）
  - TYPE: 交易类型（如"收入"、"支出"）
  ```

- S3.2 意图分类：
  ```
  识别意图类型：
  - RECORD_EXPENSE: 记录支出
  - RECORD_INCOME: 记录收入
  - RECORD_TRANSFER: 记录转账
  - BATCH_RECORD: 批量记录
  - QUERY: 查询操作
  - CONFIG: 配置操作
  ```

- S3.3 多笔交易拆分：
  - 检测分隔符（逗号、顿号、"和"、"还有"等）
  - 识别并行结构模式
  - 将复合表达拆分为多个独立交易
  - 示例："早餐15，午餐28，晚餐45" → 3笔独立交易

**S4. 智能分类模块**

- S4.1 三维分类模型：
  ```
  分类置信度 = w1×场景匹配度 + w2×商户匹配度 + w3×历史习惯匹配度

  其中：
  - 场景匹配度：基于当前时间、位置等上下文
  - 商户匹配度：基于商户名称到分类的映射库
  - 历史习惯匹配度：基于用户历史记账习惯
  ```

- S4.2 缺失信息推断：
  - 若未指定分类，根据商户推断
  - 若未指定日期，默认使用当前日期
  - 若未指定账户，使用用户常用账户

**S5. 置信度评估与用户确认**

- S5.1 置信度计算：
  ```
  总体置信度 = min(识别置信度, 分类置信度, 完整性置信度)
  ```

- S5.2 用户确认策略：
  - 高置信度（>0.9）：自动记录，后台提示
  - 中置信度（0.7-0.9）：显示识别结果，请求确认
  - 低置信度（<0.7）：高亮不确定项，请求修正

**S6. 离线/在线切换**

- S6.1 网络状态检测：实时监测网络连接状态
- S6.2 自动降级：网络不可用时自动切换到本地模型
- S6.3 结果同步：恢复网络后，同步离线期间的识别结果到云端进行验证

**S7. 学习反馈**

- S7.1 用户修正采集：记录用户对识别结果的修正
- S7.2 反馈学习：将修正数据反馈给自学习系统
- S7.3 模型优化：定期更新本地分类模型

#### 有益效果
本发明相比现有技术具有以下有益效果：

1. **多模态融合**：统一处理语音、图像、文本三种输入，用户可根据场景选择最便捷的方式。

2. **高准确率**：通过三维分类模型和LLM语义理解，分类准确率达到95%以上。

3. **多笔拆分**：支持自动识别和拆分复合表达中的多笔交易，提高记账效率。

4. **离线可用**：通过本地模型支持离线识别，确保任何场景下都可使用。

5. **持续优化**：通过用户反馈持续优化识别模型，准确率随使用时间增长。

### 权利要求书

**权利要求1**
一种多模态融合的智能记账识别方法，其特征在于，包括以下步骤：
- 接收多模态输入，所述多模态输入包括语音、图像和文本中的一种或多种；
- 对所述多模态输入进行预处理和模态转换，将语音和图像转换为文本表示；
- 对转换后的文本进行语义理解，识别实体和意图；
- 当检测到复合表达时，进行多笔交易拆分；
- 基于三维分类模型进行智能分类；
- 根据置信度评估结果决定自动记录或请求用户确认。

**权利要求2**
根据权利要求1所述的方法，其特征在于，所述多笔交易拆分步骤包括：
- 检测文本中的分隔符，所述分隔符包括逗号、顿号和连接词；
- 识别并行结构模式；
- 将复合表达拆分为多个独立的交易单元；
- 对每个交易单元独立进行实体识别和分类。

**权利要求3**
根据权利要求1所述的方法，其特征在于，所述三维分类模型的分类置信度计算公式为：
```
分类置信度 = w1×场景匹配度 + w2×商户匹配度 + w3×历史习惯匹配度
```
其中w1、w2、w3为权重系数，场景匹配度基于时间和位置上下文计算，商户匹配度基于商户分类映射库计算，历史习惯匹配度基于用户历史记账数据计算。

**权利要求4**
根据权利要求1所述的方法，其特征在于，还包括离线/在线切换步骤：
- 实时检测网络连接状态；
- 当网络不可用时，自动切换到本地识别模型；
- 当网络恢复时，同步离线期间的识别结果到云端进行验证。

**权利要求5**
根据权利要求1所述的方法，其特征在于，所述图像输入的处理包括：
- 识别图像类型，所述图像类型包括小票、支付截图、银行账单和手写笔记；
- 对图像进行增强和校正预处理；
- 通过OCR提取文字信息；
- 通过大语言模型进行语义理解，提取结构化交易信息。

**权利要求6**
一种多模态融合的智能记账识别系统，其特征在于，包括：
- 预处理模块，用于对多模态输入进行预处理；
- 模态转换模块，用于将语音和图像转换为文本表示；
- 语义理解模块，用于进行实体识别和意图分类；
- 交易拆分模块，用于将复合表达拆分为多笔独立交易；
- 智能分类模块，用于基于三维模型进行分类；
- 置信度评估模块，用于计算识别置信度并决定确认策略。

**权利要求7**
根据权利要求6所述的系统，其特征在于，还包括：
- 离线识别模块，包含本地语音识别模型和本地分类模型；
- 网络检测模块，用于检测网络状态并控制在线/离线切换；
- 学习反馈模块，用于采集用户修正并反馈给学习系统。

---

<a name="专利三"></a>
## 专利三：分层自学习与协同学习的财务管理方法及系统

### 发明名称
分层自学习与协同学习的个人财务管理方法及系统

### 技术领域
本发明涉及机器学习和个人财务管理技术领域，尤其涉及一种分层自学习与协同学习的个人财务管理方法及系统。

### 背景技术
现有的智能财务管理应用在个性化和智能化方面存在以下技术问题：

1. **冷启动问题**：新用户没有历史数据，系统无法提供个性化服务，需要长时间使用才能逐步适应用户习惯。

2. **学习孤岛**：每个用户的学习成果相互隔离，无法共享，导致大量重复学习，资源浪费。

3. **隐私与共享矛盾**：用户财务数据敏感，传统的集中式学习方案存在隐私泄露风险。

4. **模型更新困难**：传统机器学习需要重新训练和部署模型，无法实现在线增量学习。

5. **跨模块复用缺失**：分类学习的成果无法复用到预算建议等其他模块，学习效率低。

因此，需要一种新的技术方案，能够在保护用户隐私的前提下实现个体学习与群体智慧的融合，支持在线增量学习，并实现跨模块的知识迁移。

### 发明内容

#### 技术问题
本发明要解决的技术问题是：如何在保护用户隐私的前提下，实现个体学习、协同学习、迁移学习和增量学习的统一框架，提高财务管理应用的智能化水平。

#### 技术方案
为解决上述技术问题，本发明提供一种分层自学习与协同学习的财务管理方法，包括以下步骤：

**S1. 统一学习接口层**

- S1.1 定义标准化学习接口：
  ```
  ISelfLearningModule<InputType, ResultType>:
    - collectSample(input, userFeedback): 采集学习样本
    - train(samples): 训练模型
    - predict(input): 预测结果
    - evaluate(): 评估模型效果
    - export(): 导出模型
    - import(model): 导入模型
  ```

- S1.2 学习模块注册与发现：
  - 各智能模块（分类、预算、异常检测等）实现统一接口
  - 核心学习引擎自动发现并管理已注册模块

**S2. 个体学习层**

- S2.1 显式反馈学习：
  - 采集用户的主动修正行为（如修改分类、调整金额）
  - 将修正记录为高置信度样本
  - 更新个人模型权重

- S2.2 隐式行为学习：
  - 采集用户的接受/拒绝行为
  - 分析使用模式和偏好
  - 推断用户意图

- S2.3 渐进式规则生成：
  ```
  当满足以下条件时生成个人规则：
  - 相同模式出现次数 >= 阈值（如3次）
  - 用户未修正该模式
  - 模式置信度 >= 0.8

  规则格式：
  {条件} → {结论} [置信度, 支持度]

  示例：
  {商户包含"星巴克"} → {分类="餐饮-咖啡"} [0.95, 15]
  ```

**S3. 协同学习层**

- S3.1 数据脱敏处理：
  ```
  脱敏规则：
  - 移除用户ID、设备ID等直接标识符
  - 金额归一化（转换为相对比例）
  - 商户名泛化（如"星巴克中关村店"→"星巴克"）
  - 时间模糊化（精确到日期级别）
  - 位置泛化（精确到城市级别）
  ```

- S3.2 规则提炼与沉淀：
  ```
  当个人规则满足以下条件时上传至协同层：
  - 规则置信度 >= 0.9
  - 规则支持度 >= 10
  - 用户同意参与协同学习

  协同规则生成条件：
  - 相似规则在 N 个用户中出现（N >= 100）
  - 规则冲突率 < 5%
  ```

- S3.3 群体智慧分发：
  - 新用户获取协同规则作为初始模型
  - 协同规则定期同步到客户端
  - 协同规则与个人规则融合时，个人规则优先

**S4. 迁移学习层**

- S4.1 跨模块知识迁移：
  ```
  迁移路径示例：
  - 分类学习 → 预算建议（分类偏好用于预算分配建议）
  - 消费模式 → 异常检测（正常模式用于异常基线）
  - 语音习惯 → 命令理解（常用表达用于意图识别）
  ```

- S4.2 特征共享机制：
  - 定义通用特征向量
  - 各模块可读取共享特征
  - 特征更新自动通知相关模块

**S5. 增量学习层**

- S5.1 在线模型更新：
  ```
  增量更新算法：
  1. 新样本到达
  2. 计算新样本对当前模型的影响
  3. 微调模型参数（不重新训练）
  4. 验证模型性能未退化
  5. 应用更新后的模型
  ```

- S5.2 时间衰减机制：
  - 远期样本权重逐渐降低
  - 近期样本权重保持稳定
  - 权重衰减公式：`weight = base_weight × exp(-λ × age)`

- S5.3 灾难性遗忘防护：
  - 保留关键历史样本
  - 定期进行完整性检验
  - 检测到性能退化时回滚

**S6. 隐私保护层**

- S6.1 本地优先原则：
  - 敏感数据仅在本地处理
  - 模型训练在设备端完成
  - 仅上传脱敏后的规则

- S6.2 差分隐私：
  - 对上传数据添加噪声
  - 确保单个用户数据不可还原

- S6.3 用户控制：
  - 用户可选择是否参与协同学习
  - 用户可查看和删除已上传的规则
  - 用户可导出个人模型

**S7. 效果评估层**

- S7.1 评估指标：
  ```
  - 准确率 (Accuracy)
  - 精确率 (Precision)
  - 召回率 (Recall)
  - F1 分数
  - 响应时间
  - 用户修正率
  ```

- S7.2 A/B测试框架：
  - 支持多版本模型对比
  - 自动选择表现更优的版本

#### 有益效果
本发明相比现有技术具有以下有益效果：

1. **冷启动优化**：通过协同学习，新用户可立即获得群体智慧支持，无需长时间积累。

2. **隐私保护**：采用本地优先和数据脱敏策略，在实现知识共享的同时保护用户隐私。

3. **持续进化**：支持在线增量学习，模型随使用自动优化，无需重新部署。

4. **知识复用**：通过迁移学习，一个模块的学习成果可惠及其他模块。

5. **统一框架**：所有智能模块使用统一接口，便于扩展和维护。

### 权利要求书

**权利要求1**
一种分层自学习与协同学习的财务管理方法，其特征在于，包括以下步骤：
- 定义统一的学习接口，各智能模块实现该接口；
- 在个体学习层，采集用户的显式反馈和隐式行为，生成个人规则；
- 在协同学习层，对个人规则进行脱敏处理后上传，通过群体规则提炼生成协同规则；
- 将协同规则分发至客户端，与个人规则融合使用；
- 支持跨模块的知识迁移和在线增量更新。

**权利要求2**
根据权利要求1所述的方法，其特征在于，所述数据脱敏处理包括：
- 移除直接标识符；
- 对金额进行归一化处理；
- 对商户名进行泛化处理；
- 对时间和位置进行模糊化处理。

**权利要求3**
根据权利要求1所述的方法，其特征在于，所述协同规则生成条件包括：
- 相似规则在预设数量的用户中出现；
- 规则冲突率低于预设阈值；
- 规则置信度高于预设阈值。

**权利要求4**
根据权利要求1所述的方法，其特征在于，所述增量学习包括：
- 新样本到达时计算对当前模型的影响；
- 微调模型参数而非重新训练；
- 应用时间衰减机制降低远期样本权重；
- 检测性能退化时进行模型回滚。

**权利要求5**
一种分层自学习与协同学习的财务管理系统，其特征在于，包括：
- 统一学习接口层，定义标准化的学习接口；
- 个体学习层，用于采集用户反馈并生成个人规则；
- 协同学习层，用于脱敏处理、规则提炼和分发；
- 迁移学习层，用于跨模块知识迁移；
- 增量学习层，用于在线模型更新；
- 隐私保护层，用于确保数据安全。

---

<a name="专利四"></a>
## 专利四：零基预算的动态分配与追踪方法及系统

### 发明名称
基于小金库模型的零基预算动态分配与追踪方法及系统

### 技术领域
本发明涉及个人财务管理技术领域，尤其涉及一种基于小金库模型的零基预算动态分配与追踪方法及系统。

### 背景技术
现有的预算管理方案存在以下技术问题：

1. **静态分配**：传统预算在月初设定后难以调整，无法适应实际消费变化。

2. **约束力弱**：预算超支时仅提供提醒，缺乏有效的行为约束机制。

3. **多目标冲突**：用户有多个财务目标（储蓄、还债、日常消费），现有方案难以协调。

4. **收入分配繁琐**：收入到达时需要手动分配到各预算类别，操作复杂。

因此，需要一种新的技术方案，能够实现预算的动态分配、灵活调拨和主动拦截，帮助用户更有效地管理财务。

### 发明内容

#### 技术问题
本发明要解决的技术问题是：如何实现预算的动态分配和灵活调拨，在超支时提供有效拦截，并协调多个财务目标。

#### 技术方案
为解决上述技术问题，本发明提供一种基于小金库模型的零基预算方法，包括以下步骤：

**S1. 小金库模型定义**

- S1.1 小金库类型：
  ```
  - 固定支出型：房租、水电、保险等必须支付
  - 弹性支出型：餐饮、交通、娱乐等可调整
  - 储蓄目标型：紧急基金、购房首付等
  - 债务还款型：信用卡、贷款还款等
  ```

- S1.2 小金库属性：
  ```
  Vault {
    id: 唯一标识
    name: 名称
    type: 类型
    budgetAmount: 预算金额
    currentBalance: 当前余额
    targetAmount: 目标金额（储蓄型）
    priority: 分配优先级
    linkedCategories: 关联分类
  }
  ```

**S2. 四层分配策略**

- S2.1 固定金额分配：
  ```
  策略：直接指定分配金额
  示例：每月固定分配¥3000到"房租"小金库
  ```

- S2.2 百分比分配：
  ```
  策略：按收入的百分比分配
  示例：将收入的20%分配到"储蓄"小金库
  ```

- S2.3 剩余分配：
  ```
  策略：将未分配余额分配给指定小金库
  示例：其他分配完成后，剩余金额进入"弹性消费"
  ```

- S2.4 补齐目标分配：
  ```
  策略：优先补齐某小金库至目标金额
  示例：优先将"应急金"补齐到¥30000
  ```

**S3. 收入自动分配协调器**

- S3.1 收入类型识别：
  - 工资收入：按主分配规则分配
  - 奖金收入：可配置特殊分配规则
  - 兼职收入：可配置独立分配策略

- S3.2 分配执行顺序：
  ```
  1. 按优先级排序所有小金库
  2. 依次执行固定金额分配
  3. 执行百分比分配
  4. 执行补齐目标分配
  5. 执行剩余分配
  6. 记录分配明细
  ```

**S4. 小金库间动态调拨**

- S4.1 调拨触发：
  - 用户主动发起调拨
  - 系统建议调拨（某小金库余额不足时）

- S4.2 调拨规则：
  ```
  调拨请求 {
    fromVault: 来源小金库
    toVault: 目标小金库
    amount: 调拨金额
    reason: 调拨原因
  }

  验证规则：
  - 来源小金库余额 >= 调拨金额
  - 调拨后钱龄影响评估
  ```

- S4.3 调拨历史记录：
  - 完整记录每次调拨
  - 支持调拨撤销

**S5. 消费拦截机制**

- S5.1 预警阈值：
  ```
  阈值配置：
  - 60%：黄色预警，温和提醒
  - 80%：橙色预警，强提醒
  - 100%：红色预警，拦截确认
  ```

- S5.2 拦截流程：
  ```
  当支出金额 > 小金库余额时：
  1. 暂停交易记录
  2. 弹出拦截确认界面
  3. 显示当前余额和预算执行状态
  4. 提供解决方案：
     - 从其他小金库调拨
     - 调整本次消费金额
     - 标记为计划外支出
     - 确认超支记录
  5. 用户确认后完成记录
  ```

**S6. 与钱龄系统联动**

- S6.1 预算影响钱龄：
  - 严格遵守预算 → 钱龄增长
  - 频繁超支 → 钱龄下降

- S6.2 钱龄影响预算建议：
  - 钱龄低时建议压缩弹性支出
  - 钱龄高时可适当放宽预算

#### 有益效果
本发明相比现有技术具有以下有益效果：

1. **灵活性**：支持动态调拨和多策略分配，适应各种消费场景。

2. **约束力**：通过拦截机制形成有效的行为约束，帮助用户控制支出。

3. **协调性**：多类型小金库协调多个财务目标，避免顾此失彼。

4. **自动化**：收入自动分配，减少用户操作负担。

5. **联动性**：与钱龄系统深度集成，形成完整的财务管理闭环。

### 权利要求书

**权利要求1**
一种基于小金库模型的零基预算方法，其特征在于，包括以下步骤：
- 创建多类型小金库，所述类型包括固定支出型、弹性支出型、储蓄目标型和债务还款型；
- 为每个小金库配置分配策略，所述分配策略包括固定金额、百分比、剩余分配和补齐目标；
- 当收入到达时，按优先级和策略自动分配到各小金库；
- 当支出超过小金库余额时，触发拦截确认机制；
- 支持小金库间的动态调拨。

**权利要求2**
根据权利要求1所述的方法，其特征在于，所述拦截确认机制包括：
- 暂停交易记录；
- 显示当前预算执行状态；
- 提供多种解决方案供用户选择；
- 用户确认后完成交易记录。

**权利要求3**
根据权利要求1所述的方法，其特征在于，还包括与钱龄系统的联动：
- 预算执行情况影响钱龄计算；
- 钱龄水平影响预算建议生成。

**权利要求4**
一种基于小金库模型的零基预算系统，其特征在于，包括：
- 小金库管理模块，用于创建和管理多类型小金库；
- 分配策略模块，用于配置和执行多种分配策略；
- 自动分配模块，用于收入到达时自动分配；
- 拦截确认模块，用于超支时的行为拦截；
- 调拨管理模块，用于小金库间的资金调拨。

---

<a name="专利五"></a>
## 专利五：四维语音交互的财务管理方法及系统

### 发明名称
四维语音交互的个人财务管理方法及系统

### 技术领域
本发明涉及语音交互和个人财务管理技术领域，尤其涉及一种四维语音交互的个人财务管理方法及系统。

### 背景技术
现有的语音记账功能存在以下技术问题：

1. **功能单一**：仅支持语音记账，无法通过语音完成其他操作。

2. **缺乏上下文理解**：无法理解连续对话，每次都需要完整表达。

3. **反馈机制不完善**：识别结果无法语音确认，用户需要查看屏幕。

4. **无障碍支持不足**：视力受损用户难以使用现有语音功能。

因此，需要一种新的技术方案，实现覆盖记账、配置、导航、查询的全场景语音交互。

### 发明内容

#### 技术问题
本发明要解决的技术问题是：如何实现记账、配置、导航、查询四个维度的完整语音交互，支持多轮对话和上下文理解。

#### 技术方案
为解决上述技术问题，本发明提供一种四维语音交互方法，包括以下步骤：

**S1. 意图识别引擎**

- S1.1 四维意图分类：
  ```
  记账意图（RECORD）：
  - "花了35吃午饭"
  - "收到工资8000"

  配置意图（CONFIG）：
  - "餐饮预算改成2000"
  - "开启自动同步"

  导航意图（NAVIGATE）：
  - "打开预算"
  - "查看钱龄"

  查询意图（QUERY）：
  - "这个月花了多少"
  - "餐饮预算还剩多少"
  ```

- S1.2 意图识别模型：
  ```
  输入：用户语音文本
  输出：{意图类型, 置信度, 槽位值}

  槽位提取：
  - 金额槽位
  - 分类槽位
  - 时间槽位
  - 账户槽位
  ```

**S2. 多轮对话管理**

- S2.1 上下文维护：
  ```
  对话上下文 {
    sessionId: 会话ID
    history: [对话历史]
    currentIntent: 当前意图
    slots: 已填充槽位
    pendingSlots: 待填充槽位
  }
  ```

- S2.2 槽位追问：
  ```
  当必要槽位缺失时：
  1. 识别缺失的必要槽位
  2. 生成追问话术
  3. 等待用户回答
  4. 更新槽位值
  5. 检查是否满足执行条件
  ```

- S2.3 意图切换：
  ```
  支持对话中的意图切换：
  用户："记一笔午饭28"
  系统："好的，已记录午饭28元"
  用户："改成38"（修正意图）
  系统："已将金额修改为38元"
  ```

**S3. 语音反馈系统**

- S3.1 TTS语音播报：
  - 识别结果确认播报
  - 操作结果播报
  - 错误提示播报

- S3.2 反馈模板：
  ```
  记账成功："{分类}支出{金额}元，已记录"
  查询结果："{时间}共支出{金额}元，{分类}占比最高"
  配置成功："{配置项}已更新为{新值}"
  ```

**S4. 无障碍支持**

- S4.1 全语音操作模式：
  - 所有功能可通过语音完成
  - 无需查看屏幕

- S4.2 语音引导：
  - 主动提示可用的语音命令
  - 提供帮助指令

#### 有益效果
本发明相比现有技术具有以下有益效果：

1. **全面性**：覆盖记账、配置、导航、查询四个维度。

2. **自然性**：支持多轮对话，无需每次完整表达。

3. **反馈性**：语音播报确认，无需查看屏幕。

4. **无障碍**：视力受损用户可完全通过语音使用。

### 权利要求书

**权利要求1**
一种四维语音交互的财务管理方法，其特征在于，包括以下步骤：
- 接收用户语音输入并转换为文本；
- 进行意图识别，将意图分类为记账、配置、导航或查询四种类型；
- 提取意图对应的槽位值；
- 维护对话上下文，支持多轮对话和意图切换；
- 执行识别的意图并生成语音反馈。

**权利要求2**
根据权利要求1所述的方法，其特征在于，所述多轮对话包括：
- 当必要槽位缺失时，生成追问话术；
- 根据用户回答更新槽位值；
- 支持用户在对话中修正前一条指令。

**权利要求3**
一种四维语音交互的财务管理系统，其特征在于，包括：
- 语音识别模块，用于将语音转换为文本；
- 意图识别模块，用于分类四种意图类型并提取槽位；
- 对话管理模块，用于维护对话上下文和多轮交互；
- 执行模块，用于执行识别的意图；
- 语音合成模块，用于生成语音反馈。

---

<a name="专利六"></a>
## 专利六：位置增强的财务管理方法及系统

### 发明名称
位置增强的个人财务管理方法及系统

### 技术领域
本发明涉及地理信息服务和个人财务管理技术领域，尤其涉及一种位置增强的个人财务管理方法及系统。

### 背景技术
现有的记账应用在位置智能方面存在以下技术问题：

1. **场景混淆**：无法区分日常消费和出差/旅游消费，影响财务分析准确性。

2. **预警缺失**：进入高消费场所时无法主动提醒预算情况。

3. **通勤盲区**：无法识别和分析通勤相关消费。

因此，需要一种新的技术方案，将位置信息融入财务管理全流程。

### 发明内容

#### 技术问题
本发明要解决的技术问题是：如何利用位置信息增强财务管理能力，实现消费场景识别、地理围栏预警和位置增强钱龄。

#### 技术方案
为解决上述技术问题，本发明提供一种位置增强的财务管理方法，包括以下步骤：

**S1. 常驻地点识别**

- S1.1 位置数据采集：
  - 获取用户授权后的位置信息
  - 记录位置历史（加密存储）

- S1.2 聚类分析：
  ```
  使用K-means聚类识别常驻地点：
  1. 对历史位置进行聚类
  2. 分析各聚类的时间特征
  3. 自动标注"家"、"公司"等标签
  ```

**S2. 消费场景识别**

- S2.1 场景分类：
  ```
  日常消费：在常驻地点附近（距离<5km）
  异地消费：不在常驻地点附近
  通勤消费：在家和公司之间的路线上
  ```

- S2.2 场景标记：
  - 为每笔交易自动标记消费场景
  - 支持用户修改场景标记

**S3. 地理围栏预警**

- S3.1 围栏定义：
  ```
  围栏类型：
  - 高消费商圈围栏
  - 常去餐厅围栏
  - 自定义围栏
  ```

- S3.2 触发机制：
  ```
  当用户进入围栏区域时：
  1. 检测预算执行状态
  2. 生成个性化提醒
  3. 推送通知到用户设备
  ```

**S4. 位置增强钱龄**

- S4.1 分场景钱龄计算：
  ```
  overall: 综合钱龄
  daily: 日常消费钱龄（排除异地消费）
  byContext: 分场景钱龄
  ```

- S4.2 权重调整：
  - 异地消费权重降低，减少对日常钱龄的影响
  - 支持"旅游模式"，该模式下消费不计入钱龄

**S5. 隐私保护**

- S5.1 本地优先：位置数据本地加密存储
- S5.2 最小化采集：仅在需要时获取位置
- S5.3 透明控制：用户可查看和删除位置历史

#### 有益效果
本发明相比现有技术具有以下有益效果：

1. **场景感知**：准确区分日常和异地消费。

2. **主动预警**：进入高消费区域时主动提醒。

3. **精准分析**：位置增强的钱龄更准确反映日常财务健康。

4. **隐私友好**：数据本地存储，用户可控。

### 权利要求书

**权利要求1**
一种位置增强的财务管理方法，其特征在于，包括以下步骤：
- 采集并分析用户位置历史，识别常驻地点；
- 根据交易发生位置与常驻地点的关系，识别消费场景；
- 为交易标记消费场景标签；
- 根据消费场景调整钱龄计算权重；
- 当用户进入预设地理围栏时，触发预算预警。

**权利要求2**
根据权利要求1所述的方法，其特征在于，所述消费场景包括：
- 日常消费：在常驻地点附近的消费；
- 异地消费：不在常驻地点附近的消费；
- 通勤消费：在家和公司之间路线上的消费。

**权利要求3**
根据权利要求1所述的方法，其特征在于，所述位置增强钱龄计算包括：
- 计算综合钱龄；
- 计算排除异地消费后的日常钱龄；
- 提供"旅游模式"，该模式下消费不计入钱龄。

**权利要求4**
一种位置增强的财务管理系统，其特征在于，包括：
- 位置采集模块，用于采集和存储位置信息；
- 常驻识别模块，用于通过聚类分析识别常驻地点；
- 场景识别模块，用于为交易标记消费场景；
- 围栏预警模块，用于地理围栏触发预算预警；
- 钱龄增强模块，用于位置增强的钱龄计算。

---

## 附录：专利申请优先级与时间规划

| 优先级 | 专利名称 | 申请类型 | 建议提交时间 |
|-------|---------|---------|-------------|
| P0 | 钱龄FIFO算法 | 发明专利 | 2026年Q1 |
| P0 | 多模态识别系统 | 发明专利 | 2026年Q1 |
| P0 | 分层自学习框架 | 发明专利 | 2026年Q1 |
| P0 | 零基预算系统 | 发明+实用新型 | 2026年Q1 |
| P1 | 四维语音交互 | 发明专利 | 2026年Q2 |
| P1 | 位置增强系统 | 发明专利 | 2026年Q2 |

---

<a name="专利七"></a>
## 专利七：多因子交易去重方法及系统

### 发明名称
一种基于多因子综合评分的财务交易去重方法及系统

### 技术领域
本发明涉及数据处理技术领域，尤其涉及一种基于多因子综合评分的财务交易去重方法及系统。

### 背景技术
随着移动支付和多渠道账单管理的普及，用户经常需要从多个数据源（如微信、支付宝、银行APP）导入交易记录。然而，不同渠道对同一笔交易的描述格式存在差异，导致传统的精确匹配方法无法有效识别重复交易，存在以下技术问题：

1. **单一匹配规则局限性**：仅基于金额+日期的匹配方式容易产生误判，尤其是日常高频消费场景（如每天同一时间同一地点买早餐）。

2. **时间偏差问题**：不同支付渠道的交易时间戳可能存在几分钟甚至几小时的偏差，导致同一笔交易被误判为两笔不同交易。

3. **描述格式不统一**：同一商户在不同渠道的名称可能不同（如"星巴克"vs"星巴克咖啡（中关村店）"），传统字符串匹配难以识别。

4. **缺乏用户个性化学习**：系统无法从用户历史纠正行为中学习，导致同类错误反复出现。

因此，需要一种新的多因子综合评分去重方法，能够精确识别重复交易，同时具备个性化学习能力。

### 发明内容

#### 技术问题
本发明要解决的技术问题是：如何在多数据源导入场景下，准确识别重复交易，减少误判和漏判，并具备从用户反馈中持续学习的能力。

#### 技术方案
本发明提供一种基于多因子综合评分的财务交易去重方法，包括以下步骤：

**S1. 三层去重架构**
- S1.1 第一层精确匹配：
  ```
  如果 金额相同 AND 日期相同 AND 描述相同:
      标记为"确定重复"，置信度 = 100%
      返回
  ```
- S1.2 第二层特征匹配：
  ```
  如果 金额相同 AND 日期相近(±1天) AND 描述相似度 > 80%:
      计算置信度 = 70% + 描述相似度增量
      标记为"高度疑似"
  ```
- S1.3 第三层语义匹配：
  ```
  提取商户语义特征（品牌名、商户类型、地点关键词）
  计算语义相似度
  如果 语义相似度 > 阈值:
      标记为"可能重复"
  ```

**S2. 多因子评分模型**
- S2.1 定义评分因子集合：
  - F1: 金额匹配度（完全相同=1.0，±1%=0.9，±5%=0.5）
  - F2: 时间接近度（同一时刻=1.0，±1小时=0.8，±1天=0.5）
  - F3: 描述相似度（编辑距离归一化）
  - F4: 商户语义匹配（品牌识别+实体抽取）
  - F5: 位置辅助因子（同地点消费检测）
  - F6: 用户历史模式（基于历史纠正记录）
  - F7: 家庭成员交叉验证（家庭账本场景）

- S2.2 综合评分计算：
  ```
  重复置信度 = Σ(Wi × Fi) / Σ(Wi)

  其中：
  Wi = 第i个因子的权重（可通过用户反馈动态调整）
  Fi = 第i个因子的得分 [0, 1]
  ```

**S3. 自适应阈值学习**
- S3.1 初始阈值设定：
  ```
  确定重复阈值 = 0.95
  高度疑似阈值 = 0.80
  可能重复阈值 = 0.60
  ```
- S3.2 用户反馈学习：
  ```
  当用户标记"确实重复"但系统未识别:
      降低相应因子的阈值
      增加该类模式的权重
  当用户标记"非重复"但系统误判:
      提高相应因子的阈值
      添加负样本到排除规则
  ```

**S4. 实际去重流程**
- S4.1 导入时预处理：对新交易进行标准化（金额格式、日期格式、描述分词）
- S4.2 候选集筛选：基于金额和日期快速索引，缩小比对范围
- S4.3 多因子评分：对候选集中每个交易计算综合置信度
- S4.4 结果分级展示：按置信度分级展示（确定重复/高度疑似/可能重复）
- S4.5 用户确认与学习：记录用户决策，更新模型参数

### 权利要求书

1. 一种基于多因子综合评分的财务交易去重方法，其特征在于，包括以下步骤：
   a) 构建三层去重架构，包括精确匹配层、特征匹配层和语义匹配层；
   b) 定义多因子评分模型，所述因子包括金额匹配度、时间接近度、描述相似度、商户语义匹配、位置辅助因子和用户历史模式；
   c) 计算新交易与已有交易的综合重复置信度；
   d) 根据用户反馈动态调整因子权重和匹配阈值。

2. 根据权利要求1所述的方法，其特征在于，所述精确匹配层采用金额+日期+描述的完全一致性匹配，置信度为100%。

3. 根据权利要求1所述的方法，其特征在于，所述特征匹配层采用模糊匹配策略，日期容差为±1天，描述相似度阈值为80%。

4. 根据权利要求1所述的方法，其特征在于，所述语义匹配层采用NLP实体抽取技术，提取商户品牌名、商户类型、地点关键词进行语义级别的匹配。

5. 根据权利要求1所述的方法，其特征在于，所述用户反馈学习包括正样本强化和负样本排除两种机制。

### 说明书附图

**图1：三层去重架构流程图**
```
新交易输入
    ↓
[第一层：精确匹配] → 匹配成功 → 确定重复(100%)
    ↓ 未匹配
[第二层：特征匹配] → 匹配成功 → 高度疑似(70-95%)
    ↓ 未匹配
[第三层：语义匹配] → 匹配成功 → 可能重复(60-70%)
    ↓ 未匹配
标记为新交易
```

**图2：多因子评分模型示意图**
```
┌─────────────────────────────────────────────────────┐
│                  多因子评分引擎                       │
├──────────┬──────────┬──────────┬──────────┬─────────┤
│ 金额因子  │ 时间因子  │ 描述因子  │ 语义因子  │ 位置因子 │
│   F1     │   F2     │   F3     │   F4     │   F5    │
│ W1=0.25  │ W2=0.20  │ W3=0.20  │ W4=0.15  │ W5=0.10 │
├──────────┴──────────┴──────────┴──────────┴─────────┤
│         综合置信度 = Σ(Wi × Fi) / Σ(Wi)              │
└─────────────────────────────────────────────────────┘
```

### 具体实施方式

以导入支付宝账单为例：

1. 用户选择导入支付宝账单文件
2. 系统解析账单，提取交易记录
3. 对每笔交易进行三层去重检测：
   - 精确匹配：发现"2026-01-15 ¥35.00 星巴克"与已有记录完全一致，标记为确定重复
   - 特征匹配：发现"2026-01-14 ¥34.80 星巴克咖啡中关村店"与"2026-01-14 ¥35.00 星巴克"高度相似，计算置信度=85%
   - 语义匹配：发现"2026-01-10 ¥128.00 海底捞"与"2026-01-10 ¥128.00 海底捞火锅(望京店)"语义匹配，置信度=72%
4. 展示去重结果，用户确认
5. 系统学习用户决策，优化后续识别

---

<a name="专利八"></a>
## 专利八：财务数据可视化交互方法及系统

### 发明名称
一种基于钱龄维度的财务数据多层次可视化交互方法及系统

### 技术领域
本发明涉及数据可视化技术领域，尤其涉及一种基于钱龄维度的财务数据多层次可视化交互方法及系统。

### 背景技术
现有的个人财务应用大多采用传统的收支统计图表（如饼图、柱状图），存在以下技术问题：

1. **维度单一**：仅展示金额维度，无法反映资金的时间价值和流动性。

2. **交互受限**：静态图表难以支持数据下钻和多维度探索。

3. **关联性差**：图表之间相互独立，无法展示数据之间的联动关系。

4. **洞察不足**：缺乏基于数据的智能洞察和异常检测。

因此，需要一种新的可视化交互方法，能够以钱龄为核心维度，提供多层次、可交互、联动式的财务数据可视化体验。

### 发明内容

#### 技术问题
本发明要解决的技术问题是：如何以"钱龄"为核心维度，构建多层次、可交互、具有数据联动能力的财务可视化系统。

#### 技术方案
本发明提供一种基于钱龄维度的财务数据多层次可视化交互方法，包括以下步骤：

**S1. 钱龄可视化组件体系**
- S1.1 钱龄仪表盘：
  ```
  显示当前账户整体钱龄指标
  采用渐变色环形图，颜色映射健康等级：
  - 60+天：深绿色（非常健康）
  - 30-59天：绿色（健康）
  - 14-29天：黄色（一般）
  - 7-13天：橙色（偏低）
  - 3-6天：红色（紧张）
  - 0-2天：深红色（月光）
  ```

- S1.2 钱龄趋势图：
  ```
  时间轴：过去30/90/180天
  Y轴：钱龄天数
  展示钱龄变化趋势
  支持点击查看具体日期的钱龄明细
  ```

- S1.3 资源池瀑布图：
  ```
  横向展示所有活跃资源池
  高度表示剩余金额
  颜色表示资源池年龄
  支持点击查看资源池消费链路
  ```

**S2. 多维度下钻交互**
- S2.1 时间维度下钻：
  ```
  年 → 月 → 周 → 日
  点击某月可展开该月详情
  支持手势缩放和拖拽
  ```

- S2.2 分类维度下降：
  ```
  一级分类 → 二级分类 → 具体交易
  饼图点击可展开子分类
  支持面包屑导航返回
  ```

- S2.3 钱龄维度下钻：
  ```
  整体钱龄 → 分类钱龄 → 交易钱龄 → 资源池追溯
  展示每笔支出消耗了哪些收入资源池
  ```

**S3. 数据联动机制**
- S3.1 选中联动：
  ```
  在图表A中选中某数据点
  自动高亮图表B/C/D中的关联数据
  例：选中"餐饮"分类，趋势图自动切换为餐饮趋势
  ```

- S3.2 筛选联动：
  ```
  设置全局筛选条件（时间范围、分类、账户）
  所有图表同步更新
  ```

- S3.3 变更通知：
  ```
  当底层数据发生变化（新交易、编辑、删除）
  自动刷新受影响的可视化组件
  采用防抖机制，避免频繁刷新
  ```

**S4. 智能洞察生成**
- S4.1 异常检测：
  ```
  检测钱龄突变（突然大幅下降）
  检测消费异常（金额/频率/时间异常）
  自动生成洞察卡片
  ```

- S4.2 趋势预测：
  ```
  基于历史数据预测未来钱龄趋势
  预警可能的"月光"风险
  ```

### 权利要求书

1. 一种基于钱龄维度的财务数据多层次可视化交互方法，其特征在于，包括以下步骤：
   a) 构建以钱龄为核心维度的可视化组件体系，包括钱龄仪表盘、钱龄趋势图和资源池瀑布图；
   b) 实现多维度下钻交互，支持时间、分类、钱龄三个维度的逐层展开；
   c) 建立图表间的数据联动机制，包括选中联动、筛选联动和变更通知；
   d) 集成智能洞察生成模块，自动检测异常和预测趋势。

2. 根据权利要求1所述的方法，其特征在于，所述钱龄仪表盘采用六级健康等级映射，通过渐变色环形图直观展示账户财务健康状态。

3. 根据权利要求1所述的方法，其特征在于，所述资源池瀑布图采用FIFO顺序排列，支持点击追溯每笔支出的收入来源。

4. 根据权利要求1所述的方法，其特征在于，所述变更通知机制采用防抖策略，在300ms内的连续变更合并为单次刷新。

### 说明书附图

**图1：钱龄可视化组件体系**
```
┌─────────────────────────────────────────────────────┐
│                   钱龄概览仪表盘                     │
│  ┌──────────┐  ┌──────────┐  ┌──────────┐         │
│  │ 当前钱龄  │  │ 健康等级  │  │ 趋势箭头  │         │
│  │  42天    │  │  健康    │  │   ↑3天   │         │
│  └──────────┘  └──────────┘  └──────────┘         │
├────────────────────────────────────────────────────┤
│                   钱龄趋势图                        │
│  ^钱龄                                             │
│  │      ___/\___                                   │
│  │   __/        \__                                │
│  │__/              \__                             │
│  └──────────────────────→ 时间                     │
├────────────────────────────────────────────────────┤
│                   资源池瀑布图                       │
│  ┌──┐ ┌────┐ ┌──────┐ ┌────────┐                  │
│  │  │ │    │ │      │ │        │  ← 活跃资源池     │
│  │1月│ │2月 │ │3月   │ │4月     │                   │
│  └──┘ └────┘ └──────┘ └────────┘                  │
└────────────────────────────────────────────────────┘
```

### 具体实施方式

用户打开"分析"页面，系统展示钱龄可视化界面：

1. 仪表盘显示当前钱龄42天（健康等级：健康），较上周提升3天
2. 趋势图展示过去30天钱龄变化，用户点击某一天可查看该日明细
3. 资源池瀑布图展示4个活跃资源池：
   - 1月工资（已耗尽）
   - 2月工资（剩余¥500）
   - 3月工资（剩余¥3,000）
   - 4月工资（剩余¥8,000）
4. 用户点击"餐饮"分类饼图块，系统联动展示：
   - 趋势图切换为餐饮消费趋势
   - 资源池图高亮餐饮消费来源
   - 下方列表展示餐饮交易明细
5. 系统检测到本周餐饮消费较上周增长35%，生成洞察卡片提醒用户

---

<a name="专利九"></a>
## 专利九：渐进式披露的移动应用界面设计方法

### 发明名称
一种基于渐进式披露原则的移动应用界面自适应设计方法及系统

### 技术领域
本发明涉及人机交互技术领域，尤其涉及一种基于渐进式披露原则的移动应用界面自适应设计方法及系统。

### 背景技术
移动应用的功能日益丰富，但用户注意力有限，存在以下交互设计问题：

1. **信息过载**：一次性展示过多功能和信息，导致用户认知负担过重。

2. **新手友好性差**：复杂界面让新用户感到困惑，增加学习成本。

3. **高级用户受限**：为照顾新手而简化界面，影响高级用户效率。

4. **加载体验差**：等待完整页面加载时，用户看到白屏或加载动画。

因此，需要一种渐进式披露的界面设计方法，能够根据用户水平和使用场景，自适应地展示合适的信息层次。

### 发明内容

#### 技术问题
本发明要解决的技术问题是：如何设计一种能够根据用户水平和使用场景，自适应展示信息层次的移动应用界面系统。

#### 技术方案
本发明提供一种基于渐进式披露原则的移动应用界面自适应设计方法，包括以下步骤：

**S1. 信息层次划分**
- S1.1 三层信息架构：
  ```
  第一层：核心信息（必须看到的）
    - 账户余额
    - 当日收支
    - 快捷记账入口

  第二层：常用信息（经常需要的）
    - 本周/本月统计
    - 分类概览
    - 近期交易

  第三层：详细信息（偶尔需要的）
    - 完整交易列表
    - 详细分析报告
    - 高级设置选项
  ```

- S1.2 用户水平判定：
  ```
  新手用户（使用<7天）：
    - 优先展示第一层
    - 引导式披露第二层
    - 隐藏第三层

  普通用户（7-30天）：
    - 展示第一、二层
    - 按需展示第三层

  高级用户（>30天）：
    - 直接展示全部层次
    - 提供快捷键和高级功能
  ```

**S2. 骨架屏与渐进加载**
- S2.1 骨架屏设计：
  ```
  根据目标布局生成骨架屏
  骨架元素采用灰色渐变动画
  优先加载可见区域内容
  ```

- S2.2 渐进加载策略：
  ```
  优先级1：视口内核心内容（首屏<500ms）
  优先级2：视口内次要内容（1s内）
  优先级3：视口外预加载内容（用户滚动前）
  优先级4：按需加载内容（用户触发时）
  ```

**S3. 自适应内容展示**
- S3.1 折叠展开模式：
  ```
  默认折叠高级选项
  用户点击"更多"展开
  记住用户的展开偏好
  ```

- S3.2 上下文感知：
  ```
  根据当前场景调整展示内容
  例：月底展示预算使用情况
  例：发薪日展示收入确认
  ```

**S4. 性能与体验优化**
- S4.1 懒加载实现：
  ```
  图表组件：滚动到可见区域时加载
  图片资源：占位符 → 缩略图 → 高清图
  列表数据：分页加载，每次20条
  ```

- S4.2 预加载策略：
  ```
  预测用户下一步操作
  提前加载可能需要的数据
  后台静默加载非关键资源
  ```

### 权利要求书

1. 一种基于渐进式披露原则的移动应用界面自适应设计方法，其特征在于，包括以下步骤：
   a) 将界面信息划分为核心信息、常用信息和详细信息三个层次；
   b) 根据用户使用时长和行为判定用户水平，自适应选择信息展示层次；
   c) 采用骨架屏和渐进加载策略，优化页面加载体验；
   d) 实现懒加载和预加载机制，平衡性能与用户体验。

2. 根据权利要求1所述的方法，其特征在于，所述用户水平判定采用使用天数和操作复杂度两个维度的综合评估。

3. 根据权利要求1所述的方法，其特征在于，所述骨架屏根据目标布局动态生成，支持列表、卡片、图表等多种组件类型。

### 说明书附图

**图1：渐进式披露架构**
```
┌─────────────────────────────────────────────────┐
│                 信息层次金字塔                    │
│                                                 │
│                  ┌─────┐                        │
│                  │核心 │  ← 100%用户可见         │
│               ┌──┴─────┴──┐                     │
│               │  常用信息  │  ← 普通+高级用户     │
│            ┌──┴───────────┴──┐                  │
│            │    详细信息     │  ← 高级用户/按需   │
│            └─────────────────┘                  │
└─────────────────────────────────────────────────┘
```

**图2：骨架屏加载流程**
```
[骨架屏] → [核心内容] → [次要内容] → [预加载内容]
   0ms       500ms        1000ms       用户滚动时
```

### 具体实施方式

新用户首次打开应用：

1. 显示骨架屏占位（200ms内）
2. 加载核心信息：账户余额、今日收支（500ms内）
3. 折叠显示"本月概览"卡片标题（提示可展开）
4. 隐藏高级分析功能，底部显示"更多功能"入口
5. 用户使用7天后，自动展开"本月概览"卡片
6. 用户使用30天后，首页直接显示完整统计和快捷入口

---

<a name="专利十"></a>
## 专利十：智能账单解析与导入方法及系统

### 发明名称
一种基于多模态识别的智能账单解析与导入方法及系统

### 技术领域
本发明涉及文档处理和自然语言处理技术领域，尤其涉及一种基于多模态识别的智能账单解析与导入方法及系统。

### 背景技术
用户需要从多个渠道（银行、支付宝、微信、信用卡等）导入历史账单数据，现有技术存在以下问题：

1. **格式识别困难**：不同机构的账单格式差异大，需要大量适配工作。

2. **字段映射繁琐**：用户需要手动指定"金额""日期""描述"等字段对应关系。

3. **分类缺失**：导入的交易缺乏分类信息，需要用户手动补充。

4. **大文件处理慢**：大账单文件处理时间长，用户体验差。

因此，需要一种智能账单解析方法，能够自动识别格式、智能映射字段、自动分类，并高效处理大文件。

### 发明内容

#### 技术问题
本发明要解决的技术问题是：如何自动识别和解析多种格式的账单文件，智能完成字段映射和分类补充，并高效处理大文件。

#### 技术方案
本发明提供一种基于多模态识别的智能账单解析与导入方法，包括以下步骤：

**S1. 智能格式检测**
- S1.1 文件类型识别：
  ```
  支持格式：CSV、Excel、PDF、图片
  通过文件头和扩展名双重验证
  ```

- S1.2 账单来源识别：
  ```
  特征匹配识别账单来源：
  - 微信账单特征：交易时间、交易类型、收/支、交易对方...
  - 支付宝账单特征：交易创建时间、交易来源地、交易状态...
  - 银行账单特征：交易日期、记账日期、交易金额、余额...
  自动匹配对应解析模板
  ```

- S1.3 未知格式处理：
  ```
  当无法识别来源时：
  1. 分析表头行，推断字段含义
  2. 采用AI模型进行字段语义理解
  3. 展示推断结果，请用户确认
  ```

**S2. 插件化解析器架构**
- S2.1 解析器接口定义：
  ```
  interface BillParser {
    bool canParse(File file);
    List<Transaction> parse(File file);
    ParserMetadata getMetadata();
  }
  ```

- S2.2 内置解析器：
  ```
  WeChatBillParser      // 微信账单
  AlipayBillParser      // 支付宝账单
  CMBBillParser         // 招商银行
  ICBCBillParser        // 工商银行
  GenericCSVParser      // 通用CSV
  GenericExcelParser    // 通用Excel
  ```

- S2.3 动态解析器加载：
  ```
  支持在线下载新解析器
  用户可贡献自定义解析器
  ```

**S3. AI辅助字段映射**
- S3.1 自动字段推断：
  ```
  分析每列数据特征：
  - 数值型 + 包含货币符号 → 金额字段
  - 日期格式 → 日期字段
  - 文本长度较长 → 描述字段
  - 枚举值（收入/支出）→ 类型字段
  ```

- S3.2 智能分类补充：
  ```
  调用AI分类模型：
  根据交易描述推断分类
  根据金额范围辅助判断
  根据交易对方名称匹配商户库
  ```

**S4. 大文件分片处理**
- S4.1 分片策略：
  ```
  文件大小 > 1MB：分片处理
  每片1000条记录
  并行处理多个分片
  ```

- S4.2 进度反馈：
  ```
  实时显示处理进度
  支持暂停/继续
  处理完成后展示摘要
  ```

### 权利要求书

1. 一种基于多模态识别的智能账单解析与导入方法，其特征在于，包括以下步骤：
   a) 智能检测账单文件格式和来源，自动匹配对应解析模板；
   b) 采用插件化解析器架构，支持多种账单格式的扩展；
   c) 利用AI模型进行字段语义理解和自动分类补充；
   d) 对大文件采用分片并行处理策略，提供实时进度反馈。

2. 根据权利要求1所述的方法，其特征在于，所述账单来源识别采用表头特征匹配和内容特征分析的双重验证机制。

3. 根据权利要求1所述的方法，其特征在于，所述AI辅助字段映射结合数据类型分析和语义理解两种技术。

4. 根据权利要求1所述的方法，其特征在于，所述分片处理采用1000条/片的粒度，支持暂停、继续和取消操作。

### 说明书附图

**图1：智能格式检测流程**
```
账单文件输入
    ↓
[文件类型识别] → CSV/Excel/PDF/图片
    ↓
[账单来源识别] → 微信/支付宝/银行/未知
    ↓
[选择解析器]
    ↓
[解析执行]
```

**图2：插件化解析器架构**
```
┌─────────────────────────────────────────────────┐
│                 BillParser 接口                  │
├─────────────────────────────────────────────────┤
│  WeChatParser │ AlipayParser │ BankParsers...  │
├─────────────────────────────────────────────────┤
│                动态解析器加载器                   │
└─────────────────────────────────────────────────┘
```

### 具体实施方式

用户导入银行账单：

1. 用户选择银行账单CSV文件
2. 系统检测文件格式：CSV
3. 系统分析表头特征，识别为招商银行账单
4. 自动匹配CMBBillParser解析器
5. 解析过程中对每笔交易调用AI分类：
   - "星巴克咖啡" → 餐饮/饮品
   - "滴滴出行" → 交通/打车
   - "淘宝购物" → 购物/网购
6. 发现文件包含3000条记录，启动分片处理
7. 展示进度条，3秒完成解析
8. 展示导入预览，包括新记录数、疑似重复数
9. 用户确认后写入数据库

---

<a name="专利十一"></a>
## 专利十一：移动端离线优先的增量同步方法

### 发明名称
一种基于离线队列的移动端数据增量同步方法及系统

### 技术领域
本发明涉及分布式数据同步技术领域，尤其涉及一种基于离线队列的移动端数据增量同步方法及系统。

### 背景技术
移动应用需要在离线和在线状态间无缝切换，确保数据一致性，现有技术存在以下问题：

1. **离线体验差**：网络断开时功能受限或完全不可用。

2. **同步冲突**：多设备同时修改同一数据时，冲突解决策略不完善。

3. **全量同步低效**：每次同步传输全部数据，浪费带宽和时间。

4. **同步失败恢复难**：同步中断后难以从断点恢复。

因此，需要一种离线优先的增量同步方法，能够在离线时正常工作，在线时高效同步。

### 发明内容

#### 技术问题
本发明要解决的技术问题是：如何实现移动应用的离线优先架构，确保离线时正常工作，在线时高效增量同步，并妥善处理数据冲突。

#### 技术方案
本发明提供一种基于离线队列的移动端数据增量同步方法，包括以下步骤：

**S1. 离线队列管理**
- S1.1 操作队列结构：
  ```
  OfflineOperation {
    id: String,           // 操作唯一标识
    type: OperationType,  // CREATE/UPDATE/DELETE
    entity: String,       // 实体类型（交易/分类/预算）
    entityId: String,     // 实体ID
    payload: JSON,        // 操作数据
    timestamp: DateTime,  // 操作时间
    retryCount: Int,      // 重试次数
    status: OperationStatus  // PENDING/SYNCING/SYNCED/FAILED
  }
  ```

- S1.2 队列操作：
  ```
  当用户执行写操作时：
  1. 立即写入本地数据库
  2. 创建OfflineOperation记录
  3. 加入离线队列
  4. 如果在线，触发同步
  ```

**S2. 增量同步机制**
- S2.1 变更追踪：
  ```
  每个实体维护版本号(version)和修改时间(modifiedAt)
  客户端记录最后同步时间(lastSyncTime)
  同步时只传输lastSyncTime之后的变更
  ```

- S2.2 同步流程：
  ```
  1. 上传阶段：
     将本地离线队列中的操作发送到服务端
     服务端返回每个操作的处理结果

  2. 下载阶段：
     请求服务端lastSyncTime之后的变更
     合并到本地数据库

  3. 确认阶段：
     更新lastSyncTime
     清理已同步的离线操作
  ```

**S3. 冲突检测与解决**
- S3.1 冲突检测：
  ```
  当同一实体在客户端和服务端都有修改时：
  比较版本号和修改时间
  标记为冲突状态
  ```

- S3.2 冲突解决策略：
  ```
  策略1（默认）：后写入者获胜
    以修改时间最新的版本为准

  策略2：字段级合并
    非冲突字段自动合并
    冲突字段保留最新值

  策略3：用户决策
    展示冲突详情
    让用户选择保留哪个版本
  ```

**S4. 失败恢复与重试**
- S4.1 重试机制：
  ```
  失败操作进入重试队列
  采用指数退避策略：1s, 2s, 4s, 8s...
  最多重试5次
  超过重试次数标记为FAILED
  ```

- S4.2 断点续传：
  ```
  记录同步进度（已处理的操作ID）
  中断后从断点恢复
  支持批量操作的部分成功
  ```

### 权利要求书

1. 一种基于离线队列的移动端数据增量同步方法，其特征在于，包括以下步骤：
   a) 构建离线操作队列，记录离线状态下的所有写操作；
   b) 采用版本号和修改时间进行变更追踪，实现增量同步；
   c) 设计多策略的冲突检测与解决机制；
   d) 实现失败重试和断点续传的可靠性保障。

2. 根据权利要求1所述的方法，其特征在于，所述离线操作队列采用先进先出原则，保证操作顺序一致性。

3. 根据权利要求1所述的方法，其特征在于，所述冲突解决支持后写入者获胜、字段级合并和用户决策三种策略。

4. 根据权利要求1所述的方法，其特征在于，所述重试机制采用指数退避策略，避免服务端过载。

### 说明书附图

**图1：离线优先架构**
```
┌────────────────────────────────────────────────┐
│                   应用层                        │
│  ┌────────────┐    ┌────────────┐             │
│  │  UI组件    │ ←→ │  Provider  │              │
│  └────────────┘    └────────────┘             │
│                         ↓                      │
│  ┌─────────────────────────────────────────┐  │
│  │              本地数据库                   │  │
│  │  ┌─────────┐  ┌─────────────────────┐   │  │
│  │  │ 业务数据 │  │    离线操作队列      │   │  │
│  │  └─────────┘  └─────────────────────┘   │  │
│  └─────────────────────────────────────────┘  │
│                         ↓                      │
│  ┌─────────────────────────────────────────┐  │
│  │              同步服务                     │  │
│  │  上传 → 下载 → 冲突解决 → 确认           │  │
│  └─────────────────────────────────────────┘  │
│                         ↓                      │
│                    云端服务器                   │
└────────────────────────────────────────────────┘
```

**图2：增量同步流程**
```
客户端                          服务端
  │                               │
  │ ──上传离线队列操作──────────→ │
  │                               │ 处理操作
  │ ←──返回处理结果────────────── │
  │                               │
  │ ──请求增量变更(since=T1)────→ │
  │                               │ 查询变更
  │ ←──返回变更数据────────────── │
  │                               │
  │ 合并本地数据                   │
  │ 更新lastSyncTime              │
  │                               │
```

### 具体实施方式

用户在地铁（离线）中记账：

1. 用户记录一笔"早餐 ¥15"
2. 系统将交易写入本地SQLite
3. 创建OfflineOperation记录加入队列
4. 界面立即显示这笔交易
5. 手机恢复网络连接
6. 同步服务检测到网络可用
7. 上传离线队列中的操作
8. 服务端返回成功
9. 请求服务端增量变更（发现其他设备新增了一笔交易）
10. 合并到本地数据库
11. 更新lastSyncTime，清理已同步操作
12. 用户在其他设备也能看到"早餐 ¥15"

---

<a name="专利十二"></a>
## 专利十二：隐私保护的协同学习方法

### 发明名称
一种基于差分隐私的分布式协同学习方法及系统

### 技术领域
本发明涉及机器学习和隐私计算技术领域，尤其涉及一种基于差分隐私的分布式协同学习方法及系统。

### 背景技术
智能应用需要从用户行为中学习以提升准确率，但收集用户数据存在隐私风险，现有技术存在以下问题：

1. **隐私泄露风险**：集中式学习需要上传用户原始数据，存在泄露风险。

2. **模型个性化不足**：统一模型无法适应个体差异。

3. **数据孤岛**：用户数据分散，难以利用群体智慧。

4. **合规挑战**：GDPR等法规对数据收集和使用有严格限制。

因此，需要一种隐私保护的协同学习方法，能够在保护用户隐私的前提下，利用群体智慧优化模型。

### 发明内容

#### 技术问题
本发明要解决的技术问题是：如何在保护用户隐私数据的前提下，实现多用户间的协同学习，提升模型准确率。

#### 技术方案
本发明提供一种基于差分隐私的分布式协同学习方法，包括以下步骤：

**S1. 分层学习架构**
- S1.1 个体学习层：
  ```
  每个用户设备本地维护个性化模型
  基于用户自己的数据进行训练
  模型参数存储在本地
  ```

- S1.2 协同学习层：
  ```
  周期性聚合多用户的模型更新
  不传输原始数据，只传输模型梯度
  聚合后的模型下发给所有用户
  ```

- S1.3 迁移学习层：
  ```
  新用户继承协同模型作为初始模型
  快速适应，无需冷启动
  ```

**S2. 差分隐私保护**
- S2.1 本地差分隐私：
  ```
  在上传梯度前添加噪声：
  noisy_gradient = gradient + Laplace(0, sensitivity/epsilon)

  其中：
  sensitivity = 梯度敏感度上界
  epsilon = 隐私预算参数
  ```

- S2.2 隐私预算管理：
  ```
  每个用户有总隐私预算B
  每次参与协同学习消耗预算ε
  当累计消耗>B时停止参与
  ```

- S2.3 数据脱敏规则：
  ```
  金额：保留量级，模糊具体值
  商户：只传输分类，不传输名称
  时间：只传输时段，不传输精确时间
  ```

**S3. 安全聚合协议**
- S3.1 聚合流程：
  ```
  1. 服务端生成随机种子，分发给参与用户
  2. 用户使用种子加密本地梯度
  3. 服务端聚合加密梯度
  4. 只有聚合结果可解密，单个用户梯度不可见
  ```

- S3.2 最小参与人数：
  ```
  聚合需要至少K个用户参与（K≥100）
  确保单个用户贡献被充分稀释
  ```

**S4. 模型同步与更新**
- S4.1 同步策略：
  ```
  后台静默同步：WiFi+充电时
  手动同步：用户触发
  协同模型版本控制
  ```

- S4.2 增量更新：
  ```
  不传输完整模型
  只传输模型差异（delta）
  客户端本地合并
  ```

### 权利要求书

1. 一种基于差分隐私的分布式协同学习方法，其特征在于，包括以下步骤：
   a) 构建三层学习架构，包括个体学习层、协同学习层和迁移学习层；
   b) 采用本地差分隐私技术，在上传模型梯度前添加噪声保护；
   c) 实现安全聚合协议，确保服务端无法获取单个用户的梯度；
   d) 采用隐私预算管理机制，控制用户隐私暴露程度。

2. 根据权利要求1所述的方法，其特征在于，所述本地差分隐私采用拉普拉斯噪声机制，噪声量由隐私预算参数ε控制。

3. 根据权利要求1所述的方法，其特征在于，所述安全聚合要求最小参与用户数不少于100人。

4. 根据权利要求1所述的方法，其特征在于，所述数据脱敏规则对金额、商户、时间等敏感字段进行模糊化处理。

5. 根据权利要求1所述的方法，其特征在于，所述迁移学习层使新用户继承协同模型，无需冷启动即可获得基础智能能力。

### 说明书附图

**图1：分层学习架构**
```
┌────────────────────────────────────────────────────────┐
│                      协同模型                           │
│            （聚合自所有用户的通用知识）                    │
└────────────────────────────────────────────────────────┘
                          ↑
                    安全聚合↑差分隐私
                          ↑
┌──────────┐  ┌──────────┐  ┌──────────┐  ┌──────────┐
│ 用户A模型 │  │ 用户B模型 │  │ 用户C模型 │  │ 用户D模型 │
│ (个性化) │  │ (个性化) │  │ (个性化) │  │ (个性化) │
└──────────┘  └──────────┘  └──────────┘  └──────────┘
     ↑             ↑             ↑             ↑
┌──────────┐  ┌──────────┐  ┌──────────┐  ┌──────────┐
│ 用户A数据 │  │ 用户B数据 │  │ 用户C数据 │  │ 用户D数据 │
│ (本地)   │  │ (本地)   │  │ (本地)   │  │ (本地)   │
└──────────┘  └──────────┘  └──────────┘  └──────────┘
```

**图2：差分隐私保护流程**
```
本地梯度 → 敏感度裁剪 → 添加噪声 → 上传服务端
    ↓           ↓           ↓           ↓
 原始值      限制范围    隐私保护     安全传输
```

### 具体实施方式

系统如何学习用户的分类习惯：

1. 用户A将"瑞幸咖啡"分类为"餐饮/饮品"
2. 本地模型学习：商户名包含"咖啡" → 分类"餐饮/饮品"
3. 系统准备上传学习成果：
   - 原始规则：瑞幸咖啡 → 餐饮/饮品
   - 脱敏后：[咖啡类商户] → 餐饮/饮品
   - 添加差分隐私噪声
4. 服务端聚合1000个用户的学习成果
5. 发现90%用户将"咖啡"相关商户归类为"餐饮/饮品"
6. 更新协同模型
7. 新用户B首次使用，自动继承协同模型
8. 用户B记录"星巴克"消费，系统自动建议"餐饮/饮品"

---

## 附录：专利申请优先级与时间规划（更新版）

| 优先级 | 专利名称 | 申请类型 | 建议提交时间 |
|-------|---------|---------|-------------|
| P0 | 钱龄FIFO算法 | 发明专利 | 2026年Q1 |
| P0 | 多模态识别系统 | 发明专利 | 2026年Q1 |
| P1 | 分层自学习框架 | 发明专利 | 2026年Q1 |
| P1 | 零基预算系统 | 发明+实用新型 | 2026年Q1 |
| P1 | 四维语音交互 | 发明专利 | 2026年Q2 |
| P1 | 位置增强系统 | 发明专利 | 2026年Q2 |
| P2 | 多因子交易去重 | 发明专利 | 2026年Q2 |
| P2 | 钱龄可视化交互 | 发明专利 | 2026年Q2 |
| P2 | 渐进式披露界面 | 发明专利 | 2026年Q3 |
| P2 | 智能账单导入 | 发明专利 | 2026年Q3 |
| P2 | 离线增量同步 | 发明专利 | 2026年Q3 |
| P2 | 隐私保护协同学习 | 发明专利 | 2026年Q3 |

---

*本文档仅供专利申请参考使用*
*建议在正式提交前由专利代理人进行审核和优化*
