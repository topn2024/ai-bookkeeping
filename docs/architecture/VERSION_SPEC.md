# 版本号规范

## 格式

```
Major.Minor.Patch+Build
```

示例: `2.0.0+40`

## 各部分含义

| 部分 | 说明 | 递增条件 |
|------|------|----------|
| **Major** | 主版本号 | 重大功能更新、架构变更、不兼容改动 |
| **Minor** | 次版本号 | 新功能、向后兼容的功能增强 |
| **Patch** | 修订号 | Bug修复、小改进、安全补丁 |
| **Build** | 构建号 | 每次发布递增，永不重置 |

## 版本递增规则

### Major 递增 (x.0.0)
- 重大UI/UX重构
- 核心架构变更
- 不兼容的API变更
- 里程碑版本发布

### Minor 递增 (x.y.0)
- 新增功能模块
- 显著的功能增强
- 新增设置选项
- 重大性能优化

### Patch 递增 (x.y.z)
- Bug修复
- 小型UI调整
- 文案修改
- 稳定性改进

### Build 递增 (+n)
- 每次正式发布必须递增
- 永不重置（即使Major/Minor变化）
- 用于追踪具体构建版本

## 版本历史规划

| 版本 | Build | 说明 |
|------|-------|------|
| 1.0.0 | 1-10 | 初始版本 |
| 1.1.x | 11-20 | 基础功能完善 |
| 1.2.x | 21-39 | 功能增强 |
| **2.0.0** | **40** | **简易模式、语音助手六大入口** |
| 2.1.x | 41+ | 后续迭代 |

## 发布前检查清单

1. [ ] 更新 `pubspec.yaml` 中的 version
2. [ ] 运行 `flutter analyze` 确保无错误
3. [ ] 编译 Release APK 成功
4. [ ] **签名验证通过** (发布脚本自动检查)
5. [ ] 测试主要功能正常
6. [ ] 验证升级流程正常

## 签名安全

### Release 证书信息
| 项目 | 值 |
|------|-----|
| CN | AI Bookkeeping Team |
| O | AI Bookkeeping |
| SHA-256 | `13d33ab9de62c3e1dc333cc7fbf1b9bdb9ebbe2d00cc067f69f32c2b313a0043` |

### 自动验证
发布脚本 (`publish_apk.sh`) 会自动验证 APK 签名：
- 检测到 **Debug 证书** → 立即阻止发布
- 证书指纹 **不匹配** → 立即阻止发布
- 只有使用正确的 Release 证书才能发布

### 重要警告
⚠️ **切勿使用 Debug 证书发布生产版本！**
- Android 不允许更换签名证书升级
- 一旦用错误证书发布，用户必须卸载重装

## 发布命令

```bash
# 一键发布
ADMIN_PASSWORD=xxx ./scripts/publish_apk.sh \
  --version 2.0.0 \
  --code 40 \
  --notes "- 新增简易模式\n- 六大唤醒入口\n- 悬浮球快捷记账\n- 深度链接支持" \
  --build --publish
```

## 强制更新策略

| 情况 | 是否强制 |
|------|----------|
| 安全漏洞修复 | 是 |
| 数据库结构变更 | 是 |
| API不兼容变更 | 是 |
| 普通功能更新 | 否 |
| Bug修复 | 否 |
