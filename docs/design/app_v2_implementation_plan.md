# AI智能记账 2.0 实施方案

> 版本：2.0.0
> 日期：2026-01-06
> 状态：实施阶段

## 文档说明

本文档为AI智能记账2.0版本的**实施方案**，从[版本设计方案](./app_v2_design.md)中独立出来，专注于项目实施层面的内容。

**文档定位：**
- **设计方案** ([app_v2_design.md](./app_v2_design.md))：关注"做什么"和"为什么这样做"
- **实施方案** (本文档)：关注"怎么做"和"什么时候做"

**相关文档：**
- [AI智能记账 2.0 版本设计方案](./app_v2_design.md) - 功能设计与技术架构
- [AI智能记账 2.0 代码设计文档](./app_v2_code_design.md) - 代码实现细节
- [AI智能记账 2.0 测试策略](./app_v2_test_strategy.md) - 测试验证相关内容

---

## 目录

**第一部分：版本迁移**

1. [版本迁移策略](#1-版本迁移策略)

**第二部分：开发实施**

2. [实施路线图](#2-实施路线图)

---

# 第一部分：版本迁移

---



---

## 1. 版本迁移策略

本章说明从1.x版本到2.0版本的升级策略。

### 1.0 迁移策略总览

#### 1.0.1 当前版本状态

**关键事实：1.x版本当前没有实际用户和用户数据。**

基于这一现状，我们采用**全新起点策略**，而非传统的渐进式迁移：

```
┌────────────────────────────────────────────────────────────────────────────┐
│                         1.x → 2.0 迁移策略                                   │
├────────────────────────────────────────────────────────────────────────────┤
│                                                                            │
│  【当前状态】                                                                │
│  ├── 1.x版本：无实际用户、无用户数据                                         │
│  ├── 数据库：无需迁移历史数据                                                │
│  └── 结论：可以采用更大胆、高效的策略                                         │
│                                                                            │
│  【迁移策略】                                                                │
│  ┌─────────────────────────────────────────────────────────────────────┐   │
│  │                                                                     │   │
│  │   ✅ 全新Schema设计 - 不受1.x结构约束                                │   │
│  │   ✅ 直接使用2.0数据模型 - 无需兼容层                                 │   │
│  │   ✅ 简化迁移代码 - 无需复杂的数据转换逻辑                             │   │
│  │   ✅ 快速迭代 - 可随时调整数据结构                                    │   │
│  │                                                                     │   │
│  └─────────────────────────────────────────────────────────────────────┘   │
│                                                                            │
│  【不需要的复杂机制】                                                        │
│  ├── ❌ 版本链式迁移脚本                                                   │
│  ├── ❌ 升级前自动备份                                                     │
│  ├── ❌ 分批迁移与断点续传                                                 │
│  ├── ❌ 回滚机制                                                           │
│  └── ❌ 向后兼容的"只增不删"策略                                           │
│                                                                            │
└────────────────────────────────────────────────────────────────────────────┘
```

#### 1.0.2 简化后的设计原则

| 设计维度 | 策略 | 说明 |
|---------|------|------|
| **Schema设计** | 全新设计 | 直接采用2.0最优数据模型，无需考虑1.x兼容 |
| **数据迁移** | 无需迁移 | 1.x无用户数据，2.0从空白开始 |
| **版本管理** | 简化管理 | Schema版本从v1开始，为未来2.x→3.x迁移预留 |
| **测试策略** | 全新测试 | 只需测试2.0功能，无需测试迁移路径 |

#### 1.0.3 与2.0其他系统的协同关系图

```
┌─────────────────────────────────────────────────────────────────────────────────┐
│                       版本迁移策略 - 系统协同全景图                               │
├─────────────────────────────────────────────────────────────────────────────────┤
│                                                                                 │
│                          ┌───────────────────────┐                              │
│                          │    版本迁移策略        │                              │
│                          │  MigrationService     │                              │
│                          └───────────┬───────────┘                              │
│                                      │                                          │
│    ┌─────────────┬───────────┬───────┴───────┬───────────┬─────────────┐       │
│    │             │           │               │           │             │       │
│    ▼             ▼           ▼               ▼           ▼             ▼       │
│ ┌───────┐  ┌───────┐  ┌───────────┐  ┌───────────┐  ┌───────┐  ┌───────────┐  │
│ │数据备份│  │APP升级│  │零基预算   │  │ 钱龄系统  │  │数据导入│  │同步系统   │  │
│ │       │  │       │  │           │  │           │  │       │  │           │  │
│ │升级备份│  │版本检测│  │Schema迁移 │  │资源池初始 │  │格式兼容│  │增量同步   │  │
│ │自动回滚│  │增量更新│  │小金库创建 │  │钱龄重算   │  │版本转换│  │冲突解决   │  │
│ │完整恢复│  │强制更新│  │预算继承   │  │历史补算   │  │数据修复│  │版本对齐   │  │
│ └───┬───┘  └───┬───┘  └─────┬─────┘  └─────┬─────┘  └───┬───┘  └─────┬─────┘  │
│     │          │            │              │            │            │         │
│     └──────────┴────────────┴──────────────┴────────────┴────────────┘         │
│                                      │                                          │
│                                      ▼                                          │
│              ┌─────────────────────────────────────────────┐                   │
│              │             迁移安全保障                      │                   │
│              │  智能备份 → 分批迁移 → 完整校验 → 安全回滚   │                   │
│              └─────────────────────────────────────────────┘                   │
│                                                                                 │
│  ┌─────────────────────────────────────────────────────────────────────┐       │
│  │                         迁移触发场景                                 │       │
│  ├───────────────┬───────────────┬───────────────┬───────────────────┤       │
│  │ APP升级       │ 数据恢复       │ 数据导入       │ 换机迁移          │       │
│  ├───────────────┼───────────────┼───────────────┼───────────────────┤       │
│  │ • 版本号变更  │ • 备份恢复     │ • 旧版数据     │ • 新设备登录      │       │
│  │ • Schema变更  │ • 云端同步     │ • 格式转换     │ • 云端数据拉取    │       │
│  │ • 功能开关    │ • 错误修复     │ • 数据修复     │ • Schema对齐      │       │
│  └───────────────┴───────────────┴───────────────┴───────────────────┘       │
│                                                                                 │
└─────────────────────────────────────────────────────────────────────────────────┘
```

#### 1.0.4 本章内容导航图

```
┌─────────────────────────────────────────────────────────────────────────────────┐
│                         第26章 版本迁移策略 - 内容导航                              │
├─────────────────────────────────────────────────────────────────────────────────┤
│                                                                                 │
│  ┌───────────────┐    ┌───────────────┐    ┌───────────────┐                   │
│  │  26.1 数据库  │    │  26.2 功能开关 │    │  26.3 渐进式  │                   │
│  │    迁移       │    │               │    │  升级引导     │                   │
│  │ ─────────────│    │ ─────────────│    │ ─────────────│                   │
│  │ • Migration  │    │ • Feature    │    │ • 欢迎页引导  │                   │
│  │   脚本管理   │    │   Flag服务   │    │ • 功能介绍    │                   │
│  │ • Schema升级 │    │ • 版本控制   │    │ • 开始使用    │                   │
│  │ • 资源池初始 │    │ • A/B测试    │    │ • 新功能发现  │                   │
│  └───────────────┘    └───────────────┘    └───────────────┘                   │
│          │                   │                   │                              │
│          └───────────────────┴───────────────────┘                              │
│                              │                                                   │
│                              ▼                                                   │
│  ┌─────────────────────────────────────────────────────────────────────────┐   │
│  │                      26.4 数据兼容性策略（核心）                           │   │
│  │  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐    │   │
│  │  │ 26.4.1     │  │ 26.4.2     │  │ 26.4.3     │  │ 26.4.4     │    │   │
│  │  │ 兼容原则   │  │ Schema版本 │  │ 版本元数据 │  │ 智能备份   │    │   │
│  │  │ 只增不删   │  │ 管理       │  │            │  │ 策略       │    │   │
│  │  └─────────────┘  └─────────────┘  └─────────────┘  └─────────────┘    │   │
│  │  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐    │   │
│  │  │ 26.4.5     │  │ 26.4.6     │  │ 26.4.7     │  │ 26.4.8-9   │    │   │
│  │  │ 渐进迁移   │  │ 完整校验   │  │ 格式版本化 │  │ API兼容    │    │   │
│  │  │ 断点续传   │  │ 余额一致   │  │            │  │ UI展示     │    │   │
│  │  └─────────────┘  └─────────────┘  └─────────────┘  └─────────────┘    │   │
│  └─────────────────────────────────────────────────────────────────────────┘   │
│                              │                                                   │
│                              ▼                                                   │
│  ┌─────────────────────────────────────────────────────────────────────────┐   │
│  │                         26.5 系统集成                                     │   │
│  │  ┌───────────┐  ┌───────────┐  ┌───────────┐  ┌───────────┐            │   │
│  │  │ 钱龄系统  │  │ 零基预算  │  │ 数据导入  │  │ APP升级   │            │   │
│  │  │ 集成      │  │ 集成      │  │ 集成      │  │ 集成      │            │   │
│  │  └───────────┘  └───────────┘  └───────────┘  └───────────┘            │   │
│  │  ┌───────────┐  ┌───────────┐  ┌───────────┐  ┌───────────┐            │   │
│  │  │ 同步系统  │  │ 语音交互  │  │ 自学习    │  │ 用户体验  │            │   │
│  │  │ 集成      │  │ 集成      │  │ 集成      │  │ 集成      │            │   │
│  │  └───────────┘  └───────────┘  └───────────┘  └───────────┘            │   │
│  └─────────────────────────────────────────────────────────────────────────┘   │
│                              │                                                   │
│                              ▼                                                   │
│                    ┌───────────────────┐                                        │
│                    │  26.6 目标达成检测 │                                        │
│                    │  版本迁移质量验证  │                                        │
│                    └───────────────────┘                                        │
│                                                                                 │
└─────────────────────────────────────────────────────────────────────────────────┘
```


### 1.1 数据库迁移

> 📄 **代码实现**: 见 [代码设计文档 - 代码块373](app_v2_code_design.md#code-373)

### 1.2 功能开关

> 📄 **代码实现**: 见 [代码设计文档 - 代码块374](app_v2_code_design.md#code-374)

### 1.3 渐进式升级引导

> 📄 **代码实现**: 见 [代码设计文档 - 代码块375](app_v2_code_design.md#code-375)

### 1.4 数据兼容性策略

#### 1.4.1 数据兼容性原则

> ⚠️ **适用范围说明**：以下数据兼容性原则**仅适用于2.0版本发布后的后续版本升级**。
> 由于1.X版本无实际用户和数据，从1.X迁移到2.0版本时**不需要**考虑数据兼容性，
> 2.0版本可以自由重构数据库表结构、删除或重命名字段、完全重新设计数据模型。

```
┌──────────────────────────────────────────────────────────────────────────┐
│                         数据兼容性核心原则                                  │
│                      （适用于2.0版本发布后）                                 │
├──────────────────────────────────────────────────────────────────────────┤
│                                                                          │
│  原则一：只增不删（Additive Only）                                         │
│  ├── 数据库字段只增加，不删除已有字段                                       │
│  ├── 新字段必须有默认值或允许NULL                                          │
│  └── 废弃字段标记为deprecated，保留至少2个大版本                            │
│                                                                          │
│  原则二：向后兼容（Backward Compatible）                                   │
│  ├── 新版本APP能读取旧版本数据                                             │
│  ├── 旧版本APP能读取新版本数据（忽略未知字段）                               │
│  └── 数据格式变更必须提供转换器                                            │
│                                                                          │
│  原则三：升级前备份（Backup Before Upgrade）                                │
│  ├── 重大升级前自动创建数据备份                                            │
│  ├── 备份包含完整数据库和配置                                              │
│  └── 保留最近3个版本的备份                                                 │
│                                                                          │
│  原则四：渐进式迁移（Progressive Migration）                                │
│  ├── 大量数据迁移分批执行，避免ANR                                         │
│  ├── 迁移过程可中断可恢复                                                  │
│  └── 迁移进度可视化展示                                                   │
│                                                                          │
│  原则五：数据校验（Data Validation）                                        │
│  ├── 迁移前后数据完整性校验                                                │
│  ├── 关键数据（金额、余额）必须校验一致                                     │
│  └── 校验失败则回滚并报告                                                  │
│                                                                          │
└──────────────────────────────────────────────────────────────────────────┘
```

#### 1.4.2 数据库Schema版本管理

> 📄 **代码实现**: 见 [代码设计文档 - 代码块376](app_v2_code_design.md#code-376)

#### 1.4.3 版本发布元数据

> 📄 **代码实现**: 见 [代码设计文档 - 代码块431](app_v2_code_design.md#code-431)

每次打包发布时，必须在版本元数据中标注是否存在数据库变动，用于客户端智能判断是否需要备份。

```yaml
# pubspec.yaml 或独立的 version_metadata.yaml
version: 1.2.23+40

# 版本元数据（构建时自动生成到 assets/version_metadata.json）
metadata:
  release_date: "2026-01-15"

  # 数据库变动标记（关键字段）
  database_changes: true          # 是否有数据库变动
  schema_version: 21              # 目标Schema版本
  previous_schema_version: 20     # 上一版本Schema版本

  # 变动详情（用于展示给用户）
  migration_notes:
    - "新增习惯追踪表 (habits)"
    - "交易表增加 recurring_id 字段"

  # 备份建议级别
  backup_level: required          # required(必须) / recommended(建议) / optional(可选)

  # 迁移预估时间（秒，用于进度展示）
  estimated_migration_time: 30

  # 最低兼容版本（低于此版本必须强制升级）
  min_compatible_version: "1.2.0"
```

> 📄 **代码实现**: 见 [代码设计文档 - 代码块377](app_v2_code_design.md#code-377)

#### 1.4.4 智能升级备份策略

基于版本元数据，智能判断是否需要在升级前进行备份，避免无效备份。

**备份存储位置说明：**

```
┌──────────────────────────────────────────────────────────────────────────┐
│                         备份存储策略                                        │
├──────────────────────────────────────────────────────────────────────────┤
│                                                                          │
│  备份类型            存储位置        用途                  保留策略        │
│  ─────────────────────────────────────────────────────────────────────   │
│  升级备份            本地            升级失败快速回滚      保留最近3个      │
│  手动备份            本地+云端       用户主动备份          用户自定义       │
│  自动定期备份        云端            数据安全/换机恢复     最近7天+月备份   │
│                                                                          │
│  ┌─────────────────────────────────────────────────────────────────┐    │
│  │  升级备份选择【本地】的原因：                                      │    │
│  │  • 速度快：本地IO无网络延迟，升级体验流畅                         │    │
│  │  • 离线可用：无网络时也能完成升级                                 │    │
│  │  • 临时性：仅用于升级回滚，成功后可清理                           │    │
│  │  • 隐私安全：敏感数据不经过网络传输                               │    │
│  └─────────────────────────────────────────────────────────────────┘    │
│                                                                          │
│  ┌─────────────────────────────────────────────────────────────────┐    │
│  │  云端备份的触发时机：                                              │    │
│  │  • 用户手动点击"备份到云端"                                        │    │
│  │  • 自动定期备份（可在设置中开启，默认关闭）                        │    │
│  │  • 换机恢复流程中从云端拉取                                        │    │
│  └─────────────────────────────────────────────────────────────────┘    │
│                                                                          │
└──────────────────────────────────────────────────────────────────────────┘
```

**智能备份决策流程：**

```
┌──────────────────────────────────────────────────────────────────────────┐
│                         智能备份决策流程                                    │
├──────────────────────────────────────────────────────────────────────────┤
│                                                                          │
│  1. 检测到新版本可用                                                       │
│       ↓                                                                   │
│  2. 下载新版本的 version_metadata.json                                    │
│       ↓                                                                   │
│  3. 检查 database_changes 字段                                            │
│       ↓                                                                   │
│  ┌────────────────┬─────────────────────────────────────────────────┐   │
│  │ database_changes │                   处理方式                      │   │
│  ├────────────────┼─────────────────────────────────────────────────┤   │
│  │     true       │ 本地备份 → 显示备份进度 → 执行迁移               │   │
│  │     false      │ 跳过备份 → 直接安装更新                          │   │
│  └────────────────┴─────────────────────────────────────────────────┘   │
│                                                                          │
│  4. 用户可选择手动备份（设置 → 数据备份 → 备份到云端）                     │
│                                                                          │
└──────────────────────────────────────────────────────────────────────────┘
```

> 📄 **代码实现**: 见 [代码设计文档 - 代码块378](app_v2_code_design.md#code-378)

> 📄 **代码实现**: 见 [代码设计文档 - 代码块379](app_v2_code_design.md#code-379)

#### 1.4.5 渐进式数据迁移

> 📄 **代码实现**: 见 [代码设计文档 - 代码块380](app_v2_code_design.md#code-380)

#### 1.4.6 数据完整性校验

> 📄 **代码实现**: 见 [代码设计文档 - 代码块381](app_v2_code_design.md#code-381)

#### 1.4.7 数据格式版本化

> 📄 **代码实现**: 见 [代码设计文档 - 代码块382](app_v2_code_design.md#code-382)

#### 1.4.8 API兼容性层

> 📄 **代码实现**: 见 [代码设计文档 - 代码块383](app_v2_code_design.md#code-383)

#### 1.4.9 升级流程UI

> 📄 **代码实现**: 见 [代码设计文档 - 代码块384](app_v2_code_design.md#code-384)

### 1.5 与其他系统的集成

#### 1.5.0 系统集成全景图

```
┌─────────────────────────────────────────────────────────────────────────────────┐
│                      版本迁移策略 - 系统集成全景图                                │
├─────────────────────────────────────────────────────────────────────────────────┤
│                                                                                 │
│                          ┌───────────────────────┐                              │
│                          │    版本迁移服务        │                              │
│                          │  MigrationService     │                              │
│                          └───────────┬───────────┘                              │
│                                      │                                          │
│    ┌─────────────┬───────────┬───────┴───────┬───────────┬─────────────┐       │
│    │             │           │               │           │             │       │
│    ▼             ▼           ▼               ▼           ▼             ▼       │
│ ┌───────┐  ┌───────┐  ┌───────────┐  ┌───────────┐  ┌───────┐  ┌───────────┐  │
│ │钱龄系统│  │零基预算│  │ 数据导入  │  │ 数据备份  │  │APP升级│  │同步系统   │  │
│ │ (7章) │  │ (8章) │  │  (11章)  │  │  (本章)  │  │(本章) │  │  (16章)  │  │
│ │资源池  │  │小金库  │  │格式转换   │  │升级备份   │  │版本元数│  │数据对齐   │  │
│ │初始化  │  │迁移    │  │兼容性处理 │  │完整恢复   │  │据检查  │  │版本同步   │  │
│ └───────┘  └───────┘  └───────────┘  └───────────┘  └───────┘  └───────────┘  │
│                                                                                 │
│  ═══════════════════════════════════════════════════════════════════════════   │
│                          2.0新增迁移模块 (第一层)                                │
│  ═══════════════════════════════════════════════════════════════════════════   │
│                                                                                 │
│ ┌───────────┐  ┌───────────┐  ┌───────────┐  ┌───────────┐  ┌───────────┐     │
│ │ 家庭账本  │  │ 语音交互  │  │ 自学习系统 │  │ 位置智能  │  │ 习惯培养  │     │
│ │  (15章)  │  │  (18章)  │  │  (14章)  │  │  (12章)  │  │  (9章)   │     │
│ │          │  │          │  │          │  │          │  │          │     │
│ │ 家庭关系  │  │ 语音配置  │  │ 学习模型  │  │ 位置偏好  │  │ 成就数据  │     │
│ │ 成员角色  │  │ 语音历史  │  │ 反馈数据  │  │ 地理围栏  │  │ 连续记账  │     │
│ └───────────┘  └───────────┘  └───────────┘  └───────────┘  └───────────┘     │
│                                                                                 │
│  ═══════════════════════════════════════════════════════════════════════════   │
│                          2.0新增迁移模块 (第二层)                                │
│  ═══════════════════════════════════════════════════════════════════════════   │
│                                                                                 │
│ ┌───────────┐  ┌───────────┐  ┌───────────┐  ┌───────────┐  ┌───────────┐     │
│ │ 用户体验  │  │ NPS增长   │  │ 极致体验  │  │ 跨设备    │  │ 深度个性化 │     │
│ │  (20章)  │  │  (16章)  │  │ (20.16+) │  │ (20.9)  │  │ (20.6)  │     │
│ │          │  │          │  │          │  │          │  │          │     │
│ │ 主题偏好  │  │ NPS评分   │  │ 边界场景  │  │ 设备绑定  │  │ 个性化    │     │
│ │ 交互习惯  │  │ 反馈历史  │  │ 容错配置  │  │ 同步策略  │  │ 配置迁移  │     │
│ └───────────┘  └───────────┘  └───────────┘  └───────────┘  └───────────┘     │
│                                                                                 │
│  ───────────────────────────────────────────────────────────────────────────   │
│                              迁移保障机制                                        │
│  ───────────────────────────────────────────────────────────────────────────   │
│                                                                                 │
│   ┌─────────┐      ┌─────────┐      ┌─────────┐      ┌─────────┐              │
│   │ 智能备份 │ ──▶ │ 分批迁移 │ ──▶ │ 完整校验 │ ──▶ │ 安全回滚 │              │
│   │ 版本元数 │      │ 断点续传 │      │ 金额一致 │      │ 一键恢复 │              │
│   └─────────┘      └─────────┘      └─────────┘      └─────────┘              │
│                                                                                 │
└─────────────────────────────────────────────────────────────────────────────────┘
```

#### 1.5.1 集成触发点

| 集成模块 | 触发场景 | 迁移操作 | 回滚策略 |
|---------|---------|---------|---------|
| **钱龄系统** | Schema升级到v16 | 创建资源池表、初始化历史数据 | 删除资源池表及数据 |
| **零基预算** | Schema升级到v15 | 创建小金库表、迁移预算数据 | 恢复原预算结构 |
| **数据导入** | 导入旧版数据 | 格式版本检测、逐版本转换 | 保留原始导入文件 |
| **数据备份** | 版本升级前 | 智能判断是否需要备份 | 从备份完整恢复 |
| **APP升级** | 新版本安装 | 检测版本元数据、执行迁移链 | 回滚到升级前版本 |
| **同步系统** | 多设备数据同步 | 版本对齐、Schema兼容 | 保留冲突数据供用户处理 |
| **语音交互** | Schema升级到v21 | 创建语音配置表、迁移历史记录 | 恢复默认语音设置 |
| **自学习系统** | Schema升级到v22 | 创建学习模型表、初始化权重 | 删除学习数据，使用默认模型 |
| **用户体验** | Schema升级到v23 | 迁移主题偏好、交互习惯配置 | 恢复系统默认主题 |
| **家庭账本** | Schema升级到v24 | 创建家庭表、成员角色迁移 | 删除家庭关系，保留个人数据 |
| **位置智能** | Schema升级到v25 | 创建位置偏好表、地理围栏配置 | 删除位置数据，关闭位置功能 |
| **习惯培养** | Schema升级到v26 | 创建成就表、连续记账数据初始化 | 删除成就记录，重置积分 |
| **NPS增长** | Schema升级到v27 | 创建反馈历史表、用户画像迁移 | 删除反馈数据 |
| **极致体验** | Schema升级到v28 | 迁移边界场景配置、容错策略 | 恢复默认容错配置 |

#### 1.5.2 与钱龄系统集成

> 📄 **代码实现**: 见 [代码设计文档 - 代码块385](app_v2_code_design.md#code-385)

#### 1.5.3 与零基预算系统集成

> 📄 **代码实现**: 见 [代码设计文档 - 代码块386](app_v2_code_design.md#code-386)

#### 1.5.4 与数据导入系统集成

> 📄 **代码实现**: 见 [代码设计文档 - 代码块387](app_v2_code_design.md#code-387)

#### 1.5.5 与APP升级系统集成

> 📄 **代码实现**: 见 [代码设计文档 - 代码块388](app_v2_code_design.md#code-388)

#### 1.5.6 与同步系统集成

> 📄 **代码实现**: 见 [代码设计文档 - 代码块389](app_v2_code_design.md#code-389)



#### 1.5.7 与语音交互系统集成

> 📄 **代码实现**: 见 [代码设计文档 - 代码块390](app_v2_code_design.md#code-390)

#### 1.5.8 与自学习系统集成

> 📄 **代码实现**: 见 [代码设计文档 - 代码块391](app_v2_code_design.md#code-391)

#### 1.5.9 与用户体验系统集成

> 📄 **代码实现**: 见 [代码设计文档 - 代码块392](app_v2_code_design.md#code-392)

### 1.6 目标达成检测

> 📄 **代码实现**: 见 [代码设计文档 - 代码块393](app_v2_code_design.md#code-393)

---

# 第二部分：开发实施

---

## 2. 实施路线图

本章详细说明AI智能记账2.0版本的开发实施计划，包括阶段划分、任务分解、里程碑定义和验收标准，确保项目按计划高质量交付。

> ⚠️ **重要前提**：由于1.X版本无实际用户和数据，2.0版本开发可采用**激进重构策略**：
> - **无迁移负担**：可完全重新设计数据模型，无需编写1.X→2.0数据迁移脚本
> - **无兼容约束**：API、数据库Schema可自由调整，无需保持向后兼容
> - **并行开发**：多个功能模块可同时启动开发，无需串行等待
> - **快速迭代**：可直接发布，无需灰度发布策略

### 2.0 设计原则回顾

#### 2.0.1 实施路线图设计原则矩阵

```
┌─────────────────────────────────────────────────────────────────────────────────┐
│                      实施路线图 - 设计原则应用矩阵                                 │
├─────────────────────────────────────────────────────────────────────────────────┤
│                                                                                 │
│  ┌─────────────┐    ┌─────────────┐    ┌─────────────┐    ┌─────────────┐      │
│  │  增量交付   │    │  风险前置   │    │  价值驱动   │    │  质量内建   │      │
│  ├─────────────┤    ├─────────────┤    ├─────────────┤    ├─────────────┤      │
│  │ 小步快跑    │    │ 核心功能    │    │ 用户价值    │    │ 测试先行    │      │
│  │ 持续集成    │    │ 优先验证    │    │ 优先排序    │    │ 自动化验证  │      │
│  │ 快速迭代    │    │ 技术债务    │    │ MVP思维     │    │ 持续重构    │      │
│  │ 灰度发布    │    │ 早期暴露    │    │ 反馈驱动    │    │ 代码审查    │      │
│  └─────────────┘    └─────────────┘    └─────────────┘    └─────────────┘      │
│         │                  │                  │                  │             │
│         └──────────────────┴──────────────────┴──────────────────┘             │
│                                    │                                            │
│                                    ▼                                            │
│  ┌─────────────────────────────────────────────────────────────────┐           │
│  │                     开发实施核心流程                              │           │
│  │  ┌─────────────────────────────────────────────────────────┐   │           │
│  │  │  规划 → 开发 → 测试 → 评审 → 发布 → 监控 → 优化         │   │           │
│  │  └─────────────────────────────────────────────────────────┘   │           │
│  └─────────────────────────────────────────────────────────────────┘           │
│                                    │                                            │
│         ┌──────────────────────────┴──────────────────────────┐                │
│         │                                                      │                │
│         ▼                                                      ▼                │
│  ┌─────────────┐                                        ┌─────────────┐        │
│  │  敏捷开发   │                                        │  可观测性   │        │
│  ├─────────────┤                                        ├─────────────┤        │
│  │ Sprint规划  │                                        │ 进度追踪    │        │
│  │ 每日站会    │                                        │ 风险预警    │        │
│  │ 回顾改进    │                                        │ 质量度量    │        │
│  │ 持续交付    │                                        │ 资源监控    │        │
│  └─────────────┘                                        └─────────────┘        │
│                                                                                 │
└─────────────────────────────────────────────────────────────────────────────────┘
```

#### 2.0.2 设计理念

| 设计维度 | 在实施路线图的体现 | 具体实现 |
|---------|---------------------|---------|
| **增量交付** | 分阶段交付可用功能 | 3个核心阶段+并行开发；每阶段有明确交付物 |
| **风险前置** | 核心功能优先开发 | 钱龄/预算等核心引擎优先；技术风险早期暴露 |
| **价值驱动** | 用户价值排序功能 | 钱龄分析差异化优先；习惯培养紧随其后 |
| **质量内建** | 开发过程中保证质量 | 测试金字塔55%单元测试；CI/CD自动化 |
| **并行开发** | 最大化开发效率 | 无依赖模块同时开发；UI与后端并行；测试与开发并行 |
| **激进重构** | 无历史包袱 | 无需数据迁移；可自由重构；直接发布 |

#### 2.0.3 与2.0其他系统的协同关系图

```
┌─────────────────────────────────────────────────────────────────────────────────┐
│                       实施路线图 - 系统协同全景图                                 │
├─────────────────────────────────────────────────────────────────────────────────┤
│                                                                                 │
│                          ┌───────────────────────┐                              │
│                          │    实施路线图          │                              │
│                          │  ProjectRoadmap       │                              │
│                          └───────────┬───────────┘                              │
│                                      │                                          │
│    ┌─────────────────────────────────┴─────────────────────────────────┐       │
│    │                         开发阶段规划                                │       │
│    ├───────────┬───────────┬───────────┬───────────┬───────────────────┤       │
│    │  Alpha    │  Beta-1   │  Beta-2   │  Beta-3   │  RC-1/2 + Release │       │
│    │  架构升级  │  核心引擎  │  习惯培养  │  AI智能   │  体验优化+发布    │       │
│    └───────────┴───────────┴───────────┴───────────┴───────────────────┘       │
│                                      │                                          │
│    ┌─────────────┬───────────┬───────┴───────┬───────────┬─────────────┐       │
│    │             │           │               │           │             │       │
│    ▼             ▼           ▼               ▼           ▼             ▼       │
│ ┌───────┐  ┌───────┐  ┌───────────┐  ┌───────────┐  ┌───────┐  ┌───────────┐  │
│ │钱龄系统│  │零基预算│  │ 习惯培养  │  │ AI智能   │  │用户体验│  │版本迁移   │  │
│ │ (7章) │  │ (8章) │  │  (9章)   │  │ (10章)  │  │(20章) │  │  (26章)  │  │
│ │       │  │       │  │          │  │          │  │       │  │          │  │
│ │ Beta-1 │  │ Beta-1 │  │ Beta-2  │  │ Beta-3   │  │ RC-1  │  │ Release  │  │
│ └───────┘  └───────┘  └───────────┘  └───────────┘  └───────┘  └───────────┘  │
│                                                                                 │
│  ───────────────────────────────────────────────────────────────────────────   │
│                              质量保障体系                                        │
│  ───────────────────────────────────────────────────────────────────────────   │
│                                                                                 │
│ ┌───────────┐  ┌───────────┐  ┌───────────┐  ┌───────────┐  ┌───────────┐     │
│ │ 测试策略  │  │ 安全设计  │  │ 可观测性  │  │ 异常处理  │  │ 性能优化  │     │
│ │  (25章)  │  │  (22章)  │  │  (23章)  │  │  (24章)  │  │  (19章)  │     │
│ │          │  │          │  │          │  │          │  │          │     │
│ │ 全程覆盖  │  │ 全程覆盖  │  │ 全程覆盖  │  │ 全程覆盖  │  │ 全程覆盖  │     │
│ └───────────┘  └───────────┘  └───────────┘  └───────────┘  └───────────┘     │
│                                                                                 │
│  ───────────────────────────────────────────────────────────────────────────   │
│                              发布后持续迭代                                      │
│  ───────────────────────────────────────────────────────────────────────────   │
│                                                                                 │
│ ┌───────────────────┐  ┌───────────────────┐  ┌───────────────────┐           │
│ │ NPS监测与口碑优化  │  │ 社交裂变与获客    │  │ ASO与内容营销     │           │
│ │     (28章)        │  │    (29章)        │  │    (Post-Launch)  │           │
│ └───────────────────┘  └───────────────────┘  └───────────────────┘           │
│                                                                                 │
└─────────────────────────────────────────────────────────────────────────────────┘
```

#### 2.0.4 本章内容导航图

```
┌─────────────────────────────────────────────────────────────────────────────────┐
│                         第27章 实施路线图 - 内容导航                              │
├─────────────────────────────────────────────────────────────────────────────────┤
│                                                                                 │
│  ┌───────────────────────────────────────────────────────────────────────┐     │
│  │                      27.1 开发阶段                                      │     │
│  │  ┌─────────┐  ┌─────────┐  ┌─────────┐  ┌─────────┐  ┌─────────┐     │     │
│  │  │ Alpha   │→ │ Beta-1  │→ │ Beta-2  │→ │ Beta-3  │→ │  RC-1   │     │     │
│  │  │ 架构升级 │  │ 核心引擎 │  │ 习惯培养 │  │ AI增强  │  │ 体验优化 │     │     │
│  │  └─────────┘  └─────────┘  └─────────┘  └─────────┘  └─────────┘     │     │
│  │        ┌─────────┐  ┌─────────┐  ┌───────────────┐                   │     │
│  │        │  RC-2   │→ │ Release │→ │  Post-Launch  │                   │     │
│  │        │ 情感设计 │  │ 质量发布 │  │  持续增长     │                   │     │
│  │        └─────────┘  └─────────┘  └───────────────┘                   │     │
│  └───────────────────────────────────────────────────────────────────────┘     │
│                                      │                                          │
│                                      ▼                                          │
│  ┌───────────────────────────────────────────────────────────────────────┐     │
│  │                      27.2 任务清单                                      │     │
│  │  • 阶段一：数据层 + 架构层任务                                          │     │
│  │  • 阶段二：钱龄系统 + 零基预算任务                                      │     │
│  │  • 阶段三：消费审视 + 冲动防护 + 财务缓冲 + 激励系统任务                 │     │
│  │  • 阶段四：AI识别 + 智能技术 + 位置智能任务                             │     │
│  │  • 阶段五：可视化 + 体验设计 + 懒人原则 + 家庭账本任务                   │     │
│  │  • 阶段六：伙伴化 + 无障碍 + 国际化任务                                 │     │
│  │  • 阶段七：测试 + 安全 + 可观测性 + 版本迁移任务                        │     │
│  │  • 阶段八：NPS + 社交裂变 + ASO任务                                    │     │
│  └───────────────────────────────────────────────────────────────────────┘     │
│                                      │                                          │
│                                      ▼                                          │
│  ┌───────────────────────────────────────────────────────────────────────┐     │
│  │                      27.3 里程碑与验收标准                               │     │
│  │  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐                   │     │
│  │  │ 功能验收    │  │ 质量门禁    │  │ 发布检查清单 │                   │     │
│  │  │ 标准定义    │  │ 自动化执行  │  │ 人工审核    │                   │     │
│  │  └─────────────┘  └─────────────┘  └─────────────┘                   │     │
│  └───────────────────────────────────────────────────────────────────────┘     │
│                                      │                                          │
│                                      ▼                                          │
│                          ┌───────────────────┐                                  │
│                          │  27.4 目标达成检测 │                                  │
│                          │  路线图执行验证    │                                  │
│                          └───────────────────┘                                  │
│                                                                                 │
└─────────────────────────────────────────────────────────────────────────────────┘
```

### 2.1 开发阶段

> 💡 **并行开发策略**：由于无历史数据迁移负担，可采用激进的并行开发模式，大幅缩短开发周期。

```
┌──────────────────────────────────────────────────────────────────────────────────────────┐
│                      2.0 版本开发路线图 (激进并行模式)                                       │
├──────────────────────────────────────────────────────────────────────────────────────────┤
│                                                                                          │
│  ════════════════════════════════════════════════════════════════════════════════════   │
│  第一阶段：基础架构 + 核心引擎 (并行启动)                                                   │
│  ════════════════════════════════════════════════════════════════════════════════════   │
│                                                                                          │
│  ┌─────────────────────────────┐  ┌─────────────────────────────┐                       │
│  │    并行轨道 A: 数据层        │  │    并行轨道 B: 架构层        │                       │
│  │    ─────────────────────    │  │    ─────────────────────    │                       │
│  │    • 全新数据库 Schema      │  │    • Riverpod 3.x 升级      │                       │
│  │    • ResourcePool 模型      │  │    • CrudNotifier 重构       │                       │
│  │    • BudgetVault 模型       │  │    • 离线队列服务            │                       │
│  │    • Transaction 扩展       │  │    • 自动同步服务            │                       │
│  │    (无需迁移脚本!)          │  │                              │                       │
│  └──────────────┬──────────────┘  └──────────────┬──────────────┘                       │
│                 │                                 │                                      │
│                 └─────────────┬──────────────────┘                                      │
│                               ↓                                                          │
│  ┌─────────────────────────────┐  ┌─────────────────────────────┐                       │
│  │    并行轨道 C: 钱龄系统     │  │    并行轨道 D: 零基预算      │                       │
│  │    ─────────────────────    │  │    ─────────────────────    │                       │
│  │    • 钱龄计算引擎           │  │    • 预算分配服务            │                       │
│  │    • FIFO/LIFO策略          │  │    • 智能分配算法            │                       │
│  │    • 钱龄趋势分析           │  │    • 小金库 CRUD             │                       │
│  │    • 钱龄可视化组件         │  │    • 预算结转管理            │                       │
│  └─────────────────────────────┘  └─────────────────────────────┘                       │
│                                                                                          │
│  ════════════════════════════════════════════════════════════════════════════════════   │
│  第二阶段：功能模块并行开发 (4轨道同时推进)                                                 │
│  ════════════════════════════════════════════════════════════════════════════════════   │
│                                                                                          │
│  ┌──────────────┐ ┌──────────────┐ ┌──────────────┐ ┌──────────────┐                    │
│  │ 轨道E: 习惯  │ │ 轨道F: AI    │ │ 轨道G: 体验  │ │ 轨道H: 家庭  │                    │
│  │ ──────────   │ │ ──────────   │ │ ──────────   │ │ ──────────   │                    │
│  │ • 消费审视   │ │ • 语音识别   │ │ • 数据下钻   │ │ • 账本模型   │                    │
│  │ • 冲动防护   │ │ • NLU服务    │ │ • MD3主题    │ │ • 成员管理   │                    │
│  │ • 财务缓冲   │ │ • 位置智能   │ │ • 深色模式   │ │ • AA分摊     │                    │
│  │ • 弹性激励   │ │ • OCR增强    │ │ • 微交互     │ │ • 权限系统   │                    │
│  └──────────────┘ └──────────────┘ └──────────────┘ └──────────────┘                    │
│                                                                                          │
│  ════════════════════════════════════════════════════════════════════════════════════   │
│  第三阶段：体验打磨 + 质量保障 (并行收尾)                                                   │
│  ════════════════════════════════════════════════════════════════════════════════════   │
│                                                                                          │
│  ┌──────────────┐ ┌──────────────┐ ┌──────────────┐ ┌──────────────┐ ┌──────────────┐   │
│  │ 轨道I: 情感  │ │ 轨道J: 无障碍│ │ 轨道K: 国际化│ │ 轨道L: 测试  │ │ 轨道M: 高可用│   │
│  │ ──────────   │ │ ──────────   │ │ ──────────   │ │ ──────────   │ │ ──────────   │   │
│  │ • 伙伴文案   │ │ • 语义标签   │ │ • 多语言     │ │ • 单元测试   │ │ • 限流熔断   │   │
│  │ • 场景识别   │ │ • 屏幕阅读器 │ │ • 货币格式   │ │ • 集成测试   │ │ • 幂等设计   │   │
│  │ • 情感分析   │ │ • 高对比度   │ │ • 日期时间   │ │ • 性能优化   │ │ • Saga事务   │   │
│  │ • 动态文案   │ │ • 触控优化   │ │ • RTL布局    │ │ • 安全审计   │ │ • 分布式锁   │   │
│  └──────────────┘ └──────────────┘ └──────────────┘ └──────────────┘ └──────────────┘   │
│                                                                                          │
│  ════════════════════════════════════════════════════════════════════════════════════   │
│  发布：直接发布 (无灰度)                                                                   │
│  ════════════════════════════════════════════════════════════════════════════════════   │
│                                                                                          │
│  ┌──────────────────────────────────────────────────────────────────────────────────┐   │
│  │  • 无需灰度发布策略 (无现有用户)                                                    │   │
│  │  • 应用商店直接全量发布                                                             │   │
│  │  • 监控告警配置完成后即可发布                                                        │   │
│  └──────────────────────────────────────────────────────────────────────────────────┘   │
│                                                                                          │
└──────────────────────────────────────────────────────────────────────────────────────────┘
```

#### 2.1.1 并行开发依赖关系图

```
┌──────────────────────────────────────────────────────────────────────────────────────────┐
│                           任务依赖关系与并行机会分析                                         │
├──────────────────────────────────────────────────────────────────────────────────────────┤
│                                                                                          │
│  【无依赖 - 可立即并行】                                                                   │
│  ════════════════════════════════════════════════════════════════════════════════════   │
│                                                                                          │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐                     │
│  │  数据模型   │  │  架构升级   │  │  UI组件库   │  │  国际化     │                     │
│  │  设计实现   │  │  Riverpod   │  │  MD3主题    │  │  翻译准备   │                     │
│  └─────────────┘  └─────────────┘  └─────────────┘  └─────────────┘                     │
│        │                │                │                │                              │
│        └────────────────┴────────────────┴────────────────┘                              │
│                                   │                                                      │
│                                   ↓                                                      │
│  【轻度依赖 - 接口定义后并行】                                                              │
│  ════════════════════════════════════════════════════════════════════════════════════   │
│                                                                                          │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐                     │
│  │  钱龄系统   │  │  预算系统   │  │  习惯培养   │  │  家庭账本   │                     │
│  │  (依赖数据) │  │  (依赖数据) │  │  (依赖数据) │  │  (依赖数据) │                     │
│  └─────────────┘  └─────────────┘  └─────────────┘  └─────────────┘                     │
│        │                │                │                │                              │
│        └────────────────┴────────────────┴────────────────┘                              │
│                                   │                                                      │
│                                   ↓                                                      │
│  【中度依赖 - 核心功能后并行】                                                              │
│  ════════════════════════════════════════════════════════════════════════════════════   │
│                                                                                          │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐                     │
│  │  AI语音     │  │  位置智能   │  │  数据下钻   │  │  伙伴文案   │                     │
│  │ (依赖交易)  │  │ (依赖交易)  │  │ (依赖图表)  │  │ (依赖场景)  │                     │
│  └─────────────┘  └─────────────┘  └─────────────┘  └─────────────┘                     │
│                                                                                          │
│  【独立模块 - 随时并行】                                                                   │
│  ════════════════════════════════════════════════════════════════════════════════════   │
│                                                                                          │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐                     │
│  │  无障碍设计 │  │  深色模式   │  │  单元测试   │  │  安全审计   │                     │
│  │  (独立)     │  │  (独立)     │  │  (随开发)   │  │  (独立)     │                     │
│  └─────────────┘  └─────────────┘  └─────────────┘  └─────────────┘                     │
│                                                                                          │
└──────────────────────────────────────────────────────────────────────────────────────────┘
```

#### 2.1.2 原开发阶段详细内容 (供参考)

以下为原规划的串行开发阶段详细内容，可作为任务分解参考：

```
┌──────────────────────────────────────────────────────────────────────────────┐
│                        原开发阶段详细内容 (参考)                                 │
├──────────────────────────────────────────────────────────────────────────────┤
│                                                                              │
│  ╔══════════════════════════════════════════════════════════════════════╗   │
│  ║  阶段一：基础架构升级 (Alpha)                                          ║   │
│  ╠══════════════════════════════════════════════════════════════════════╣   │
│  ║  ┌─────────────────────────────────────────────────────────────────┐ ║   │
│  ║  │ 数据层                                                          │ ║   │
│  ║  │  • 全新数据库Schema设计 (v1，无需迁移)                           │ ║   │
│  ║  │  • ResourcePool / ResourceConsumption 数据模型                  │ ║   │
│  ║  │  • BudgetVault (小金库) 数据模型                                │ ║   │
│  ║  │  • Transaction 模型扩展 (vault_id, location_info)              │ ║   │
│  ║  └─────────────────────────────────────────────────────────────────┘ ║   │
│  ║  ┌─────────────────────────────────────────────────────────────────┐ ║   │
│  ║  │ 架构层                                                          │ ║   │
│  ║  │  • Riverpod 3.x Provider 架构升级                               │ ║   │
│  ║  │  • CrudNotifier 统一模式重构                                    │ ║   │
│  ║  │  • 离线队列服务 (OfflineQueueService)                           │ ║   │
│  ║  │  • 自动同步服务 (AutoSyncService)                               │ ║   │
│  ║  └─────────────────────────────────────────────────────────────────┘ ║   │
│  ╚══════════════════════════════════════════════════════════════════════╝   │
│                                      ↓                                       │
│  ╔══════════════════════════════════════════════════════════════════════╗   │
│  ║  阶段二：核心业务引擎 (Beta-1)                                        ║   │
│  ╠══════════════════════════════════════════════════════════════════════╣   │
│  ║  ┌─────────────────────────────────────────────────────────────────┐ ║   │
│  ║  │ 钱龄系统 (第7章)                                                 │ ║   │
│  ║  │  • MoneyAgeCalculator 钱龄计算引擎                              │ ║   │
│  ║  │  • FIFO/LIFO/加权平均 消费顺序策略                              │ ║   │
│  ║  │  • 历史数据钱龄重建服务                                         │ ║   │
│  ║  │  • 钱龄趋势分析与预测                                           │ ║   │
│  ║  └─────────────────────────────────────────────────────────────────┘ ║   │
│  ║  ┌─────────────────────────────────────────────────────────────────┐ ║   │
│  ║  │ 零基预算系统 (第8章)                                            │ ║   │
│  ║  │  • AllocationService 预算分配服务                               │ ║   │
│  ║  │  • 智能分配建议算法                                             │ ║   │
│  ║  │  • 小金库 CRUD 功能                                             │ ║   │
│  ║  │  • 交易-小金库自动关联                                          │ ║   │
│  ║  │  • 预算结转与周期管理                                           │ ║   │
│  ║  └─────────────────────────────────────────────────────────────────┘ ║   │
│  ╚══════════════════════════════════════════════════════════════════════╝   │
│                                      ↓                                       │
│  ╔══════════════════════════════════════════════════════════════════════╗   │
│  ║  阶段三：金融习惯培养 (Beta-2)                                        ║   │
│  ╠══════════════════════════════════════════════════════════════════════╣   │
│  ║  ┌─────────────────────────────────────────────────────────────────┐ ║   │
│  ║  │ 消费审视系统 (第6.2章)                                          │ ║   │
│  ║  │  • SubscriptionTrackingService 订阅追踪                         │ ║   │
│  ║  │  • LatteFactorAnalyzer 拿铁因子分析                             │ ║   │
│  ║  │  • 消费洞察与可操作建议 (ActionableInsightService)              │ ║   │
│  ║  │  • OperationGuide 操作指南生成                                  │ ║   │
│  ║  └─────────────────────────────────────────────────────────────────┘ ║   │
│  ║  ┌─────────────────────────────────────────────────────────────────┐ ║   │
│  ║  │ 冲动消费防护 (第6.3章)                                          │ ║   │
│  ║  │  • ImpulseControlService 冲动消费干预                           │ ║   │
│  ║  │  • CoolingOffPeriodService 冷静期服务                           │ ║   │
│  ║  │  • SpendingPlanningService 先规划再消费引导                     │ ║   │
│  ║  │  • WishListService 愿望清单管理                                 │ ║   │
│  ║  └─────────────────────────────────────────────────────────────────┘ ║   │
│  ║  ┌─────────────────────────────────────────────────────────────────┐ ║   │
│  ║  │ 财务缓冲建立 (第6.4章)                                          │ ║   │
│  ║  │  • FinancialBufferService 应急金管理                            │ ║   │
│  ║  │  • DebtHealthService 债务健康管理                               │ ║   │
│  ║  │  • DebtSnowballService 债务雪球还款计划                         │ ║   │
│  ║  └─────────────────────────────────────────────────────────────────┘ ║   │
│  ║  ┌─────────────────────────────────────────────────────────────────┐ ║   │
│  ║  │ 弹性激励系统 (第6.5-6.6章)                                      │ ║   │
│  ║  │  • AdaptiveBudgetService 弹性预算调整                           │ ║   │
│  ║  │  • InclusiveMotivationService 包容性记账激励                    │ ║   │
│  ║  │  • SocialComparisonService 社会认同参照                         │ ║   │
│  ║  │  • FinancialCommitmentService 承诺一致机制                      │ ║   │
│  ║  └─────────────────────────────────────────────────────────────────┘ ║   │
│  ╚══════════════════════════════════════════════════════════════════════╝   │
│                                      ↓                                       │
│  ╔══════════════════════════════════════════════════════════════════════╗   │
│  ║  阶段四：AI智能化增强 (Beta-3)                                        ║   │
│  ╠══════════════════════════════════════════════════════════════════════╣   │
│  ║  ┌─────────────────────────────────────────────────────────────────┐ ║   │
│  ║  │ AI识别系统 (第10章)                                              │ ║   │
│  ║  │  • EnhancedVoiceRecognitionService 实时语音识别                 │ ║   │
│  ║  │  • NLUService 自然语言理解服务                                  │ ║   │
│  ║  │  • 多模态输入统一处理 (语音/图片/文本)                          │ ║   │
│  ║  └─────────────────────────────────────────────────────────────────┘ ║   │
│  ║  ┌─────────────────────────────────────────────────────────────────┐ ║   │
│  ║  │ 智能化技术方案 (第15章)                                         │ ║   │
│  ║  │  • 端侧AI模型部署                                               │ ║   │
│  ║  │  • 离线智能分类                                                 │ ║   │
│  ║  │  • 隐私保护联邦学习                                             │ ║   │
│  ║  └─────────────────────────────────────────────────────────────────┘ ║   │
│  ║  ┌─────────────────────────────────────────────────────────────────┐ ║   │
│  ║  │ 地理位置智能化 (第15章)                                         │ ║   │
│  ║  │  • LocationService 位置服务层                                   │ ║   │
│  ║  │  • CrossRegionSpendingService 异地消费检测                      │ ║   │
│  ║  │  • GeofenceAlertService 地理围栏提醒                            │ ║   │
│  ║  │  • LocationAwareMoneyAgeService 位置感知钱龄                    │ ║   │
│  ║  └─────────────────────────────────────────────────────────────────┘ ║   │
│  ╚══════════════════════════════════════════════════════════════════════╝   │
│                                      ↓                                       │
│  ╔══════════════════════════════════════════════════════════════════════╗   │
│  ║  阶段五：体验设计优化 (RC-1)                                          ║   │
│  ╠══════════════════════════════════════════════════════════════════════╣   │
│  ║  ┌─────────────────────────────────────────────────────────────────┐ ║   │
│  ║  │ 数据联动与可视化 (第12章)                                        │ ║   │
│  ║  │  • DrillDownNavigationService 数据下钻导航                      │ ║   │
│  ║  │  • BreadcrumbStateManager 面包屑状态管理                        │ ║   │
│  ║  │  • 交互式图表组件 (分类饼图下钻、趋势图)                        │ ║   │
│  ║  │  • 下钻过渡动画                                                 │ ║   │
│  ║  └─────────────────────────────────────────────────────────────────┘ ║   │
│  ║  ┌─────────────────────────────────────────────────────────────────┐ ║   │
│  ║  │ 用户体验设计 (第17章)                                           │ ║   │
│  ║  │  • Material Design 3 主题系统                                   │ ║   │
│  ║  │  • 动态色彩与深色模式                                           │ ║   │
│  ║  │  • 微交互动画                                                   │ ║   │
│  ║  │  • 手势操作优化                                                 │ ║   │
│  ║  └─────────────────────────────────────────────────────────────────┘ ║   │
│  ║  ┌─────────────────────────────────────────────────────────────────┐ ║   │
│  ║  │ 懒人设计原则 (第3章)                                           │ ║   │
│  ║  │  • 最少操作原则落地                                             │ ║   │
│  ║  │  • 智能默认值系统                                               │ ║   │
│  ║  │  • 单手操作优化                                                 │ ║   │
│  ║  │  • FeatureUsageWeightModel 操作效率模型                         │ ║   │
│  ║  └─────────────────────────────────────────────────────────────────┘ ║   │
│  ╚══════════════════════════════════════════════════════════════════════╝   │
│                                      ↓                                       │
│  ╔══════════════════════════════════════════════════════════════════════╗   │
│  ║  阶段六：伙伴化与情感设计 (RC-2)                                      ║   │
│  ╠══════════════════════════════════════════════════════════════════════╣   │
│  ║  ┌─────────────────────────────────────────────────────────────────┐ ║   │
│  ║  │ 伙伴化设计 (第4章)                                             │ ║   │
│  ║  │  • CompanionCopywritingService 伙伴化文案生成                   │ ║   │
│  ║  │  • 场景识别器 + 情感分析器                                      │ ║   │
│  ║  │  • 动态文案缓存池                                               │ ║   │
│  ║  │  • 情感化交互反馈                                               │ ║   │
│  ║  └─────────────────────────────────────────────────────────────────┘ ║   │
│  ║  ┌─────────────────────────────────────────────────────────────────┐ ║   │
│  ║  │ 无障碍设计 (第5章)                                             │ ║   │
│  ║  │  • SemanticLabelService 语义化标签                              │ ║   │
│  ║  │  • 屏幕阅读器完整支持                                           │ ║   │
│  ║  │  • 高对比度模式                                                 │ ║   │
│  ║  │  • 触控区域优化                                                 │ ║   │
│  ║  └─────────────────────────────────────────────────────────────────┘ ║   │
│  ║  ┌─────────────────────────────────────────────────────────────────┐ ║   │
│  ║  │ 国际化与本地化 (第18章)                                         │ ║   │
│  ║  │  • 多语言支持 (中/英/日/韩等)                                   │ ║   │
│  ║  │  • 货币格式本地化                                               │ ║   │
│  ║  │  • 日期时间本地化                                               │ ║   │
│  ║  └─────────────────────────────────────────────────────────────────┘ ║   │
│  ╚══════════════════════════════════════════════════════════════════════╝   │
│                                      ↓                                       │
│  ╔══════════════════════════════════════════════════════════════════════╗   │
│  ║  阶段七：质量保障与发布 (Release)                                     ║   │
│  ╠══════════════════════════════════════════════════════════════════════╣   │
│  ║  ┌─────────────────────────────────────────────────────────────────┐ ║   │
│  ║  │ 测试与质量 (第18-19章)                                          │ ║   │
│  ║  │  • 单元测试 (55%) + Widget测试 (25%)                            │ ║   │
│  ║  │  • 集成测试 (15%) + E2E测试 (5%)                                │ ║   │
│  ║  │  • 异常处理与容错设计验证                                       │ ║   │
│  ║  │  • 性能优化：图表渲染、列表虚拟化                               │ ║   │
│  ║  └─────────────────────────────────────────────────────────────────┘ ║   │
│  ║  ┌─────────────────────────────────────────────────────────────────┐ ║   │
│  ║  │ 安全与隐私 (第19章)                                             │ ║   │
│  ║  │  • 数据加密存储                                                 │ ║   │
│  ║  │  • 敏感数据脱敏                                                 │ ║   │
│  ║  │  • 权限最小化原则                                               │ ║   │
│  ║  └─────────────────────────────────────────────────────────────────┘ ║   │
│  ║  ┌─────────────────────────────────────────────────────────────────┐ ║   │
│  ║  │ 可观测性 (第22章)                                               │ ║   │
│  ║  │  • 日志采集与分析                                               │ ║   │
│  ║  │  • 性能监控指标                                                 │ ║   │
│  ║  │  • 错误追踪与告警                                               │ ║   │
│  ║  └─────────────────────────────────────────────────────────────────┘ ║   │
│  ║  ┌─────────────────────────────────────────────────────────────────┐ ║   │
│  ║  │ 版本迁移与发布 (第23章)                                         │ ║   │
│  ║  │  • 1.x → 2.0 数据迁移脚本                                       │ ║   │
│  ║  │  • 升级引导流程                                                 │ ║   │
│  ║  │  • 应用商店准备 (截图/描述/ASO)                                 │ ║   │
│  ║  │  • 灰度发布 (10% → 50% → 100%)                                  │ ║   │
│  ║  └─────────────────────────────────────────────────────────────────┘ ║   │
│  ╚══════════════════════════════════════════════════════════════════════╝   │
│                                                                              │
└──────────────────────────────────────────────────────────────────────────────┘
```

### 2.2 任务清单

> 💡 **并行开发说明**：以下任务按并行轨道组织，同一轨道内的任务可按顺序执行，不同轨道可同时开发。

> 📊 **进度统计**：轨道A ✅100% | 轨道B ✅100% | 轨道C ✅100% | 轨道D ✅100% | 轨道E ✅100% (33/33) | 轨道F ✅100% | 轨道G-1 ✅100% (12/12) | 轨道G ✅100% (57/57) | 轨道H ✅100% | 轨道I ✅100% | 轨道J ✅100% | 轨道K ✅100% | 轨道L ✅100% (20/20) | 轨道M ✅100% (6/6) | 轨道N ✅100% (5/5)

---

#### 第一阶段：基础架构 + 核心引擎

##### 并行轨道 A：数据层 (可立即启动) ✅ 已完成

**数据模型设计与实现**
- [x] 设计全新数据库 Schema (v15，含钱龄和小金库表)
- [x] 实现 ResourcePool 和 ResourceConsumption 数据模型
- [x] 实现 BudgetVault (小金库) 数据模型
- [x] 扩展 Transaction 模型，添加 vault_id、location_info、moneyAge 字段
- [x] ~~设计并实现数据模型版本兼容层~~ (无需，新建库)
- [x] 实现 Habit 习惯数据模型（第9章） *(models/habit.dart)*
- [x] 实现 Achievement 成就数据模型（第9章） *(models/achievement.dart)*
- [x] 实现 Location 位置数据模型（第14章） *(models/transaction_location.dart)*
- [x] 实现 ImportRecord 导入记录数据模型（第11章） *(models/import_batch.dart + import_candidate.dart)*
- [x] 实现 NPSSurvey NPS调查数据模型（第30章） *(models/nps_survey.dart)*
- [x] 实现 InviteCode 邀请码数据模型（第31章） *(models/invite_code.dart)*
- [x] 实现 Family/Member/Ledger 家庭账本数据模型（第13章） *(models/family.dart + member.dart + ledger.dart)*

##### 并行轨道 B：架构层 (可立即启动，与轨道A并行) ✅ 已完成

**架构升级**
- [x] 升级至 Riverpod 3.x Provider 架构 (已是3.1.0)
- [x] 重构所有 Provider 为 CrudNotifier 统一模式
- [x] 实现 OfflineQueueService 离线队列服务
- [x] 实现 AutoSyncService 自动同步服务
- [x] 实现冲突检测与解决策略 (Local-first时间戳策略)
- [x] 实现 CRDT 冲突解决算法（VectorClock + CrdtSyncService）
- [x] 实现 WebSocket 实时同步通道（WebSocketService）
- [x] 实现 CircuitBreaker 熔断器（容错机制）
- [x] ~~实现 gRPC 高性能通信层~~ (暂不需要，WebSocket已满足需求)

##### 并行轨道 C：钱龄系统 (依赖轨道A数据模型接口) ✅ 已完成

##### 并行轨道 D：零基预算系统 (依赖轨道A数据模型接口，与轨道C并行) ✅ 核心完成

---

#### 第二阶段：功能模块并行开发 (轨道A/B完成后启动)

##### 并行轨道 E：习惯培养模块

##### 并行轨道 F：AI智能模块 ✅ 已完成

##### 并行轨道 G：体验设计模块

##### 并行轨道 H：家庭账本模块

---

#### 第三阶段：体验打磨 + 质量保障 (与第二阶段后期并行)

##### 并行轨道 I：情感化设计

##### 并行轨道 J：无障碍设计

##### 并行轨道 K：国际化

##### 并行轨道 L：测试与质量保障

##### 并行轨道 M：高可用架构增强 (10万DAU支撑)

##### 并行轨道 N：用户体系与权限 (全免费策略)

---

### 2.2.1 详细任务清单（按功能模块）

以下为完整任务清单，可根据并行轨道安排进行分配：

#### 钱龄系统 (轨道C) ✅ 已完成 (13/13)

- [x] 实现 MoneyAgeCalculator 钱龄计算引擎 *(services/money_age_calculator.dart)*
- [x] 实现 FIFO/LIFO/加权平均 消费顺序策略 *(money_age_calculator.dart - ConsumptionStrategy)*
- [x] 实现 MoneyAgeRebuildService 历史数据钱龄重建服务 *(services/money_age_rebuild_service.dart)*
- [x] 实现 MoneyAgeTrendService 钱龄趋势分析与预测 *(services/money_age_trend_service.dart)*
- [x] 实现 MoneyAgeDashboardCard 钱龄仪表盘卡片组件 *(widgets/money_age_dashboard_card.dart)*
- [x] 实现 MoneyAgeTrendChart 钱龄趋势图组件 *(widgets/money_age_trend_chart.dart)*
- [x] 实现 ResourcePoolManager 资源池管理器（第7.3节）*(services/resource_pool_manager.dart)*
- [x] 实现 MoneyAgeLevelService 健康等级判定服务（第7.2节）*(services/money_age_level_service.dart)*
- [x] 实现 MoneyAgeInfluenceAnalysis 钱龄影响因素分析组件（第7.5节）*(widgets/money_age_influence_analysis.dart)*
- [x] 实现 ResourcePool 资源池数据模型 *(models/resource_pool.dart)*
- [x] 实现钱龄增量计算优化（脏数据标记机制）（第7.3节）*(resource_pool_manager.dart)*
- [x] 实现 SmartMoneyAgeService 钱龄预测与建议服务（第7.6节）*(services/smart_money_age_service.dart)*
- [x] 实现钱龄阶段进度展示组件（第7.4节）*(money_age_dashboard_card.dart)*

> **已完成文件** (9个服务/组件文件)：
> - `services/money_age_calculator.dart` - 钱龄计算引擎（FIFO/LIFO/加权平均策略）
> - `services/resource_pool_manager.dart` - 资源池管理器（增量计算/脏标记优化）
> - `services/money_age_trend_service.dart` - 趋势分析与预测服务
> - `services/smart_money_age_service.dart` - 智能钱龄预测与建议
> - `services/money_age_level_service.dart` - 健康等级判定服务
> - `services/money_age_rebuild_service.dart` - 历史数据重建服务
> - `widgets/money_age_dashboard_card.dart` - 仪表盘卡片组件
> - `widgets/money_age_trend_chart.dart` - 趋势图组件
> - `widgets/money_age_influence_analysis.dart` - 影响因素分析组件
> - `models/resource_pool.dart` - 资源池数据模型

#### 零基预算系统 (轨道D) ✅ 已完成 (21/21)

**第1-2层：基础服务与分配服务**
- [x] 实现 AllocationService 预算分配服务 *(services/allocation_service.dart)*
- [x] 实现智能分配建议算法 *(getSuggestions/autoAllocate)*
- [x] 实现小金库 CRUD 完整功能 *(services/vault_repository.dart)*
- [x] 实现交易-小金库自动关联逻辑 *(services/transaction_vault_linker.dart)*
- [x] 实现预算结转与周期管理 *(services/budget_carryover_service.dart)*
- [x] 实现预算超支实时预警服务 *(services/budget_alert_service.dart)*
- [x] 实现多种预算分配策略（固定/百分比/补齐/剩余）*(allocation_service.dart)*

**第3层：预算建议服务**
- [x] 实现 SmartBudgetService 基于历史消费的预算建议 *(services/smart_budget_service.dart)*
- [x] 实现 LocalizedBudgetCategoryService 城市级预算类目推荐 *(services/localized_budget_service.dart)*
- [x] 实现 LocalizedBudgetAmountService 城市消费水平金额建议 *(services/localized_budget_service.dart)*
- [x] 实现 BudgetPlanningCoordinator 预算规划协调器 *(services/budget_planning_coordinator.dart)*

**第4层：位置增强服务**
- [x] 实现 LocationAwareZeroBudgetService 位置感知预算服务 *(services/budget_planning_coordinator.dart)*
- [x] 实现 LocationBudgetReminder 地理围栏预算提醒 *(services/location_budget_reminder.dart)*

**第5层：协作扩展服务**
- [x] 实现 FamilyBudgetService 家庭共享预算管理 *(services/family_budget_service.dart)*
- [x] 实现 VoiceBudgetQueryService 语音预算查询服务 *(services/voice_budget_query_service.dart)*
- [x] 实现 SelfLearningBudgetService 自学习预算优化 *(services/self_learning_budget_service.dart)*

**系统集成**
- [x] 实现预算执行与钱龄变化联动 *(services/budget_money_age_integration.dart)*
- [x] 实现低余额触发冲动消费拦截 *(services/impulse_spending_interceptor.dart)*
- [x] 实现预算与习惯系统集成 *(services/budget_habit_integration.dart)*
- [x] 实现 BudgetDistributionEngine 预算分配引擎 *(services/budget_distribution_engine.dart)*

**UI页面**
- [x] 实现小金库概览页 *(pages/vault_overview_page.dart)*
- [x] 实现资金分配页 *(pages/allocation_page.dart)*

> **已完成文件** (18个服务 + 2个页面)：
> - `services/allocation_service.dart` - 核心分配服务
> - `services/vault_repository.dart` - 数据仓储
> - `services/transaction_vault_linker.dart` - 交易关联
> - `services/budget_carryover_service.dart` - 结转管理
> - `services/budget_alert_service.dart` - 预警服务
> - `services/smart_budget_service.dart` - 智能建议
> - `services/localized_budget_service.dart` - 本地化建议
> - `services/budget_money_age_integration.dart` - 钱龄联动
> - `services/impulse_spending_interceptor.dart` - 冲动消费拦截
> - `services/budget_planning_coordinator.dart` - 规划协调器
> - `services/budget_habit_integration.dart` - 习惯系统集成
> - `services/location_budget_reminder.dart` - 位置提醒
> - `services/budget_distribution_engine.dart` - 分配引擎
> - `services/family_budget_service.dart` - 家庭预算
> - `services/voice_budget_query_service.dart` - 语音查询
> - `services/self_learning_budget_service.dart` - 自学习服务
> - `pages/vault_overview_page.dart` - 概览页面
> - `pages/allocation_page.dart` - 分配页面

#### 习惯培养模块 (轨道E) ✅ 已完成 (33/33)

**消费审视系统**
- [x] 实现 SubscriptionTrackingService 订阅追踪服务
- [x] 实现订阅浪费检测与提醒（含在SubscriptionTrackingService中）
- [x] 实现 LatteFactorAnalyzer 拿铁因子分析
- [x] 实现 ActionableInsightService 可操作洞察服务
- [x] 实现 OperationGuide 操作指南生成（含在ActionableInsightService中）
- [x] 实现 GuideLifecycleManager 指南生命周期管理

**冲动消费防护**
- [x] 实现 ImpulseControlService 冲动消费干预服务（ImpulseSpendingInterceptor）
- [x] 实现 CoolingOffPeriodService 冷静期服务
- [x] 实现 SpendingPlanningService 先规划再消费引导
- [x] 实现 WishListService 愿望清单管理
- [x] 实现 MonthlyPlanningCard 月度规划卡片

**财务缓冲建立**
- [x] 实现 FinancialBufferService 应急金管理服务
- [x] 实现应急金目标设定与进度追踪（含在FinancialBufferService中）
- [x] 实现 DebtHealthService 债务健康管理服务
- [x] 实现 DebtSnowballService 债务雪球还款计划（含在DebtHealthService中）
- [x] 实现 DebtHealthCard 债务健康卡片

**弹性激励系统**
- [x] 实现 AdaptiveBudgetService 弹性预算调整服务
- [x] 实现 InclusiveMotivationService 包容性记账激励
- [x] 实现 FlexibleRecordingGoal 弹性记账目标（含在InclusiveMotivationService中）
- [x] 实现 BreakRecoveryAssistant 中断恢复助手
- [x] 实现 SocialComparisonService 社会认同参照服务
- [x] 实现 PeerComparisonCard 同类用户对比卡片
- [x] 实现 FinancialCommitmentService 承诺一致机制
- [x] 实现 CommitmentCreationWizard 承诺创建向导
- [x] 实现 CommitmentProgressCard 承诺进度卡片
- [x] 实现 WantsVsNeedsClassifier "想要"与"需要"分类服务（第9.2节）
- [x] 实现实时预算可视化组件（余额/进度展示）（第9.3节）
- [x] 实现消费前确认弹窗组件（第9.3节）
- [x] 实现 MoneyAgeProgressionService 钱龄进阶目标管理（第9.4节）
- [x] 实现 ConsecutiveRecordingRewardService 连续记账奖励（GamificationService）
- [x] 实现 FinancialHealthScoreService 财务健康分计算（第9.6节）
- [x] 实现 EmergencyExpenseHandler 突发支出处理流程（第9.5节）
- [x] 实现 VariableIncomeAdapter 收入不稳定适配（第9.5节）

> **已完成文件** (21个服务 + 7个UI组件)：
> - `services/subscription_tracking_service.dart` - 订阅追踪服务
> - `services/latte_factor_analyzer.dart` - 拿铁因子分析
> - `services/impulse_spending_interceptor.dart` - 冲动消费拦截（已增强）
> - `services/cooling_off_service.dart` - 冷静期服务
> - `services/wish_list_service.dart` - 愿望清单管理
> - `services/financial_buffer_service.dart` - 应急金管理
> - `services/debt_health_service.dart` - 债务健康管理
> - `services/gamification_service.dart` - 游戏化激励系统
> - `services/actionable_insight_service.dart` - 可操作洞察服务（含操作指南）
> - `services/spending_planning_service.dart` - 消费规划服务
> - `services/financial_commitment_service.dart` - 承诺一致机制
> - `services/wants_vs_needs_classifier.dart` - 想要与需要分类
> - `services/break_recovery_assistant.dart` - 中断恢复助手
> - `services/variable_income_adapter.dart` - 收入不稳定适配
> - `services/adaptive_budget_service.dart` - 弹性预算调整
> - `services/social_comparison_service.dart` - 社会认同参照
> - `services/inclusive_motivation_service.dart` - 包容性记账激励
> - `services/money_age_progression_service.dart` - 钱龄进阶目标管理
> - `services/emergency_expense_handler.dart` - 突发支出处理
> - `services/financial_health_score_service.dart` - 财务健康评分
> - `services/guide_lifecycle_manager.dart` - 指南生命周期管理
> - `widgets/expense_confirmation_dialog.dart` - 消费确认弹窗
> - `widgets/budget_status_bar.dart` - 实时预算可视化组件
> - `widgets/peer_comparison_card.dart` - 同类用户对比卡片
> - `widgets/commitment_progress_card.dart` - 承诺进度卡片
> - `widgets/commitment_creation_wizard.dart` - 承诺创建向导
> - `widgets/debt_health_card.dart` - 债务健康卡片
> - `widgets/monthly_planning_card.dart` - 月度规划卡片

#### AI智能模块 (轨道F) ✅ 已完成 (45/45)

**AI识别系统**
- [x] 实现 VoiceRecognitionEngine 实时语音识别 *(services/voice_recognition_engine.dart)*
- [x] 实现 NLUEngine 自然语言理解服务 *(services/nlu_engine.dart)*
- [x] 实现多模态输入统一处理（语音/图片/文本）*(services/multimodal_input_service.dart)*
- [x] 优化语音识别准确率与响应速度（BookkeepingASROptimizer）
- [x] 实现图像OCR票据识别增强 *(services/multimodal_input_service.dart - OCRService)*
- [x] 实现 VoiceNavigationService 语音页面导航服务（145页/16模块）*(services/voice_navigation_service.dart)*

**智能化技术方案**
- [x] 端侧AI模型评估与选型（LocalWhisperService + LocalMLService）
- [x] 实现离线智能分类功能 *(services/smart_category_service.dart - LocalMLService)*
- [x] 实现用户行为学习与预测 *(services/user_profile_service.dart)*
- [x] 隐私保护联邦学习方案设计（本地模型优先策略）

**地理位置智能化**
- [x] 实现 LocationService 位置服务抽象层 *(services/location_service.dart)*
- [x] 实现 PreciseLocationService GPS高精度定位 *(services/location_service.dart)*
- [x] 实现 CityLocationService 城市级定位 *(services/location_service.dart)*
- [x] 实现 CrossRegionSpendingService 异地消费检测 *(services/location_service.dart)*
- [x] 实现 GeofenceAlertService 地理围栏提醒 *(services/location_service.dart)*
- [x] 实现 UserHomeLocationService 用户常驻位置服务 *(services/location_service.dart)*
- [x] 实现 SpendingContextAnalyzer 消费场景分析 *(services/location_service.dart)*

**智能分类与反馈学习（第16章）**
- [x] 实现 SmartCategoryService 四层递进智能分类服务（第16.2节）*(services/smart_category_service.dart)*
- [x] 实现本地TFLite分类模型（第16.2节）*(LocalMLService)*
- [x] 实现 FeedbackLearningService 反馈学习闭环服务（第16.2节）*(services/feedback_learning_service.dart)*
- [x] 实现 IncrementalLearningScheduler 增量学习调度器（第16.2节）*(services/feedback_learning_service.dart)*
- [x] 实现智能分类准确率监控机制（第16.2节）*(feedback_learning_service.dart)*

**多模态与上下文（第10章）**
- [x] 实现 UnifiedRecognitionService 多模态输入统一入口服务（第10.2节）*(services/multimodal_input_service.dart)*
- [x] 实现 InputPreprocessor 输入预处理器（降噪/VAD/裁剪/增强）（第10.2节）*(services/multimodal_input_service.dart)*
- [x] 实现 ReceiptParser 票据解析服务（第10.6节）*(services/multimodal_input_service.dart)*
- [x] 实现 ScreenshotParser 截图解析服务（第10.6节）*(services/multimodal_input_service.dart)*
- [x] 实现 ContextManager 会话上下文管理服务（第10.7节）*(services/nlu_engine.dart)*
- [x] 实现上下文补全服务（第10.7节）*(nlu_engine.dart - ContextManager)*
- [x] 实现 ConfidenceEvaluator 识别置信度评估（第10.9节）*(multimodal_input_service.dart)*
- [x] 实现 UserProfileService 用户画像分析服务（第17章）*(services/user_profile_service.dart)*

**用户画像分析（第17章）**
- [x] 实现 UserProfile 用户画像数据模型 *(services/user_profile_service.dart)*
- [x] 实现 UserProfileAnalyzer 用户画像分析器 *(services/user_profile_service.dart)*

**智能分析与预测服务（新增）**
- [x] 实现 SplitBillService AA制分摊处理服务（第16.4节）*(services/split_bill_service.dart)*
- [x] 实现 AnomalyDetectionService 智能异常检测服务（第16.5节）*(services/anomaly_detection_service.dart)*
- [x] 实现 TrendPredictionService 消费趋势预测服务（第16.5节）*(services/trend_prediction_service.dart)*
- [x] 实现 LocationAwareMoneyAgeService 位置感知钱龄服务（第14.7节）*(services/location_aware_money_age_service.dart)*
- [x] 实现 NaturalLanguageSearchService 自然语言搜索服务（第16.6节）*(services/nl_search_service.dart)*
- [x] 实现 DialogManagerService 对话式记账助手（第16.7节）*(services/dialog_manager_service.dart)*
- [x] 实现 CollaborativeLearningService 协同学习服务（第17章）*(services/collaborative_learning_service.dart)*
- [x] 实现 TTSService 文字转语音服务（第10章）*(services/tts_service.dart)*

**P0核心增强（2025-01新增）**
- [x] 实现 OfflineASRService 离线语音识别服务（Sherpa-ONNX本地引擎）*(services/offline_asr_service.dart)*
- [x] 实现 DialogContextPersistenceService 对话上下文持久化服务（会话恢复/跨会话学习）*(services/dialog_context_persistence_service.dart)*
- [x] 实现 GeofenceBackgroundService 系统级地理围栏后台服务（Android/iOS原生集成）*(services/geofence_background_service.dart)*
- [x] 实现 RealCollaborativeApiClient 协同学习真实API客户端（重试/缓存/认证）*(services/collaborative_learning_api_client.dart)*
- [x] 实现 UserProfileApplicationService 用户画像实时应用服务（UI个性化/推荐/默认值）*(services/user_profile_application_service.dart)*

> **已完成文件** (20个服务文件)：
> - `services/voice_recognition_engine.dart` - 语音识别引擎（在线阿里云ASR + 离线Whisper）
> - `services/nlu_engine.dart` - NLU自然语言理解引擎（意图分类/实体提取/上下文管理）
> - `services/location_service.dart` - 位置服务体系（精确定位/城市定位/异地检测/围栏告警）
> - `services/smart_category_service.dart` - 智能分类服务（四层策略：商家历史→关键词→本地ML→LLM）
> - `services/multimodal_input_service.dart` - 多模态输入服务（语音/图像/文本统一处理）
> - `services/feedback_learning_service.dart` - 反馈学习服务（增量学习/商家映射/关键词学习）
> - `services/user_profile_service.dart` - 用户画像服务（行为分析/消费特征/个性推断）
> - `services/split_bill_service.dart` - AA分摊服务（AA检测/人数提取/多种分摊模式）
> - `services/anomaly_detection_service.dart` - 异常检测服务（金额/时间/频率/重复检测）
> - `services/trend_prediction_service.dart` - 趋势预测服务（SMA/WMA/季节性调整）
> - `services/location_aware_money_age_service.dart` - 位置感知钱龄服务（日常/临时消费分离）
> - `services/nl_search_service.dart` - 自然语言搜索服务（本地规则+LLM理解）
> - `services/dialog_manager_service.dart` - 对话管理服务（多轮对话/槽位填充）
> - `services/collaborative_learning_service.dart` - 协同学习服务（脱敏上报/规则融合）
> - `services/tts_service.dart` - TTS服务（文字转语音/语音播报）
> - `services/offline_asr_service.dart` - 离线ASR服务（Sherpa-ONNX引擎/模型管理/VAD）
> - `services/dialog_context_persistence_service.dart` - 对话上下文持久化（会话恢复/跨会话学习/偏好提取）
> - `services/geofence_background_service.dart` - 地理围栏后台服务（系统级API/原生通道/商家围栏）
> - `services/collaborative_learning_api_client.dart` - 协同学习API客户端（HTTP/重试/缓存/认证）
> - `services/user_profile_application_service.dart` - 用户画像应用服务（UI个性化/智能推荐/默认值填充）

#### 数据导入导出模块 (轨道G-1) ✅ 已完成 (12/12)

**数据源解析器（第11.2节）**
- [x] 实现 ImportRecord 导入记录数据模型（第11章） *(models/import_batch.dart + import_candidate.dart)*
- [x] 验证/增强 WechatBillParser 微信账单解析器 *(services/import/wechat_bill_parser.dart - 已验证完善)*
- [x] 验证/增强 AlipayBillParser 支付宝账单解析器 *(services/import/alipay_bill_parser.dart - 已验证完善)*
- [x] 验证/增强 GenericBankParser 通用银行流水解析器 *(services/import/generic_bank_parser.dart - 已验证完善)*
- [x] 实现 BillFormatDetector 智能格式检测服务 *(services/import/bill_format_detector.dart - 已验证完善)*

**三层去重机制（第11.3节）**
- [x] 验证/增强 DuplicateScorer 重复评分服务（精确匹配→特征匹配→语义匹配）*(services/import/enhanced_duplicate_scorer.dart - 三层去重/AI语义匹配)*
- [x] 实现去重置信度可视化展示（100%/80-99%/60-79%分级标记） *(widgets/import/duplicate_confidence_widget.dart)*
- [x] 实现多因子综合评分（位置辅助/家庭交叉验证） *(enhanced_duplicate_scorer.dart - 位置匹配/家庭交叉验证)*

**批量导入服务（第11.4节）**
- [x] 验证/增强 BatchImportService 批量导入服务 *(services/import/batch_import_service.dart - 已验证完善)*
- [x] 实现导入进度可视化UI组件（进度条/预估时间/取消功能） *(widgets/import/import_progress_widget.dart)*
- [x] 实现导入后钱龄自动重算触发 *(services/import/import_money_age_integration.dart)*
- [x] 实现家庭成员导入分配功能（导入时指定归属成员） *(services/import/family_import_assignment_service.dart)*

> **已完成文件**：
> - `services/import_service.dart` - 导入服务主入口
> - `services/export_service.dart` - 导出服务
> - `services/import/batch_import_service.dart` - 批量导入服务
> - `services/import/bill_format_detector.dart` - 账单格式检测
> - `services/import/duplicate_scorer.dart` - 重复评分
> - `services/import/wechat_bill_parser.dart` - 微信账单解析
> - `services/import/alipay_bill_parser.dart` - 支付宝账单解析
> - `services/import/generic_bank_parser.dart` - 通用银行解析
> - `services/duplicate_detection_service.dart` - 重复检测服务

#### 体验设计模块 (轨道G) ✅ 已完成 (57/57)

**数据联动与可视化**
- [x] 实现 DrillDownNavigationService 数据下钻导航服务 *(services/drill_down_navigation_service.dart - 含下钻维度/路径/事件/历史)*
- [x] 实现 BreadcrumbStateManager 面包屑状态管理 *(services/breadcrumb_state_manager.dart - 含多种显示样式/自适应折叠)*
- [x] 实现交互式分类饼图（支持下钻） *(widgets/interactive_pie_chart.dart - 含点击/长按/选中动画/触觉反馈)*
- [x] 实现趋势图交互组件 *(widgets/interactive_trend_chart.dart - 多系列/平滑曲线/触摸交互/数据点高亮)*
- [x] 实现下钻过渡动画效果 *(widgets/drill_down_transition.dart - 缩放/淡入/滑动/涟漪/饼图展开)*

**用户体验设计**
- [x] 实现 Material Design 3 完整主题系统 *(services/md3_theme_service.dart - 含完整ThemeData/ColorScheme/文字主题)*
- [x] 实现动态色彩生成与应用 *(md3_theme_service.dart - ColorScheme.fromSeed动态生成)*
- [x] 实现深色模式完整适配 *(md3_theme_service.dart - generateDarkTheme方法)*
- [x] 实现微交互动画库 *(services/micro_animation_service.dart - 缩放/弹跳/脉冲/心跳/勾选动画)*
- [x] 优化手势操作体验 *(services/gesture_enhancement_service.dart - 手势管理/触觉反馈/边缘滑动返回)*

**懒人设计原则落地**
- [x] 实现最少操作原则相关优化 *(gesture_enhancement_service.dart - EnhancedTouchTarget/触摸目标优化)*
- [x] 实现智能默认值系统 *(services/smart_default_service.dart - 最近/最频繁/时间段/位置推荐)*
- [x] 优化单手操作体验 *(gesture_enhancement_service.dart - OneHandReachWrapper/舒适区域计算/FAB位置推荐)*
- [x] 实现 FeatureUsageWeightModel 操作效率模型 *(services/feature_usage_weight_model.dart - 频率/最近/完成率/效率权重)*
- [x] 实现渐进式复杂度功能展示 *(feature_usage_weight_model.dart - ProgressiveDisclosureService/新手引导/功能解锁)*

**数据联动增强（第12章）**
- [x] 实现 DrillDownStackManager 下钻栈管理服务（第12.5节） *(drill_down_navigation_service.dart含栈管理)*
- [x] 实现消费热力图组件（按时段/日期展示）（第12.2节） *(widgets/consumption_heatmap.dart - 颜色映射/点击交互/图例)*
- [x] 实现跨页面筛选条件状态保持服务（第12.4节） *(services/filter_state_service.dart - 多类型筛选/页面共享)*
- [x] 实现 DataChangeListener 数据变更实时监听服务（第12.6节） *(services/data_change_listener_service.dart - 批量合并/防抖)*
- [x] 实现可视化组件增量刷新策略（第12.6节） *(services/incremental_refresh_service.dart - 优先级调度/批量合并/并发控制)*
- [x] 实现图表截图与分享功能（第12.8节） *(services/chart_share_service.dart - 截图/水印/多平台分享)*
- [x] 实现家庭成员消费对比可视化组件（第12.2节） *(widgets/family_comparison_chart.dart - 柱状图/环形图/雷达图/堆叠图)*
- [x] 实现位置消费地理热力图组件（第12.2节） *(widgets/location_spending_heatmap.dart - 热力渐变/缩放平移/位置标记)*
- [x] 实现习惯打卡日历热力图组件（第12.2节） *(widgets/habit_calendar_heatmap.dart - GitHub风格/连续天数/完成度颜色)*
- [x] 实现语音下钻指令与可视化系统集成（第12.7节） *(services/voice_drill_down_service.dart - 指令解析/别名映射/上下文理解)*

> **已完成文件** (12个服务/组件文件)：
> - `services/drill_down_navigation_service.dart` - 数据下钻导航服务
> - `services/breadcrumb_state_manager.dart` - 面包屑状态管理
> - `services/md3_theme_service.dart` - Material Design 3 主题系统
> - `services/micro_animation_service.dart` - 微交互动画库
> - `services/smart_default_service.dart` - 智能默认值系统
> - `services/gesture_enhancement_service.dart` - 手势增强与单手操作优化
> - `services/feature_usage_weight_model.dart` - 操作效率模型与渐进式复杂度
> - `services/filter_state_service.dart` - 跨页面筛选状态
> - `services/data_change_listener_service.dart` - 数据变更监听
> - `services/incremental_refresh_service.dart` - 可视化组件增量刷新
> - `services/chart_share_service.dart` - 图表截图与分享
> - `services/voice_drill_down_service.dart` - 语音下钻指令解析
> - `widgets/interactive_pie_chart.dart` - 交互式饼图
> - `widgets/interactive_trend_chart.dart` - 交互式趋势图
> - `widgets/drill_down_transition.dart` - 下钻过渡动画
> - `widgets/consumption_heatmap.dart` - 消费热力图
> - `widgets/family_comparison_chart.dart` - 家庭成员消费对比图
> - `widgets/location_spending_heatmap.dart` - 位置消费地理热力图
> - `widgets/habit_calendar_heatmap.dart` - 习惯打卡日历热力图

**反重力设计体系（第20.2.6节）** ✅ 已完成 (17/17)

*布局反重力*
- [x] 实现 AntigravityBottomSheet 多级底部弹窗组件（支持25%/50%/90%高度吸附） *(widgets/glass_components.dart - AntigravityBottomSheet.mini/half/full)*
- [x] 实现底部导航栏替代顶部Tab导航布局 *(widgets/glass_components.dart - GlassBottomNavigation)*
- [x] 实现 FAB 展开菜单组件（扇形展开动画） *(widgets/antigravity_animations.dart - FabExpandAnimation)*
- [x] 实现表单底部确认按钮固定组件 StickyBottomBar *(widgets/antigravity_layout.dart - StickyBottomBar)*
- [x] 优化分类选择为底部半屏弹窗模式 *(pages/add_transaction_page.dart - 已使用底部弹窗)*

*视觉反重力*
- [x] 实现 FloatingCard 悬浮卡片组件（L0-L5层级阴影系统） *(theme/antigravity_shadows.dart + widgets/glass_components.dart - FloatingCard)*
- [x] 实现玻璃态效果 Glassmorphism 组件（毛玻璃背景模糊） *(widgets/glass_components.dart - GlassCard/GlassFab)*
- [x] 实现层叠卡片组交互组件 StackedCards *(widgets/glass_components.dart - StackedCards)*
- [x] 实现浮岛式布局容器 FloatingIslandLayout *(widgets/antigravity_layout.dart - FloatingIslandLayout/FloatingIsland)*

*动效反重力*
- [x] 实现 FloatingAnimationMixin 悬浮动画控制器（失重状态浮动效果） *(widgets/antigravity_layout.dart - FloatingAnimationMixin)*
- [x] 实现记账成功金额上飘动画 AmountFloatUpAnimation *(widgets/antigravity_animations.dart - AmountFloatUpAnimation)*
- [x] 实现列表新增项从底部升入动画 ListItemRiseAnimation *(widgets/antigravity_animations.dart - ListRiseUpAnimation)*
- [x] 实现气泡粒子上升效果 BubbleRiseEffect *(widgets/antigravity_layout.dart - BubbleRiseEffect)*
- [x] 应用弹性缓动曲线（easeOutBack/elasticOut）到全局动画 *(widgets/antigravity_animations.dart - AntigravityCurves)*

*反重力设计审查*
- [x] 审查核心操作是否在拇指热区（下半屏45%） *(widgets/antigravity_layout.dart - ThumbZoneContainer)*
- [x] 审查是否使用底部弹窗替代全屏跳转 *(已全局应用)*
- [x] 审查动画方向是否符合反重力原则（向上为主） *(所有动画均向上)*

> **已完成文件** (4个组件文件)：
> - `theme/antigravity_shadows.dart` - 反重力阴影系统（L0-L5六级悬浮层级）
> - `widgets/antigravity_animations.dart` - 反重力动画组件（金额上飘/列表上升/Toast升起/悬浮呼吸/成功打勾/FAB展开/摇晃警告）
> - `widgets/antigravity_layout.dart` - 反重力布局组件（StickyBottomBar/FloatingIsland/BubbleRise/ThumbZone）
> - `widgets/glass_components.dart` - 玻璃态效果组件（GlassCard/GlassBottomNav/GlassFab/FloatingCard/StackedCards/BottomSheet/Toast）

**交互体验设计（第21章）** ✅ 已完成 (4/4)
- [x] 验证语音交互状态视觉反馈完整性（待唤醒/聆听中/处理中/成功/失败） *(widgets/voice_interaction_state_widget.dart - VoiceInteractionState枚举/状态动画)*
- [x] 验证UX设计系统与钱龄/预算/习惯模块的视觉一致性 *(已验证 - 使用统一MD3主题)*
- [x] 实现离线状态下的交互反馈优化 *(widgets/voice_interaction_state_widget.dart - OfflineStatusWidget)*
- [x] 验证错误状态的用户引导流程 *(widgets/voice_interaction_state_widget.dart - ErrorGuidanceWidget/错误分类引导)*

**个性化与社交设计（第22章）** ✅ 已完成 (6/6)
- [x] 实现主题色自定义选择器（6预设 + 自定义颜色） *(widgets/theme_color_picker.dart - HSL滑块/预览效果)*
- [x] 实现首页卡片自定义布局（显示/隐藏/排序） *(widgets/home_card_customizer.dart - HomeCardCustomizer/拖拽排序)*
- [x] 实现常用分类置顶与隐藏功能 *(widgets/home_card_customizer.dart - CategoryPinManager)*
- [x] 实现 PersonalizationSettingsService 个性化设置持久化服务 *(services/personalization_settings_service.dart)*
- [x] 实现快捷操作自定义（语音/拍照/模板入口） *(widgets/home_card_customizer.dart - QuickActionCustomizer)*
- [x] 实现智能个性化学习（分类排序/金额建议/时间建议） *(personalization_settings_service.dart - 置顶/隐藏/密度设置)*

**记账体验优化（第23章）** ✅ 已完成 (5/5)
- [x] 实现准确率成长曲线可视化展示（70%→95%成长路径） *(services/accuracy_growth_service.dart + widgets/accuracy_growth_widget.dart)*
- [x] 实现场景化耗时统计与展示（语音/拍照/手动各场景） *(services/scenario_timing_service.dart + widgets/scenario_timing_widget.dart)*
- [x] 验证零配置开始的新用户流程完整性 *(已验证 - 智能默认值系统支持)*
- [x] 实现识别结果快速微调交互优化 *(widgets/recognition_quick_adjust_widget.dart - 置信度展示/分类切换/金额微调)*
- [x] 实现多笔拆分记账的批量确认体验 *(widgets/batch_transaction_confirm_widget.dart - 批量选择/滑动删除/金额编辑)*

> **第21-23章已完成文件** (10个组件/服务文件)：
> - `widgets/voice_interaction_state_widget.dart` - 语音交互状态组件（5种状态/音波动画/离线提示/错误引导）
> - `services/personalization_settings_service.dart` - 个性化设置服务（主题色/卡片布局/快捷操作/分类管理）
> - `widgets/theme_color_picker.dart` - 主题色选择器（6预设/HSL自定义/实时预览）
> - `widgets/home_card_customizer.dart` - 首页卡片自定义（拖拽排序/可见性切换/分类管理/快捷操作）
> - `services/accuracy_growth_service.dart` - 准确率成长服务（记录追踪/周趋势/里程碑/分场景统计）
> - `services/scenario_timing_service.dart` - 场景耗时服务（计时/统计/对比/建议）
> - `widgets/accuracy_growth_widget.dart` - 准确率成长曲线组件（图表/阶段/预测/里程碑庆祝）
> - `widgets/scenario_timing_widget.dart` - 场景耗时展示组件（对比图/周趋势/建议）
> - `widgets/recognition_quick_adjust_widget.dart` - 识别结果快速微调组件（置信度/分类切换/金额调整）
> - `widgets/batch_transaction_confirm_widget.dart` - 批量交易确认组件（多选/滑动删除/分类编辑/金额编辑）

#### 家庭账本模块 (轨道H) ✅ 已完成 (24/24)
- [x] 实现 Ledger 账本数据模型（个人/家庭/情侣/群组/专项） *(models/ledger.dart - LedgerType枚举含personal/family/couple/group/special)*
- [x] 实现 LedgerService 账本管理服务 *(providers/ledger_provider.dart - 含CRUD与权限管理)*
- [x] 实现 MemberService 成员管理服务 *(models/member.dart - 含Member模型与角色定义)*
- [x] 实现邀请码生成与验证机制 *(models/invite_code.dart + services/qr_invite_service.dart)*
- [x] 实现二维码邀请功能 *(services/qr_invite_service.dart - 含语音邀请码支持)*
- [x] 实现成员角色权限系统（所有者/管理员/成员/只读） *(models/member.dart - MemberRole枚举owner/admin/editor/viewer)*
- [x] 实现家庭预算分配与配额管理 *(services/family_budget_service.dart)*
- [x] 实现 SplitService AA分摊服务 *(services/split_service.dart)*
- [x] 实现多种分摊策略（均摊/按比例/自定义） *(services/split_service.dart - SplitStrategy枚举)*
- [x] 实现分摊结算与提醒功能 *(services/split_service.dart - settleExpenseSplit方法)*
- [x] 实现家庭账本同步服务 (FamilyLedgerSyncService) *(services/family_ledger_sync_service.dart - 含CRDT向量时钟)*
- [x] 实现账本切换与数据隔离 *(providers/ledger_context_provider.dart - switchLedger方法)*
- [x] 实现家庭成员贡献分析 *(services/family_dashboard_service.dart - getMemberContribution)*
- [x] 实现家庭报表与趋势分析 *(services/family_report_service.dart - 含月报/对比分析)*
- [x] 实现隐私可见性控制（账目对成员的可见性） *(services/family_privacy_service.dart + models/privacy_settings.dart)*
- [x] 实现 FamilySavingsGoalService 家庭共同储蓄目标（第13.6节） *(services/family_savings_goal_service.dart)*
- [x] 实现 FamilyLeaderboardService 家庭排行榜与激励（第13.6节） *(services/family_leaderboard_service.dart)*
- [x] 实现 FamilyConflictResolver 家庭数据冲突解决（第13.7节） *(services/family_conflict_resolver.dart - 含LWW/合并策略)*
- [x] 实现 FamilyPrivacyService 家庭账本隐私控制（第13.8节） *(services/family_privacy_service.dart)*
- [x] 实现 LedgerContextProvider 统一账本上下文（第13.9节） *(providers/ledger_context_provider.dart)*
- [x] 实现家庭账本语音查询功能（"家庭支出多少"）（第13.9节） *(services/voice_budget_query_service.dart)*
- [x] 实现家庭成员位置共享消费（第13.9节） *(services/location_service.dart + models/transaction_location.dart)*
- [x] 实现家庭裂变邀请激励机制（第13.9节） *(services/qr_invite_service.dart - InviteRewardConfig)*
- [x] 实现家庭账本无障碍支持（第13.9节） *(services/accessibility/)*

#### 情感化设计模块 (轨道I) ✅ 已完成 (12/12)

**伙伴化设计**
- [x] 实现 CompanionCopywritingService 伙伴化文案生成服务 *(services/companion_copywriting_service.dart)*
- [x] 实现场景识别器 *(companion_copywriting_service.dart - SceneRecognizer)*
- [x] 实现情感分析器 *(companion_copywriting_service.dart - EmotionAnalyzer)*
- [x] 实现动态文案缓存池 *(companion_copywriting_service.dart - CopywritingCachePool)*
- [x] 实现情感化交互反馈系统 *(services/companion_integration_service.dart)*
- [x] 预生成文案库（支持离线使用）*(companion_copywriting_service.dart - PreGeneratedCopyLibrary)*
- [x] 实现 CompanionEventBus 伙伴化触发事件总线（第4.8节）*(services/companion_event_bus.dart)*
- [x] 实现伙伴化消息频率控制服务（每日≤3条）（第4.6节）*(companion_event_bus.dart - MessageFrequencyController)*
- [x] 实现伙伴化用户偏好设置（安静模式等）（第4.6节）*(companion_copywriting_service.dart - CompanionPreferences)*
- [x] 实现 CompanionEffectTracker 伙伴化效果追踪（第4.8节）*(services/companion_effect_tracker.dart)*
- [x] 实现伙伴化与钱龄系统集成（钱龄变化触发）（第4.8节）*(services/companion_integration_service.dart)*
- [x] 实现伙伴化与预算系统集成（超支预警）（第4.8节）*(services/companion_integration_service.dart)*

> **已完成文件** (4个服务文件)：
> - `services/companion_copywriting_service.dart` - 伙伴化文案生成服务（场景识别/情感分析/缓存池/预生成库/用户偏好）
> - `services/companion_event_bus.dart` - 伙伴化事件总线（事件分发/频率控制/优先级队列）
> - `services/companion_effect_tracker.dart` - 伙伴化效果追踪（展示/点击/反馈/指标计算）
> - `services/companion_integration_service.dart` - 伙伴化系统集成（钱龄/预算/记账/成就集成）

#### 无障碍设计模块 (轨道J) ✅ 已完成 (12/12)
- [x] 实现 SemanticLabelService 语义化标签服务
- [x] 完善屏幕阅读器支持（TalkBack/VoiceOver）
- [x] 实现高对比度模式
- [x] 优化触控区域尺寸（最小48x48dp）
- [x] 实现键盘导航支持
- [x] 实现 AccessibleColorService 色彩对比度服务（第5.2节）
- [x] 实现 TouchTargetService 触控目标尺寸服务（第5.3节）
- [x] 实现 FocusManagementService 焦点管理服务（第5.3节）
- [x] 实现无障碍清晰错误提示（关联到字段）（第5.4节）
- [x] 实现危险操作确认与撤销机制（第5.4节）
- [x] 实现无障碍审计工具（自动检测问题）（第5.6节）
- [x] 实现文字缩放支持（200%不丢失内容）（第5.2节）

> **已完成文件** (8个服务文件)：
> - `services/accessibility/semantic_label_service.dart` - 语义化标签服务（金额/日期/交易/钱龄/预算/图表等完整语义支持）
> - `services/accessibility/accessible_color_service.dart` - 色彩对比度服务（WCAG对比度计算/色盲模拟/色彩建议）
> - `services/accessibility/touch_target_service.dart` - 触控目标服务（尺寸检测/间距检查/触觉反馈/无障碍按钮组件）
> - `services/accessibility/focus_management_service.dart` - 焦点管理服务（区域焦点/导航/历史/陷阱/跳过链接）
> - `services/accessibility/high_contrast_service.dart` - 高对比度服务（多种模式/主题生成/颜色工具）
> - `services/accessibility/keyboard_navigation_service.dart` - 键盘导航服务（快捷键注册/列表网格导航）
> - `services/accessibility/accessible_error_service.dart` - 无障碍错误服务（错误管理/表单验证/屏幕阅读器播报）
> - `services/accessibility/dangerous_operation_service.dart` - 危险操作服务（确认对话框/撤销重做栈/过期机制）
> - `services/accessibility/accessibility_audit_service.dart` - 无障碍审计服务（多维度检测/报告生成/评分系统）
> - `services/accessibility/text_scaling_service.dart` - 文字缩放服务（多级别支持/响应式字体/自适应组件）

#### 国际化模块 (轨道K) ✅ 已完成 (7/7)
- [x] 完善多语言支持（中/英/日/韩） *(l10n/app_en.arb, app_zh.arb, app_ja.arb, app_ko.arb - 4语言完整翻译)*
- [x] 实现货币格式本地化 *(services/locale_format_service.dart - 18种货币支持)*
- [x] 实现日期时间本地化 *(services/locale_format_service.dart - 含相对时间格式化)*
- [x] 实现数字格式本地化 *(services/locale_format_service.dart - 含东亚万/亿单位)*
- [x] 实现 RTL 布局支持 *(services/rtl_support_service.dart - 含方向感知组件)*
- [x] 实现国际化文案翻译质量检查机制（第25章） *(services/translation_quality_service.dart + i18n_goal_detection_service.dart)*
- [x] 实现应用内动态语言切换（无需重启）（第25章） *(providers/locale_provider.dart - version机制触发UI刷新)*

#### 测试与质量保障模块 (轨道L) ✅ 已完成 (20/20)

**测试与质量**
- [x] 编写核心业务单元测试（覆盖率≥55%） *(test/services/money_age_test.dart + budget_service_test.dart + transaction_service_test.dart)*
- [x] 编写 Widget 测试（覆盖率≥25%） *(test/widgets/transaction_card_test.dart + budget_card_test.dart)*
- [x] 编写集成测试（覆盖率≥15%） *(test/integration/ - 核心流程测试)*
- [x] 编写 E2E 端到端测试（覆盖率≥5%） *(test/e2e/ - 关键路径测试)*
- [x] 异常处理与容错设计验证 *(services/resilience/ - 断路器+降级策略)*
- [x] 性能优化：图表渲染优化 *(widgets/charts/optimized_charts.dart - LTTB降采样/缓存/动画)*
- [x] 性能优化：列表虚拟化 *(widgets/performance/virtualized_list.dart)*
- [x] 性能优化：内存占用优化 *(services/performance/memory_optimization_service.dart)*
- [x] 创建测试辅助工具与Mock服务 *(test/helpers/test_helpers.dart + mock_services.dart)*

**安全与隐私**
- [x] 实现敏感数据加密存储 *(services/security/sensitive_data_encryption_service.dart - AES-256-GCM加密/密钥轮换)*
- [x] 实现敏感数据展示脱敏 *(services/security/data_masking_service.dart - 银行卡/手机号/身份证/金额脱敏)*
- [x] 权限最小化原则审查 *(已验证 - 仅请求必要权限)*
- [x] 安全漏洞扫描与修复 *(已验证 - 无高危漏洞)*

**可观测性**
- [x] 实现日志采集与分析系统 *(services/observability/logger_service.dart - 多级别/多输出/结构化日志)*
- [x] 实现性能监控指标上报 *(services/observability/metrics_service.dart - 计数器/仪表/直方图/摘要)*
- [x] 实现错误追踪与告警机制 *(services/observability/error_tracking_service.dart - 错误分组/告警规则)*
- [x] 实现用户行为分析埋点 *(services/analytics/user_behavior_analytics_service.dart - 事件追踪/会话管理/业务埋点)*
- [x] 实现 TraceID 全链路追踪（第25章） *(services/observability/trace_service.dart - W3C Trace Context)*

**容错与扩展（第23/24章）**
- [x] 实现 CircuitBreaker 断路器模式（第23章） *(services/circuit_breaker.dart - 已完成)*
- [x] 实现关键操作幂等性设计验证（第23章） *(已验证 - 交易ID唯一性)*
- [x] 实现 FeatureFlag 功能开关系统（第24章） *(services/resilience/feature_flag_service.dart - 目标规则/A-B测试/灰度发布)*
- [x] 实现优雅降级策略（第23章） *(services/resilience/graceful_degradation_service.dart - 多级降级/自动恢复)*

> **已完成文件** (17个新建文件 + 1个已存在)：
> - `services/security/sensitive_data_encryption_service.dart` - AES-256-GCM加密服务（密钥管理/字段级加密/PBKDF2派生）
> - `services/security/data_masking_service.dart` - 数据脱敏服务（银行卡/手机号/身份证/邮箱/姓名/金额脱敏）
> - `services/observability/logger_service.dart` - 结构化日志服务（多级别/多输出/日志轮转/TraceID关联）
> - `services/observability/metrics_service.dart` - 性能指标服务（计数器/仪表/直方图/摘要/计时器）
> - `services/observability/error_tracking_service.dart` - 错误追踪服务（错误分组/告警规则/采样/速率限制）
> - `services/observability/trace_service.dart` - 链路追踪服务（W3C Trace Context/Span管理/上下文传播）
> - `services/resilience/feature_flag_service.dart` - 功能开关服务（目标规则/A-B测试/灰度发布/远程配置）
> - `services/resilience/graceful_degradation_service.dart` - 优雅降级服务（多级降级/健康监控/自动恢复）
> - `widgets/performance/virtualized_list.dart` - 虚拟化列表组件（高性能滚动/懒加载/网格支持）
> - `services/performance/memory_optimization_service.dart` - 内存优化服务（智能缓存/内存监控/自动清理）
> - `services/analytics/user_behavior_analytics_service.dart` - 用户行为分析服务（事件追踪/会话管理/批量上报）
> - `widgets/charts/optimized_charts.dart` - 优化图表组件（LTTB降采样/渲染缓存/动画优化）
> - `test/helpers/test_helpers.dart` - 测试辅助工具（数据生成器/性能测试/断言辅助）
> - `test/helpers/mock_services.dart` - Mock服务集合（数据库/HTTP/AI/同步/通知/分析）
> - `test/services/money_age_test.dart` - 资金年龄单元测试（FIFO计算/等级分类/趋势分析）
> - `test/services/budget_service_test.dart` - 预算服务单元测试（创建/支出/预警/结转）
> - `test/services/transaction_service_test.dart` - 交易服务单元测试（CRUD/过滤/统计/余额）
> - `test/widgets/transaction_card_test.dart` - 交易卡片Widget测试（显示/交互/颜色）
> - `test/widgets/budget_card_test.dart` - 预算卡片Widget测试（进度/预警/概览）
> - `services/circuit_breaker.dart` - 断路器服务（已存在 - 状态管理/自动恢复/注册表）

**发布准备** ✅ 已完成
- [x] ~~实现 1.x → 2.0 数据迁移脚本~~ (无需，无现有用户)
- [x] ~~实现智能升级备份策略~~ (无需，无现有数据)
- [x] ~~设计并实现升级引导流程~~ (无需，新用户直接使用)
- [x] 更新用户文档 *(已完成文档更新)*
- [x] 更新 API 文档 *(已完成API文档)*
- [x] 准备应用商店截图和描述 *(services/growth/aso_service.dart - 多语言元数据)*
- [x] ASO 优化（关键词、描述）*(services/growth/aso_service.dart - 关键词分析/描述优化)*
- [x] 内部测试验证 *(test/ - 单元测试/Widget测试覆盖)*
- [x] ~~灰度发布 (10% → 50% → 100%)~~ (无需，直接全量发布)
- [x] 正式发布与版本监控 *(已配置版本监控)*

#### 高可用架构增强模块 (轨道M) ✅ 已完成 (6/6)

> 📋 **对应设计文档**：第32章 高可用架构设计、第33章 分布式一致性设计、第34章 可扩展性增强设计
> 📊 **目标规模**：支持10万DAU基线，可扩展至100万DAU

**限流与熔断（第32章）**
- [x] 实现多级限流服务（全局/API/用户/IP四层） *(services/resilience/rate_limiter_service.dart)*
  - 令牌桶算法实现
  - 滑动窗口突发检测
  - 白名单支持
  - 10万DAU配置（5000 QPS）

**幂等性设计（第32章）**
- [x] 实现幂等性服务 *(services/resilience/idempotency_service.dart)*
  - 客户端幂等键生成（UUID/内容哈希/混合策略）
  - 请求内容SHA256哈希验证
  - 处理中状态超时与自动重试
  - TTL过期自动清理

**分布式事务（第33章）**
- [x] 实现Saga事务编排器 *(services/resilience/saga_orchestrator.dart)*
  - 编排式Saga模式（步骤依赖关系）
  - 自动补偿机制（反向/全部/选择性策略）
  - 失败重试（可配置次数和延迟）
  - 预定义Saga（记账事务、账单导入）

**缓存一致性（第33章）**
- [x] 实现缓存一致性服务 *(services/resilience/cache_consistency_service.dart)*
  - Cache-Aside模式
  - 延迟双删机制
  - 版本控制防ABA问题
  - LRU淘汰策略

**分布式锁（第33章）**
- [x] 实现分布式锁服务 *(services/resilience/distributed_lock_service.dart)*
  - RedLock算法（5节点容错）
  - 自动续期机制
  - 公平锁FIFO队列
  - 死锁预防（超时自动释放）

**已有组件增强**
- [x] 断路器服务 *(services/circuit_breaker.dart - 已存在)*
- [x] 优雅降级服务 *(services/resilience/graceful_degradation_service.dart - 已存在)*
- [x] 功能开关服务 *(services/resilience/feature_flag_service.dart - 已存在)*

> **已完成文件** (5个新建 + 3个已存在)：
> - `services/resilience/rate_limiter_service.dart` - 多级限流服务（令牌桶/滑动窗口/四层限流）
> - `services/resilience/idempotency_service.dart` - 幂等性服务（幂等键/内容哈希/超时重试）
> - `services/resilience/saga_orchestrator.dart` - Saga事务编排器（补偿机制/步骤依赖/重试策略）
> - `services/resilience/cache_consistency_service.dart` - 缓存一致性服务（Cache-Aside/延迟双删/版本控制）
> - `services/resilience/distributed_lock_service.dart` - 分布式锁服务（RedLock/自动续期/公平锁）
> - `services/circuit_breaker.dart` - 断路器服务（已存在）
> - `services/resilience/graceful_degradation_service.dart` - 优雅降级服务（已存在）
> - `services/resilience/feature_flag_service.dart` - 功能开关服务（已存在）

#### 用户体系与权限模块 (轨道N) ✅ 已完成 (5/5)

> 📋 **对应设计文档**：第35章 用户体系与权限设计
> 📊 **产品策略**：全免费版本，访客可用非AI功能，登录用户可用全部功能

**用户类型与会话管理**
- [x] 实现 UserType 用户类型枚举（访客/登录用户） *(services/user_access_service.dart)*
- [x] 实现 UserSession 用户会话模型 *(services/user_access_service.dart)*
- [x] 实现 UserAccessService 用户访问控制服务 *(services/user_access_service.dart)*
  - 用户类型管理（访客/登录用户）
  - 功能分类定义（基础功能/AI功能）
  - 功能访问权限检查
  - 会话状态管理

**功能权限定义**
- [x] 定义基础功能列表（18+功能，访客可用） *(services/user_access_service.dart)*
  - 手动记账、交易列表、交易搜索
  - 账户管理、分类管理
  - 手动预算、预算追踪、零基预算、小金库
  - 钱龄分析、钱龄趋势
  - 统计报表、图表可视化
  - 数据导入导出
  - 位置服务、习惯追踪、打卡成就
  - 家庭账本、提醒通知、主题设置

- [x] 定义AI功能列表（15+功能，仅登录用户可用） *(services/user_access_service.dart)*
  - AI语音记账、AI图像识别、OCR文字识别
  - AI意图理解、AI智能分类
  - AI预算建议、AI对话交互
  - AI异常检测、AI智能洞察、AI趋势预测
  - AI自学习、AI语音播报
  - AI账单解析、AI交易拆分
  - AI协同学习

> **已完成文件** (1个服务文件)：
> - `services/user_access_service.dart` - 用户访问控制服务（用户类型/功能分类/权限检查/会话管理/功能注册表）

#### 用户增长体系 ✅ 已完成

**NPS监测与口碑优化（第28章）** ✅ 已完成
- [x] 实现应用内NPS调查组件（智能触发时机）*(services/growth/nps_survey_service.dart + widgets/growth/nps_survey_widget.dart)*
- [x] 实现NPS数据采集与分析服务 *(services/growth/nps_survey_service.dart - NPSStatistics分析)*
- [x] 实现用户分群策略（推荐者/被动者/贬损者）*(NPSCategory分群 + getCategoryActions后续动作)*
- [x] 实现针对性反馈收集与响应机制 *(getFollowUpQuestion动态问题)*
- [x] 实现口碑分享素材自动生成 *(widgets/growth/nps_survey_widget.dart - ShareCard/BillSummaryShareCard)*
- [x] 实现成就徽章与里程碑分享功能 *(services/growth/app_review_service.dart - AchievementService)*
- [x] 实现应用商店好评引导流程 *(services/growth/app_review_service.dart - AppReviewService)*

**社交裂变与低成本获客（第29章）** ✅ 已完成
- [x] 实现家庭/情侣记账邀请码机制 *(services/growth/invitation_service.dart - InviteCodeType.family/couple)*
- [x] 实现邀请奖励系统（双向激励）*(DualRewardConfig + MilestoneReward里程碑奖励)*
- [x] 实现社交分享组件（微信/朋友圈/微博）*(ShareChannel枚举 + shareToChannel方法)*
- [x] 实现账单分享卡片设计与生成 *(widgets/growth/nps_survey_widget.dart - BillSummaryShareCard/AchievementShareCard)*
- [x] 实现邀请漏斗数据埋点与分析 *(trackFunnelEvent + getFunnelStats漏斗分析)*
- [x] 实现 A/B 测试框架（邀请文案/奖励策略）*(services/resilience/feature_flag_service.dart - 已支持A/B测试)*

**ASO与内容营销准备** ✅ 已完成
- [x] 完善应用商店关键词优化 *(services/growth/aso_service.dart - getKeywordSuggestions/analyzeKeyword)*
- [x] 准备理财知识小贴士内容库 *(services/growth/content_marketing_service.dart - TipCard内置库)*
- [x] 实现记账技巧卡片分享功能 *(ContentMarketingService + ShareCard组件)*
- [x] 实现用户故事收集与展示模块 *(UserStory模型 + submitUserStory提交)*

> **用户增长体系已完成文件** (6个新建文件)：
> - `services/growth/nps_survey_service.dart` - NPS调查服务（智能触发/数据采集/用户分群/反馈收集）
> - `services/growth/invitation_service.dart` - 邀请服务（邀请码生成/双向奖励/社交分享/漏斗分析）
> - `services/growth/app_review_service.dart` - 应用评价服务（智能引导/成就系统/徽章管理）
> - `services/growth/content_marketing_service.dart` - 内容营销服务（理财技巧库/用户故事/个性化推荐）
> - `services/growth/aso_service.dart` - ASO优化服务（多语言元数据/关键词分析/截图规格）
> - `widgets/growth/nps_survey_widget.dart` - NPS调查组件（评分选择/反馈输入/分享卡片）

> **注**：用户增长体系已完成核心功能实现，可随发布后持续迭代优化

#### 离线能力验证与实现 (横切任务) ✅ 已完成 (22/22)

> 📎 **设计文档**：离线能力等级定义详见[设计文档 第15.3.1节 离线能力矩阵](app_v2_design.md#1531-离线能力矩阵)

**L0 完全离线能力验证**
- [x] 验证手动记账全流程离线可用 *(services/offline_capability_service.dart - FeatureOfflineCapability配置)*
- [x] 验证历史记录查看离线秒开 *(services/offline_capability_service.dart - L0级别功能验证)*
- [x] 验证预算和钱龄本地计算正确 *(services/offline_capability_service.dart - 预算/钱龄功能离线配置)*
- [x] 验证基础图表报表离线数据完整 *(services/offline_capability_service.dart - 报表功能离线配置)*
- [x] 验证本地数据导出无需网络 *(services/offline_capability_service.dart - 数据导出L0配置)*

**L1 增强离线能力实现**
- [x] 实现本地Whisper语音识别降级（85-90%准确率）*(services/offline_asr_service.dart + offline_capability_service.dart降级执行)*
- [x] 实现本地OCR识别降级（90%+金额识别）*(services/multimodal_input_service.dart + offline_capability_service.dart)*
- [x] 实现规则引擎智能分类降级（80-85%准确率）*(services/smart_category_service.dart - LocalMLService)*
- [x] 实现离线洞察预生成机制 *(services/offline_insight_service.dart - 8种洞察类型预生成)*
- [x] 实现联网后云端校验自动纠错流程 *(services/cloud_verification_service.dart - 语音/OCR/分类校验)*

**L2 在线优先能力实现**
- [x] 实现离线操作队列持久化（OfflineQueueService）*(services/offline_queue_service.dart - 已实现)*
- [x] 实现联网后自动同步机制 *(services/auto_sync_service.dart + offline_capability_service.dart)*
- [x] 实现家庭账本离线记账暂存 *(services/family_offline_sync_service.dart - FamilyOfflineStorageService)*
- [x] 实现同步冲突检测与解决策略 *(services/family_offline_sync_service.dart - SyncConflictService + VectorClock)*

**离线状态UI反馈**
- [x] 实现离线状态顶部提示条 *(widgets/offline_status_widgets.dart - OfflineStatusBar)*
- [x] 实现功能降级状态视觉标识 *(widgets/offline_status_widgets.dart - FeatureDegradationBadge)*
- [x] 实现L3仅在线功能禁用提示 *(widgets/offline_status_widgets.dart - OnlineOnlyFeatureWrapper)*
- [x] 实现联网恢复自动刷新机制 *(widgets/offline_status_widgets.dart - NetworkRecoveryRefreshMixin)*

**离线能力测试**
- [x] 编写L0-L3各等级功能离线测试用例 *(test/helpers/offline_test_utils.dart - OfflineCapabilityTestSuite)*
- [x] 实现网络状态模拟测试工具 *(test/helpers/offline_test_utils.dart - NetworkSimulator)*
- [x] 验证飞行模式下核心流程可用 *(test/helpers/offline_test_utils.dart - _runL0Tests)*
- [x] 验证弱网环境下的降级体验 *(test/helpers/offline_test_utils.dart - simulateWeakNetwork)*

> **已完成文件** (6个新建文件 + 4个已有文件集成)：
> - `services/offline_capability_service.dart` - 离线能力核心服务（等级定义/功能矩阵/降级执行/状态监控）
> - `services/offline_insight_service.dart` - 离线洞察预生成服务（8种洞察类型/定时更新/缓存管理）
> - `services/cloud_verification_service.dart` - 云端校验自动纠错服务（语音/OCR/分类校验/自动应用）
> - `services/family_offline_sync_service.dart` - 家庭离线同步服务（暂存队列/向量时钟/冲突解决）
> - `widgets/offline_status_widgets.dart` - 离线状态UI组件（状态条/降级标识/禁用包装/自动刷新）
> - `test/helpers/offline_test_utils.dart` - 离线能力测试工具（网络模拟/L0-L3测试套件）
> - 集成已有：`offline_queue_service.dart`, `auto_sync_service.dart`, `offline_asr_service.dart`, `smart_category_service.dart`

> **注**：测试策略已独立为单独文档，详见 [AI智能记账 2.0 测试策略](./app_v2_test_strategy.md)

> 📎 **相关文档**：完整的3年战略目标（财务/用户/产品/市场）、OKR分解、资源配置及风险管理见[AI智能记账2.0战略分析报告（五看三定）](../AI智能记账2.0战略分析报告（五看三定）.md#8-第二定定目标)

### 2.3 里程碑与验收标准

> 💡 **并行开发里程碑**：采用并行开发模式后，里程碑按功能完整性而非阶段划分。

#### 2.3.1 阶段里程碑定义

```
┌─────────────────────────────────────────────────────────────────────────────────────────┐
│                     并行开发里程碑全景图 (激进模式)                                         │
├─────────────────────────────────────────────────────────────────────────────────────────┤
│                                                                                         │
│  ════════════════════════════════════════════════════════════════════════════════════  │
│  第一阶段里程碑 (基础架构 + 核心引擎)                                                      │
│  ════════════════════════════════════════════════════════════════════════════════════  │
│                                                                                         │
│  ┌───────────────────────────────────┐  ┌───────────────────────────────────┐          │
│  │  M1-A: 数据层完成                   │  │  M1-B: 架构层完成 (并行)           │          │
│  │  ───────────────────────────────  │  │  ───────────────────────────────  │          │
│  │  ✓ 全新Schema设计完成              │  │  ✓ Riverpod 3.x升级完成           │          │
│  │  ✓ ResourcePool模型CRUD完整       │  │  ✓ CrudNotifier统一模式重构       │          │
│  │  ✓ BudgetVault模型CRUD完整        │  │  ✓ OfflineQueueService正常        │          │
│  │  ✓ Transaction模型扩展完成        │  │  ✓ AutoSyncService正常            │          │
│  │  (无需迁移脚本!)                   │  │  ✓ 无编译错误                      │          │
│  │  交付物: 数据层单元测试通过         │  │  交付物: 架构升级验证报告           │          │
│  └───────────────────────────────────┘  └───────────────────────────────────┘          │
│                     │                                    │                              │
│                     └────────────────┬───────────────────┘                              │
│                                      ↓                                                  │
│  ┌───────────────────────────────────┐  ┌───────────────────────────────────┐          │
│  │  M1-C: 钱龄系统完成                 │  │  M1-D: 预算系统完成 (并行)         │          │
│  │  ───────────────────────────────  │  │  ───────────────────────────────  │          │
│  │  ✓ 钱龄计算引擎准确率≥99%          │  │  ✓ 小金库CRUD功能完整             │          │
│  │  ✓ FIFO/LIFO/加权平均策略          │  │  ✓ 预算分配服务正常               │          │
│  │  ✓ 钱龄趋势分析功能                │  │  ✓ 交易-小金库关联≥95%            │          │
│  │  ✓ 钱龄可视化组件                  │  │  ✓ 预算结转管理正常               │          │
│  │  交付物: 钱龄功能演示               │  │  交付物: 预算功能演示              │          │
│  └───────────────────────────────────┘  └───────────────────────────────────┘          │
│                                                                                         │
│  ════════════════════════════════════════════════════════════════════════════════════  │
│  第二阶段里程碑 (功能模块并行开发)                                                         │
│  ════════════════════════════════════════════════════════════════════════════════════  │
│                                                                                         │
│  ┌──────────────┐ ┌──────────────┐ ┌──────────────┐ ┌──────────────┐                   │
│  │ M2-E: 习惯   │ │ M2-F: AI    │ │ M2-G: 体验   │ │ M2-H: 家庭   │                   │
│  │ ──────────   │ │ ──────────   │ │ ──────────   │ │ ──────────   │                   │
│  │ ✓ 订阅追踪   │ │ ✓ 语音≥95%  │ │ ✓ 下钻流畅   │ │ ✓ 账本CRUD   │                   │
│  │ ✓ 拿铁因子   │ │ ✓ NLU≥90%   │ │ ✓ MD3主题    │ │ ✓ 成员管理   │                   │
│  │ ✓ 冲动防护   │ │ ✓ 位置智能   │ │ ✓ 深色模式   │ │ ✓ AA分摊     │                   │
│  │ ✓ 弹性激励   │ │ ✓ OCR增强   │ │ ✓ 微交互     │ │ ✓ 同步服务   │                   │
│  └──────────────┘ └──────────────┘ └──────────────┘ └──────────────┘                   │
│                                                                                         │
│  ════════════════════════════════════════════════════════════════════════════════════  │
│  第三阶段里程碑 (体验打磨 + 质量保障)                                                      │
│  ════════════════════════════════════════════════════════════════════════════════════  │
│                                                                                         │
│  ┌──────────────┐ ┌──────────────┐ ┌──────────────┐ ┌──────────────┐                   │
│  │ M3-I: 情感   │ │ M3-J: 无障碍│ │ M3-K: 国际化 │ │ M3-L: 质量   │                   │
│  │ ──────────   │ │ ──────────   │ │ ──────────   │ │ ──────────   │                   │
│  │ ✓ 伙伴文案   │ │ ✓ TalkBack  │ │ ✓ 中/英/日/韩│ │ ✓ 测试≥55%   │                   │
│  │ ✓ 场景识别   │ │ ✓ VoiceOver │ │ ✓ 货币格式   │ │ ✓ 安全审计   │                   │
│  │ ✓ 动态文案   │ │ ✓ 高对比度   │ │ ✓ 日期时间   │ │ ✓ 性能达标   │                   │
│  │ ✓ 离线支持   │ │ ✓ 触控优化   │ │ ✓ RTL布局    │ │ ✓ 监控配置   │                   │
│  └──────────────┘ └──────────────┘ └──────────────┘ └──────────────┘                   │
│                                                                                         │
│  ════════════════════════════════════════════════════════════════════════════════════  │
│  发布里程碑 (直接全量发布)                                                                 │
│  ════════════════════════════════════════════════════════════════════════════════════  │
│                                                                                         │
│  ┌─────────────────────────────────────────────────────────────────────────────────┐   │
│  │  M-Release: 正式发布                                                              │   │
│  │  ─────────────────────────────────────────────────────────────────────────────  │   │
│  │  验收标准:                                                                        │   │
│  │  ✓ 全部测试通过（单元/Widget/集成/E2E）                                           │   │
│  │  ✓ 安全审计通过（无高危漏洞）                                                     │   │
│  │  ✓ 性能指标达标（启动<3秒，内存<200MB）                                           │   │
│  │  ✓ 应用商店截图和描述准备完成                                                     │   │
│  │  ✓ 内部测试验证通过                                                               │   │
│  │  ✓ 应用商店审核通过                                                               │   │
│  │  ✗ 无需迁移验证 (无现有用户)                                                      │   │
│  │  ✗ 无需灰度发布 (直接全量)                                                        │   │
│  │  交付物: 正式发布版 2.0.0                                                         │   │
│  └─────────────────────────────────────────────────────────────────────────────────┘   │
│                                                                                         │
└─────────────────────────────────────────────────────────────────────────────────────────┘
```

#### 2.3.2 原串行里程碑 (供参考)

<details>
<summary>点击展开原串行开发里程碑详情</summary>

```
┌─────────────────────────────────────────────────────────────────────────────────┐
│                         原开发阶段里程碑 (参考)                                      │
├─────────────────────────────────────────────────────────────────────────────────┤
│                                                                                 │
│  ┌─────────────────────────────────────────────────────────────────────────┐   │
│  │  M1: Alpha 完成                                                          │   │
│  │  ─────────────────────────────────────────────────────────────────────  │   │
│  │  验收标准:                                                                │   │
│  │  ✓ 全新数据库Schema设计完成                                               │   │
│  │  ✓ ResourcePool/BudgetVault模型CRUD完整                                   │   │
│  │  ✓ Riverpod 3.x架构升级完成，无编译错误                                   │   │
│  │  ✓ OfflineQueueService离线队列功能正常                                    │   │
│  │  交付物: 内部测试版APK，架构验证报告                                       │   │
│  └─────────────────────────────────────────────────────────────────────────┘   │
│                                      ↓                                          │
│  ┌─────────────────────────────────────────────────────────────────────────┐   │
│  │  M2: Beta-1 完成                                                          │   │
│  │  ─────────────────────────────────────────────────────────────────────  │   │
│  │  验收标准:                                                                │   │
│  │  ✓ 钱龄计算引擎准确率≥99%（FIFO/LIFO/加权平均）                           │   │
│  │  ✓ 历史数据钱龄重建功能正常（10万条交易<30秒）                             │   │
│  │  ✓ 小金库CRUD及预算分配功能完整                                           │   │
│  │  ✓ 交易-小金库自动关联准确率≥95%                                          │   │
│  │  ✓ 核心功能单元测试覆盖率≥60%                                             │   │
│  │  交付物: 内部Beta测试版，功能演示视频                                      │   │
│  └─────────────────────────────────────────────────────────────────────────┘   │
│                                      ↓                                          │
│  ┌─────────────────────────────────────────────────────────────────────────┐   │
│  │  M3: Beta-2 完成                                                          │   │
│  │  ─────────────────────────────────────────────────────────────────────  │   │
│  │  验收标准:                                                                │   │
│  │  ✓ 订阅追踪识别准确率≥90%                                                 │   │
│  │  ✓ 拿铁因子分析功能可用                                                   │   │
│  │  ✓ 冲动消费干预弹窗触发正确                                               │   │
│  │  ✓ 应急金目标设定与进度追踪正常                                           │   │
│  │  ✓ 习惯培养激励系统积分计算正确                                           │   │
│  │  交付物: 功能演示版                                                        │   │
│  └─────────────────────────────────────────────────────────────────────────┘   │
│                                      ↓                                          │
│  ┌─────────────────────────────────────────────────────────────────────────┐   │
│  │  M4: Beta-3 完成                                                          │   │
│  │  ─────────────────────────────────────────────────────────────────────  │   │
│  │  验收标准:                                                                │   │
│  │  ✓ 语音识别准确率≥95%（常见记账场景）                                      │   │
│  │  ✓ 自然语言理解意图识别准确率≥90%                                         │   │
│  │  ✓ 位置智能功能正常（地理围栏触发延迟<5秒）                                │   │
│  │  ✓ 离线智能分类可用                                                       │   │
│  │  ✓ AI功能测试覆盖率≥80%                                                   │   │
│  │  交付物: 公开Beta版                                                        │   │
│  └─────────────────────────────────────────────────────────────────────────┘   │
│                                      ↓                                          │
│  ┌─────────────────────────────────────────────────────────────────────────┐   │
│  │  M5: RC-1 完成                                                            │   │
│  │  ─────────────────────────────────────────────────────────────────────  │   │
│  │  验收标准:                                                                │   │
│  │  ✓ 数据下钻导航流畅（无卡顿感）                                           │   │
│  │  ✓ Material Design 3主题完整应用                                          │   │
│  │  ✓ 深色模式全面适配                                                       │   │
│  │  ✓ 家庭账本核心功能可用                                                   │   │
│  │  ✓ 极致体验边界场景覆盖                                                   │   │
│  │  ✓ 用户体验评分≥4.0（内部测试）                                           │   │
│  │  交付物: 候选发布版-1                                                      │   │
│  └─────────────────────────────────────────────────────────────────────────┘   │
│                                      ↓                                          │
│  ┌─────────────────────────────────────────────────────────────────────────┐   │
│  │  M6: RC-2 完成                                                            │   │
│  │  ─────────────────────────────────────────────────────────────────────  │   │
│  │  验收标准:                                                                │   │
│  │  ✓ 伙伴化文案覆盖所有核心场景                                             │   │
│  │  ✓ 无障碍设计通过TalkBack/VoiceOver测试                                   │   │
│  │  ✓ 国际化支持（中/英/日/韩）完整                                          │   │
│  │  ✓ 跨设备一致性验证通过                                                   │   │
│  │  ✓ 情感化交互反馈自然                                                     │   │
│  │  交付物: 候选发布版-2                                                      │   │
│  └─────────────────────────────────────────────────────────────────────────┘   │
│                                      ↓                                          │
│  ┌─────────────────────────────────────────────────────────────────────────┐   │
│  │  M7: Release 完成                                                         │   │
│  │  ─────────────────────────────────────────────────────────────────────  │   │
│  │  验收标准:                                                                │   │
│  │  ✓ 全部测试通过（单元/Widget/集成/E2E）                                   │   │
│  │  ✓ 安全审计通过（无高危漏洞）                                             │   │
│  │  ✓ 性能指标达标（启动<3秒，内存<200MB）                                   │   │
│  │  ✓ 应用商店审核通过                                                       │   │
│  │  交付物: 正式发布版2.0.0                                                   │   │
│  └─────────────────────────────────────────────────────────────────────────┘   │
│                                                                                 │
└─────────────────────────────────────────────────────────────────────────────────┘
```

</details>

#### 2.3.3 质量门禁标准

| 门禁类型 | 检查项 | 标准 | 自动化 |
|---------|--------|------|--------|
| **代码门禁** | 单元测试覆盖率 | ≥55% | ✓ CI自动检查 |
| | Widget测试覆盖率 | ≥25% | ✓ CI自动检查 |
| | 代码风格检查 | 0错误 | ✓ flutter analyze |
| | 代码审查 | 至少1人approve | ✓ PR必须 |
| **功能门禁** | 核心功能回归测试 | 100%通过 | ✓ 自动化测试 |
| | 新功能验收测试 | 100%通过 | 部分自动化 |
| | 边界条件测试 | 覆盖已知边界 | 部分自动化 |
| **性能门禁** | 冷启动时间 | ≤3秒 | ✓ 性能基准测试 |
| | 热启动时间 | ≤1秒 | ✓ 性能基准测试 |
| | 内存占用 | ≤200MB | ✓ 性能基准测试 |
| | 列表滚动帧率 | ≥55FPS | ✓ 性能基准测试 |
| **安全门禁** | 静态代码扫描 | 无高危 | ✓ 安全扫描工具 |
| | 敏感数据检查 | 无明文存储 | ✓ 自动化检查 |
| | 依赖漏洞扫描 | 无已知漏洞 | ✓ pub audit |

#### 2.3.4 验收标准详细定义

> 📄 **代码实现**: 见 [代码设计文档 - 代码块394](app_v2_code_design.md#code-394)

#### 2.3.5 发布检查清单

```
┌─────────────────────────────────────────────────────────────────────────────────┐
│                         正式发布前检查清单                                         │
├─────────────────────────────────────────────────────────────────────────────────┤
│                                                                                 │
│  ═══════════════════════════════════════════════════════════════════════════   │
│                              代码与测试                                          │
│  ═══════════════════════════════════════════════════════════════════════════   │
│                                                                                 │
│  □ 所有代码已合并到release分支                                                   │
│  □ 版本号已更新（pubspec.yaml, build.gradle）                                    │
│  □ CHANGELOG已更新                                                              │
│  □ 所有自动化测试通过（CI绿色）                                                  │
│  □ 代码审查全部完成（无pending PR）                                              │
│  □ 技术债务已记录（可接受级别）                                                  │
│                                                                                 │
│  ═══════════════════════════════════════════════════════════════════════════   │
│                              功能与体验                                          │
│  ═══════════════════════════════════════════════════════════════════════════   │
│                                                                                 │
│  □ 核心功能回归测试通过                                                          │
│  □ 新功能验收测试通过                                                            │
│  □ 极端边界场景测试通过                                                          │
│  □ 无障碍设计验证通过                                                            │
│  □ 国际化翻译完整（无遗漏key）                                                   │
│  □ 深色模式适配完整                                                              │
│                                                                                 │
│  ═══════════════════════════════════════════════════════════════════════════   │
│                              安全与隐私                                          │
│  ═══════════════════════════════════════════════════════════════════════════   │
│                                                                                 │
│  □ 安全扫描通过（无高危漏洞）                                                    │
│  □ 敏感数据加密存储验证                                                          │
│  □ 权限声明最小化检查                                                            │
│  □ 隐私政策已更新（如有变更）                                                    │
│  □ 第三方SDK合规性检查                                                           │
│                                                                                 │
│  ═══════════════════════════════════════════════════════════════════════════   │
│                              性能与稳定性                                        │
│  ═══════════════════════════════════════════════════════════════════════════   │
│                                                                                 │
│  □ 性能基准测试通过                                                              │
│  □ 内存泄漏检测通过                                                              │
│  □ ANR/卡顿监控无异常                                                            │
│  □ 崩溃率<0.1%（内部测试期间）                                                    │
│  □ 电量消耗测试通过                                                              │
│                                                                                 │
│  ═══════════════════════════════════════════════════════════════════════════   │
│                              发布准备                                            │
│  ═══════════════════════════════════════════════════════════════════════════   │
│                                                                                 │
│  □ Release APK/AAB已签名                                                        │
│  □ 应用商店截图已更新                                                            │
│  □ 应用描述已更新                                                                │
│  □ 更新日志已准备                                                                │
│  ☒ 灰度发布配置 (无需，直接全量发布)                                              │
│  □ 回滚方案已准备                                                                │
│  □ 监控告警已配置                                                                │
│  □ 客服FAQ已更新                                                                 │
│                                                                                 │
│  ═══════════════════════════════════════════════════════════════════════════   │
│                              版本迁移 (无需，无现有用户)                           │
│  ═══════════════════════════════════════════════════════════════════════════   │
│                                                                                 │
│  ☒ 1.x→2.0迁移脚本 (无需)                                                        │
│  ☒ 迁移成功率验证 (无需)                                                          │
│  ☒ 迁移失败回滚机制 (无需)                                                        │
│  ☒ 升级引导流程 (无需，新用户直接使用)                                            │
│  ☒ 数据完整性校验 (无需)                                                          │
│                                                                                 │
│  审批签字:                                                                       │
│  ├─ 产品负责人: ________________  日期: ________                                │
│  ├─ 技术负责人: ________________  日期: ________                                │
│  ├─ 测试负责人: ________________  日期: ________                                │
│  └─ 安全负责人: ________________  日期: ________                                │
│                                                                                 │
└─────────────────────────────────────────────────────────────────────────────────┘
```

### 2.4 目标达成检测

> 📄 **代码实现**: 见 [代码设计文档 - 代码块395](app_v2_code_design.md#code-395)
